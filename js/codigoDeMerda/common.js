define("compiled/common",function(){}),//     Underscore may be freely distributed under the MIT license.
function(){var e=this,t=e._,i={},n=Array.prototype,o=Object.prototype,r=Function.prototype,a=n.push,s=n.slice,l=n.concat,c=o.toString,u=o.hasOwnProperty,d=n.forEach,h=n.map,g=n.reduce,p=n.reduceRight,m=n.filter,f=n.every,b=n.some,v=n.indexOf,y=n.lastIndexOf,_=Array.isArray,w=Object.keys,k=r.bind,x=function(e){return e instanceof x?e:this instanceof x?void(this._wrapped=e):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.6.0";var C=x.each=x.forEach=function(e,t,n){if(null==e)return e;if(d&&e.forEach===d)e.forEach(t,n);else if(e.length===+e.length){for(var o=0,r=e.length;r>o;o++)if(t.call(n,e[o],o,e)===i)return}else for(var a=x.keys(e),o=0,r=a.length;r>o;o++)if(t.call(n,e[a[o]],a[o],e)===i)return;return e};x.map=x.collect=function(e,t,i){var n=[];return null==e?n:h&&e.map===h?e.map(t,i):(C(e,function(e,o,r){n.push(t.call(i,e,o,r))}),n)};var S="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,i,n){var o=arguments.length>2;if(null==e&&(e=[]),g&&e.reduce===g)return n&&(t=x.bind(t,n)),o?e.reduce(t,i):e.reduce(t);if(C(e,function(e,r,a){o?i=t.call(n,i,e,r,a):(i=e,o=!0)}),!o)throw new TypeError(S);return i},x.reduceRight=x.foldr=function(e,t,i,n){var o=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return n&&(t=x.bind(t,n)),o?e.reduceRight(t,i):e.reduceRight(t);var r=e.length;if(r!==+r){var a=x.keys(e);r=a.length}if(C(e,function(s,l,c){l=a?a[--r]:--r,o?i=t.call(n,i,e[l],l,c):(i=e[l],o=!0)}),!o)throw new TypeError(S);return i},x.find=x.detect=function(e,t,i){var n;return A(e,function(e,o,r){return t.call(i,e,o,r)?(n=e,!0):void 0}),n},x.filter=x.select=function(e,t,i){var n=[];return null==e?n:m&&e.filter===m?e.filter(t,i):(C(e,function(e,o,r){t.call(i,e,o,r)&&n.push(e)}),n)},x.reject=function(e,t,i){return x.filter(e,function(e,n,o){return!t.call(i,e,n,o)},i)},x.every=x.all=function(e,t,n){t||(t=x.identity);var o=!0;return null==e?o:f&&e.every===f?e.every(t,n):(C(e,function(e,r,a){return(o=o&&t.call(n,e,r,a))?void 0:i}),!!o)};var A=x.some=x.any=function(e,t,n){t||(t=x.identity);var o=!1;return null==e?o:b&&e.some===b?e.some(t,n):(C(e,function(e,r,a){return o||(o=t.call(n,e,r,a))?i:void 0}),!!o)};x.contains=x.include=function(e,t){return null==e?!1:v&&e.indexOf===v?-1!=e.indexOf(t):A(e,function(e){return e===t})},x.invoke=function(e,t){var i=s.call(arguments,2),n=x.isFunction(t);return x.map(e,function(e){return(n?t:e[t]).apply(e,i)})},x.pluck=function(e,t){return x.map(e,x.property(t))},x.where=function(e,t){return x.filter(e,x.matches(t))},x.findWhere=function(e,t){return x.find(e,x.matches(t))},x.max=function(e,t,i){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var n=-1/0,o=-1/0;return C(e,function(e,r,a){var s=t?t.call(i,e,r,a):e;s>o&&(n=e,o=s)}),n},x.min=function(e,t,i){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var n=1/0,o=1/0;return C(e,function(e,r,a){var s=t?t.call(i,e,r,a):e;o>s&&(n=e,o=s)}),n},x.shuffle=function(e){var t,i=0,n=[];return C(e,function(e){t=x.random(i++),n[i-1]=n[t],n[t]=e}),n},x.sample=function(e,t,i){return null==t||i?(e.length!==+e.length&&(e=x.values(e)),e[x.random(e.length-1)]):x.shuffle(e).slice(0,Math.max(0,t))};var E=function(e){return null==e?x.identity:x.isFunction(e)?e:x.property(e)};x.sortBy=function(e,t,i){return t=E(t),x.pluck(x.map(e,function(e,n,o){return{value:e,index:n,criteria:t.call(i,e,n,o)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index-t.index}),"value")};var T=function(e){return function(t,i,n){var o={};return i=E(i),C(t,function(r,a){var s=i.call(n,r,a,t);e(o,s,r)}),o}};x.groupBy=T(function(e,t,i){x.has(e,t)?e[t].push(i):e[t]=[i]}),x.indexBy=T(function(e,t,i){e[t]=i}),x.countBy=T(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,i,n){i=E(i);for(var o=i.call(n,t),r=0,a=e.length;a>r;){var s=r+a>>>1;i.call(n,e[s])<o?r=s+1:a=s}return r},x.toArray=function(e){return e?x.isArray(e)?s.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,i){return null==e?void 0:null==t||i?e[0]:0>t?[]:s.call(e,0,t)},x.initial=function(e,t,i){return s.call(e,0,e.length-(null==t||i?1:t))},x.last=function(e,t,i){return null==e?void 0:null==t||i?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,i){return s.call(e,null==t||i?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var $=function(e,t,i){return t&&x.every(e,x.isArray)?l.apply(i,e):(C(e,function(e){x.isArray(e)||x.isArguments(e)?t?a.apply(i,e):$(e,t,i):i.push(e)}),i)};x.flatten=function(e,t){return $(e,t,[])},x.without=function(e){return x.difference(e,s.call(arguments,1))},x.partition=function(e,t){var i=[],n=[];return C(e,function(e){(t(e)?i:n).push(e)}),[i,n]},x.uniq=x.unique=function(e,t,i,n){x.isFunction(t)&&(n=i,i=t,t=!1);var o=i?x.map(e,i,n):e,r=[],a=[];return C(o,function(i,n){(t?n&&a[a.length-1]===i:x.contains(a,i))||(a.push(i),r.push(e[n]))}),r},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=s.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.contains(t,e)})})},x.difference=function(e){var t=l.apply(n,s.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;e>i;i++)t[i]=x.pluck(arguments,""+i);return t},x.object=function(e,t){if(null==e)return{};for(var i={},n=0,o=e.length;o>n;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},x.indexOf=function(e,t,i){if(null==e)return-1;var n=0,o=e.length;if(i){if("number"!=typeof i)return n=x.sortedIndex(e,t),e[n]===t?n:-1;n=0>i?Math.max(0,o+i):i}if(v&&e.indexOf===v)return e.indexOf(t,i);for(;o>n;n++)if(e[n]===t)return n;return-1},x.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(y&&e.lastIndexOf===y)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var o=n?i:e.length;o--;)if(e[o]===t)return o;return-1},x.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),o=0,r=new Array(n);n>o;)r[o++]=e,e+=i;return r};var M=function(){};x.bind=function(e,t){var i,n;if(k&&e.bind===k)return k.apply(e,s.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return i=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(s.call(arguments)));M.prototype=e.prototype;var o=new M;M.prototype=null;var r=e.apply(o,i.concat(s.call(arguments)));return Object(r)===r?r:o}},x.partial=function(e){var t=s.call(arguments,1);return function(){for(var i=0,n=t.slice(),o=0,r=n.length;r>o;o++)n[o]===x&&(n[o]=arguments[i++]);for(;i<arguments.length;)n.push(arguments[i++]);return e.apply(this,n)}},x.bindAll=function(e){var t=s.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return C(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var i={};return t||(t=x.identity),function(){var n=t.apply(this,arguments);return x.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},x.delay=function(e,t){var i=s.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(s.call(arguments,1)))},x.throttle=function(e,t,i){var n,o,r,a=null,s=0;i||(i={});var l=function(){s=i.leading===!1?0:x.now(),a=null,r=e.apply(n,o),n=o=null};return function(){var c=x.now();s||i.leading!==!1||(s=c);var u=t-(c-s);return n=this,o=arguments,0>=u?(clearTimeout(a),a=null,s=c,r=e.apply(n,o),n=o=null):a||i.trailing===!1||(a=setTimeout(l,u)),r}},x.debounce=function(e,t,i){var n,o,r,a,s,l=function(){var c=x.now()-a;t>c?n=setTimeout(l,t-c):(n=null,i||(s=e.apply(r,o),r=o=null))};return function(){r=this,o=arguments,a=x.now();var c=i&&!n;return n||(n=setTimeout(l,t)),c&&(s=e.apply(r,o),r=o=null),s}},x.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return x.partial(t,e)},x.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},x.keys=function(e){if(!x.isObject(e))return[];if(w)return w(e);var t=[];for(var i in e)x.has(e,i)&&t.push(i);return t},x.values=function(e){for(var t=x.keys(e),i=t.length,n=new Array(i),o=0;i>o;o++)n[o]=e[t[o]];return n},x.pairs=function(e){for(var t=x.keys(e),i=t.length,n=new Array(i),o=0;i>o;o++)n[o]=[t[o],e[t[o]]];return n},x.invert=function(e){for(var t={},i=x.keys(e),n=0,o=i.length;o>n;n++)t[e[i[n]]]=i[n];return t},x.functions=x.methods=function(e){var t=[];for(var i in e)x.isFunction(e[i])&&t.push(i);return t.sort()},x.extend=function(e){return C(s.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},x.pick=function(e){var t={},i=l.apply(n,s.call(arguments,1));return C(i,function(i){i in e&&(t[i]=e[i])}),t},x.omit=function(e){var t={},i=l.apply(n,s.call(arguments,1));for(var o in e)x.contains(i,o)||(t[o]=e[o]);return t},x.defaults=function(e){return C(s.call(arguments,1),function(t){if(t)for(var i in t)void 0===e[i]&&(e[i]=t[i])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var F=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var o=c.call(e);if(o!=c.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var r=i.length;r--;)if(i[r]==e)return n[r]==t;var a=e.constructor,s=t.constructor;if(a!==s&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1;i.push(e),n.push(t);var l=0,u=!0;if("[object Array]"==o){if(l=e.length,u=l==t.length)for(;l--&&(u=F(e[l],t[l],i,n)););}else{for(var d in e)if(x.has(e,d)&&(l++,!(u=x.has(t,d)&&F(e[d],t[d],i,n))))break;if(u){for(d in t)if(x.has(t,d)&&!l--)break;u=!l}}return i.pop(),n.pop(),u};x.isEqual=function(e,t){return F(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!(!e||1!==e.nodeType)},x.isArray=_||function(e){return"[object Array]"==c.call(e)},x.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!(!e||!x.has(e,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return u.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.constant=function(e){return function(){return e}},x.property=function(e){return function(t){return t[e]}},x.matches=function(e){return function(t){if(t===e)return!0;for(var i in e)if(e[i]!==t[i])return!1;return!0}},x.times=function(e,t,i){for(var n=Array(Math.max(0,e)),o=0;e>o;o++)n[o]=t.call(i,o);return n},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},x.now=Date.now||function(){return(new Date).getTime()};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};R.unescape=x.invert(R.escape);var j={escape:new RegExp("["+x.keys(R.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(R.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(j[e],function(t){return R[e][t]})}}),x.result=function(e,t){if(null==e)return void 0;var i=e[t];return x.isFunction(i)?i.call(e):i},x.mixin=function(e){C(x.functions(e),function(t){var i=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),P.call(this,i.apply(x,e))}})};var I=0;x.uniqueId=function(e){var t=++I+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,i){var n;i=x.defaults({},i,x.templateSettings);var o=new RegExp([(i.escape||O).source,(i.interpolate||O).source,(i.evaluate||O).source].join("|")+"|$","g"),r=0,a="__p+='";e.replace(o,function(t,i,n,o,s){return a+=e.slice(r,s).replace(D,function(e){return"\\"+N[e]}),i&&(a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),o&&(a+="';\n"+o+"\n__p+='"),r=s+t.length,t}),a+="';\n",i.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(i.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(t)return n(t,x);var l=function(e){return n.call(this,e,x)};return l.source="function("+(i.variable||"obj")+"){\n"+a+"}",l},x.chain=function(e){return x(e).chain()};var P=function(e){return this._chain?x(e).chain():e};x.mixin(x),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];x.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],P.call(this,i)}}),C(["concat","join","slice"],function(e){var t=n[e];x.prototype[e]=function(){return P.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),//     Backbone may be freely distributed under the MIT license.
function(e,t){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(i,n,o){e.Backbone=t(e,o,i,n)});else if("undefined"!=typeof exports){var i=require("underscore");t(e,exports,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,i,n){{var o=e.Backbone,r=[],a=(r.push,r.slice);r.splice}t.VERSION="1.1.2",t.$=n,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=t.Events={on:function(e,t,i){if(!c(this,"on",e,[t,i])||!t)return this;this._events||(this._events={});var n=this._events[e]||(this._events[e]=[]);return n.push({callback:t,context:i,ctx:i||this}),this},once:function(e,t,n){if(!c(this,"once",e,[t,n])||!t)return this;var o=this,r=i.once(function(){o.off(e,r),t.apply(this,arguments)});return r._callback=t,this.on(e,r,n)},off:function(e,t,n){var o,r,a,s,l,u,d,h;if(!this._events||!c(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events=void 0,this;for(s=e?[e]:i.keys(this._events),l=0,u=s.length;u>l;l++)if(e=s[l],a=this._events[e]){if(this._events[e]=o=[],t||n)for(d=0,h=a.length;h>d;d++)r=a[d],(t&&t!==r.callback&&t!==r.callback._callback||n&&n!==r.context)&&o.push(r);o.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1);if(!c(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&u(i,t),n&&u(n,arguments),this},stopListening:function(e,t,n){var o=this._listeningTo;if(!o)return this;var r=!t&&!n;n||"object"!=typeof t||(n=this),e&&((o={})[e._listenId]=e);for(var a in o)e=o[a],e.off(t,n,this),(r||i.isEmpty(e._events))&&delete this._listeningTo[a];return this}},l=/\s+/,c=function(e,t,i,n){if(!i)return!0;if("object"==typeof i){for(var o in i)e[t].apply(e,[o,i[o]].concat(n));return!1}if(l.test(i)){for(var r=i.split(l),a=0,s=r.length;s>a;a++)e[t].apply(e,[r[a]].concat(n));return!1}return!0},u=function(e,t){var i,n=-1,o=e.length,r=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,a);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,a,s);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}},d={listenTo:"on",listenToOnce:"once"};i.each(d,function(e,t){s[t]=function(t,n,o){var r=this._listeningTo||(this._listeningTo={}),a=t._listenId||(t._listenId=i.uniqueId("l"));return r[a]=t,o||"object"!=typeof n||(o=this),t[e](n,o,this),this}}),s.bind=s.on,s.unbind=s.off,i.extend(t,s);var h=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(h.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var o,r,a,s,l,c,u,d;if(null==e)return this;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;a=n.unset,l=n.silent,s=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=i.clone(this.attributes),this.changed={}),d=this.attributes,u=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(o in r)t=r[o],i.isEqual(d[o],t)||s.push(o),i.isEqual(u[o],t)?delete this.changed[o]:this.changed[o]=t,a?delete d[o]:d[o]=t;if(!l){s.length&&(this._pending=n);for(var h=0,g=s.length;g>h;h++)this.trigger("change:"+s[h],this,d[s[h]],n)}if(c)return this;if(!l)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?i.clone(this.changed):!1;var t,n=!1,o=this._changing?this._previousAttributes:this.attributes;for(var r in e)i.isEqual(o[r],t=e[r])||((n||(n={}))[r]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=e?i.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(i){return t.set(t.parse(i,e),e)?(n&&n(t,i,e),void t.trigger("sync",t,i,e)):!1},D(this,e),this.sync("read",this,e)},save:function(e,t,n){var o,r,a,s=this.attributes;if(null==e||"object"==typeof e?(o=e,n=t):(o={})[e]=t,n=i.extend({validate:!0},n),o&&!n.wait){if(!this.set(o,n))return!1}else if(!this._validate(o,n))return!1;o&&n.wait&&(this.attributes=i.extend({},s,o)),void 0===n.parse&&(n.parse=!0);var l=this,c=n.success;return n.success=function(e){l.attributes=s;var t=l.parse(e,n);return n.wait&&(t=i.extend(o||{},t)),i.isObject(t)&&!l.set(t,n)?!1:(c&&c(l,e,n),void l.trigger("sync",l,e,n))},D(this,n),r=this.isNew()?"create":n.patch?"patch":"update","patch"===r&&(n.attrs=o),a=this.sync(r,this,n),o&&n.wait&&(this.attributes=s),a},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,o=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&o(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;D(this,e);var r=this.sync("delete",this,e);return e.wait||o(),r},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||N();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1):!0}});var g=["keys","values","pairs","invert","pick","omit"];i.each(g,function(e){h.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.attributes),i[e].apply(i,t)}});var p=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},f={add:!0,remove:!1};i.extend(p.prototype,s,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,f))},remove:function(e,t){var n=!i.isArray(e);e=n?[e]:i.clone(e),t||(t={});var o,r,a,s;for(o=0,r=e.length;r>o;o++)s=e[o]=this.get(e[o]),s&&(delete this._byId[s.id],delete this._byId[s.cid],a=this.indexOf(s),this.models.splice(a,1),this.length--,t.silent||(t.index=a,s.trigger("remove",s,this,t)),this._removeReference(s,t));return n?e[0]:e},set:function(e,t){t=i.defaults({},t,m),t.parse&&(e=this.parse(e,t));var n=!i.isArray(e);e=n?e?[e]:[]:i.clone(e);var o,r,a,s,l,c,u,d=t.at,g=this.model,p=this.comparator&&null==d&&t.sort!==!1,f=i.isString(this.comparator)?this.comparator:null,b=[],v=[],y={},_=t.add,w=t.merge,k=t.remove,x=!p&&_&&k?[]:!1;for(o=0,r=e.length;r>o;o++){if(l=e[o]||{},a=l instanceof h?s=l:l[g.prototype.idAttribute||"id"],c=this.get(a))k&&(y[c.cid]=!0),w&&(l=l===s?s.attributes:l,t.parse&&(l=c.parse(l,t)),c.set(l,t),p&&!u&&c.hasChanged(f)&&(u=!0)),e[o]=c;else if(_){if(s=e[o]=this._prepareModel(l,t),!s)continue;b.push(s),this._addReference(s,t)}s=c||s,!x||!s.isNew()&&y[s.id]||x.push(s),y[s.id]=!0}if(k){for(o=0,r=this.length;r>o;++o)y[(s=this.models[o]).cid]||v.push(s);v.length&&this.remove(v,t)}if(b.length||x&&x.length)if(p&&(u=!0),this.length+=b.length,null!=d)for(o=0,r=b.length;r>o;o++)this.models.splice(d+o,0,b[o]);else{x&&(this.models.length=0);var C=x||b;for(o=0,r=C.length;r>o;o++)this.models.push(C[o])}if(u&&this.sort({silent:!0}),!t.silent){for(o=0,r=b.length;r>o;o++)(s=b[o]).trigger("add",s,this,t);(u||x&&x.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,o=this.models.length;o>n;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return a.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return i.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return i.invoke(this.models,"get",e)},fetch:function(e){e=e?i.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t(n,i,e),n.trigger("sync",n,i,e)},D(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?i.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,o=t.success;return t.success=function(e,i){t.wait&&n.add(e,t),o&&o(e,i,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e;t=t?i.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_addReference:function(e){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];i.each(b,function(e){p.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.models),i[e].apply(i,t)}});var v=["groupBy","countBy","sortBy","indexBy"];i.each(v,function(e){p.prototype[e]=function(t,n){var o=i.isFunction(t)?t:function(e){return e.get(t)};return i[e](this.models,o,n)}});var y=t.View=function(e){this.cid=i.uniqueId("view"),e||(e={}),i.extend(this,i.pick(e,w)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName","events"];i.extend(y.prototype,s,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=i.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[e[t]]),n){var o=t.match(_),r=o[1],a=o[2];n=i.bind(n,this),r+=".delegateEvents"+this.cid,""===a?this.$el.on(r,n):this.$el.on(r,a,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e["class"]=i.result(this,"className"));var n=t.$("<"+i.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,o){var r=x[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:r,dataType:"json"};if(o.url||(a.url=i.result(n,"url")||N()),null!=o.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",o.emulateJSON&&(a.data._method=r);var s=o.beforeSend;o.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",r),s?s.apply(this,arguments):void 0}}"GET"===a.type||o.emulateJSON||(a.processData=!1),"PATCH"===a.type&&k&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=o.xhr=t.ajax(i.extend(a,o));return n.trigger("request",n,l,o),l};var k=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,E=/\*\w+/g,T=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(C.prototype,s,{initialize:function(){},route:function(e,n,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return t.history.route(e,function(i){var a=r._extractParameters(e,i);r.execute(o,a),r.trigger.apply(r,["route:"+n].concat(a)),r.trigger("route",n,a),t.history.trigger("route",r,n,a)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(T,"\\$&").replace(S,"(?:$1)?").replace(A,function(e,t){return t?e:"([^/?]+)"}).replace(E,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var $=t.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,R=/msie [\w.]+/,j=/\/$/,I=/#.*$/;$.started=!1,i.extend($.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(j,"");e.indexOf(i)||(e=e.slice(i.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if($.started)throw new Error("Backbone.history has already been started");$.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),o=document.documentMode,r=R.exec(navigator.userAgent.toLowerCase())&&(!o||7>=o);if(this.root=("/"+this.root+"/").replace(F,"/"),r&&this._wantsHashChange){var a=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow,this.navigate(n)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var s=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),$.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),i.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!$.started)return!1;t&&t!==!0||(t={trigger:!!t});var i=this.root+(e=this.getFragment(e||""));if(e=e.replace(I,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new $;var O=function(e,t){var n,o=this;n=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,t);var r=function(){this.constructor=n};return r.prototype=o.prototype,n.prototype=new r,e&&i.extend(n.prototype,e),n.__super__=o.prototype,n};h.extend=p.extend=C.extend=y.extend=$.extend=O;var N=function(){throw new Error('A "url" property or function must be specified')},D=function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}};return t}),// Distributed under MIT license
function(e,t){if("function"==typeof define&&define.amd)define("marionette",["backbone","underscore"],function(i,n){return e.Marionette=t(e,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=t(e,i,n)}else e.Marionette=t(e,e.Backbone,e._)}(this,function(e,t,i){function n(e,t){var i=new Error(e);throw i.name=t||"Error",i}// Distributed under MIT license
!function(e,t){var i=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){return e===i?(delete this._indexByCustom[t],!0):void 0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(n,function(e){i.prototype[e]=function(){var i=t.values(this._views),n=[i].concat(t.toArray(arguments));return t[e].apply(t,n)}}),i}(e,t),e.ChildViewContainer.VERSION="0.1.4",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer}(t,i),// Distributed under MIT license
function(e,t){var i=e.Wreqr,n=e.Wreqr={};return e.Wreqr.VERSION="1.3.1",e.Wreqr.noConflict=function(){return e.Wreqr=i,this},n.Handlers=function(e,t){var i=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,i){var n=null;t.isObject(e)&&!t.isFunction(e)&&(n=e.context,e=e.callback),this.setHandler(i,e,n)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(e,t),n.CommandStorage=function(){var i=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(i.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var i=this.getCommands(e);i.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),i}(),n.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var i=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,i)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,i,n){var o=this.storage.getCommands(e);t.each(o.instances,function(e){i.apply(n,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var i,n=e.storageType||this.storageType;i=t.isFunction(n)?new n:n,this.storage=i}})}(n),n.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);return this.hasHandler(e)?this.getHandler(e).apply(this,t):void 0}})}(n),n.EventAggregator=function(e,t){var i=function(){};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events),i}(e,t),n.Channel=function(){var i=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(i.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,i,n){if(i){n=n||this;var o="vent"===e?"on":"setHandler";t.each(i,function(i,r){this[e][o](r,t.bind(i,n))},this)}}}),i}(n),n.radio=function(e){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(i.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var i=this._channels[t];return i||(i=new e.Channel(t),this._channels[t]=i),i},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(n[e],function(t){this[e][t]=o(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},o=function(e,t,i){return function(n){var o=e._getChannel(n)[t],r=Array.prototype.slice.call(arguments,1);return o[i].apply(o,r)}};return new i}(n),e.Wreqr}(t,i);var o=e.Marionette,r=t.Marionette={};r.VERSION="2.1.0",r.noConflict=function(){return e.Marionette=o,this},t.Marionette=r,r.Deferred=t.$.Deferred;var a=Array.prototype.slice;return r.extend=t.Model.extend,r.getOption=function(e,t){if(e&&t){var i;return i=e.options&&void 0!==e.options[t]?e.options[t]:e[t]}},r.proxyGetOption=function(e){return r.getOption(this,e)},r.normalizeMethods=function(e){var t={};return i.each(e,function(e,n){i.isFunction(e)||(e=this[e]),e&&(t[n]=e)},this),t},r.normalizeUIKeys=function(e,t){return"undefined"!=typeof e?(i.each(i.keys(e),function(i){var n=/@ui\.[a-zA-Z_$0-9]*/g;i.match(n)&&(e[i.replace(n,function(e){return t[e.slice(4)]})]=e[i],delete e[i])}),e):void 0},r.actAsCollection=function(e,t){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){e[n]=function(){var e=i.values(i.result(this,t)),o=[e].concat(i.toArray(arguments));return i[n].apply(i,o)}})},r.triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi,n=function(n){var o,r="on"+n.replace(t,e),a=this[r];return i.isFunction(a)&&(o=a.apply(this,i.tail(arguments))),i.isFunction(this.trigger)&&this.trigger.apply(this,arguments),o};return n}(),r.MonitorDOMRefresh=function(e){function n(e){e._isShown=!0,r(e)}function o(e){e._isRendered=!0,r(e)}function r(e){e._isShown&&e._isRendered&&a(e)&&i.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}function a(i){return t.$.contains(e,i.el)}return function(e){e.listenTo(e,"show",function(){n(e)}),e.listenTo(e,"render",function(){o(e)})}}(document.documentElement),function(e){function t(e,t,o,r){var a=r.split(/\s+/);i.each(a,function(i){var r=e[i];r||n('Method "'+i+'" was configured as an event handler, but does not exist.'),e.listenTo(t,o,r)})}function o(e,t,i,n){e.listenTo(t,i,n)}function r(e,t,n,o){var r=o.split(/\s+/);i.each(r,function(i){var o=e[i];e.stopListening(t,n,o)})}function a(e,t,i,n){e.stopListening(t,i,n)}function s(e,t,n,o,r){t&&n&&(i.isFunction(n)&&(n=n.call(e)),i.each(n,function(n,a){i.isFunction(n)?o(e,t,a,n):r(e,t,a,n)}))}e.bindEntityEvents=function(e,i,n){s(e,i,n,o,t)},e.unbindEntityEvents=function(e,t,i){s(e,t,i,a,r)},e.proxyBindEntityEvents=function(t,i){return e.bindEntityEvents(this,t,i)},e.proxyUnbindEntityEvents=function(t,i){return e.unbindEntityEvents(this,t,i)}}(r),r.Callbacks=function(){this._deferred=r.Deferred(),this._callbacks=[]},i.extend(r.Callbacks.prototype,{add:function(e,t){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),n.then(function(i){t&&(i.context=t),e.call(i.context,i.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=r.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),r.Controller=function(e){this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},r.Controller.extend=r.extend,i.extend(r.Controller.prototype,t.Events,{destroy:function(){var e=a.call(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.triggerMethod.apply(this,["destroy"].concat(e)),this.stopListening(),this.off(),this},triggerMethod:r.triggerMethod,getOption:r.proxyGetOption}),r.Object=function(e){this.options=i.extend({},i.result(this,"options"),e),this.initialize(this.options)},r.Object.extend=r.extend,i.extend(r.Object.prototype,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening()},triggerMethod:r.triggerMethod,getOption:r.proxyGetOption,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),i.extend(r.Object.prototype,t.Events),r.Region=function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,this.el||n('An "el" must be specified for a region.',"NoElError"),this.$el=this.getEl(this.el),this.initialize){var i=a.apply(arguments);this.initialize.apply(this,i)}},i.extend(r.Region,{buildRegion:function(e,t){return i.isString(e)?this._buildRegionFromSelector(e,t):e.selector||e.el||e.regionClass?this._buildRegionFromObject(e,t):i.isFunction(e)?this._buildRegionFromRegionClass(e):void n("Improper region configuration type. Please refer to http://marionettejs.com/docs/marionette.region.html#region-configuration-types")},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,n){var o=e.regionClass||n,r=i.omit(e,"selector","regionClass");e.selector&&!r.el&&(r.el=e.selector);var a=new o(r);return e.parentEl&&(a.getEl=function(n){if(i.isObject(n))return t.$(n);var o=e.parentEl;return i.isFunction(o)&&(o=o()),o.find(n)}),a},_buildRegionFromRegionClass:function(e){return new e}}),i.extend(r.Region.prototype,t.Events,{show:function(e,t){this._ensureElement();var n=t||{},o=e!==this.currentView,r=!!n.preventDestroy,a=!!n.forceShow,s=!!this.currentView,l=!r&&o;l&&this.empty();var c=o||a;return c?(e.once("destroy",i.bind(this.empty,this)),e.render(),s&&this.triggerMethod("before:swap",e),this.triggerMethod("before:show",e),i.isFunction(e.triggerMethod)?e.triggerMethod("before:show"):this.triggerMethod.call(e,"before:show"),this.attachHtml(e),this.currentView=e,s&&this.triggerMethod("swap",e),this.triggerMethod("show",e),i.isFunction(e.triggerMethod)?e.triggerMethod("show"):this.triggerMethod.call(e,"show"),this):this},_ensureElement:function(){i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),this.$el&&0!==this.$el.length||n('An "el" '+this.$el.selector+" must exist in DOM")},getEl:function(e){return t.$(e)},attachHtml:function(e){this.el.innerHTML="",this.el.appendChild(e.el)},empty:function(){var e=this.currentView;if(e)return this.triggerMethod("before:empty",e),this._destroyView(),this.triggerMethod("empty",e),delete this.currentView,this},_destroyView:function(){var e=this.currentView;e.destroy&&!e.isDestroyed?e.destroy():e.remove&&e.remove()},attachView:function(e){return this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this},getOption:r.proxyGetOption,triggerMethod:r.triggerMethod}),r.Region.extend=r.extend,r.RegionManager=function(e){var t=e.Controller.extend({constructor:function(t){this._regions={},e.Controller.call(this,t)},addRegions:function(e,t){i.isFunction(e)&&(e=e.apply(this,arguments));var n={};return i.each(e,function(e,o){i.isString(e)&&(e={selector:e}),e.selector&&(e=i.defaults({},e,t));var r=this.addRegion(o,e);n[o]=r},this),n},addRegion:function(t,n){var o,r=i.isObject(n),a=i.isString(n),s=!!n.selector;return o=a||r&&s?e.Region.buildRegion(n,e.Region):i.isFunction(n)?e.Region.buildRegion(n,e.Region):n,this.triggerMethod("before:add:region",t,o),this._store(t,o),this.triggerMethod("add:region",t,o),o},get:function(e){return this._regions[e]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return i.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return i.each(e,function(e){e.empty()},this),e},destroy:function(){return this.removeRegions(),e.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete this._regions[e],this._setLength(),this.triggerMethod("remove:region",e,t)},_setLength:function(){this.length=i.size(this._regions)}});return e.actAsCollection(t.prototype,"_regions"),t}(r),r.TemplateCache=function(e){this.templateId=e},i.extend(r.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new r.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=a.call(arguments),i=t.length;if(i>0)for(e=0;i>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(r.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var i=t.$(e).html();return i&&0!==i.length||n('Could not find template: "'+e+'"',"NoTemplateError"),i},compileTemplate:function(e){return i.template(e)}}),r.Renderer={render:function(e,t){e||n("Cannot render the template since its false, null or undefined.","TemplateNotFoundError");var i;return(i="function"==typeof e?e:r.TemplateCache.get(e))(t)}},r.View=t.View.extend({constructor:function(e){i.bindAll(this,"render"),this.options=i.extend({},i.result(this,"options"),i.isFunction(e)?e.call(this):e),this.events=this.normalizeUIKeys(i.result(this,"events")),i.isObject(this.behaviors)&&new r.Behaviors(this),t.View.apply(this,arguments),r.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,a.call(arguments,1))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return i.isFunction(t)&&(t=t.call(this)),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"ui"),n=i.result(this,"_uiBindings");return r.normalizeUIKeys(e,n||t)},configureTriggers:function(){if(this.triggers){var e={},t=this.normalizeUIKeys(i.result(this,"triggers"));return i.each(t,function(t,n){var o=i.isObject(t),r=o?t.event:t;e[n]=function(e){if(e){var i=e.preventDefault,n=e.stopPropagation,a=o?t.preventDefault:i,s=o?t.stopPropagation:n;a&&i&&i.apply(e),s&&n&&n.apply(e)}var l={view:this,model:this.model,collection:this.collection};this.triggerMethod(r,l)}},this),e}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),this},_delegateDOMEvents:function(e){e=e||this.events,i.isFunction(e)&&(e=e.call(this)),e=this.normalizeUIKeys(e);var n={},o=i.result(this,"behaviorEvents")||{},r=this.configureTriggers();i.extend(n,o,e,r),t.View.prototype.delegateEvents.call(this,n)},undelegateEvents:function(){var e=a.call(arguments);return t.View.prototype.undelegateEvents.apply(this,e),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),this},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed){var e=new Error("Cannot use a view thats already been destroyed.");throw e.name="ViewDestroyedError",e}},destroy:function(){if(!this.isDestroyed){var e=a.call(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.remove(),this}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(i.keys(e),function(t){var i=e[t];this.ui[t]=this.$(i)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},triggerMethod:r.triggerMethod,normalizeMethods:r.normalizeMethods,getOption:r.proxyGetOption,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),r.ItemView=r.View.extend({constructor:function(){r.View.apply(this,arguments)},serializeData:function(){var e={};return this.model?e=i.partial(this.serializeModel,this.model).apply(this,arguments):this.collection&&(e={items:i.partial(this.serializeCollection,this.collection).apply(this,arguments)}),e},serializeCollection:function(e){return e.toJSON.apply(e,a.call(arguments,1))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e!==!1){e||n("Cannot render the template since it is null or undefined.","UndefinedTemplateError");var t=this.serializeData();t=this.mixinTemplateHelpers(t);var i=r.Renderer.render(e,t,this);return this.attachElContent(i),this}},attachElContent:function(e){return this.$el.html(e),this},destroy:function(){return this.isDestroyed?void 0:r.View.prototype.destroy.apply(this,arguments)}}),r.CollectionView=r.View.extend({childViewEventPrefix:"childview",constructor:function(e){var t=e||{};this.sort=i.isUndefined(t.sort)?!0:t.sort,this._initChildViewStorage(),r.View.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&i.invoke(this._bufferedChildren,"triggerMethod","before:show")},_triggerShowBufferedChildren:function(){this._isShown&&(i.each(this._bufferedChildren,function(e){i.isFunction(e.triggerMethod)?e.triggerMethod("show"):r.triggerMethod.call(e,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e){this.destroyEmptyView();var t=this.getChildView(e),i=this.collection.indexOf(e);this.addChild(e,t,i)},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},onShowCalled:function(){this.children.each(function(e){i.isFunction(e.triggerMethod)?e.triggerMethod("show"):r.triggerMethod.call(e,"show")})},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},resortView:function(){this.render()},_sortViews:function(){var e=this.collection.find(function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this);e&&this.resortView()},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var e;this.collection.each(function(t,i){e=this.getChildView(t),this.addChild(t,e,i)},this)},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new t.Model;this.addEmptyView(i,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.destroyChildren(),delete this._showingEmptyView)},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var n=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(n)&&(n=n.call(this));var o=this.buildChildView(e,t,n);this._isShown&&this.triggerMethod.call(o,"before:show"),this.children.add(o),this.renderChildView(o,-1),this._isShown&&this.triggerMethod.call(o,"show")},getChildView:function(){var e=this.getOption("childView");return e||n('A "childView" must be specified',"NoChildViewError"),e},addChild:function(e,t,n){var o=this.getOption("childViewOptions");i.isFunction(o)&&(o=o.call(this,e,n));var r=this.buildChildView(e,t,o);return this._updateIndices(r,!0,n),this._addChildView(r,n),r},_updateIndices:function(e,t,i){this.sort&&(t?(e._index=i,this.children.each(function(t){t._index>=e._index&&t._index++})):this.children.each(function(t){t._index>=e._index&&t._index--}))},_addChildView:function(e,t){this.proxyChildEvents(e),this.triggerMethod("before:add:child",e),this.children.add(e),this.renderChildView(e,t),this._isShown&&!this.isBuffering&&(i.isFunction(e.triggerMethod)?e.triggerMethod("show"):r.triggerMethod.call(e,"show")),this.triggerMethod("add:child",e)},renderChildView:function(e,t){return e.render(),this.attachHtml(this,e,t),e},buildChildView:function(e,t,n){var o=i.extend({model:e},n);return new t(o)},removeChildView:function(e){return e&&(this.triggerMethod("before:remove:child",e),e.destroy?e.destroy():e.remove&&e.remove(),this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1)),e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},attachHtml:function(e,t,i){e.isBuffering?(e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t)):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i,n=this.sort&&t<this.children.length-1;return n&&(i=this.children.find(function(e){return e._index===t+1})),i?(i.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?void 0:(this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),r.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(){var e=this.children.map(i.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),e},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var n=a.call(arguments),o=n[0],r=this.normalizeMethods(i.result(this,"childEvents"));n[0]=t+":"+o,n.splice(1,0,e),"undefined"!=typeof r&&i.isFunction(r[o])&&r[o].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)},this)}}),r.CompositeView=r.CollectionView.extend({constructor:function(){r.CollectionView.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))})},getChildView:function(){var e=this.getOption("childView")||this.constructor;return e||n('A "childView" must be specified',"NoChildViewError"),e},serializeData:function(){var e={};return this.model&&(e=i.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&r.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=r.Renderer.render(t,e,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var i=this.getChildViewContainer(e);i.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this);t.append(e.el)},getChildViewContainer:function(e){if("$childViewContainer"in e)return e.$childViewContainer;var t,o=r.getOption(e,"childViewContainer");if(o){var a=i.isFunction(o)?o.call(e):o;t="@"===a.charAt(0)&&e.ui?e.ui[a.substr(4)]:e.$(a),t.length<=0&&n('The specified "childViewContainer" was not found: '+e.childViewContainer,"ChildViewContainerMissingError")}else t=e.$el;return e.$childViewContainer=t,t},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),r.LayoutView=r.ItemView.extend({regionClass:r.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),r.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),r.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.regionManager.destroy(),r.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(e,t){this.triggerMethod("before:region:add",e);var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return this.triggerMethod("before:region:remove",e),delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t=this,i={regionClass:this.getOption("regionClass"),parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,i)},_initializeRegions:function(e){var t;this._initRegionManager(),t=i.isFunction(this.regions)?this.regions(e):this.regions||{};var n=this.getOption.call(e,"regions");i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.emptyRegions(),this.regionManager.each(function(e){e.reset()})},getRegionManager:function(){return new r.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})}}),r.Behavior=function(e,t){function i(t,i){this.view=i,this.defaults=e.result(this,"defaults")||{},this.options=e.extend({},this.defaults,t),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return e.extend(i.prototype,t.Events,{initialize:function(){},destroy:function(){this.stopListening()},triggerMethod:r.triggerMethod,getOption:r.proxyGetOption,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),i.extend=r.extend,i}(i,t),r.Behaviors=function(e,t){function i(e,o){o=i.parseBehaviors(e,o||t.result(e,"behaviors")),i.wrap(e,o,t.keys(n))}var n={setElement:function(e,i){return e.apply(this,t.tail(arguments,2)),t.each(i,function(e){e.$el=this.$el,e.el=this.el},this),this},destroy:function(e,i){var n=t.tail(arguments,2);return e.apply(this,n),t.invoke(i,"destroy",n),this},bindUIElements:function(e,i){e.apply(this),t.invoke(i,e)},unbindUIElements:function(e,i){e.apply(this),t.invoke(i,e)},triggerMethod:function(e,i){var n=t.tail(arguments,2);e.apply(this,n),t.each(i,function(t){e.apply(t,n)})},delegateEvents:function(i,n){var o=t.tail(arguments,2);return i.apply(this,o),t.each(n,function(t){e.bindEntityEvents(t,this.model,e.getOption(t,"modelEvents")),e.bindEntityEvents(t,this.collection,e.getOption(t,"collectionEvents"))},this),this},undelegateEvents:function(i,n){var o=t.tail(arguments,2);return i.apply(this,o),t.each(n,function(t){e.unbindEntityEvents(t,this.model,e.getOption(t,"modelEvents")),e.unbindEntityEvents(t,this.collection,e.getOption(t,"collectionEvents"))},this),this},behaviorEvents:function(i,n){var o={},r=t.result(this,"ui");return t.each(n,function(i,n){var a={},s=t.clone(t.result(i,"events"))||{},l=t.result(i,"ui"),c=t.extend({},r,l);s=e.normalizeUIKeys(s,c),t.each(t.keys(s),function(e){var o=new Array(n+2).join(" "),r=e+o,l=t.isFunction(s[e])?s[e]:i[s[e]];a[r]=t.bind(l,i)}),o=t.extend(o,a)}),o}};return t.extend(i,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored.See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(e,n){return e.behaviorClass?e.behaviorClass:t.isFunction(i.behaviorsLookup)?i.behaviorsLookup.apply(this,arguments)[n]:i.behaviorsLookup[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,o){var r=i.getBehaviorClass(n,o),a=new r(n,e),s=i.parseBehaviors(e,t.result(a,"behaviors"));return[a].concat(s)}).flatten().value()},wrap:function(e,i,o){t.each(o,function(o){e[o]=t.partial(n[o],e[o],i)})}}),i}(r,i),r.AppRouter=t.Router.extend({constructor:function(e){t.Router.apply(this,arguments),this.options=e||{};var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){var n=i.invert(this.getOption("appRoutes"))[e];i.isFunction(this.onRoute)&&this.onRoute(e,n,t)},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,o){var r=e[o];r||n('Method "'+o+'" was not found on the controller'),this.route(t,o,i.bind(r,e))},getOption:r.proxyGetOption}),r.Application=function(e){this._initializeRegions(e),this._initCallbacks=new r.Callbacks,this.submodules={},i.extend(this,e),this._initChannel()},i.extend(r.Application.prototype,t.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var i=r.Module.getClass(t),n=a.call(arguments);return n.unshift(this),i.create.apply(i,n)},getRegionManager:function(){return new r.RegionManager},_initializeRegions:function(e){var t=i.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var n=r.getOption(e,"regions");return i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this.listenTo(this._regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this._regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this._regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres},triggerMethod:r.triggerMethod,getOption:r.proxyGetOption}),r.Application.extend=r.extend,r.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,i.isFunction(this.initialize)&&this.initialize(e,t,this.options)
},r.Module.extend=r.extend,i.extend(r.Module.prototype,t.Events,{initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var o=i.flatten([this,this.app,t,r,t.$,i,n]);e.apply(this,o)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new r.Callbacks,this._finalizerCallbacks=new r.Callbacks},triggerMethod:r.triggerMethod}),i.extend(r.Module,{create:function(e,t,n){var o=e,r=a.call(arguments);r.splice(0,3),t=t.split(".");var s=t.length,l=[];return l[s-1]=n,i.each(t,function(t,i){var a=o;o=this._getModule(a,t,e,n),this._addModuleDefinition(a,o,l[i],r)},this),o},_getModule:function(e,t,n,o){var r=i.extend({},o),a=this.getClass(o),s=e[t];return s||(s=new a(t,n,r),e[t]=s,e.submodules[t]=s),s},getClass:function(e){var t=r.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var o=this._getDefine(i),r=this._getStartWithParent(i,t);o&&t.addDefinition(o,n),this._addStartWithParent(e,t,r)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof r.Module?(n=t.constructor.prototype.startWithParent,i.isUndefined(n)?!0:n):i.isObject(e)?(n=e.startWithParent,i.isUndefined(n)?!0:n):!0},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof r.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),r}),define("log",["globals","underscore"],function(e){var t=window.console?window.console:{};t.log=t.log||function(){},t.time=t.time||function(){},t.timeEnd=t.timeEnd||function(){},t.error=t.error||function(){},e.JS_LOGS_IGNORE=e.JS_LOGS_IGNORE||[],Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),i=this,n=function(){},o=function(){return i.apply(this instanceof n&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,o.prototype=new n,o}),Function.prototype.bind&&window.console&&"object"==typeof t.log&&(t.old_browser=!0,_.each(["log","info","warn","error","assert","dir","clear","profile","profileEnd"],function(e){t[e]=this.bind(t[e],t)},Function.prototype.call));var i=function(i,o){if(!i)return function(){t.error("Invalid log type: "+i)};if(n&&n[i])return function(){t.error("Log type "+i+" already exists")};o=o||"color: black",t.watch&&(o=null),t.old_browser&&(o=null);var r=function(r){return r=r||"log",function(){if(e.JS_DEBUG&&!_.contains(e.JS_LOGS_IGNORE,i)){var a=Array.prototype.slice.call(arguments,0);if(_.contains(["log","error","important"],r)){var s=i;if("important"==r)var s=i+" >";e.FRAMED&&(s="FRAME "+s),"log"!=s&&(o?(o.match(/background-color/)?o="padding:1px 5px 1px 4px;border-radius:2px;"+o:s+=":",a.unshift(o),a.unshift("%c"+s)):a.unshift(s+":"))}n&&n[i]&&"timeEnd"==r&&n[i]("timer:");var l=t[r]?r:"log";t[l].apply(t,a)}}},a=r("log");return a.error=r("error"),a.important=r("important"),a.time=r("time"),a.timeEnd=r("timeEnd"),n&&(n[i]=a),a},n=i("log","background-color: grey; color: white");return n.create=i,n.module=n.create("amd","color:grey"),n.module("lib/log"),n}),define("lib/backbone.when",["require","backbone","log"],function(e){var t=e("backbone"),i=e("log");i.module("lib/backbone.when");var n=i,o={};return o.applyTo=function(e){e&&e.prototype&&e.prototype.on===t.Events.on?_.extend(e.prototype,o.Events):n.error("This object does not have Backbone.Events")},o.Events={trigger:function(e){this._past_events||(this._past_events={});var i=Array.prototype.slice.call(arguments,1);return this._past_events[e]=i,t.Events.trigger.apply(this,arguments)},forget:function(e){this._past_events||(this._past_events={}),delete this._past_events[e]},when:function(e,t,i){this._past_events||(this._past_events={});var n=this._past_events[e];return n?(t.apply(i,n),this):(this.once.apply(this,arguments),this)},whenever:function(e,t,i){this._past_events||(this._past_events={});var n=this._past_events[e];return n&&t.apply(i,n),this.on.apply(this,arguments),this}},o}),define("model/basemodel",["require","globals","backbone","lib/backbone.when","log"],function(e){var t=e("globals"),i=e("backbone"),n=e("lib/backbone.when"),o=e("log");o.module("model/basemodel");var r=o,a=i.Model.extend({initialize:function(e,t){t||(t={}),i.Model.prototype.initialize.apply(this,arguments),this.calculated_values=_.extend({},this.calculated_values,t.calculated_values)},sync:function(e,n,o){o=o||{},"/ajax"==this.url.substring(0,5)&&(o.emulateJSON=!0,_.defaults(o,{type:o.type||"POST",success:function(e){r("There was generic ajax success.",e)},error:function(e){r("There was a generic ajax error.",e)},data:n.toJSON()}),o.data._authentication_token=t.AUTH_TOKEN),i.Model.prototype.sync.apply(this,arguments)},get:function(e){var t;return t=this.calculated_values&&this.calculated_values[e]?this.calculated_values[e].call(this):i.Model.prototype.get.apply(this,arguments),t instanceof Array?t.slice(0):t},set:function(e,t){return"string"==typeof e&&_.isFunction(t)?void(this.calculated_values[e]=t):i.Model.prototype.set.apply(this,arguments)},toJSON:function(){var e=i.Model.prototype.toJSON.apply(this,arguments);return _.each(this.calculated_values,function(t,i){e[i]=t.call(this)},this),e},is:function(){var e=this.get.apply(this,arguments);return e===!0},isNot:function(){var e=this.get.apply(this,arguments);return e!==!0}});return n.applyTo(a),a}),define("model/viewport",["require","globals","model/basemodel","log"],function(e){var t=(e("globals"),e("model/basemodel")),i=e("log");i.module("model/viewport");var n=i.create("viewport","background-color:darkslategray;color:white"),o=$("html"),r=$(window),a=["small","medium","large"],s=_.map(a,function(e){return"viewport-"+e}),l=t.extend({defaults:{size:"",small:null,medium:null,large:null,mobile_width:null},initialize:function(){t.prototype.initialize.apply(this,arguments),this.listenTo(AboutMe,"window:resize window:orientationchange",this.checkViewportSize),this.on("change:size",this.onChangeSize),this.on("change:small",this.onChangeSmall),this.on("change:medium",this.onChangeMedium),this.on("change:large",this.onChangeLarge);var e=[];_.each(a,function(t){e.push("viewport:"+t),e.push("viewport:not:"+t)}),_.each(e,function(e){AboutMe.on(e,function(){n(e)})}),this.initializeEvents(),this.checkViewportSize();var i=this;define("viewport",[],function(){return i})},onEvent:function(e){n("viewport event:",e)},initializeEvents:function(){r.on("resize",_.debounce(function(){AboutMe.trigger("window:resize")},100)),r.on("scroll",_.debounce(function(){AboutMe.trigger("window:scroll")},500)),r.on("orientationchange",function(){AboutMe.trigger("window:orientationchange")})},checkViewportSize:function(){var e,t={};e=Modernizr.mq("only screen and (max-width: 640px)")?"small":Modernizr.mq("only screen and (min-width: 641px) and (max-width: 1024px)")?"medium":"large",t.size=e,_.each(a,function(e){t[e]=!1}),t[e]=!0,this.set(t)},onChangeSize:function(){var e=this.get("size");this.setMobileWidth(),this.setViewportClass(e)},setViewportClass:_.debounce(function(e){var t="viewport-"+e;if(!o.hasClass(t)){o.removeClass(s.join(" ")).addClass(t),o.removeClass("viewport-not-"+e);var i=[];_.each(a,function(t){t!==e&&i.push("viewport-not-"+t)}),o.addClass(i.join(" "))}},100),onChangeSmall:function(){this.triggerSizeChangeEvent("small")},onChangeMedium:function(){this.triggerSizeChangeEvent("medium")},onChangeLarge:function(){this.triggerSizeChangeEvent("large")},triggerSizeChangeEvent:function(e){var t=this.is(e);AboutMe.trigger(t?"viewport:"+e:"viewport:not:"+e)},setMobileWidth:function(){var e=Math.min(r.width(),640);this.isNot("small")&&(e=580),this.set("mobile_width",e)}});return l}),/**
 * @license
 * Detect Mobile Browsers
 * http://detectmobilebrowsers.com/
 * converted to an AMD module by pascal
 */
define("vendor/detectmobilebrowser",[],function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}),define("model/browser",["require","globals","model/basemodel","model/viewport","vendor/detectmobilebrowser","log"],function(e){var t=(e("globals"),e("model/basemodel")),i=e("model/viewport"),n=e("vendor/detectmobilebrowser"),o=e("log");o.module("model/browser");var r=o.create("browser","background-color:darkslategray;color:white"),a=$("html"),s=["mobile","tablet","desktop","iphone","ipad","ios","android","touch"],l=t.extend({defaults:{mobile:null,tablet:null,desktop:null,iphone:null,ipad:null,ios:null,android:null,touch:null},initialize:function(){t.prototype.initialize.apply(this,arguments),this.initializeConstants(),this.setBrowserClasses(),this.adjustFixedElementsForTouch(),this.adjustScaleForTouch(),this.viewport=new i;var e=this;define("browser",[],function(){return e})},onEvent:function(e){r("browser event:",e)},initializeConstants:function(){var e,t,i,o,r,a,s,l,c=navigator.userAgent;e=c.match(/iPhone/i)||c.match(/iPod/i),t=c.match(/iPad/i),i=e||t,o=c.match(/android/i),r=Modernizr.touch,a=n,s=t,l=!(a||s),this.set({iphone:!!e,ipad:!!t,ios:!!i,android:!!o,touch:!!r,mobile:!!a,tablet:!!s,desktop:!!l})},setBrowserClasses:function(){var e=[];_.each(s,function(t){this.is(t)&&e.push("browser-"+t)},this),a.addClass(e.join(" "))},adjustFixedElementsForTouch:function(){if(!this.isNot("touch")){var e=$("body");$("body.has-fixednav").on("focus","input,[contenteditable]",function(){$(this).is(":visible")&&!$(this).closest(".topnav").length&&e.removeClass("has-fixednav")}).on("blur","input,[contenteditable]",function(){$(this).is(":visible")&&!$(this).closest(".topnav").length&&e.addClass("has-fixednav")}),$("body.has-fixedsubnav").on("focus","input,[contenteditable]",function(){$(this).is(":visible")&&!$(this).closest(".subnav").length&&e.removeClass("has-fixedsubnav")}).on("blur","input,[contenteditable]",function(){$(this).is(":visible")&&!$(this).closest(".subnav").length&&e.addClass("has-fixedsubnav")})}},adjustScaleForTouch:function(){if(document.querySelector&&document.addEventListener){var e=document.querySelector('meta[name="viewport"]'),t=navigator.userAgent;e&&/iPhone|iPad/.test(t)&&!/Opera Mini/.test(t)&&(e.content="width=device-width, minimum-scale=1.0, maximum-scale=1.0",document.addEventListener("gesturestart",function(){e.content="width=device-width, minimum-scale=0.25, maximum-scale=1.6"},!1))}}});return l}),/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
define("text",["module"],function(e){var t,i,n,o,r,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,u=c&&location.protocol&&location.protocol.replace(/\:/,""),d=c&&location.hostname,h=c&&(location.port||void 0),g={},p=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){i=a[t];try{e=new ActiveXObject(i)}catch(n){}if(e){a=[i];break}}return e},parseName:function(e){var t,i,n,o=!1,r=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!a||r>1)?(t=e.substring(0,r),i=e.substring(r+1,e.length)):t=e,n=i||t,r=n.indexOf("!"),-1!==r&&(o="strip"===n.substring(r+1),n=n.substring(0,r),i?i=n:t=n),{moduleName:t,ext:i,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,o){var r,a,s,l=t.xdRegExp.exec(e);return l?(r=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(r&&r!==i||a&&a.toLowerCase()!==n.toLowerCase()||(s||a)&&s!==o)):!0},finishLoad:function(e,i,n,o){n=i?t.strip(n):n,p.isBuild&&(g[e]=n),o(n)},load:function(e,i,n,o){if(o.isBuild&&!o.inlineText)return void n();p.isBuild=o.isBuild;var r=t.parseName(e),a=r.moduleName+(r.ext?"."+r.ext:""),s=i.toUrl(a),l=p.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void n():void(!c||l(s,u,d,h)?t.get(s,function(i){t.finishLoad(e,r.strip,i,n)},function(e){n.error&&n.error(e)}):i([a],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,n)}))},write:function(e,i,n){if(g.hasOwnProperty(i)){var o=t.jsEscape(g[i]);n.asModule(e+"!"+i,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,i,n,o,r){var a=t.parseName(i),s=a.ext?"."+a.ext:"",l=a.moduleName+s,c=n.toUrl(a.moduleName+s)+".js";t.load(l,n,function(){var i=function(e){return o(c,e)};i.asModule=function(e,t){return o.asModule(e,c,t)},t.write(e,l,i,r)},r)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var o=i.readFileSync(e,"utf8");0===o.indexOf("")&&(o=o.substring(1)),t(o)}catch(r){n(r)}}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,i,n,o){var r,a=t.createXhr();if(a.open("GET",e,!0),o)for(r in o)o.hasOwnProperty(r)&&a.setRequestHeader(r.toLowerCase(),o[r]);p.onXhr&&p.onXhr(a,e),a.onreadystatechange=function(){var t,o;4===a.readyState&&(t=a.status,t>399&&600>t?(o=new Error(e+" HTTP status: "+t),o.xhr=a,n(o)):i(a.responseText),p.onXhrComplete&&p.onXhrComplete(a,e))},a.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,o="utf-8",r=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),o)),l="";try{for(i=new java.lang.StringBuffer,n=s.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=s.readLine());)i.append(a),i.append(n);l=String(i.toString())}finally{s.close()}t(l)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,o=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var i,a,s,l={};r&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),i.init(s,1,0,!1),a=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),a.init(i,"utf-8",i.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(i.available(),l),a.close(),i.close(),t(l.value)}catch(c){throw new Error((s&&s.path||"")+": "+c)}}),t}),define("text!template/app_layout.html",[],function(){return'<: if (data.g.UNSUPPORTED) { :>\n	<div class="structure unsupported-banner">\n		<div class="content">Looks like you\'re using an unsupported browser. <a href="http://whatbrowser.org" target="_blank" class="button dark orange">Upgrade Now</a></div>\n	</div>\n<: } :>\n\n<: if (data.show_topnav) { :>\n	<div class="structure topnav"></div>\n<: } :>\n\n<: if (data.show_subnav) { :>\n	<div class="structure subnav">\n		<div class="content"></div>\n	</div>\n<: } :>\n\n<: if (data.custom_content) { :>\n	<div class="main-container"></div>\n<: } else if (\'app_layout.html\') { :>\n	<div class="structure main main-container">\n		<div class="content"></div>\n	</div>\n<: } :>\n\n<: if (data.show_footer) { :>\n	<div class="structure footer"></div>\n<: } :>\n'}),define("module/app_layout",["require","globals","marionette","model/basemodel","text!template/app_layout.html","log"],function(e){var t=e("globals"),i=e("marionette"),n=e("model/basemodel"),o=e("text!template/app_layout.html"),r=e("log");r.module("module/app_layout");r.create("app_layout");_.templateSettings.escape=/\{\{(.+?)\}\}/g,_.templateSettings.interpolate=/\[\[(.+?)\]\]/g,_.templateSettings.evaluate=/<:([\s\S]+?):>/g,_.templateSettings.variable="data";var a=$("html"),s=$("body"),l=n.extend({defaults:{fixed_nav:!0},calculated_values:{show_topnav:function(){var e=!0;return _.contains(["home","index","aol","follow"],t.PAGE)&&(e=!1),e},show_subnav:function(){var e=!1;return _.contains(["people","dashboard"],t.PAGE)&&(e=!0),e},custom_content:function(){var e=!1;return _.contains(["home","upgrade","follow","user","hireme"],t.PAGE)&&(e=!0),e},show_footer:function(){var e=!0;return _.contains(["home","new_user","progresspage","contact_import","user","follow"],t.PAGE)&&(e=!1),e}}}),c=i.LayoutView.extend({className:"page-content",template:_.template(o),regions:{},onBeforeRender:function(){this.templateHelpers={g:t}},onRender:function(){var i=this.model.toJSON();if("about.me"===t.DOMAIN_NAME&&"production"!==t.ENVIRONMENT&&a.addClass("fakeproduction"),t.UNSUPPORTED&&s.addClass("unsupported"),i.show_topnav&&e(["module/topnav"],_.bind(function(e){var t=new e.Model,i=new e.View({model:t});this.addRegion("topnav_region",".structure.topnav"),this.topnav_region.show(i)},this)),i.show_subnav&&(this.addRegion("subnav_region",".structure.subnav .content"),$(".template.subnav-template").length)){var n=$(".template.subnav-template").remove().html();this.$(this.subnav_region.el).append(n)}if(i.custom_content?this.addRegion("main_region",".main-container"):this.addRegion("main_region",".structure.main .content"),$(".template.content-template").length){var o=$(".template.content-template").remove().html();this.$(this.main_region.el).append(o)}i.show_footer&&e(["module/footer"],_.bind(function(e){var t=new e.View;this.addRegion("footer_region",".structure.footer"),this.footer_region.show(t)},this))}});return{View:c,Model:l}}),/**
 * @license
 * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
 * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
 * requestAnimationFrame polyfill by Erik Mller. fixes from Paul Irish and Tino Zijdel
 * MIT license
 */
function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),o=window.setTimeout(function(){t(i+n)},n);return e=i+n,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("vendor/requestAnimationFrame",function(){}),define("app",["require","globals","backbone","marionette","lib/backbone.when","model/browser","module/app_layout","log","vendor/requestAnimationFrame"],function(e){var t=e("globals"),i=e("backbone"),n=e("marionette"),o=e("lib/backbone.when"),r=e("model/browser"),a=e("module/app_layout"),s=e("log");e("vendor/requestAnimationFrame"),s.module("app");var l=s.create("app","background-color:grey;border:1px solid #1f3136;color:white;");return o.applyTo(n.Application),AboutMe=new n.Application,AboutMe.browser=new r,AboutMe.onRequest=function(){AboutMe.reqres.setHandler.apply(AboutMe.reqres,arguments)},AboutMe.onRequests=function(){AboutMe.reqres.setHandlers.apply(AboutMe.reqres,arguments)},AboutMe.onCommand=function(){AboutMe.commands.setHandler.apply(AboutMe.commands,arguments)},AboutMe.onCommands=function(){AboutMe.commands.setHandlers.apply(AboutMe.commands,arguments)},AboutMe.addRegions({app_region:".page-container"}),AboutMe.once("router:done",function(){i.history&&!i.History.started&&i.history.start({pushState:Modernizr.history})}),AboutMe.addInitializer(function(){if(e(["jstorage"],function(){var e=$.jStorage.get("globals");_.extend(t,e)}),!t.FRAMED){var i=new a.Model,n=new a.View({model:i});this.app_region.show(n),this.main_region=n.main_region,this.subnav_region=n.subnav_region}switch(e(["controller/autologin"]),t.PAGE){case"user":e(["controller/typekit"]),e(["view/profile"]);break;case"upgrade":e(["view/store"]);break;case"aboutus":case"dashboard":case"groups":case"mapped":case"people":case"playground":case"share":case"promoted":case"stats":case"search":e(["module/"+t.PAGE]);break;case"account":case"backstory":case"change_password":case"contact_import":case"dashboard":case"follow":case"groups":case"hireme":case"home":case"invite":case"login":case"new_user":case"offer-email":case"progresspage":case"recent_sites":case"spotlight":e(["view/"+t.PAGE]);break;default:l("No view controller for page: "+t.PAGE)}t.ENVIRONMENT.match(/(development|test)/)&&t.BRANCH_ADMIN&&e(["viewport"],function(t){t.isNot("small")&&e(["controller/branch_admin"])}),t.ENVIRONMENT.match(/(development|test)/)&&(e(["lib/expose"]),e(["lib/listenercount"])),t.SERVER_MESSAGE&&t.SERVER_MESSAGE.message&&e(["lib/dialog"],function(e){var i=t.SERVER_MESSAGE.message;i=i.replace("support.about.me","<a href='http://support.about.me'>support.about.me</a>"),i=i.replace("Try search","Try <a href='/search'>search</a>"),i=i.replace(/{{br ?\/}}/g,"<br />"),i=i.replace(/{{p}}/g,"<p>"),i=i.replace(/{{\/p}}/g,"</p>"),e.banner(i,{status:t.SERVER_MESSAGE.status,duration:1e4})});var o=function(){var e=[".button",".lightswitch",".topnav .nav-link",".topnav .nav-item",".menu .menu-toggle",".menu .menu-head",".menu .menu-label",".text.link",".compliment-modal li.compliment",".collect-modal li.item",".profilepage background img",".profilepage #backstretch img",".profilepage .background","label.checkbox","label.radio",".dash .sidenav ul.filters",".dash .feed .note .response","#customize-pane-fonts","#customize-pane-backgrounds","#customize-pane-colors","#customize-pane-links",".share .nav",".colorwell",".ui-widget-overlay",".invite .email .contacts .chooser label",".group-next",".group-prev"];$("body").on("selectstart",e.join(","),function(){return!1})};$(document).ready(o),"production"!==t.ENVIRONMENT&&(window.selenium_ready=!0)}),e(["api/mapsocket","api/requests","api/events"],function(t){t.when("ready",function(){e(["viewer"],function(e){e.when("ready",function(){l("Starting AboutMe app"),AboutMe.start()})})})}),AboutMe}),define("api/events",["require","globals","log"],function(e){var t=e("globals"),i=e("log");i.module("api/events");var n=i.event||i.create("event","background-color:green;color:white"),o={"group:delete:ui":"Show the confirmation UI for deleting a group","group:delete:success":"A group was deleted","create_group_modal:group_created":"A group was created using the standalone New Collection modal","mapped:message":"A mapped message has been received from the mapped domain socket","mapped:ajax:post":"A mapped page is attempting an ajax post","mapped:ajax:post:response:<socket_message_id>":"A mapped ajax post has been completed via the mapped domain socket","mapped:ajax:get":"A mapped page is attempting an ajax get","mapped:ajax:get:response:<socket_message_id>":"A mapped ajax get has been completed via the mapped domain socket","router:done":"A backbone router is ready for use","user:compliment:ui":"Show the UI for complimenting a single user","user:collect:ui":"Show the UI for adding a single user to the Viewer's collections","user:collect:ui:closed":"The UI for adding a single user to the Viewer's collections has closed","user:collect:add":"Add a user to a collection","user:collect:remove":"Remove a user from a collection","user:mute":"Mute a user","user:mute:ui":"Show the UI for muting a user","user:flag":"Flag a user","user:flag:ui":"Show the UI for flagging a user","user:admin_remove:ui":"Show the admin-only UI for renoving a user from a system directory","user:admin_remove:success":"A user has been successfully removed from a system directory by an admin","user:thumb_regen":"Regenerate the thumbnail for a user","user:thumb_regen:success":"A user thumbnail has been queued for regeneration","user:view":"A user has been viewed","users:quickview":"Open quickview for a list of users","window:resize":"The window has resized","window:scroll":"The window has scrolled",error:"Generic error event. Place all other events above this one, with commas"};t.ENVIRONMENT.match(/(xdevelopment)/)&&AboutMe.addInitializer(function(){_.each(o,function(e,t){AboutMe.on(t,function(){if(AboutMe._events&&AboutMe._events[t]&&1===AboutMe._events[t].length){var i=Array.prototype.slice.call(arguments,0);n.error("Unregistered event "+t+" triggered. Description: "+e),i.length&&n("arguments",i)}})})})});/*!
 * Date Format 1.2.3
 * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
 * MIT license
 *
 * Includes enhancements by Scott Trenda <scott.trenda.net>
 * and Kris Kowal <cixar.com/~kris.kowal/>
 *
 * Accepts a date, a mask, or a date and a mask.
 * Returns a formatted version of the given date.
 * The date defaults to the current date/time.
 * The mask defaults to dateFormat.masks.default.
 * http://blog.stevenlevithan.com/archives/date-time-format
 */
var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,n=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(o,r,a){var s=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(r=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");r=String(s.masks[r]||r||s.masks["default"]),"UTC:"==r.slice(0,4)&&(r=r.slice(4),a=!0);var l=a?"getUTC":"get",c=o[l+"Date"](),u=o[l+"Day"](),d=o[l+"Month"](),h=o[l+"FullYear"](),g=o[l+"Hours"](),p=o[l+"Minutes"](),m=o[l+"Seconds"](),f=o[l+"Milliseconds"](),b=a?0:o.getTimezoneOffset(),v={d:c,dd:n(c),ddd:s.i18n.dayNames[u],dddd:s.i18n.dayNames[u+7],m:d+1,mm:n(d+1),mmm:s.i18n.monthNames[d],mmmm:s.i18n.monthNames[d+12],yy:String(h).slice(2),yyyy:h,h:g%12||12,hh:n(g%12||12),H:g,HH:n(g),M:p,MM:n(p),s:m,ss:n(m),l:n(f,3),L:n(f>99?Math.round(f/10):f),t:12>g?"a":"p",tt:12>g?"am":"pm",T:12>g?"A":"P",TT:12>g?"AM":"PM",Z:a?"UTC":(String(o).match(t)||[""]).pop().replace(i,""),o:(b>0?"-":"+")+n(100*Math.floor(Math.abs(b)/60)+Math.abs(b)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return r.replace(e,function(e){return e in v?v[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MMtt",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",isoPython:"UTC:ddd mmm dd yyyy HH:MM:ss +0000",friendly:"ddd mmm ddS 'at' h:MMtt",friendlyWithYear:"ddd mmm dd, yyyy 'at' h:MMtt"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)},Date.prototype.isSameDate=function(e){return this.getYear()==e.getYear()&&this.getMonth()==e.getMonth()&&this.getDate()==e.getDate()},Date.prototype.isSameYear=function(e){return this.getYear()==e.getYear()},define("lib/dateformat",function(){}),define("lib/utils",["globals","log","lib/dateformat"],function(e,t){t.module("lib/utils");var i={loadscript:function(e,t){t=t||{};var i,n=document,o="script",r=e[0],a=e[1],s=n.getElementsByTagName(o)[0];n.getElementById(r)?t.callback&&t.callback():(i=n.createElement(o),i.id=r,i.src=a,t.callback&&(i.onload=t.callback),t.beforeInsert&&t.beforeInsert(i),s.parentNode.insertBefore(i,s))},now:function(){return(new Date).getTime()},id:function(e){return e=String(e||""),e&&(e+="_"),e+i.now()+"_"+Math.floor(1e17*Math.random())},htmlEncode:function(e){return $("<div/>").text(e).html()},htmlDecode:function(e){return $("<div/>").html(e).text()},capitalize:function(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)},handleReturnKey:function(e,t){if(e&&t&&$.isFunction(t)){var i=window.Event?e.which:e.keyCode;i&&13==i&&t()}},handleEscapeKey:function(e,t){if(e&&t&&$.isFunction(t)){var i=window.Event?e.which:e.keyCode;i&&27==i&&t()}},validEmail:function(e){if(e.length>0){var t=i.checkLength(e,6,254);return t=t&&i.checkRegexp(e,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com")}},validURL:function(e){return e.length>0?i.checkRegexp(e,/^((http(s?))\:\/\/)?([a-zA-Z0-9])[a-zA-Z0-9\_\-\.]*\.([a-zA-Z]+)(\:[0-9]+)*(\/($|[a-zA-Z0-9@\(\)\.\:\,\;\?\!\'\\\+&%\$#\=~_\-]+))*$/i,""):!1},checkRegexp:function(e,t){return t.test(e)?!0:!1},checkLength:function(e,t,i){return e.length>i||e.length<t?!1:!0},imposeMaxLength:function(e,t,i){return t.value.length<=i||8==e.keyCode||46==e.keyCode||e.keyCode>=35&&e.keyCode<=40},escQuotes:function(e){return"string"==typeof e?e.replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e},setSelectionRange:function(e,t,i){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,i);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",t),n.select()}},setCaretToPos:function(e,t){i.setSelectionRange(e,t,t)},selectElementContents:function(e){if(window.getSelection&&document.createRange){var t=document.createRange();t.selectNodeContents(e);var i=window.getSelection();i.removeAllRanges(),i.addRange(t)}else if(document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(e),n.select()}},doubleDigit:function(e){return 10>e&&(e="0"+e),e},getEvent:function(e){return e=e||window.event},getKeyCode:function(e){e=i.getEvent(e);var t=e.which||e.keyCode;return t},getChar:function(e){var t=i.getKeyCode(e),n=String.fromCharCode(t);return n},dedupeArray:function(e){var t={},i=[];for(var n in e)t[e[n]]||(t[e[n]]=!0,i.push(e[n]));return i},dateProcess:function(e,t){e.match(/\d\d\d\d-\d\d-\d\d[T| ]\d\d:\d\d:\d\d/)&&(e=e.replace(/-/g,"/").replace(/T/g," "));var i=new Date(Date.parse(e)),n=t||"mmmm d, yyyy";return e=i.format(n)},texterize:function(e){var t=e.text().replace(/\\'/g,"&rsquo;");e.text($("<div />").html(t).text())},possessive:function(e,t){return e&&(t=t||"",e=$.trim(e))?(e.match(/s$/)?e+=t:e=e+t+"s",e):void 0},alphasort:function(e,t,n){return e=e.toLowerCase(),t=t.toLowerCase(),i.compareValues(e,t,n)},randomsort:function(){return.5-Math.random()},compareValues:function(e,t,i){return i=i||1,t>e?-1*i:e>t?1*i:0},sortGroupUsers:function(e){e.users&&e.sortby||t.error("Invalid group object");var n=function(t,n){var o=1;switch(e.sortby){case"added":t=new Date(t.added).getTime(),n=new Date(n.added).getTime(),o=-1;break;case"first":t=String(t.display[0]||t.name).toLowerCase(),n=String(n.display[0]||n.name).toLowerCase();break;case"last":t=String(t.display[1]||t.display[0]||t.name).toLowerCase(),n=String(n.display[1]||n.display[0]||n.name).toLowerCase();break;case"index":t=t.index,n=n.index}return i.compareValues(t,n,o)};e.users.sort(n)},digitize:function(e){return e.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},popup:function(e,t){t=t||[600,250];var i=screen.width,n=screen.height,o=t[0],r=t[1],a="width="+o+",height="+r+",location=no,toobar=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,copyhistory=no,left="+(i/2-o/2)+",top="+(n/2-r/1.75),e=e,s="aboutdotme_popup";window.open(e,s,a)},insertCSS:function(e,t){if(t){var i=document.getElementById(t);i||(i=document.createElement("style"),i.type="text/css",i.id=t,i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(i))}},insertHTML:function(e,t){$(t).append(e)},getPath:function(){var e=location.pathname;return e=e.replace(/^\//,""),e=e.replace(/\/$/,""),e=e.replace(/\//g,":")},isTextSelected:function(e){var i=e.selectionStart,n=e.selectionEnd,o=document.selection;return o&&0!=o.createRange().text.length?(t("text is selected"),!0):o||0==e.value.substring(i,n).length?!1:(t("text is selected"),!0)}};return i}),define("lib/event",["globals","log"],function(e,t){t.module("lib/event");var i=t.event||t.create("event","background-color:green;color:white"),n={on:function(){var e=this._parseEvent(arguments);i("Event subscribed: "+e.type),$(e.target).on(e.selector,function(){var t=Array.prototype.slice.call(arguments,0);i("Event received: "+e.type),e.callback.apply(e.target,t)})},one:function(){var e=this._parseEvent(arguments);i("One-time event subscribed: "+e.type),$(e.target).one(e.selector,function(){var t=Array.prototype.slice.call(arguments,0);i("One-time event received: "+e.type),e.callback.apply(e.target,t)})},ready:function(){var e=this._parseEvent(arguments),t=/\s+/g;if(t.test(e.selector))return e.selector=$.trim(e.selector.replace(t," ")),void n.nestReady(e);var o=this._isTriggered(e);o?(i("Ready event already triggered: "+e.type),e.callback.apply(e.target,o.arguments)):(i("Ready event subscribed: "+e.type),$(e.target).one(e.selector,function(){var t=Array.prototype.slice.call(arguments,0);i("Ready event received: "+e.type),e.callback.apply(e.target,t)}))},nestReady:function(e){var t=e.selector.split(" ").reverse();i("Nested ready event subscribed: "+e.selector);var o=[];$.each(t,function(t,i){var r;r=0===t?e.callback:o[t-1];var a=function(){n.ready(i,e.target,r)};o.push(a)});var r=o.pop();r.call()},everReady:function(){var e=this._parseEvent(arguments),t=this._isTriggered(e);t&&(i("EverReady event already triggered: "+e.type),e.callback.apply(e.target,t.arguments)),i("EverReady event subscribed: "+e.type),$(e.target).on(e.selector,function(){var t=Array.prototype.slice.call(arguments,0);i("EverReady event received: "+e.type),e.callback.apply(e.target,t)})},off:function(e,t){var n={};n=this._parseSelector(n,e),n=this._parseTarget(n,t),i("Event unsubscribed: "+n.type),$(n.target).off(n.selector)},trigger:function(){var e=this._parseTrigger(arguments);$(e.target).one(e.selector,function(t){n.saveTrigger(e,t)}),e.arguments?(i("Event triggered: "+e.selector+", with arguments: ",e.arguments),$(e.target).trigger(e.selector,e.arguments)):(i("Event triggered: "+e.selector),$(e.target).trigger(e.selector))},untrigger:function(){var e=this._parseTrigger(arguments);if(!(e&&e.target&&e.type))throw"Invalid event object";var t=$(e.target).data("triggered")||{};delete t[e.type]},saveTrigger:function(e,t){if(e&&e.target&&e.type){e.arguments=e.arguments||[],e.arguments.unshift(t);var i=$(e.target).data("triggered")||{};i[e.type]=e,$(e.target).data("triggered",i)}},ifTriggered:function(){var e=this._parseTrigger(arguments);return this._isTriggered(e)},_isTriggered:function(e){if(e&&e.target&&e.type){var t=$(e.target).data("triggered")||{};return t[e.type]}throw"Invalid event object"},_parseEvent:function(e){var e=Array.prototype.slice.call(e,0),t={};if(t.callback=e.pop(),!t.callback instanceof Function)throw"Invalid callback";return t=this._parseSelector(t,e.shift()),t=this._parseTarget(t,e.shift()),e.length&&(i("Additional arguments provided to event parser:"),i(e)),t},_parseSelector:function(e,t){if(e.selector=t,"string"!=typeof e.selector)throw"Invalid event selector: "+t;var i=t.split(".");if(e.type=i.shift(),e.namespace=i.shift()||"","string"!=typeof e.type)throw"Invalid event type: "+t;return e},_parseTarget:function(e,t){if(e.target=t||window,"string"==typeof e.target&&(e.target=$(e.target)),"object"!=typeof e.target)throw"Invalid event target: "+t;return e},_parseTrigger:function(e){var e=Array.prototype.slice.call(e,0),t={};return e[e.length-1]instanceof Array&&(t.arguments=e.pop()),t=this._parseSelector(t,e.shift()),t=this._parseTarget(t,e.shift()),e.length&&(i("Additional arguments provided to trigger parser:"),i(e)),t}};return n}),/**
 * @license
 * jQuery doTimeout: Like setTimeout, but better! - v1.0 - 3/3/2010
 * http://benalman.com/projects/jquery-dotimeout-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
function(e){function t(t){function n(){t?a.removeData(t):h&&delete i[h]}function r(){l.id=setTimeout(function(){l.fn()},g)}var a,s=this,l={},c=t?e.fn:e,u=arguments,d=4,h=u[1],g=u[2],p=u[3];if("string"!=typeof h&&(d--,h=t=0,g=u[1],p=u[2]),t?(a=s.eq(0),a.data(t,l=a.data(t)||{})):h&&(l=i[h]||(i[h]={})),l.id&&clearTimeout(l.id),delete l.id,p)l.fn=function(e){"string"==typeof p&&(p=c[p]),p.apply(s,o.call(u,d))!==!0||e?n():r()},r();else{if(l.fn)return void 0===g?n():l.fn(g===!1),!0;n()}}var i={},n="doTimeout",o=Array.prototype.slice;e[n]=function(){return t.apply(window,[0].concat(o.call(arguments)))},e.fn[n]=function(){var e=o.call(arguments),i=t.apply(this,[n+e[0]].concat(e));return"number"==typeof e[0]||"number"==typeof e[1]?this:i}}(jQuery),define("doTimeout",function(){}),define("lib/ajax",["globals","log","lib/utils","lib/event","doTimeout"],function(e,t,i,n){t.module("lib/ajax");var o=t.create("ajax","background-color:sienna;color:white"),r={_queue:[],_error:function(e,t,i,r,a,s){return 11==i.error||3==i.error?(n.trigger("ajax_authentication_error"),void require(["lib/dialog"],function(e){var t=e.error("Sorry, an error occurred. Please refresh the page and try again.",{title:"Please try again"});t.closest(".ui-dialog").find(".ui-button-text").text("Reload"),t.on("dialogclose",function(){window.location.reload()})})):void(s?16==i.error?n.trigger("weak_login",[e,i.source,i.callback,"ajax"]):s(i,t,e,r,a):(o("AJAX failed: "+e+": "+r),o(i)))},_begin:function(e,t){t.progress_modal&&$.doTimeout(t.ajax_id+"_progress",t.progress_delay,function(){require(["lib/dialog"],function(e){var i=e.progressmodal(t.progress_message);$.doTimeout(t.ajax_id+"_failed",t.progress_failure,function(){i.dialog("close"),e.error("Sorry, your request timed out.<br />Please try again.")}),n.on(t.ajax_id+"_complete",function(){$.doTimeout(t.ajax_id+"_failed"),i.dialog("close")})})}),t.begin&&t.begin(e,t)},_complete:function(e,t,i,o){n.trigger(t.ajax_id+"_complete"),t.progress_modal&&$.doTimeout(t.ajax_id+"_progress"),o&&o(t,e,i)},_success:function(e,t,i,n,r){r?r(i,t,e,n):(o("AJAX successful: "+e+": "+n),o(i))},_mangle:function(e){var t={};if(t.data={},t.options={},t.callback=null,e.length<1||"string"!=typeof e[0])throw o.error(e),"Invalid api_call.";t.api_call=e[0];for(var i=["data","options","options"],n=0,r=1;4>r;r++)e[r]&&($.isFunction(e[r])?t.callback=e[r]:(t[i[n]]=e[r],n++));return!t.callback&&t.options.success&&$.isFunction(t.options.success)&&(t.callback=t.options.success),t},_checkQueue:function(){if(this._queue.length){var e=this._queue.shift();e.call()}else this.queued=!1},get:function(t,i,n,o){var r=this._mangle([t,i,n,o]);r.options.type="GET",e.MAPPED?AboutMe.trigger("mapped:ajax:get",r.api_call,r.data,r.options,r.callback):this.request(r.api_call,r.data,r.options,r.callback)},post:function(t,i,n,o){var r=this._mangle([t,i,n,o]);r.options.type="POST",e.MAPPED?AboutMe.trigger("mapped:ajax:post",r.api_call,r.data,r.options,r.callback):this.request(r.api_call,r.data,r.options,r.callback)},load:function(e,t,i,n){handler=function(e,t,i){"error"==t&&require(["lib/dialog"],function(e){e.banner("There was an error. Please try again later.",{status:"error"})}),n&&n(e,t,i)},$.extend(i,{call:e}),$.ajaxSetup({cache:!1}),$(t).load("/ajax",i,handler)},request:function(t,n,r,a){var s=this,l=$.extend({},r);r=$.extend({progress_modal:!1,progress_message:"Processing",progress_delay:2e3,progress_failure:58e3,ssl:!1},r),r.ajax_id=i.id("ajax");var c=$.isFunction(a)?a:null,u=$.isFunction(r.error)?r.error:null,d=$.isFunction(r.complete)?r.complete:null;r.data&&$.extend(n,r.data),$.each(["complete","data","error","success"],function(e,t){delete r[t]});var h={},g=["async","beforeSend","cache","complete","contentType","context","data","dataFilter","dataType","error","global","ifModified","jsonp","jsonpCallback","password","processData","scriptCharset","success","timeout","traditional","type","url","username","xhr","xhrFields"];$.each(r,function(e,t){-1!=$.inArray(e,g)&&(h[e]=t,delete r[e])});var p=function(e,i){if(e.error){var n=parseInt(e.error);n?e.error=n:(e.msg=e.error,e.error=1)}else e.error=0,e.msg||(e.msg="");e.success&&0==e.error?s._success(t,r,e,i,c):(16==e.error&&(e.source=v,e.callback=l),s._error(t,r,e,i,"BackendError",u))},m=function(e,i,n){var o={success:!1,error:-1,msg:"An error has occurred."};s._error(t,r,o,i,n,u)},f=function(e,i){s._complete(t,r,i,d)},b=$.extend({},n,{_authentication_token:e.AUTH_TOKEN}),v=n,y={cache:!1,complete:f,data:b,dataType:"json",error:m,success:p,type:"POST",url:"/ajax/"+t+"?_="+r.ajax_id};r.ssl===!0&&(y.url=e.SSL_DOMAIN+y.url,o("SSL ajax URL",y.url)),$.extend(y,h),s._begin(t,r),$.ajax(y)},log:function(e,t){if(e.error&&e.msg){var i="";t&&(i+=t+": "),i+=e.error+": ",i+=e.msg,o(i)}else o("Ajax.log failed: output glob is missing needed properties."),o(e)}};return r}),define("controller/iframe",["globals","log"],function(e,t){t.module("controller/iframe");var i={is:function(){var e=window.location!=window.parent.location?!0:!1;return e},url:function(){return window.location}};return i}),/**
 * @license
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
function(e){"function"==typeof define&&define.amd?define("cookie",["jquery"],e):e(jQuery)}(function(e){function t(e){return s.raw?e:encodeURIComponent(e)}function i(e){return s.raw?e:decodeURIComponent(e)}function n(e){return t(s.json?JSON.stringify(e):String(e))}function o(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(a," ")),s.json?JSON.parse(e):e}catch(t){}}function r(t,i){var n=s.raw?t:o(t);return e.isFunction(i)?i(n):n}var a=/\+/g,s=e.cookie=function(o,a,l){if(void 0!==a&&!e.isFunction(a)){if(l=e.extend({},s.defaults,l),"number"==typeof l.expires){var c=l.expires,u=l.expires=new Date;u.setDate(u.getDate()+c)}return document.cookie=[t(o),"=",n(a),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var d=o?void 0:{},h=document.cookie?document.cookie.split("; "):[],g=0,p=h.length;p>g;g++){var m=h[g].split("="),f=i(m.shift()),b=m.join("=");if(o&&o===f){d=r(b,a);break}o||void 0===(b=r(b))||(d[f]=b)}return d};s.defaults={},e.removeCookie=function(t,i){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},i,{expires:-1})),!e.cookie(t))}}),define("api/mapsocket",["require","globals","backbone","lib/backbone.when","lib/ajax","log","controller/iframe","easyxdm","cookie"],function(e){var t=e("globals"),i=e("backbone"),n=e("lib/backbone.when"),o=e("lib/ajax"),r=e("log"),a=e("controller/iframe");e("easyxdm"),e("cookie"),r.module("api/mapped");var s,l=r.create("XDM");if(!t.FRAMED&&a.is()&&(top.location=a.url()),t.MAPPED||t.FRAMED)if(_.extend(easyXDM.Socket.prototype,i.Events,n.Events),t.FRAMED){var c=["http://127.0.0.1:8080","http://localhost:8080","http://*.about.me","http://about.me"];$.each(t.MAPPED_DOMAINS.split(","),function(e,t){t=t.replace(/www./,""),c.push("http://"+t.replace(/http:\/\//,"").replace(/https:\/\//,"")),c.push("http://www."+t.replace(/http:\/\//,"").replace(/https:\/\//,""))}),$.cookie("testcookie",!0);var u=$.cookie("testcookie");s=new easyXDM.Socket({acl:c,onMessage:function(e){var i,n,r=$.parseJSON(e);switch(l.important("onMessage",r),r.method){case"ajax_get":i={success:function(e){l("actions:ajax_get success:",e);var t={id:r.id,method:"ajax_get_response",data:{success:!0,error:!1,output:e}};s.postMessage(JSON.stringify(t))},error:function(e){l("actions:ajax_get error",e);var t={id:r.id,method:"ajax_get_response",data:{success:!1,error:!0,output:e}};s.postMessage(JSON.stringify(t))}},r.data._authentication_token&&(r.data._authentication_token=t.AUTH_TOKEN),o.get(r.api_call,r.data,i);break;case"ajax_post":if(!u&&"get_viewer_login_data"===r.api_call)return n={id:r.id,method:"ajax_post_response",data:{noSessionAvailable:!0,success:!0,error:!1,output:{msg:"Update successful.",logged_in:!1,success:!0,error:0}}},void s.postMessage(JSON.stringify(n));i={success:function(e){return l("actions:ajax_post success:",e),n={id:r.id,method:"ajax_post_response",data:{success:!0,error:!1,output:e}},"step1"===r.api_call&&e.success?void(top.location=t.SSL_DOMAIN+"/new_user"):void s.postMessage(JSON.stringify(n))},error:function(e){l("actions:ajax_post error:",e),n={id:r.id,method:"ajax_post_response",data:{success:!1,error:!0,output:e}},s.postMessage(JSON.stringify(n))},complete:function(e){l.important("complete",e)}},r.data._authentication_token&&(r.data._authentication_token=t.AUTH_TOKEN),o.post(r.api_call,r.data,i);break;case"backbone_sync":i=r.options||{},i.data._authentication_token=t.AUTH_TOKEN,n={id:r.id,method:"backbone_sync_response",data:{success:!1,error:!1}},i.success=function(e){n.data.success=!0,n.data.output=e,s.postMessage(JSON.stringify(n))},i.error=function(e){n.data.error=!0,n.data.output=e,s.postMessage(JSON.stringify(n))},$.ajax(i);break;default:AboutMe.trigger("mapped:message",r)}},onReady:function(){s.trigger("ready")}})}else s=new easyXDM.Socket({lazy:!1,swf:"http://d2ed0w4q03gsmw.cloudfront.net/core/easyxdm/easyxdm.swf",interval:100,props:{allowTransparency:"true",scrolling:"no"},remote:t.DOMAIN_NAME_URL+"/me/mapped/"+t.MAPPED_USER,onMessage:function(e){var t=$.parseJSON(e);switch(l.important("PARENT onMessage",t),t.method){case"ajax_post_response":t.data.noSessionAvailable&&$("html").addClass("no_session"),AboutMe.trigger("mapped:ajax:post:response:"+t.id,t.data);break;case"ajax_get_response":AboutMe.trigger("mapped:ajax:get:response:"+t.id,t.data);break;case"backbone_sync_response":AboutMe.trigger("mapped:backbone:sync:response:"+t.id,t.data);break;default:AboutMe.trigger("mapped:message",t)}},onReady:function(){s.trigger("ready")}}),AboutMe.on("mapped:ajax:post",function(e,t,i){l("+++++++++++++++++++++++++++++++++++++++++++++"),l("Arguments intercepted from Ajax.post()"),l("endpoint: "+e),l("data:",t),l("callbacks:",i),l("+++++++++++++++++++++++++++++++++++++++++++++");var n={id:_.uniqueId("socket_message"),method:"ajax_post",api_call:e,data:t};AboutMe.once("mapped:ajax:post:response:"+n.id,function(e){e.success&&i.success&&i.success(e.output),e.error&&i.error&&i.error(e.output)}),s.postMessage(JSON.stringify(n))}),AboutMe.on("mapped:ajax:get",function(e,t,i){l("+++++++++++++++++++++++++++++++++++++++++++++"),l("Arguments intercepted from Ajax.get()"),l("endpoint: "+e),l("data:",t),l("callbacks:",i),l("+++++++++++++++++++++++++++++++++++++++++++++");var n={id:_.uniqueId("socket_message"),method:"ajax_get",api_call:e,data:t};AboutMe.once("mapped:ajax:get:response:"+n.id,function(e){e.success&&i.success&&i.success(e.output),e.error&&i.error&&i.error(e.output)}),s.postMessage(JSON.stringify(n))}),i.originalSync=i.sync,i.sync=function(e,t,i){AboutMe.trigger("mapped:backbone:sync",e,t,i)},AboutMe.on("mapped:backbone:sync",function(e,t,i){i=i||{},i.data=i.data||{},i.url||(i.url=_.result(t,"url")||l.error("options.url missing"));var n={id:_.uniqueId("socket_message"),method:"backbone_sync",options:i};AboutMe.once("mapped:backbone:sync:response:"+n.id,function(e){e.success&&i.success&&i.success(e.output),e.error&&i.error&&i.error(e.output)}),s.postMessage(JSON.stringify(n))});else s={},_.extend(s,i.Events,n.Events),s.trigger("ready");return s}),define("lib/backbone.promise",["require","backbone","lib/backbone.when","log"],function(e){var t=e("backbone"),i=e("lib/backbone.when"),n=e("log");n.module("lib/backbone.promise");var o=n.create("promise"),r=function(){this.id=_.uniqueId("promise"),this.timer=null};return r.prototype={keep:function(){o("keep",this.id);var e=Array.prototype.slice.call(arguments,0);e.unshift("kept"),this.trigger.apply(this,e),this.complete.apply(this,arguments)},"break":function(){o("break",this.id);var e=Array.prototype.slice.call(arguments,0);e.unshift("broken"),this.trigger.apply(this,e),this.complete.apply(this,arguments)},complete:function(){o("complete",this.id);var e=Array.prototype.slice.call(arguments,0);e.unshift("done"),this.trigger.apply(this,e),this._events={}},kept:function(e,t){this.when("kept",e,t)},broken:function(e,t){this.when("broken",e,t)},done:function(e,t){this.when("done",e,t)},deadline:function(e){e=e||1e3,clearTimeout(this.timer),this.timer=setTimeout(e,_.bind(this.break,this))}},_.extend(r.prototype,t.Events,i.Events),delete r.prototype.whenever,r}),define("lib/metrics",["globals","log"],function(e,t){t.module("lib/metrics");var i=t.create("metric","background-color:lightgrey;color:white"),n={log:function(e,t){return _kmq?"string"!=typeof e?i.error("Metrics.log requires first argument as a string"):void(t?(_kmq.push(["record",e,t]),i(e,t)):(_kmq.push(["record",e]),i(e))):i.error("KissMetrics _kmq not defined")},identify:function(e){return _kmq?"string"!=typeof e?i.error("Metrics.identify only accepts strings"):(_kmq.push(["identify",e]),void i("Identify:",e)):i.error("KissMetrics _kmq not defined")},set:function(e){return _kmq?"object"!=typeof e?i.error("Metrics.set only accepts objects"):(_kmq.push(["set",e]),void i("Set:",e)):i.error("KissMetrics _kmq not defined")},click:function(e,t,i){$("body").on("mousedown."+n.scope(e),e,function(){n.log(t,i)})},scope:function(e){return"km-"+e.replace(/[ #.,]/g,"__")}};return n}),define("api/requests",["require","globals","lib/backbone.promise","lib/ajax","lib/metrics","log"],function(e){var t=e("globals"),i=e("lib/backbone.promise"),n=e("lib/ajax"),o=e("lib/metrics"),r=e("log");r.module("api/requests");var a=r.create("request","background-color:#076;color:white"),s={getViewerLoginData:function(e){var t={},i={ssl:!0,success:function(t){e.keep(t.logged_in?t:{})},error:function(t){a.error("viewer error",t),e.keep({})},xhrFields:{withCredentials:!0},crossDomain:!0};n.post("get_viewer_login_data",t,i)},sendCompliment:function(t,i,o){var r={user_name:i.get("user_name"),action:o},s={success:function(i){i.group&&e(["viewer"],function(e){var t=e.model.grouplist.add(i.group,{merge:!0,parse:!0});i.user&&t.memberlist.add(i.user,{merge:!0,parse:!0})}),t.keep(i)},error:function(e){a.error("sendCompliment ajax failed",e),t.break()}};n.post("compliment",r,s)},addUserToGroup:function(e,i,r){e.kept(function(e){i.memberlist.add(e),o.log("Collections",{"collections action":"Page added to collection",location:t.PAGE}),"fave"===i.get("name")&&o.log("Collections",{"collections action":"Page added to Favorites",location:t.PAGE})}),e.broken(function(e){i.trigger("add:member:error",r,e)});var s={group_name:i.get("name"),user_names:JSON.stringify([r.get("user_name")])},l={success:function(t){try{if(!t.users_success[0])throw"No user"}catch(i){throw a.error(i),new Error("addUserToGroup ajax returned invalid output")}e.keep(t.users_success[0])},error:function(t){a.error("addUserToGroup ajax failed",t),e.break(t)}};n.post("add_users_to_group",s,l)},removeUserFromGroup:function(e,i,r){e.kept(function(e){i.memberlist.remove(e),o.log("Collections",{"collections action":"Page removed from collection"}),"fave"===i.get("name")&&o.log("Collections",{"collections action":"Page removed from Favorites",location:t.PAGE})}),e.broken(function(e){i.trigger("remove:member:error",r,e)});var s={group_name:i.get("name"),remove_user:r.get("user_name")},l={success:function(t){var i;try{i=t.removed}catch(n){throw a.error(n),new Error("removeUserFromGroup ajax returned invalid output")}e.keep(r)},error:function(t){a.error("removeUserFromGroup ajax failed",t),e.break()}};n.post("remove_from_group",s,l)},removeSelfFromGroup:function(t,i,o){e(["viewer"],function(){var e={group_owner:i,group_name:o},r={success:function(e){t.keep(e)},error:function(e){a.error("removeUserFromGroup ajax failed",e),t.break()}};n.post("remove_self_from_group",e,r)})},createGroup:function(i,r){e(["viewer"],function(e){i.kept(function(i){e.model.grouplist.add(i,{parse:!0}),o.log("Collections",{"collections action":"Created new collection",location:t.PAGE})}),i.broken(function(t){e.model.grouplist.trigger("add:error",r,t)})});var s={display_name:r.get("display"),"public":r.get("public")},l=r.memberlist.at(0);l&&(s.add_user=l.get("user_name"));var c={success:function(e){e.group?i.keep(e.group):c.error(e)},error:function(e){a.error("createGroup ajax failed",e),i.break(e)}};n.post("create_group",s,c)},deleteGroup:function(t,i){e(["viewer"],function(e){t.kept(function(){e.model.grouplist.remove(i)}),t.broken(function(t){e.model.grouplist.trigger("remove:error",i,t)})});var o={group_name:i.get("name")},r={success:function(e){var n;try{n=e.group_deleted}catch(o){throw a.error(o),new Error("deleteGroup ajax returned invalid output")}t.keep(i)},error:function(e){a.error("deleteGroup ajax failed",e),t.break(e)}};n.post("delete_group",o,r)},setGroupPublic:function(e,t,i){e.kept(function(e){t.set("public",e)}),e.broken(function(e){t.trigger("set:public:error",t,e)});var o={group_name:t.get("name"),"public":i},r={success:function(t){var i;try{i=t.public}catch(n){throw a.error(n),new Error("setGroupPublic ajax returned invalid output")}e.keep(i)},error:function(t){a.error("setGroupPublic ajax failed",t),e.break(t)}};n.post("group_update_public",o,r)},setGroupSortBy:function(e,t,i){e.kept(function(e){t.set("sortby",e)}),e.broken(function(e){t.trigger("set:sortby:error",t,e)});var o={group_name:t.get("name"),sortby:i},r={success:function(t){var i;try{i=t.sortby}catch(n){throw a.error(n),new Error("setGroupSortBy ajax returned invalid output")}e.keep(i)},error:function(t){a.error("setGroupSortBy ajax failed",t),e.break(t)}};n.post("group_update_sortby",o,r)},setGroupOrder:function(e,t,i){var o={};_.each(i,function(e){o[e.get("user_name")]=e.get("index")});var r={group_name:t.get("name"),users:JSON.stringify(o)},s={success:function(t){e.keep(t)},error:function(t){a.error("setGroupOrder ajax failed",t),e.break(t)}};n.post("group_update_user_order",r,s)},setGroupDisplayName:function(e,t,i){e.kept(function(){t.set("display",i)}),e.broken(function(e){t.trigger("set:display:error",t,e)});var o={group_name:t.get("name"),display_name:i},r={success:function(t){var i;try{i=t.display}catch(n){throw a.error(n),new Error("setGroupDisplayName ajax returned invalid output")}e.keep(i)},error:function(t){a.error("setGroupDisplayName ajax failed",t),e.break(t)}};n.post("group_update_display_name",o,r)}},l=function(e,t){AboutMe.onRequest(e,function(){a.important(e);var n=new i,o=_.toArray(arguments);o.unshift(n);var r=_.last(o);try{t.apply(r,o)}catch(s){a.error(s),n.break(s)}return n})},c={"viewer:initialize":s.getViewerLoginData,"group:add:user":s.addUserToGroup,"group:remove:user":s.removeUserFromGroup,"group:remove:self":s.removeSelfFromGroup,"group:create":s.createGroup,"group:delete":s.deleteGroup,"group:set:public":s.setGroupPublic,"group:set:sortby":s.setGroupSortBy,"group:set:display":s.setGroupDisplayName,"group:set:order":s.setGroupOrder,"user:compliment":s.sendCompliment};return _.each(c,function(e,t){l(t,e)}),s}),define("lib/diacritics",["require","log"],function(e){function t(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return o[e]||e})}var i=e("log");i.module("lib/diacritics");for(var n=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],o={},r=0;r<n.length;r++)for(var a=n[r].letters.split(""),s=0;s<a.length;s++)o[a[s]]=n[r].base;return{remove:t}}),define("model/user",["require","globals","lib/backbone.when","model/basemodel","lib/diacritics","lib/utils","log"],function(e){var t=e("globals"),i=e("lib/backbone.when"),n=e("model/basemodel"),o=e("lib/diacritics"),r=e("lib/utils"),a=e("log");a.module("model/user");var s=a;window.devicePixelRatio||(window.devicePixelRatio=1);var l=n.extend({url:"/ajax/get_user_data",idAttribute:"lowercase_user_name",calculated_values:{full_name:function(){var e=this.get("first_name").trim()+" "+this.get("last_name").trim();return e.trim()},last_first:function(){var e=this.get("last_name").trim()+" "+this.get("first_name").trim();return e.trim()},display_name:function(){return this.get("full_name")||this.get("user_name")},display_first_name:function(){return this.get("first_name").trim()||this.get("user_name")},possessive_first_name:function(){var e=this.get("display_first_name");return r.possessive(e)},possessive_display_name:function(){var e=this.get("display_name");return r.possessive(e)},page_url:function(){return t.DOMAIN_NAME_URL+"/"+this.get("user_name")}},constructor:function(e,t){t=t||{},_.isString(e)&&(e={user_name:e},t.initial_fetch=!0),e=this.sanitize(e),n.prototype.constructor.apply(this,[e,t]),t.initial_fetch&&this.fetch()},initialize:function(){n.prototype.initialize.apply(this,arguments);var e=this.validate(this.attributes);e&&this.trigger("error",this,e),this.on("change:user_name",function(){this.set("lowercase_user_name",this.get("user_name").toLowerCase())})},sanitize:function(e){if(e=e||{},e instanceof Array){var t=e;e={},e.user_name=String(t[0]),e.display_name=String(t[1])}if(_.isString(e.display_name)&&_.isUndefined(e.first_name)&&_.isUndefined(e.last_name)){var i=e.display_name.split(" ");e.first_name=i.shift(),e.last_name=$.trim(i.join(" "))}return _.isString(e.display_name)&&delete e.display_name,_.isArray(e.display)&&(e.first_name=e.display[0],e.last_name=e.display[1],delete e.display),_.isString(e.name)&&(e.user_name=e.name,delete e.name),_.each(["user_name","first_name","last_name"],function(t){var i=e[t];_.isUndefined(i)&&(i=""),e[t]=String(i)},this),e.lowercase_user_name=e.user_name.toLowerCase(),e},validate:function(){},isUser:function(e){return e?e instanceof l?e.get("lowercase_user_name")===this.get("lowercase_user_name"):_.isString(e)?e.toLowerCase()===this.get("lowercase_user_name"):_.isObject(e)&&_.isString(e.user_name)?String(e.user_name).toLowerCase()===this.get("lowercase_user_name"):s.error("User.isUser requires a User model, or a string user_name, or an object with a user_name property"):!1},getAlphaSortValue:function(e){if(!e||!e.length)return"";var t=e.shift(),i=String(this.get(t));return i=o.remove(i),i=i.trim().toLowerCase().replace(/^[^a-z]+/,""),i?i:this.getAlphaSortValue(e)},getThumbnailUrl:function(e){if(!_.contains(t.THUMBNAIL_SIZES,e))throw new Error("Not a valid image size: "+e);for(var i=t.AWS_THUMBNAIL+"/thumb2",n=this.get("user_name").toLowerCase(),o=n.substr(0,3).replace(/\./g,"-").split("");o.length<3;)o.push(o[o.length-1]);var r=[];r.push(i),r=r.concat(o),r.push(n),r.push(n+"-"+e+".jpg");var a=r.join("/");return a},getThumbnailUrlForWidth:function(e){var t=this.getThumbnailSizeForWidth(e);return this.getThumbnailUrl(t)},getThumbnailSizeForWidth:function(e){var i=_.filter(t.THUMBNAIL_SIZES,function(t){var i=Number(t.split("x")[0]);return i>=e*window.devicePixelRatio?t:void 0},this),n=i.pop();return n||(n=t.THUMBNAIL_SIZES[0]),n},fetch:function(e){e=e||{};var i=this,o=e.success,r=e.error;return e.success=function(t){return t.success?(s("User fetch succeeded:",t),o&&o.apply(i,[t]),void i.trigger("ready")):void e.error(t)},e.error=function(e){s("User fetch failed:",e),r&&r.apply(i,[e]),i.trigger("ready")},_.defaults(e,{type:"POST",data:{}}),e.data.user_name=this.get("user_name"),e.data._authentication_token=t.AUTH_TOKEN,n.prototype.fetch.apply(this,[e])},parse:function(e){return e.error?!1:(e.attributes&&(e=e.attributes),this.sanitize(e))}});return i.applyTo(l),l}),define("list/userlist",["require","globals","backbone","lib/backbone.when","model/user","log"],function(e){var t=e("globals"),i=e("backbone"),n=e("lib/backbone.when"),o=e("model/user"),r=e("log");r.module("list/userlist");var a=r,s=i.Collection.extend({model:o,initialize:function(e,t){i.Collection.prototype.initialize.apply(this,arguments),this.options=_.extend({},this.defaults,t)},fetch:function(e){e=e||{};var n=this,o=e.success,r=e.error;return e.success=function(e){a("Userlist fetch succeeded:",e),o&&o.apply(n,[e]),n.trigger("ready")},e.error=function(e){a("Userlist fetch failed:",e),r&&r.apply(n,[e])},_.defaults(e,{type:"POST",data:{}}),e.data._authentication_token=t.AUTH_TOKEN,i.Collection.prototype.fetch.apply(this,[e])},hasUser:function(e){if(!e)return!1;if(e instanceof o)e=e.get("lowercase_user_name");else if(_.isString(e))e=e.toLowerCase();else{if(!_.isObject(e)||!_.isString(e.user_name))return a.error("User.isUser requires a User model, or a string user_name, or an object with a user_name property");e=e.user_name.toLowerCase()}var t=this.find(function(t){return t.isUser(e)});return t}});return n.applyTo(s),s}),define("model/viewer_model",["require","globals","lib/backbone.when","model/user","list/userlist","lib/ajax","log"],function(e){var t=(e("globals"),e("lib/backbone.when")),i=e("model/user"),n=e("list/userlist"),o=(e("lib/ajax"),e("log"));o.module("model/viewer_model");var r=o,a=i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),this.on("change:muted_users",this.onSetMutedUsers);var e=AboutMe.request("viewer:initialize",this);e.kept(this.set,this),e.broken(this.error,this),e.done(function(){this.trigger("ready")},this)},error:function(){r("error",arguments)},onSetMutedUsers:function(){var e=this.get("muted_users");e instanceof n||(e=new n(e),this.set("muted_users",e))}});return a.prototype.defaults=_.extend({},i.prototype.defaults,{logged_in:!1,admin:!1,muted_users:[]}),a.prototype.calculated_values=_.extend({},i.prototype.calculated_values,{support_link:function(){var e="http://support.about.me",t=this.get("uservoice_token");return t&&(e+="?sso="+t),e}}),t.applyTo(a),a}),define("model/member",["require","globals","model/user","log"],function(e){var t=(e("globals"),e("model/user")),i=e("log");i.module("model/member");var n=(i.backbone||i.create("backbone","background-color:chocolate;color:white"),t.extend({_name:"Member",initialize:function(){if(t.prototype.initialize.apply(this,arguments),!this.get("added")){var e=new Date;this.set("added",e.format("isoPython"))}}}));return n}),define("list/memberlist",["require","globals","list/userlist","model/member","log"],function(e){var t=(e("globals"),e("list/userlist")),i=e("model/member"),n=e("log");n.module("list/memberlist");var o=(n.backbone||n.create("backbone","background-color:chocolate;color:white"),t.extend({_name:"MemberList",model:i,initialize:function(){t.prototype.initialize.apply(this,arguments),this.cid=_.uniqueId("c")}}));return o}),define("model/group",["require","globals","backbone","model/basemodel","list/memberlist","log","lib/dateformat"],function(e){var t=(e("globals"),e("backbone")),i=e("model/basemodel"),n=e("list/memberlist"),o=e("log");e("lib/dateformat"),o.module("model/group");var r=o.backbone||o.create("backbone","background-color:chocolate;color:white"),a=i.extend({url:"/ajax/load_group",_name:"Group",idAttribute:"_id",defaults:{owner:"",display:"",name:"","public":!0,sortby:"added"},calculated_values:{url:function(){var e=[""];return e.push(this.get("owner")),e.push("collections"),e.push(this.get("name")),e.join("/")}},initialize:function(){if(i.prototype.initialize.apply(this,arguments),this.isNew()&&!this.get("created")){var e=new Date;this.set("created",e.format("isoPython"),{silent:!0})}this.isNew()&&!this.get("name")&&this.set("name",this.getCanonicalName(),{silent:!0}),this.memberlist=new n,this.setupMemberlist(),this.listenTo(this,"change:memberlist",this.setupMemberlist,this),this.listenTo(this.memberlist,"add",this.onMemberAdded,this),this.listenTo(this.memberlist,"remove",this.onMemberRemoved,this),this.listenTo(this.memberlist,"change",this.onMemberChanged,this),this.on("change:sortby",this.setMemberListComparator)},onEvent:function(){var e=_.toArray(arguments);r(this.constructor.prototype._name,this.cid,e.shift(),e)},onMemberAdded:function(e){this.trigger("add:group:member",this,e),this.trigger("change",this,e)},onMemberRemoved:function(e){this.trigger("remove:group:member",this,e),this.trigger("change",this,e)},onMemberChanged:function(e){this.trigger("change:group:member",this,e),this.trigger("change",this,e)},setupMemberlist:function(){var e=this.get("memberlist")||[];e instanceof t.Collection&&(e=e.models),_.isArray(e)&&(this.memberlist.reset(e),this.set("memberlist",this.memberlist,{silent:!0}),this.setMemberListComparator())},setMemberListComparator:function(){var e=this.get("sortby");this.memberlist.comparator=function(t){var i="";switch(e){case"added":i=0-new Date(t.get(e)).getTime();break;case"index":i=t.get(e);break;case"first":i=t.getAlphaSortValue(["display_name","user_name"]);break;case"last":i=t.getAlphaSortValue(["last_first","user_name"])}return i},this.memberlist.sort()},validate:function(e){return e.display?e.display.length>50?"That name is too long.":e.name?e.owner?void 0:"The collection must have an owner.":"That name is not valid.":"Please enter a name for the collection."},getCanonicalName:function(e){return(e=e||this.get("display"))?(e=String(e).toLowerCase(),e=e.split("+")[0],e=e.replace(/.js$/gi,""),e=e.replace(/[^a-z0-9]/gi,"")):null},fetch:function(e){return e=e||{},e.data={owner:this.get("owner"),name:this.get("name")},i.prototype.fetch.apply(this,[e])},parse:function(e){return e&&e.group&&(e=e.group),e.users&&!e.memberlist&&(e.memberlist=e.users),delete e.users,e},toJSON:function(){var e=i.prototype.toJSON.apply(this,arguments);return e.memberlist=e.memberlist.toJSON(),e}});return a}),define("list/grouplist",["require","globals","backbone","lib/backbone.when","model/user","model/group","log"],function(e){var t=e("globals"),i=e("backbone"),n=e("lib/backbone.when"),o=e("model/user"),r=e("model/group"),a=e("log");a.module("list/grouplist");var s=a.backbone||a.create("backbone","background-color:chocolate;color:white"),l=i.Collection.extend({_name:"GroupList",url:"/ajax/load_groups",model:r,constructor:function(e,t){t=t||{},_.defaults(t,{comparator:function(e){return String(e.get("display")).toLowerCase()}}),this.options=t,(e instanceof o||_.isString(e))&&(e instanceof o&&(t.user_name=e.get("user_name")),_.isString(e)&&(t.user_name=e),t.initial_fetch=!0,e=[]),i.Collection.prototype.constructor.apply(this,[e,t])},initialize:function(e,t){i.Collection.prototype.initialize.apply(this,arguments),this.user_name=t.user_name,t.initial_fetch&&this.fetch(),this.on("change:display",this.sort),this.cid=_.uniqueId("c")},onEvent:function(){var e=_.toArray(arguments);s(this.constructor.prototype._name,this.cid,e.shift(),e)},fetch:function(e){e=e||{};var n=this,o=e.success,r=e.error;return e.success=function(e){s("Grouplist fetch succeeded:",e),o&&o.apply(n,[e]),n.trigger("ready")},e.error=function(e){s("Grouplist fetch failed:",e),r&&r.apply(n,[e])},_.defaults(e,{type:"POST",data:{owner:this.user_name}}),e.data._authentication_token=t.AUTH_TOKEN,i.Collection.prototype.fetch.apply(this,[e])},parse:function(e){if(e.success===!0&&0===e.error&&e.groups&&(e=e.groups),this.options.public_only&&(e=e.filter(function(e){return e.users.length&&e.public})),this.options.limit){this.options.orig_count=e.length,e=_.sortBy(e,function(e){return-e.users.length}),e=_.filter(e,function(e){var t=e.users.length;return t>=3?e:void 0}),e=_.partition(e,function(e){return!e.auto}),e[0]=_.first(e[0],this.options.limit);var t=Math.max(this.options.limit-e[0].length,0),i=_.first(e[1],t);e=e[0].concat(i)}return e}});return n.applyTo(l),l}),/*
 * ----------------------------- JSTORAGE -------------------------------------
 * Simple local storage wrapper to save data on the browser side, supporting
 * all major browsers - IE6+, Firefox2+, Safari4+, Chrome4+ and Opera 10.5+
 *
 * Author: Andris Reinman, andris.reinman@gmail.com
 * Project homepage: www.jstorage.info
 *
 * Licensed under Unlicense:
 *
 * This is free and unencumbered software released into the public domain.
 *
 * Anyone is free to copy, modify, publish, use, compile, sell, or
 * distribute this software, either in source code form or as a compiled
 * binary, for any purpose, commercial or non-commercial, and by any
 * means.
 *
 * In jurisdictions that recognize copyright laws, the author or authors
 * of this software dedicate any and all copyright interest in the
 * software to the public domain. We make this dedication for the benefit
 * of the public at large and to the detriment of our heirs and
 * successors. We intend this dedication to be an overt act of
 * relinquishment in perpetuity of all present and future rights to this
 * software under copyright law.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR
 * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * For more information, please refer to <http://unlicense.org/>
 */
function(){function e(){var e=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),e=!0,window.localStorage.removeItem("_tmptest")}catch(t){}if(e)try{window.localStorage&&(w=window.localStorage,C="localStorage",E=w.jStorage_update)}catch(o){}else if("globalStorage"in window)try{window.globalStorage&&(w="localhost"==window.location.hostname?window.globalStorage["localhost.localdomain"]:window.globalStorage[window.location.hostname],C="globalStorage",E=w.jStorage_update)}catch(r){}else{if(k=document.createElement("link"),!k.addBehavior)return void(k=null);k.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(k);try{k.load("jStorage")}catch(a){k.setAttribute("jStorage","{}"),k.save("jStorage"),k.load("jStorage")}var l="{}";try{l=k.getAttribute("jStorage")}catch(c){}try{E=k.getAttribute("jStorage_update")}catch(h){}w.jStorage=l,C="userDataBehavior"}s(),u(),i(),d(),"addEventListener"in window&&window.addEventListener("pageshow",function(e){e.persisted&&n()},!1)}function t(){var e="{}";if("userDataBehavior"==C){k.load("jStorage");try{e=k.getAttribute("jStorage")}catch(t){}try{E=k.getAttribute("jStorage_update")}catch(i){}w.jStorage=e}s(),u(),d()}function i(){"localStorage"==C||"globalStorage"==C?"addEventListener"in window?window.addEventListener("storage",n,!1):document.attachEvent("onstorage",n):"userDataBehavior"==C&&setInterval(n,1e3)}function n(){var e;clearTimeout(A),A=setTimeout(function(){if("localStorage"==C||"globalStorage"==C)e=w.jStorage_update;else if("userDataBehavior"==C){k.load("jStorage");try{e=k.getAttribute("jStorage_update")}catch(t){}}e&&e!=E&&(E=e,o())},25)}function o(){var e,i=v.parse(v.stringify(_.__jstorage_meta.CRC32));t(),e=v.parse(v.stringify(_.__jstorage_meta.CRC32));var n,o=[],a=[];for(n in i)if(i.hasOwnProperty(n)){if(!e[n]){a.push(n);continue}i[n]!=e[n]&&"2."==String(i[n]).substr(0,2)&&o.push(n)}for(n in e)e.hasOwnProperty(n)&&(i[n]||o.push(n));r(o,"updated"),r(a,"deleted")}function r(e,t){e=[].concat(e||[]);var i,n,o,r;if("flushed"==t){e=[];for(var a in S)S.hasOwnProperty(a)&&e.push(a);t="deleted"}for(i=0,o=e.length;o>i;i++){if(S[e[i]])for(n=0,r=S[e[i]].length;r>n;n++)S[e[i]][n](e[i],t);if(S["*"])for(n=0,r=S["*"].length;r>n;n++)S["*"][n](e[i],t)}}function a(){var e=(+new Date).toString();if("localStorage"==C||"globalStorage"==C)try{w.jStorage_update=e}catch(t){C=!1}else"userDataBehavior"==C&&(k.setAttribute("jStorage_update",e),k.save("jStorage"));n()}function s(){if(w.jStorage)try{_=v.parse(String(w.jStorage))}catch(e){w.jStorage="{}"}else w.jStorage="{}";x=w.jStorage?String(w.jStorage).length:0,_.__jstorage_meta||(_.__jstorage_meta={}),_.__jstorage_meta.CRC32||(_.__jstorage_meta.CRC32={})}function l(){g();try{w.jStorage=v.stringify(_),k&&(k.setAttribute("jStorage",w.jStorage),k.save("jStorage")),x=w.jStorage?String(w.jStorage).length:0}catch(e){}}function c(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==e)throw new TypeError("Reserved key name");return!0}function u(){var e,t,i,n,o=1/0,s=!1,c=[];if(clearTimeout(y),_.__jstorage_meta&&"object"==typeof _.__jstorage_meta.TTL){e=+new Date,i=_.__jstorage_meta.TTL,n=_.__jstorage_meta.CRC32;for(t in i)i.hasOwnProperty(t)&&(i[t]<=e?(delete i[t],delete n[t],delete _[t],s=!0,c.push(t)):i[t]<o&&(o=i[t]));1/0!=o&&(y=setTimeout(u,Math.min(o-e,2147483647))),s&&(l(),a(),r(c,"deleted"))}}function d(){var e,t;if(_.__jstorage_meta.PubSub){var i,n=$;for(e=t=_.__jstorage_meta.PubSub.length-1;e>=0;e--)i=_.__jstorage_meta.PubSub[e],i[0]>$&&(n=i[0],h(i[1],i[2]));$=n}}function h(e,t){if(T[e])for(var i=0,n=T[e].length;n>i;i++)try{T[e][i](e,v.parse(v.stringify(t)))}catch(o){}}function g(){if(_.__jstorage_meta.PubSub){for(var e=+new Date-2e3,t=0,i=_.__jstorage_meta.PubSub.length;i>t;t++)if(_.__jstorage_meta.PubSub[t][0]<=e){_.__jstorage_meta.PubSub.splice(t,_.__jstorage_meta.PubSub.length-t);break}_.__jstorage_meta.PubSub.length||delete _.__jstorage_meta.PubSub}}function p(e,t){_.__jstorage_meta||(_.__jstorage_meta={}),_.__jstorage_meta.PubSub||(_.__jstorage_meta.PubSub=[]),_.__jstorage_meta.PubSub.unshift([+new Date,e,t]),l(),a()}/**
     * JS Implementation of MurmurHash2
     *
     *  SOURCE: https://github.com/garycourt/murmurhash-js (MIT licensed)
     *
     * @author <a href='mailto:gary.court@gmail.com'>Gary Court</a>
     * @see http://github.com/garycourt/murmurhash-js
     * @author <a href='mailto:aappleby@gmail.com'>Austin Appleby</a>
     * @see http://sites.google.com/site/murmurhash/
     *
     * @param {string} str ASCII only
     * @param {number} seed Positive integer only
     * @return {number} 32-bit positive integer hash
     */
function m(e,t){for(var i,n=e.length,o=t^n,r=0;n>=4;)i=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24,i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16),i^=i>>>24,i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^i,n-=4,++r;switch(n){case 3:o^=(255&e.charCodeAt(r+2))<<16;case 2:o^=(255&e.charCodeAt(r+1))<<8;case 1:o^=255&e.charCodeAt(r),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)}return o^=o>>>13,o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16),o^=o>>>15,o>>>0}var f="0.4.11",b=window.jQuery||window.$||(window.$={}),v={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(e){return String(e).evalJSON()}||b.parseJSON||b.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||b.toJSON};if("function"!=typeof v.parse||"function"!=typeof v.stringify)throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var y,_={__jstorage_meta:{CRC32:{}}},w={jStorage:"{}"},k=null,x=0,C=!1,S={},A=!1,E=0,T={},$=+new Date,M={isXML:function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?"HTML"!==t.nodeName:!1},encode:function(e){if(!this.isXML(e))return!1;try{return(new XMLSerializer).serializeToString(e)}catch(t){try{return e.xml}catch(i){}}return!1},decode:function(e){var t,i="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t};return i?(t=i.call("DOMParser"in window&&new DOMParser||window,e,"text/xml"),this.isXML(t)?t:!1):!1}};b.jStorage={version:f,set:function(e,t,i){if(c(e),i=i||{},"undefined"==typeof t)return this.deleteKey(e),t;if(M.isXML(t))t={_is_xml:!0,xml:M.encode(t)};else{if("function"==typeof t)return void 0;t&&"object"==typeof t&&(t=v.parse(v.stringify(t)))}return _[e]=t,_.__jstorage_meta.CRC32[e]="2."+m(v.stringify(t),2538058380),this.setTTL(e,i.TTL||0),r(e,"updated"),t},get:function(e,t){return c(e),e in _?_[e]&&"object"==typeof _[e]&&_[e]._is_xml?M.decode(_[e].xml):_[e]:"undefined"==typeof t?null:t},deleteKey:function(e){return c(e),e in _?(delete _[e],"object"==typeof _.__jstorage_meta.TTL&&e in _.__jstorage_meta.TTL&&delete _.__jstorage_meta.TTL[e],delete _.__jstorage_meta.CRC32[e],l(),a(),r(e,"deleted"),!0):!1},setTTL:function(e,t){var i=+new Date;return c(e),t=Number(t)||0,e in _?(_.__jstorage_meta.TTL||(_.__jstorage_meta.TTL={}),t>0?_.__jstorage_meta.TTL[e]=i+t:delete _.__jstorage_meta.TTL[e],l(),u(),a(),!0):!1},getTTL:function(e){var t,i=+new Date;return c(e),e in _&&_.__jstorage_meta.TTL&&_.__jstorage_meta.TTL[e]?(t=_.__jstorage_meta.TTL[e]-i,t||0):0},flush:function(){return _={__jstorage_meta:{CRC32:{}}},l(),a(),r(null,"flushed"),!0},storageObj:function(){function e(){}return e.prototype=_,new e},index:function(){var e,t=[];for(e in _)_.hasOwnProperty(e)&&"__jstorage_meta"!=e&&t.push(e);return t},storageSize:function(){return x},currentBackend:function(){return C},storageAvailable:function(){return!!C},listenKeyChange:function(e,t){c(e),S[e]||(S[e]=[]),S[e].push(t)},stopListening:function(e,t){if(c(e),S[e]){if(!t)return void delete S[e];for(var i=S[e].length-1;i>=0;i--)S[e][i]==t&&S[e].splice(i,1)}},subscribe:function(e,t){if(e=(e||"").toString(),!e)throw new TypeError("Channel not defined");T[e]||(T[e]=[]),T[e].push(t)},publish:function(e,t){if(e=(e||"").toString(),!e)throw new TypeError("Channel not defined");p(e,t)},reInit:function(){t()},noConflict:function(e){return delete window.$.jStorage,e&&(window.jStorage=this),this}},e()}(),define("jstorage",function(){}),define("lib/localstorage",["globals","log","jstorage"],function(e,t){t.module("lib/localstorage");var i={get:function(e,t){return $.jStorage.get(e,t)},set:function(t,i,n){return e.MAPPED&&AboutMe.trigger("mapped:storage:set",t,i,n),$.jStorage.set(t,i,n)},index:function(){return $.jStorage.index()},flush:function(){return $.jStorage.flush()},deleteKey:function(e){return $.jStorage.deleteKey(e)}};return i}),define("controller/viewer_groups",["require","globals","marionette","model/user","model/member","model/group","list/grouplist","lib/localstorage","log","viewer"],function(e){var t=e("globals"),i=e("marionette"),n=(e("model/user"),e("model/member"),e("model/group")),o=e("list/grouplist"),r=e("lib/localstorage"),a=e("log");a.module("controller/viewer_groups");var s,l=a.viewer||a.create("viewer","background-color:green;color:white"),c=i.Controller.extend({defaults:{uselocalstorage:!0},initialize:function(i){this.options=_.extend({},this.defaults,i),(t.MAPPED||t.FRAMED)&&(this.options.uselocalstorage=!1,this.purge()),s=e("viewer"),s.get("groups_updated")&&this.purge(),s.model.grouplist=this.initializeGroupList(),this.store=_.debounce(this.store,100),this.listenTo(s.model.grouplist,"add remove change",this.store),this.listenTo(AboutMe,"account:deleted",this.purge)},onEvent:function(e){l("Viewer.Groups",e)},isUserInGroup:function(e,t){return"string"==typeof t&&(t=s.model.grouplist.findWhere({name:t})),t instanceof n?t.memberlist.hasUser(e):void 0},initializeGroupList:function(){l("Viewer.Groups.fetch");var e=new o;if(e.user_name=s.get("user_name"),s.is("logged_in")){if(this.options.uselocalstorage){var t=r.get("viewer_groups");if(t&&t.data&&s.isUser(t.user_name))return l("Viewer.Groups in localstorage"),e.reset(t.data,{silent:!0}),e.trigger("ready"),e;e.when("ready",this.store,this)}l("Viewer.Groups not in localstorage; fetching via ajax"),e.fetch()}return e},purge:function(){l("Viewer.Groups.purge"),r.set("viewer_groups",null)},store:function(){this.options.uselocalstorage&&(l("Viewer.Groups.store"),r.set("viewer_groups",{user_name:s.get("user_name"),data:s.model.grouplist.toJSON()},{TTL:36e5}))}});return c}),function(e){e.isInArray=function(t,i){return e.inArray(t,i)>-1}}(jQuery),define("isInArray",function(){}),define("viewer",["require","globals","marionette","lib/backbone.when","model/viewer_model","controller/viewer_groups","log","doTimeout","isInArray"],function(e){var t=(e("globals"),e("marionette")),i=e("lib/backbone.when"),n=e("model/viewer_model"),o=e("controller/viewer_groups"),r=e("log");e("doTimeout"),e("isInArray"),r.module("controller/viewer");var a=r.viewer||r.create("viewer","background-color:green;color:white"),s=$("html"),l=t.Controller.extend({initialize:function(){this.model=new n,this.model.when("ready",this.onReady,this)},onReady:function(){this.logged_in=this.is("logged_in"),this.anonymous=!this.logged_in,a("Viewer is"+(this.logged_in?"":" not")+" logged in");var e=this.logged_in?"logged-in":"logged-out";s.addClass(e),this.Groups=new o,this.logged_in&&window.Raven&&Raven.setUser({user_name:this.get("user_name")}),this.trigger("ready")},get:function(){return this.model.get.apply(this.model,arguments)},escape:function(){return this.model.escape.apply(this.model,arguments)},set:function(){return this.model.set.apply(this.model,arguments)},is:function(){return this.model.is.apply(this.model,arguments)},isNot:function(){return this.model.isNot.apply(this.model,arguments)},isUser:function(){return this.logged_in?this.model.isUser.apply(this.model,arguments):!1}});i.applyTo(l);var c=new l;return c}),define("editmode",["globals","log","viewer"],function(e,t,i){return t.module("controller/editmode"),i.logged_in?"user"!==e.PAGE?!1:e.MAPPED?!1:e.PAGE_USER_NAME?i.isUser(e.PAGE_USER_NAME):!1:!1}),define("lib/query",["log"],function(e){e.module("lib/query");var t=function(e,t){var i="";return e=e||"?",t=t||document.location.href,t.indexOf(e)>-1&&(i=t.substring(t.indexOf(e)+e.length,t.length)),i},n=function(e,n,o,r){var a=new Array,s=t(e,n),o=o||"&";if(null===r&&(r="="),s){var l=s.split(o);if(r)for(i=0;i<l.length;i++){var c=l[i];a[c.split(r)[0]]=unescape(c.split(r)[1])}else a=l}return a},o=function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")};return{get:t,parse:n,encode:o}}),define("lib/escape",["log"],function(e){e.module("lib/escape");var t={listening:!1,stack:[],handlers:{},focushandlers:{},listen:function(t,i,n){return t&&$.isFunction(i)?(this.unlisten(t),this.stack.unshift(t),this.handlers[t]=i,$.isFunction(n)&&(this.focushandlers[t]=n),void this._on()):e.error("Escape.listen requires an id and a handler function")},unlisten:function(e){var t=$.inArray(e,this.stack);if(t>-1&&this.stack.splice(t,1),delete this.handlers[e],delete this.focushandlers[e],0==t&&this.stack.length){var e=this.stack[0];e&&this.focushandlers[e]&&this.focushandlers[e]()}this._off()},trigger:function(){var e=this.stack[0];e&&this.handlers[e]&&this.handlers[e]()},validateKey:function(e){return e.which===$.ui.keyCode.ESCAPE?!0:!1},_on:function(){this.listening||($(window).on("keyup.escape",function(e){t.validateKey(e)&&t.trigger()}),this.listening=!0)},_off:function(){this.stack.length||($(window).off("keyup.escape"),this.listening=!1)}};return t}),define("lib/disablescroll",["globals","log","lib/event","doTimeout","isInArray"],function(e,t,i){t.module("lib/disablescroll");var n={stack:[],on:function(i){return"user"!=e.PAGE?i?void($.isInArray(i,this.stack)||(this.stack.push(i),this._disableScrolling())):t.error("DisableScroll requires an id"):void 0},off:function(i){if("user"!=e.PAGE){if(!i)return t.error("DisableScroll.off requires an id");var n=$.inArray(i,this.stack);n>-1&&this.stack.splice(n,1),t(this.stack),0==this.stack.length&&this._enableScrolling()}},_disableScrolling:function(){if(!$("html").data("scrolldisabled")){$("html").data("scrolldisabled",!0);var e=$("body").width(),n=$("body").height(),o=$(window).scrollTop(),r=$(".ui-dialog.customize:visible");if(r.length){r.data("original_style",r.attr("style"));var a=r.offset().top-o,s=r.offset().left;t([a,s]),r.css({position:"fixed",top:a+"px",left:s+"px"})}$(".page-content").css({position:"absolute",top:"-"+o+"px",left:"0px",width:"100%",height:n+"px",overflow:"visible"}),$(".page-container").css({position:"fixed",top:"0px",left:"0px",width:"100%",height:"100%",overflow:"hidden"}),$(window).scrollTop(0);var l=$("body").width();e!=l&&$("html").css("overflow-y","scroll"),i.trigger("scrolling_disabled")}},_enableScrolling:function(){if($("html").data("scrolldisabled")){var e=$(".page-content").css("top");e=Math.abs(parseInt(e)),$(".page-container,.page-content").removeAttr("style"),$("html").css("overflow-y",""),$(window).scrollTop(e);var t=$(".ui-dialog.customize:visible");if(t.length){var n=t.data("original_style");n&&t.attr("style",n)}$("html").removeData("scrolldisabled"),i.trigger("scrolling_enabled")}}};return n}),function(e){e.fn.vhide=function(){return this.each(function(){e(this).css("visibility","hidden")})},e.fn.vshow=function(){return this.each(function(){e(this).css("visibility","inherit")})}}(jQuery),define("vhide",function(){}),define("class/progressbar",["globals","log","vhide"],function(e,t){t.module("class/progressbar");var i=function(e,t,i){var n=this;n.node=$(e),this.o=$.extend({maxwidth:600,empty:!0,autowidth:!0},i),n.o.empty?n.node.html(n.template):n.node.prepend(n.template),n.node.find(".progress-message span").html(t),n.node.addClass("progressbar"),this.init()};return i.prototype={template:'<div class="progress-message"><span></span></div><div class="progress-bar"></div>',init:function(){var e=this;e.left=0,e.checkWidth(),$.doTimeout(100,function(){e.checkWidth()})},checkWidth:function(){var e=this;if(e.o.autowidth){e.node.css("width",e.o.maxwidth+"px").vhide().show();var t=e.node.find(".progress-message span").width();e.node.css("width",t+40).vshow()}else e.o.width==Number(e.o.width)&&e.node.css("width",e.o.width+"px")},destroy:function(){var e=this;e.node.find(".progress-message,.progress-bar").remove(),e.node.removeClass("progressbar"),$.removeData(e.node,"progressbar")}},$.fn.progressbar=function(e,t){return e||t||!$(this).data("progressbar")?this.each(function(){$(this).data("progressbar",new i(this,e,t))}):$(this).data("progressbar")},i}),define("lib/dialog",["require","globals","marionette","lib/event","viewport","lib/utils","lib/escape","lib/disablescroll","log","class/progressbar","doTimeout","cookie","isInArray"],function(e){var t=(e("globals"),e("marionette")),i=e("lib/event"),n=e("viewport"),o=e("lib/utils"),r=e("lib/escape"),a=e("lib/disablescroll"),s=e("log");e("class/progressbar"),e("doTimeout"),e("cookie"),e("isInArray"),s.module("lib/dialog");var l=(s.create("dialog","background-color:teal;color:white"),{modals:[],config:{modal:{status:"info",modal:"true",disableScrolling:!0,width:350,position:{my:"top",at:"top+200px",of:window},autoDestroy:!0,clickOverlayToClose:!1,buttons:{OK:function(){$(this).dialog("close")}}},modaldefaults:{},bubble:{status:"info",type:"default",sticky:!1,width:250,delayduration:2e3,fadeduration:500,dismissible:!0,multiple:!0,customcss:"",classname:""},banner:{status:"confirmation",duration:5e3,closeOnEscape:!0,fadeduration:500,position:top},allowed:{statuses:["info","confirmation","warning","error"],placements:["before","after","replace","append","prepend"],showmethods:["slide","fade","show"]}},init:function(){},UI:{create:function(e,n,o){var r=$(this),a=r.closest(".ui-dialog"),s=r.dialog("option","id");a.addClass(s),l.UI.buttons.call(this),a.find(".ui-dialog-titlebar-close, .closebutton, .closelink, .cancel").on("click",function(e){e.preventDefault(),i.trigger("modal_cancel."+s)}),a.find(".ui-dialog-titlebar-close").on("mousedown",function(){return!1}),a.find(".ui-dialog-titlebar-close").empty().html("&nbsp;").addClass("glyph-close glyph-center"),r.dialog("option","modal")===!0&&a.addClass("modal");var c=$.trim(r.dialog("option","title"));c||a.addClass("unruled");var u=r.dialog("option","modalView");if(u){_.isFunction(u)&&(u=u.call(),r.dialog("option","modalView",u));var d=new t.Region({el:r});r.dialog("option","region",d)}o.create&&o.create.apply(this,[e,n])},beforeOpen:function(){var e=$(this),t=e.dialog("option","id");e.dialog("option","disableScrolling")&&a.on(t)},open:function(e,t,o){var a=$(this),s=a.closest(".ui-dialog"),l=$(".ui-widget-overlay").last(),c=a.dialog("option","id");i.on("modal_cancel."+c,function(){a.dialog("close")});var u=a.dialog("option","autoCenter");if(u){var d=function(){if(!n.is("small")){var e=a.dialog("option","position");a.dialog("option","position",e)}};a.on("opened resized",d),AboutMe.on("window:resize window:orientationchange",d),a.on("dialogclose",function(){AboutMe.off("window:resize window:orientationchange",d)})}a.dialog("option","modal")&&$.doTimeout(10,function(){$("body").addClass("modal-open")}),o.closeOnEscape&&r.listen(c,function(){i.trigger("modal_cancel."+c)});var h=a.dialog("option","clickOverlayToClose");h&&l.on("click",function(){var e=!0;_.isFunction(h)&&(e=h.call(a)),e&&i.trigger("modal_cancel."+c)});var g=a.dialog("option","overlayClass");g&&l.addClass(g);var p=a.dialog("option","modalView");if(p){var m=a.dialog("option","region");p.on("close cancel",function(){i.trigger("modal_cancel."+c)}),m.show(p)}i.trigger("modal_open",[c]),o.open&&o.open.apply(this,[e,t]),s.addClass("active"),l.addClass("active"),a.trigger("opened")},close:function(e,t,n){var o=$(this),s=o.closest(".ui-dialog"),l=s.next(".ui-widget-overlay"),c=o.dialog("option","id");n.closeOnEscape&&r.unlisten(c),o.dialog("option","clickOverlayToClose")&&l.off("click"),o.dialog("option","disableScrolling")&&a.off(c);var u=o.dialog("option","modalView");if(u){var d=o.dialog("option","region");u.off(),d.empty()}o.dialog("option","autoDestroy")===!0&&(o.dialog("destroy"),o.remove()),i.off("modal_cancel."+c),i.trigger("modal_close."+c),n.close&&n.close.apply(this,[e,t]),$(".ui-dialog.modal:visible").length||$.doTimeout(10,function(){$("body").removeClass("modal-open")}),o.off(),s.off(),l.off()},buttons:function(){var e=$(this),t=e.closest(".ui-dialog");t.find(".ui-dialog-buttonset").addClass("buttons large").find("button").addClass("button large").first().addClass("dark blue")}},bubble:function(e,t){if(e){if(t=$.extend({},l.config.bubble,t),"ok"==t.status&&(t.status="confirmation"),-1==$.inArray(t.status,l.config.allowed.statuses))throw"Invalid banner status: "+t.status;$(".bubbles").length||$("body").append('<div class="bubbles"></div>');var i="";i+='<div class="notification bubble bubble-'+t.type+" invisible "+t.classname+'">',i+='<div class="bubble-content">',i+='<div class="bubble-control bubble-close glyph-close glyph-center"></div>',i+='<div class="message-content">'+e+"</div>",i+="</div>",i+="</div>";var n=$(i),a=o.id("bubble");n.appendTo("div.bubbles"),t.customcss&&n.css(t.customcss),n.css("width",t.width);var s=function(){n.animate({opacity:0},200,function(){n.remove()}),r.unlisten(a)};return $.doTimeout(t.type,t.delayduration,function(){n.fadeIn(t.fadeduration),n.removeClass("invisible")}),t.dismissible?(r.listen(a,s),n.find(".bubble-close").click(function(){s()})):n.find(".bubble-close").remove(),t.afterInit&&t.afterInit.apply(n),n}},modal:function(e,t){if(e){var i=$.extend({},l.config.modal,t,l.config.modaldefaults);e.indexOf("<p>")<0&&(e="<p>"+e+"</p>");var o=$('<div class="alert-message">'+e+"</div>");i.dialogClass+=" modal-"+i.status,n.is("small")&&(i.width=n.get("mobile_width")),o.dialog(i),o.removeAttr("style");{o.closest(".ui-dialog")}return o}},banner:function(e,t){if(e){var a={};if($.extend(a,l.config.banner,t),"ok"==a.status&&(a.status="confirmation"),-1==$.inArray(a.status,l.config.allowed.statuses))throw"Invalid banner status: "+a.status;var s="";s+='<div class="notification banner banner-'+a.status+'">',s+='<div class="banner-center"><div class="banner-wrap">',s+='<div class="banner-content">',s+='<div class="banner-close glyph-close glyph-center">&nbsp;</div>',s+='<div class="message-content">'+e+"</div>",s+="</div>",s+="</div></div>",s+="</div>";var c=$(s),u=o.id("banner"),d=function(e){var t=function(){c.trigger("close"),$.isFunction(e)&&e()};n.isNot("small")?c.fadeOut(a.fadeduration,t):(c.addClass("fadeslow"),$.doTimeout(500,t))},h=function(e){c.fadeOut(200,function(){c.trigger("close"),$.isFunction(e)&&e()})},g=function(e){c.trigger("close"),$.isFunction(e)&&e()},p=function(){clearTimeout(c.data("timer"))},m=function(){p(),c.data("timer",setTimeout(d,a.duration))};return m(),c.find(".banner-content").hover(p,m),c.find(".banner-close").click(function(){p(),d()}),i.trigger("banner_open",[c]),a.closeOnEscape&&r.listen(u,d),c.appendTo("body"),c.find(".message-content").height()>50&&c.addClass("large"),i.on("modal_open."+u,function(){h()}),i.on("carousel_scrolled."+u,function(){h()}),i.on("banner_open."+u,function(){g()}),i.on("menu_show."+u,function(e,t){t.node.closest(".topnav").length&&h()}),c.on("close",function(){c.off(),c.removeData(),c.remove(),i.off("banner_open."+u),i.off("modal_open."+u),i.off("carousel_scrolled."+u),i.off("menu_show."+u),a.closeOnEscape&&r.unlisten(u)}),c}},error:function(e,t){t=$.extend({title:"Its not you, its us"},t),t.status="error";var i=l.modal(e,t);return i.closest(".ui-dialog").addClass("modal-error"),i},alert:function(e,t){t=t||{},t.status="alert";var i=l.modal(e,t);return i},progressmodal:function(e,t){t=$.extend({closeOnEscape:!1},t),t.status="progress";var i=l.modal(e,t),n=i.closest(".ui-dialog");return n.find(".ui-dialog-titlebar").hide(),n.find(".ui-dialog-buttonpane").remove(),i.html('<div class="progressbar" />'),i.find("div.progressbar").progressbar(e,{autowidth:!1}),i},confirm:function(e,t,n){if("function"!=typeof t)throw"Invalid handler function.";n=$.extend({title:"Confirmation"},n),n.status="confirm";var r=l.modal(e,n),a=r.dialog("option","id"),s=(r.closest(".ui-dialog"),n.button_labels||["Yes","No"]),c={};return c[s[0]]=function(){i.trigger("modal_confirm."+a)},c[s[1]]=function(){i.trigger("modal_cancel."+a)},r.dialog("option","buttons",c),i.on("keyup.confirm-"+a,function(e){o.handleReturnKey(e,function(){i.trigger("modal_confirm."+a)})}),i.on("modal_confirm."+a,function(){t(!0),r.dialog("close")}),i.on("modal_cancel."+a,function(){t(!1)}),i.one("modal_close."+a,function(){i.off("keyup.confirm_"+a),i.off("modal_confirm."+a)}),r}}),c={init:function(){this.dialogHandler(),AboutMe.whenever("viewport:small",function(){$(".ui-dialog").find(".ui-dialog-content").dialog("close")}),AboutMe.whenever("viewport:not:small",function(){$(".ui-dialog").find(".ui-dialog-content").dialog("close")})},dialogHandler:function(){if(!n.isNot("small")){var e=0;$("body").on("dialogcreate dialogbeforeopen",".ui-dialog-content",function(){e=$(window).scrollTop()}),$("body").on("dialogclose",".ui-dialog-content",function(){$.doTimeout(100,function(){$(window).scrollTop(e)})})}}};return $.fn.uidialog=$.fn.dialog,$.fn.dialog=function(){var e=_.toArray(arguments),t=e.shift();if(_.isObject(t))var i={create:t.create,open:t.open,close:t.close,autoOpen:t.autoOpen===!1?!1:!0,closeOnEscape:t.closeOnEscape===!1?!1:!0},n={autoOpen:!1,closeOnEscape:!1,create:function(e,t){l.UI.create.apply(this,[e,t,i]),i.autoOpen&&$(this).dialog("open")},beforeOpen:function(e,t){l.UI.beforeOpen.apply(this,[e,t,i])},open:function(e,t){l.UI.open.apply(this,[e,t,i])},close:function(e,t){l.UI.close.apply(this,[e,t,i])}},r=t.top||60,a={my:"top",at:"top+"+r+"px",of:window},t=_.extend({id:o.id("dialog"),modal:!0,draggable:!1,resizable:!1,autoCenter:!0,minHeight:"auto",clickOverlayToClose:!1,position:a},t,n);else if(_.isString(t))switch(t){case"open":var s=$(this).dialog("option","beforeOpen");$.isFunction(s)&&s.call(this)}e.unshift(t);var c=$(this).uidialog.apply(this,e);return"option"===e[0]&&"buttons"===e[1]&&e[2]&&l.UI.buttons.call(this),c},$(document).ready(function(){l.init(),c.init()}),l}),define("lib/colorthief",["log"],function(e){/*!
	 * quantize.js Copyright 2008 Nick Rabinowitz.
	 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
	 */
/*!
	 * Block below copied from Protovis: http://mbostock.github.com/protovis/
	 * Copyright 2010 Stanford Visualization Group
	 * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
	 */
if(e.module("lib/colorthief"),!t)var t={map:function(e,t){var i={};return t?e.map(function(e,n){return i.index=n,t.call(i,e)}):e.slice()},naturalOrder:function(e,t){return t>e?-1:e>t?1:0},sum:function(e,t){var i={};return e.reduce(t?function(e,n,o){return i.index=o,e+t.call(i,n)}:function(e,t){return e+t},0)},max:function(e,i){return Math.max.apply(null,i?t.map(e,i):e)}};var i=function(){function e(e,t,i){return(e<<2*c)+(t<<c)+i}function i(e){function t(){i.sort(e),n=!0}var i=[],n=!1;return{push:function(e){i.push(e),n=!1},peek:function(e){return n||t(),void 0===e&&(e=i.length-1),i[e]},pop:function(){return n||t(),i.pop()},size:function(){return i.length},map:function(e){return i.map(e)},debug:function(){return n||t(),i}}}function n(e,t,i,n,o,r,a){var s=this;s.r1=e,s.r2=t,s.g1=i,s.g2=n,s.b1=o,s.b2=r,s.histo=a}function o(){this.vboxes=new i(function(e,i){return t.naturalOrder(e.vbox.count()*e.vbox.volume(),i.vbox.count()*i.vbox.volume())})}function r(t){var i,n,o,r,a=1<<3*c,s=new Array(a);return t.forEach(function(t){n=t[0]>>u,o=t[1]>>u,r=t[2]>>u,i=e(n,o,r),s[i]=(s[i]||0)+1}),s}function a(e,t){var i,o,r,a=1e6,s=0,l=1e6,c=0,d=1e6,h=0;return e.forEach(function(e){i=e[0]>>u,o=e[1]>>u,r=e[2]>>u,a>i?a=i:i>s&&(s=i),l>o?l=o:o>c&&(c=o),d>r?d=r:r>h&&(h=r)}),new n(a,s,l,c,d,h,t)}function s(i,n){function o(e){var t,i,o,r,a,s=e+"1",l=e+"2",u=0;for(c=n[s];c<=n[l];c++)if(m[c]>p/2){for(o=n.copy(),r=n.copy(),t=c-n[s],i=n[l]-c,a=i>=t?Math.min(n[l]-1,~~(c+i/2)):Math.max(n[s],~~(c-1-t/2));!m[a];)a++;for(u=f[a];!u&&m[a-1];)u=f[--a];return o[l]=a,r[s]=o[l]+1,[o,r]}}if(n.count()){var r=n.r2-n.r1+1,a=n.g2-n.g1+1,s=n.b2-n.b1+1,l=t.max([r,a,s]);if(1==n.count())return[n.copy()];var c,u,d,h,g,p=0,m=[],f=[];if(l==r)for(c=n.r1;c<=n.r2;c++){for(h=0,u=n.g1;u<=n.g2;u++)for(d=n.b1;d<=n.b2;d++)g=e(c,u,d),h+=i[g]||0;p+=h,m[c]=p}else if(l==a)for(c=n.g1;c<=n.g2;c++){for(h=0,u=n.r1;u<=n.r2;u++)for(d=n.b1;d<=n.b2;d++)g=e(u,c,d),h+=i[g]||0;p+=h,m[c]=p}else for(c=n.b1;c<=n.b2;c++){for(h=0,u=n.r1;u<=n.r2;u++)for(d=n.g1;d<=n.g2;d++)g=e(u,d,c),h+=i[g]||0;p+=h,m[c]=p}return m.forEach(function(e,t){f[t]=p-e}),o(l==r?"r":l==a?"g":"b")}}function l(e,n){function l(e,t){for(var i,n=1,o=0;d>o;)if(i=e.pop(),i.count()){var r=s(c,i),a=r[0],l=r[1];if(!a)return;if(e.push(a),l&&(e.push(l),n++),n>=t)return;if(o++>d)return}else e.push(i),o++}if(!e.length||2>n||n>256)return!1;var c=r(e),u=0;c.forEach(function(){u++});var g=a(e,c),p=new i(function(e,i){return t.naturalOrder(e.count(),i.count())});p.push(g),l(p,h*n);for(var m=new i(function(e,i){return t.naturalOrder(e.count()*e.volume(),i.count()*i.volume())});p.size();)m.push(p.pop());l(m,n-m.size());for(var f=new o;m.size();)f.push(m.pop());return f}var c=5,u=8-c,d=1e3,h=.75;return n.prototype={volume:function(e){var t=this;return(!t._volume||e)&&(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(t){var i=this,n=i.histo;if(!i._count_set||t){var o,r,a,s=0;for(o=i.r1;o<=i.r2;o++)for(r=i.g1;r<=i.g2;r++)for(a=i.b1;a<=i.b2;a++)index=e(o,r,a),s+=n[index]||0;i._count=s,i._count_set=!0}return i._count},copy:function(){var e=this;return new n(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(t){var i=this,n=i.histo;if(!i._avg||t){var o,r,a,s,l,u=0,d=1<<8-c,h=0,g=0,p=0;for(r=i.r1;r<=i.r2;r++)for(a=i.g1;a<=i.g2;a++)for(s=i.b1;s<=i.b2;s++)l=e(r,a,s),o=n[l]||0,u+=o,h+=o*(r+.5)*d,g+=o*(a+.5)*d,p+=o*(s+.5)*d;i._avg=u?[~~(h/u),~~(g/u),~~(p/u)]:[~~(d*(i.r1+i.r2+1)/2),~~(d*(i.g1+i.g2+1)/2),~~(d*(i.b1+i.b2+1)/2)]}return i._avg},contains:function(e){var t=this,i=e[0]>>u;return gval=e[1]>>u,bval=e[2]>>u,i>=t.r1&&i<=t.r2&&gval>=t.g1&&i<=t.g2&&bval>=t.b1&&i<=t.b2}},o.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,i=0;i<t.size();i++)if(t.peek(i).vbox.contains(e))return t.peek(i).color;return this.nearest(e)},nearest:function(e){for(var t,i,n,o=this.vboxes,r=0;r<o.size();r++)i=Math.sqrt(Math.pow(e[0]-o.peek(r).color[0],2)+Math.pow(e[1]-o.peek(r).color[1],2)+Math.pow(e[1]-o.peek(r).color[1],2)),(t>i||void 0===t)&&(t=i,n=o.peek(r).color);return n},forcebw:function(){var e=this.vboxes;e.sort(function(e,i){return t.naturalOrder(t.sum(e.color),t.sum(i.color))});var i=e[0].color;i[0]<5&&i[1]<5&&i[2]<5&&(e[0].color=[0,0,0]);var n=e.length-1,o=e[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(e[n].color=[255,255,255])}},{quantize:l}}(),n=function(e){imgEl=e.jquery?e[0]:e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=imgEl.width,this.height=this.canvas.height=imgEl.height,this.context.drawImage(imgEl,0,0,this.width,this.height)};n.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},n.prototype.update=function(e){this.context.putImageData(e,0,0)},n.prototype.getPixelCount=function(){return this.width*this.height},n.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},n.prototype.removeCanvas=function(){$(this.canvas).remove()};var o=function(e){var t=r(e,5),i=t[0];return i},r=function(e,t){try{var o=new n(e),r=o.getImageData(),a=r.data,s=o.getPixelCount()}catch(l){return o.removeCanvas(),"error"}for(var c,u,d,h,g,p=[],m=0;s>m;m++)c=4*m,u=a[c+0],d=a[c+1],h=a[c+2],g=a[c+3],g>=125&&(u>250&&d>250&&h>250||p.push([u,d,h]));var f=i.quantize(p,t),b=f.palette();return o.removeCanvas(),b},a=function(e){for(var t=10,i=new n(e),o=i.getImageData(),r=o.data,a=i.getPixelCount(),s=0,l={r:0,g:0,b:0},c=0;a>c;c+=4*t)r[c+3]>200&&(++s,l.r+=r[c],l.g+=r[c+1],l.b+=r[c+2]);return l.r=~~(l.r/s),l.g=~~(l.g/s),l.b=~~(l.b/s),l},s=function(e,t){for(var i,o=[],r=new n(e),a=r.getImageData(),s=a.data,l=(r.getPixelCount(),Math.round(Math.sqrt(t))),c=l,u=Math.round(r.width/c),d=Math.round(r.height/l),h=0;l>h;h++){i=h*d*r.width*4;for(var g,p,m,f=0;c>f;f++){g=f*u*4,p={r:0,g:0,b:0},m=0;for(var b,v=0;d>v;v++){b=v*r.width*4;for(var y,_=0;u>_;_++)y=i+g+b+4*_,p.r+=s[y],p.g+=s[y+1],p.b+=s[y+2],m++}p.r=~~(p.r/m),p.g=~~(p.g/m),p.b=~~(p.b/m),o.push(p)}}return o};return{getDominantColor:o,createPalette:r,getAverageRGB:a,createAreaBasedPalette:s}}),define("lib/color",["log","lib/colorthief"],function(e,t){e.module("lib/color");var i=(e.create("color","background-color:#33afa5;color:white;border:1px solid red;"),{getDecimalTriplet:function(e){var t=[];return t[0]=parseInt(e.slice(0,2),16),t[1]=parseInt(e.slice(2,4),16),t[2]=parseInt(e.slice(4),16),t},getHexByte:function(e){var t=e.toString(16);return t.length<2&&(t="0"+t),t},getHexTriplet:function(e){var t=i.getHexByte(e[0])+i.getHexByte(e[1])+i.getHexByte(e[2]);return t},getDominant:function(e){var n=t.getAverageRGB(e),o=i.getHexTriplet([n.r,n.g,n.b]);return o},getComplimentary:function(e){var t="0xFFFFFF",n="0x"+e,o=(t^n).toString(16);return i.getAdjustedLuminance(o)},getGoodColor:function(e,t){t=t||[255,255,255],e=e||Math.floor(16777215*Math.random()).toString(16);var n=i.getDecimalTriplet(e);return n[0]=Math.round((n[0]+t[0])/2),n[1]=Math.round((n[1]+t[1])/2),n[2]=Math.round((n[2]+t[2])/2),e=i.getHexTriplet(n)},getAdjustedLuminance:function(e){for(;"toolight"==i.getLuminanceRange(e);)e=i.getIdealColor(e,-.1);for(;"toodark"==i.getLuminanceRange(e);)e=i.getIdealColor(e,.1);return e},getLuminanceRange:function(e){var t,i=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16),r=(299*i+587*n+114*o)/1e3;return 100>=r?t="toodark":r>100&&128>=r?t="dark":r>128&&165>=r?t="light":r>165&&(t="toolight"),t},getIdealColor:function(e,t){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var i,n,o="";for(n=0;3>n;n++)i=parseInt(e.substr(2*n,2),16),i=Math.round(Math.min(Math.max(0,i+i*t),255)).toString(16),o+=("00"+i).substr(i.length);return o}});return i}),define("controller/promoted",["require","globals","marionette","model/user","lib/localstorage","lib/ajax","lib/dialog","log"],function(e){var t=e("globals"),i=e("marionette"),n=e("model/user"),o=e("lib/localstorage"),r=e("lib/ajax"),a=e("lib/dialog"),s=e("log");s.module("controller/promoted");var l=s,c=i.Controller.extend({initialize:function(){this.addListeners(),this.readStorage()},addListeners:function(){this.listenTo(AboutMe,"user:click",this.writeStorage),this.listenTo(AboutMe,"user:click",this.trackClick),this.listenTo(AboutMe,"user:view",this.trackView),this.listenTo(AboutMe,"user:compliment:success",this.trackCompliment),this.listenTo(AboutMe,"user:collect:success",this.trackCollect),this.listenTo(AboutMe,"user:email:success",this.trackEmail),this.listenTo(AboutMe,"user:spotlight:click",this.trackSpotlight),this.listenTo(AboutMe,"promoted:feedback",this.trackFeedback),this.listenTo(AboutMe,"user:share",this.trackShare)},readStorage:function(){if("user"===t.PAGE){var e=o.get("promoted");if(e){var i=AboutMe.request("profile:user");i.isUser(e.user_name)&&e.campaign_id?i.set("campaign_id",e.campaign_id):o.set("promoted",null)}}},writeStorage:function(e){return"dashboard"===t.PAGE?e?e instanceof n?void(e.get("campaign_id")&&o.set("promoted",{user_name:e.get("user_name"),campaign_id:e.get("campaign_id")})):l.error("user must be a User model"):l.error("user required"):void 0},trackView:function(e){"dashboard"===t.PAGE&&this.trackAction(e,"view")},trackClick:function(e){this.trackAction(e,"click")},trackCompliment:function(e){this.trackAction(e,"compliment")},trackCollect:function(e){this.trackAction(e,"collect")},trackEmail:function(e){this.trackAction(e,"email")},trackSpotlight:function(e){this.trackAction(e,"spotlight")},trackAction:function(e,t){if(!t)return l.error("action required");if(!e)return l.error("user required");if(!(e instanceof n))return l.error("user must be a User model");if(e.get("campaign_id")){var i=this.getSource(),o={campaign_id:e.get("campaign_id"),action:t,source:i};r.post("track_promoted_action",o,{})}},trackShare:function(e){if(e=e||{},"user"===t.PAGE){var i=AboutMe.request("profile:user");if(!i)return l.error("user required");if(i.get("campaign_id")){e.type||l.error("share event requires a type");var n=this.getSource(),o={campaign_id:i.get("campaign_id"),action:"share",type:e.type,source:n};r.post("track_promoted_action",o,{})}}},trackFeedback:function(e,t){if(!t)return l.error("feedback_id required");if(!e)return l.error("user required");if(!(e instanceof n))return l.error("user must be a User model");if(!e.get("campaign_id"))return l.error("user must have a campaign_id");var i={campaign_id:e.get("campaign_id"),feedback_id:t},o={complete:function(){a.banner("Thanks for your feedback while we work to improve Promoted.")}};r.post("give_promoted_feedback",i,o)},getSource:function(){var e;switch(t.PAGE){case"dashboard":e="dashboard";break;case"user":e="profile";break;default:e=t.PAGE}return e}});return{initialize:function(){new c}}}),function(e){e.backstretch=function(t,i,n){function o(){if(t){var i;0==m.length?m=e("<div />").attr("id","backstretch").css({left:0,top:0,position:s?"fixed":"absolute",overflow:"hidden",zIndex:-999999,margin:0,padding:0,height:"100%",width:"100%"}):m.find("img").addClass("deleteable"),i=e("<img />").css({position:"absolute",display:"none",margin:0,padding:0,border:"none",zIndex:-999999,maxWidth:"none"}).bind("load",function(t){var i,o,a=e(this);a.css({width:"auto",height:"auto"}),i=this.width||e(t.target).width(),o=this.height||e(t.target).height(),c=i/o,r(),a.fadeIn(f.speed,function(){m.find(".deleteable").remove(),"function"==typeof n&&n()})}).appendTo(m),0==e("#backstretch").length&&(0===e(window).scrollTop()&&window.scrollTo(0,0),e(f.attachTo).append(m)),m.data("settings",f),i.attr("src",t),e(window).unbind("resize.backstretch").bind("resize.backstretch",function(){"onorientationchange"in window&&0===window.pageYOffset&&window.scrollTo(0,1),r()})}}function r(){try{g={left:0,top:0},rootWidth=u=a.width(),rootHeight=l?window.innerHeight:a.height(),d=u/c,d>=rootHeight?(h=(d-rootHeight)/2,f.centeredY&&(g.top="-"+h+"px")):(d=rootHeight,u=d*c,h=(u-rootWidth)/2,f.centeredX&&(g.left="-"+h+"px")),m.css({width:rootWidth,height:rootHeight}).find("img:not(.deleteable)").css({width:u,height:d}).css(g)}catch(e){}}{var a,s,l,c,u,d,h,g,p={attachTo:".background-container",centeredX:!0,centeredY:!1,speed:0},m=e("#backstretch"),f=m.data("settings")||p;m.data("settings")}return i&&"object"==typeof i&&e.extend(f,i),i&&"function"==typeof i&&(n=i),e(document).ready(function(){var t=window,i=navigator.userAgent,n=navigator.platform,r=i.match(/AppleWebKit\/([0-9]+)/),c=!!r&&r[1],u=i.match(/Fennec\/([0-9]+)/),d=!!u&&u[1],h=i.match(/Opera Mobi\/([0-9]+)/),g=!!h&&h[1],p=i.match(/MSIE ([0-9]+)/),m=!!p&&p[1];s=!((n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1||n.indexOf("iPod")>-1)&&c&&534>c||t.operamini&&"[object OperaMini]"==={}.toString.call(t.operamini)||h&&7458>g||i.indexOf("Android")>-1&&c&&533>c||d&&6>d||"palmGetResource"in window&&c&&534>c||i.indexOf("MeeGo")>-1&&i.indexOf("NokiaBrowser/8.5.0")>-1||m&&6>=m),a=e(s?window:document),l=s&&window.innerHeight,o()}),this}}(jQuery),define("backstretch",function(){}),define("controller/backgroundimage",["globals","log","lib/event","data/user","backstretch"],function(e,t,i,n){t.module("controller/backgroundimage");var o={init:function(){o.node=$(".background").find("img.background-image"),$("body").on("dragstart",".background img, #backstretch img",function(e){e.preventDefault()}),"center"==n.Settings.images.background_repeat&&$.doTimeout(100,function(){if(o.node.width()>0){var e=o.node.width(),t=-(e/2),r=o.node.height();return e!=n.Settings.images.background_width&&($(".background").css({width:e,marginLeft:t,height:r}),n.Settings.images.background_width=e,n.Settings.images.background_height=r,n.Settings.images.background_x=t,i.trigger("userprofile_changed",["background_width",n.Settings.images.background_width]),i.trigger("userprofile_changed",["background_height",n.Settings.images.background_height]),i.trigger("userprofile_changed",["background_x",n.Settings.images.background_x])),!1}return!0}),AboutMe.whenever("viewport:not:small",function(){"scale"==n.Settings.images.background_repeat&&n.Settings.images.background_image&&$.backstretch(n.Settings.images.background_image,{centeredY:!1,attachTo:".background-container"}),i.on("resize.scalepartial",function(){if("scale partial"==n.Settings.images.background_repeat&&n.Settings.images.background_image){var e=$(window).width()/$(window).height(),t=n.Settings.images.background_width/n.Settings.images.background_height;o.node=$(".background").find("img.background-image"),o.node.css(e>t?{width:"auto",height:"100%"}:{width:"100%",height:"auto"})}}),i.trigger("resize.scalepartial")})}};return $(document).ready(o.init),o}),function(e,t){var i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(n){function o(){var t=e(h),i=e(g);l&&(g.length?l.reject(u,t,i):l.resolve(u)),e.isFunction(n)&&n.call(s,u,t,i)}function r(e){a(e.target,"error"===e.type)}function a(t,n){t.src!==i&&-1===e.inArray(t,d)&&(d.push(t),n?g.push(t):h.push(t),e.data(t,"imagesLoaded",{isBroken:n,src:t.src}),c&&l.notifyWith(e(t),[n,u,e(h),e(g)]),u.length===d.length&&(setTimeout(o),u.unbind(".imagesLoaded",r)))}var s=this,l=e.isFunction(e.Deferred)?e.Deferred():0,c=e.isFunction(l.notify),u=s.find("img").add(s.filter("img")),d=[],h=[],g=[];return e.isPlainObject(n)&&e.each(n,function(e,t){"callback"===e?n=t:l&&l[e](t)}),u.length?u.bind("load.imagesLoaded error.imagesLoaded",r).each(function(n,o){var r=o.src,s=e.data(o,"imagesLoaded");return s&&s.src===r?void a(o,s.isBroken):o.complete&&o.naturalWidth!==t?void a(o,0===o.naturalWidth||0===o.naturalHeight):void((o.readyState||o.complete)&&(o.src=i,o.src=r))}):o(),l?l.promise(s):s}}(jQuery),define("imagesLoaded",function(){}),define("controller/avatar",["globals","log","lib/dialog","lib/event","data/user","imagesLoaded"],function(e,t,i,n,o){t.module("controller/avatar");var r={init:function(){n.on("avatar_changed",r.setup),n.on("bio_changed",r.checkSize),n.ready("biobox_ready",function(){r.setup(),n.trigger("avatar_ready")})},setup:function(){if(o.Settings.images.avatar_image){var e=$("<img />");e.attr("alt",o.Settings.display_name+" picture"),e.attr("src",o.Settings.images.avatar_image),$("div.profile .profile_photo").empty().append(e).addClass("invisible");var t=$("<div />"),i=$("<img />").appendTo(t);i.attr("alt",o.Settings.display_name+" large"),i.attr("src",o.Settings.images.avatar_image),$("body").off("click.avatar"),$("body").on("click.avatar","div.profile .profile_photo",function(){t.dialog({dialogClass:"avatar",autoDestroy:!0,clickOverlayToClose:!0,disableScrolling:!0,width:"auto",height:"auto"})}),r.checkSize()}else $("div.profile .profile_photo").empty().addClass("invisible")},checkSize:function(){var e=$("div.profile div.profile_photo img");e.length&&e.imagesLoaded(function(){if(e.parent(".profile_photo").css({"margin-left":"-9999px"}).removeClass("invisible"),e.css({width:"auto",height:"auto"}),o.Settings.images.avatar_width=e.width(),o.Settings.images.avatar_height=e.height(),o.Settings.images.avatar_width>0){var t=parseInt(1.5*o.Settings.fonts.font_bio_size),i=Math.max(10-Math.round(o.Settings.fonts.font_bio_size/4),3),n=o.Settings.images.avatar_width/o.Settings.images.avatar_height,r=$("div.profile").width(),a=Math.floor(Math.min(t/2,15));return o.Settings.images.avatar_height=Math.floor(i*t-t/2),o.Settings.images.avatar_width=Math.round(o.Settings.images.avatar_height*n),o.Settings.images.avatar_width>r-40&&(o.Settings.images.avatar_width=r-40,o.Settings.images.avatar_height="auto",a=0),e.css({height:o.Settings.images.avatar_height+"px",width:o.Settings.images.avatar_width+"px"}),e.parent(".profile_photo").css({"margin-left":0,width:o.Settings.images.avatar_width,height:o.Settings.images.avatar_height,"margin-right":a+"px"}),!1}return!0})}};return $(document).ready(r.init),r}),define("controller/deferred",["globals","log","viewer","model/user","lib/metrics","lib/event","jstorage","cookie"],function(e,t,i,n,o,r){t.module("controller/deferred");var a={check:function(){var e=a.read();if(e)switch(e.action){case"compliment":i.logged_in&&e.data.user&&e.data.type&&require(["controller/compliment_modal"],function(){var t=new n(e.data.user);AboutMe.once("user:compliment:complete",function(){r.trigger("deferred_ready")}),AboutMe.trigger("user:compliment",t,e.data.type),a.expire()});break;case"email":i.logged_in&&e.data.message&&require(["lib/sendemail"],function(){var t=new n(e.data.user);AboutMe.once("user:email:complete",function(){r.trigger("deferred_ready")}),AboutMe.trigger("user:email",t,e.data.message),a.expire()});break;case"dialog":e.data.type&&e.data.msg&&require(["lib/dialog"],function(t){t[e.data.type](e.data.msg,e.data.o),r.trigger("deferred_ready"),a.expire()});break;case"collect":i.logged_in&&e.data.user&&require(["controller/collect_modal"],function(){var t=new n(e.data.user);AboutMe.once("user:collect:ui:closed",function(){r.trigger("deferred_ready")}),AboutMe.trigger("user:collect:ui",t,{show_thumb:!0}),a.expire()});break;default:t("Deferred action not supported: "+e.action),r.trigger("deferred_ready"),a.expire()}else r.trigger("deferred_ready");if(i.logged_in){var s=a.read("deferred_metric");s&&s.action&&s.location&&o.log(s.action,{location:s.location}),a.expire("deferred_metric")}},read:function(e,t){e=e||"deferred_action",t=t||null;var i;return i="cookie"===t?$.parseJSON($.cookie(e)||null):$.jStorage.get(e)},store:function(i,n){if(n=n||"deferred_action",!e.MAPPED){if(t("actual defer: "+n),"deferred_action"==n){var o={action:i.action||!1,data:{}};i.data.user?o.data.user=i.data.user:(t.error("deprecated call to Deferred.store with just a displayname"),o.data.displayname=i.data.displayname||!1),$.cookie(n,JSON.stringify(o),{expires:6e5,path:"/"})}return $.jStorage.set(n,i,{TTL:6e5})}t("deferred defer",i,n),AboutMe.trigger("mapped:deferred:defer",i,n)},expire:function(e){return e=e||"deferred_action",$.cookie(e,"",{path:"/",expires:-5}),$.jStorage.set(e,null,{TTL:0})}};return $(document).ready(a.check),a}),define("lib/windowtools",["log"],function(e){e.module("lib/windowtools");var t={width:function(){return null!=window.outerWidth?window.outerWidth:null!=window.innerWidth?window.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:null!=document.body?document.body.clientWidth:null},height:function(){return null!=window.outerHeight?window.outerHeight:null!=window.innerHeight?window.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:null!=document.body?document.body.clientHeight:null},size:function(){return[WindowInfo.width(),WindowInfo.height()]},left:function(){return null!=window.screenX?window.screenX:window.screenLeft},top:function(){return null!=window.screenY?window.screenY:window.screenTop},right:function(){return WindowInfo.left()+WindowInfo.width()},bottom:function(){return WindowInfo.top()+WindowInfo.height()},position:function(){return[WindowInfo.left(),WindowInfo.top()]},resizeFromCenter:function(e,t){var i=WindowInfo.size(),n=WindowInfo.position();window.moveTo(n[0]+(i[0]-e)/2,n[1]+(i[1]-t)/2),window.resizeTo(e,t)},popup:function(e,i){var n=!1;i=$.extend({name:null,center:!1,centerX:!0,centerY:!1,relativeTo:"browser",width:600,height:500,left:0,top:100,location:0,menubar:0,resizable:1,scrollbars:1,status:0,toolbar:0},i);var o="height="+i.height+",width="+i.width+",toolbar="+i.toolbar+",scrollbars="+i.scrollbars+",status="+i.status+",resizable="+i.resizable+",location="+i.location+",menuBar="+i.menubar;return i.center&&(i.centerX=!0,i.centerY=!0),"browser"==i.relativeTo?(i.left=i.centerX?t.left()+(t.width()/2-i.width/2):t.left()+i.left,i.top=i.centerY?t.top()+(t.height()/2-i.height/2):t.top()+i.top):(i.centerX&&(i.left=(screen.availWidth-i.width)/2),i.centerY&&(i.top=(screen.availHeight-i.height)/2)),n=window.open(e,i.name,o+",left="+i.left+",top="+i.top),n.focus(),n}};return t}),define("controller/followbuttons",["globals","log","viewer","data/user","lib/event","lib/metrics","lib/dialog","lib/utils","lib/ajax","lib/windowtools"],function(e,t,i,n,o,r,a,s,l,c){t.module("controller/followbuttons");var u={init:function(){if("user"===e.PAGE){u.button=$("#follow_button"),u.existing={},u.deleted={},$("#follow_modal").find("li").each(function(){u.existing[$(this).attr("data-service")]=!0}),u.setTitle(),u.showhide(),o.on("followbuttons_changed",function(){u.showhide()}),u.modal.init(),o.ready("follow_app_deleted",function(e,t){u.deleted[t]=!0}),o.on("follow_modal",u.modal.open);var t=$("#spotlight_banner");t.find(".follow_twitter").on("click",function(){u.twitter.init(this)}),t.find(".follow_instagram").on("click",function(){u.instagram.init(this)}),t.find(".connect_linkedin").on("click",function(){u.linkedin.init(this)}),o.trigger("followbuttons_changed"),o.trigger("followbuttons_ready")}},modal:{init:function(){u.modal.html=$("#follow_modal").remove().html()},prepare:function(){u.node=$(".followbuttons"),$.each(n.Settings.follow_buttons,function(e){var i=e.replace(/follow_/,""),o=u.node.find("li."+e),r=u.deleted[i]&&u.deleted[i];n.Settings.follow_buttons[e]&&!r?o.removeClass("invisible"):o.addClass("invisible"),n.Settings.follow_buttons[e]&&$("body").on("click",".followbuttons .button."+i,function(e){e.preventDefault(),t("which follow: "+i),u[i].init(this)})})},open:function(){u.modal.m=u.modal.create(),u.modal.prepare(),r.log("Follow Modal Displayed",{location:e.PAGE+"_follow"})},create:function(){var e={title:"Follow",dialogClass:"followbuttons",width:150,position:"center",close:u.modal.close,disableScrolling:!0,clickOverlayToClose:!0,autoDestroy:!0};return $(u.modal.html).dialog(e)},close:function(){o.trigger("follow_modal_closed")}},setTitle:function(){var e=n.Settings.first_name?n.Settings.first_name:n.Settings.user_name;u.button.attr("title","Follow or connect with "+e+".")},showhide:function(){var e=!1;$.each(n.Settings.follow_buttons,function(t){var i=u.existing[t.replace(/follow_/,"")]?u.existing[t.replace(/follow_/,"")]:!1,o=u.deleted[t.replace(/follow_/,"")]?u.deleted[t.replace(/follow_/,"")]:!1;1==n.Settings.follow_buttons[t]&&i&&!o&&(e=!0)}),t("show follow Button: "+e),e?u.button.closest("li.serviceactions").removeClass("invisible"):u.button.closest("li.serviceactions").addClass("invisible"),o.trigger("profileactions_changed")},twitter:{init:function(e){if(e){var t=$(e);if(!t.hasClass("disabled")){if(i.isUser(n.Settings.user_name))return a.banner("You cant follow yourself!",{status:"warning"}),void(u.modal.m&&u.modal.m.dialog("close"));var o=600,s=500,d=t.data("href")?t.data("href"):t.prop("href");u.popup&&u.popup.close(),u.popup=c.popup(d,{name:"aboutme_anon_follow_twitter",width:o,height:s,center:!0,location:1,toolbar:1}),r.log("Social Share",{Network:"Twitter","Social Action":"Follow"}),r.log("Twitter",{"Share Type":"Follow"}),_gaq.push(["_trackSocial","Twitter","Follow"]),i.isUser(n.Settings.user_name)||l.post("follow_note",{follow:"twitter",user_name:n.Settings.user_name}),u.modal.m&&u.modal.m.dialog("close")}}}},px500:{init:function(e){if(e){var o=$(e);if(!o.hasClass("disabled")){if(i.isUser(n.Settings.user_name))return a.banner("You cant follow yourself!",{status:"warning"}),void(u.modal.m&&u.modal.m.dialog("close"));t("500px follow called");var d=n.Settings.px500_id||o.data("px500_id"),h=n.Settings.user_name||s.htmlEncode(o.data("actor")),g=n.Settings.display_name||s.htmlEncode(o.data("actor_display_name"));if(i.logged_in&&i.get("px500_id")&&d){var p={success:function(){a.banner("You are now following "+g+" on 500px."),i.isUser(h)||l.post("follow_note",{follow:"px500",user_name:h}),r.log("Social Share",{Network:"500px","Social Action":"Follow"}),r.log("500px",{"Share Type":"Follow"}),_gaq.push(["_trackSocial","500px","Follow"]),u.modal.m&&u.modal.m.dialog("close")},error:function(){t("500px follow error"),a.banner("There was an error following this user. Please try again later.",{status:"error"})}};l.post("px500_follow",{target_id:d},p)}else if(!i.logged_in||!i.get("px500_id")){if(o.hasClass("disabled"))return;if(!o.data("href")&&!o.prop("href"))return;var m=550,f=420,b=o.data("href")?o.data("href"):o.prop("href");u.popup&&u.popup.close(),u.popup=c.popup(b,{name:"aboutme_anon_follow_px500",width:m,height:f,center:!0,location:1,toolbar:1}),u.modal.m&&u.modal.m.dialog("close")}}}}},instagram:{init:function(e){if(e){var o=$(e);t("instagram follow called");var d=n.Settings.instagram_id||o.data("instagram_id"),h=n.Settings.user_name||s.htmlEncode(o.data("actor")),g=n.Settings.display_name||s.htmlEncode(o.data("actor_display_name"));if(i.logged_in&&!$.isEmptyObject(i.get("instagram_id"))&&d){if(o.hasClass("disabled"))return;if(i.isUser(h))return a.banner("You cant follow yourself!",{status:"warning"}),void(u.modal.m&&u.modal.m.dialog("close"));var p={target_id:d},m={success:function(){a.banner("You are following "+g+" on Instagram."),i.isUser(h)||l.post("follow_note",{follow:"instagram",user_name:h}),r.log("Social Share",{Network:"Instagram","Social Action":"Follow"}),r.log("Instagram",{"Share Type":"Follow"}),_gaq.push(["_trackSocial","Instagram","Follow"]),u.modal.m&&u.modal.m.dialog("close")},error:function(){t("instagram follow error"),a.banner("There was an error following this user. Please try again later.",{status:"error"})}};l.post("instagram_follow",p,m)}else if(!i.logged_in||$.isEmptyObject(i.get("instagram_id"))){if(o.hasClass("disabled"))return;if(!o.data("href")&&!o.prop("href"))return;if(i.isUser(n.Settings.user_name))return a.banner("You cant follow yourself!",{status:"warning"}),void(u.modal.m&&u.modal.m.dialog("close"));var f=550,b=420,v=o.data("href")?o.data("href"):o.prop("href");u.popup&&u.popup.close(),u.popup=c.popup(v,{name:"aboutme_anon_follow_instagram",width:f,height:b,center:!0,location:1,toolbar:1}),u.modal.m&&u.modal.m.dialog("close")}}}},linkedin:{init:function(e){if(e){var o=$(e);t("linkedin follow called");var d=n.Settings.linkedin_id||o.data("linkedin_id"),h=n.Settings.user_name||s.htmlEncode(o.data("actor")),g=n.Settings.display_name||s.htmlEncode(o.data("actor_display_name"));if(i.logged_in&&!$.isEmptyObject(i.get("linkedin_id"))&&d){if(o.hasClass("disabled"))return;if(i.isUser(h))return a.banner("You cant follow yourself!",{status:"warning"}),void(u.modal.m&&u.modal.m.dialog("close"));var p={target_id:d},m={success:function(){a.banner("Your invitation has been sent to "+g+" successfully."),u.modal.m&&u.modal.m.dialog("close"),r.log("Social Share",{Network:"LinkedIn","Social Action":"Connect"}),r.log("LinkedIn",{"Share Type":"Connect"}),_gaq.push(["_trackSocial","LinkedIn","Connect"])},error:function(){t("linkedin follow error"),a.banner("There was an error connecting this user. Please try again later.",{status:"error"})}};l.post("linkedin_invite",p,m)}else if(!i.logged_in||$.isEmptyObject(i.get("linkedin_id"))){if(o.hasClass("disabled"))return;if(!o.data("href")&&!o.prop("href"))return;if(i.isUser(n.Settings.user_name))return a.banner("You cant follow yourself!",{status:"warning"}),void u.modal.m.dialog("close");var f=690,b=500,v=o.data("href")?o.data("href"):o.prop("href");u.popup&&u.popup.close(),u.popup=c.popup(v,{name:"aboutme_anon_follow_linkedin",width:f,height:b,center:!0,location:1,toolbar:1}),u.modal.m&&u.modal.m.dialog("close")}}}},tumblr:{init:function(e){if(e){var o=$(e);if(t("tumblr follow called"),!o.hasClass("disabled")&&o.data("href")){if(i.isUser(n.Settings.user_name))return a.banner("You cant follow yourself!",{status:"warning"}),void u.modal.m.dialog("close");r.log("Social Share",{Network:"Tumblr","Social Action":"Follow"}),r.log("Tumblr",{"Share Type":"Follow"}),_gaq.push(["_trackSocial","Tumblr","Follow"]);var s=920,l=520;u.popup&&u.popup.close(),u.popup=c.popup(o.data("href"),{name:"aboutme_anon_follow_tumblr",width:s,height:l,center:!0,location:1,toolbar:1}),u.modal.m&&u.modal.m.dialog("close")}}}}};return $(document).ready(u.init),u}),define("controller/profileactions",["globals","log","lib/event","data/user","viewer","lib/metrics","controller/deferred","lib/utils","isInArray","controller/followbuttons"],function(e,t,i,n,o,r,a,s){t.module("controller/profileactions");var l={init:function(){l.checkState(),i.on("profileactions_changed",l.checkState),$("html").hasClass("no_session")&&$("#emailme_button, #add_button, #compliment_button").remove(),$("body").on("click","#compliment_button",l.complimentModal),$("body").on("click","#add_button",l.collectionModal),$("body").on("click","#share_button",l.shareModal),$("body").on("click","#emailme_button,.emailme_button",l.emailmeModal),$("body").on("click","#follow_button",l.followModal),o.logged_in||($("#compliment_button").attr("title","Say something nice to "+n.Settings.first_name+"!"),$("#add_button").attr("title","Save "+n.Settings.possessive_first_name+" page and contact info."),$("#share_button").attr("title","Share "+n.Settings.possessive_first_name+" page."),$("#emailme_button").attr("title","Have a question or comment?  Send an email.")),i.on("weak_emailme_open",l.emailmeModal)},checkState:function(){var e=$(".actions > li");e.removeClass("first last").addClass("invisible"),n.Settings.email_public?$("#emailme_button").removeClass("invisible"):$("#emailme_button").addClass("invisible"),n.Settings.add_visible?$("#add_button").removeClass("invisible"):$("#add_button").addClass("invisible");var t=!1;$.each(n.Settings.compliment_buttons,function(e,i){$.isInArray(e,["display_chat","display_collaborate"])||(t=t||i)}),t=t||n.Settings.allow_fave,t?$("#compliment_button").removeClass("invisible"):$("#compliment_button").addClass("invisible");var o=!1;$.each(n.Settings.share_buttons,function(e,t){$.isInArray(e,["share_buttons_location"])||(o=o||t)}),o?$("#share_button").removeClass("invisible"):$("#share_button").addClass("invisible"),e.not(".invisible").first().addClass("first"),e.not(".invisible").last().addClass("last"),i.trigger("biobox_changed")
},complimentModal:function(){$(this);r.log("Clicked Compliment on Profile"),require(["controller/compliment_modal"],function(){var e=AboutMe.request("profile:user");AboutMe.trigger("user:compliment:ui",e)})},collectionModal:function(){$(this);r.log("Clicked Add on Profile"),require(["controller/collect_modal"],function(){var e=AboutMe.request("profile:user");AboutMe.trigger("user:collect:ui",e)})},shareModal:function(){$(this);r.log("Clicked Share on Profile");var e=[n.Settings.user_name,n.Settings.display_name,n.Settings.twitter_name,n.Settings.share_buttons];require(["controller/socialbuttons"],function(){i.trigger("sharebuttons_modal",e)})},emailmeModal:function(e){e=s.getEvent(e);var t=$(e.target).data("show_phone")||!1;if(o.logged_in&&o.is("weak_login"))return i.trigger("weak_login",["clicked emailme","weak_emailme_open","","event"]),!1;$(this);r.log("Clicked Email Me on Profile"),require(["controller/emailme"],function(){var e=AboutMe.request("profile:user");AboutMe.trigger("user:email:ui",e,t)})},followModal:function(){$(this);r.log("Clicked Follow on Profile"),i.trigger("follow_modal")}};return $(document).ready(l.init),l}),function(e){e.fn.shrinkLine=function(t){return t=e.extend({min_font_size:10,lines:1,increment:1},t),this.each(function(){var i=e(this),n=e('<span style="display:inline-block">&nbsp;</span>');i.append(n);var o=n.height()*t.lines;n.remove();for(var r=parseInt(i.css("font-size"));i.height()>o&&r>t.min_font_size;)r-=t.increment,i.css("font-size",r+"px")})}}(jQuery),define("shrinkLine",function(){}),function(e){e.fn.shrinkWrap=function(t){return t=e.extend({minimum:10,evalExternally:!1,textToTest:!1,allowUpsize:!1,adjust:0},t),this.each(function(){var i=e(this);t.allowUpsize&&i.css("font-size","");var n=e("<span></span>");if(n.text(t.textToTest?t.textToTest:i.text()),t.evalExternally){var o=parseInt(i.css("font-size"));n.addClass("shrinkwrap-tester").css({fontSize:o,position:"absolute",marginLeft:-9999,whiteSpace:"nowrap"}),e("body").prepend(n)}else i.empty().append(n);for(var r=parseInt(i.css("font-size"));n.outerWidth()>i.outerWidth()+t.adjust&&r>t.minimum;)r--,i.css("font-size",r+"px"),t.evalExternally&&n.css("font-size",r+"px");e(".shrinkwrap-tester").remove()})}}(jQuery),define("shrinkWrap",function(){}),define("controller/biobox",["require","globals","viewer","data/user","viewport","lib/event","lib/color","editmode","lib/ajax","lib/dialog","lib/metrics","log","doTimeout","controller/avatar","controller/profileactions","shrinkLine","shrinkWrap"],function(e){var t=e("globals"),i=e("viewer"),n=e("data/user"),o=e("viewport"),r=e("lib/event"),a=e("lib/color"),s=e("editmode"),l=e("lib/ajax"),c=(e("lib/dialog"),e("lib/metrics")),u=e("log");e("doTimeout"),e("controller/avatar"),e("controller/profileactions"),e("shrinkLine"),e("shrinkWrap"),u.module("controller/biobox");var d=u.create("biobox","background-color:rgba(0,0,0,0.6);color:white"),h=0,g={firstview:!1,init:function(){n.Settings.renamed||(this.node=$("div.profile"),g.ContactInfo.init(),AboutMe.when("viewport:not:small",function(){g.setIcons()}),AboutMe.whenever("viewport:not:small",function(){g.setLinkLineHeight(),g.updateColor(),g.checkWidth(),g.checkState()}),AboutMe.whenever("viewport:small",function(){g.checkState(),g.checkWidth(),g.checkPosition()}),r.ready("viewport:small below:no:sections",function(){g.recommendedUsers()}),g.createIconMenus(),r.ready("typekit_complete",function(){g.setLinkLineHeight(),g.checkWidth(),g.checkState(),g.checkPosition(),r.trigger("biobox_ready")}),$.doTimeout(5e3,function(){r.trigger("mapped_actions_loaded")}),r.ready("avatar_ready biobox_state_checked biobox_width_changed",function(){g.show()}),r.on("contactinfo_changed",g.ContactInfo.sort),r.on("biobox_changed name_changed headline_changed links_changed",g.checkState),r.on("biobox_width_changed",g.videoIframewidth),r.on("biobox_changed name_changed headline_changed links_changed",g.checkWidth),r.on("biobox_color_changed biobox_shadow_changed",function(e,t){g.updateColor(t)}),r.on("apporder_changed",g.createIconMenus),r.on("links_changed",g.setLinkLineHeight),r.on("biobox_moved",g.checkPosition),AboutMe.on("window:resize window:orientationchange",g.checkPosition),r.ready("biobox_shown",function(){i.logged_in&&i.isUser(n.Settings.user_name)||g.profileClickTrack()}),r.ready("biobox_shown profile_ready",function(){e(["controller/belowthefold"])}),g.mapped())},setIcons:function(){e([t.DOMAIN_NAME_URL+"/me/icons/"+n.Settings.user_name],function(e){var t='<style type="text/css">';t+=e.service_icons,t+="</style>",$("head").append(t)})},mapped:function(){t.MAPPED&&e(["api/mapsocket"],function(e){e.when("ready",function(){var t=n.Settings,i={Settings:{user_id:t.user_id,user_name:t.user_name,first_name:t.first_name,last_name:t.last_name,display_name:t.display_name,possessive_display_name:t.possessive_display_name,possessive_first_name:t.possessive_first_name,twitter_name:t.twitter_name,email_public:t.email_public,allow_fave:t.allow_fave,compliment_buttons:t.compliment_buttons,origin_domain:t.origin_domain}},o={method:"user_data",data:i};e.postMessage(JSON.stringify(o))}),AboutMe.on("mapped:deferred:defer",function(t,i){var n={id:Date.now(),method:"deferred_defer",which:i,obj:t};e.postMessage(JSON.stringify(n))}),AboutMe.on("mapped:storage:set",function(t,i,n){var o={method:"set_storage",data:{key:t,value:i,options:n}};e.postMessage(JSON.stringify(o))})})},checkState:function(){var e=$.trim(g.node.find("h1.name").text());e.length>0?g.node.find("h1.name").removeClass("invisible"):g.node.find("h1.name").addClass("invisible");var t=$.trim(g.node.find("h2.headline").text());t.length>0?g.node.find("h2.headline").removeClass("invisible"):g.node.find("h2.headline").addClass("invisible"),g.node.find("div.featured iframe").length>0?g.node.find("div.featured").removeClass("invisible"):g.node.find("div.featured").addClass("invisible"),g.node.find("ul.tags").children().size()>0&&n.Settings.tags_visible?g.node.find("ul.tags").removeClass("invisible"):g.node.find("ul.tags").addClass("invisible"),g.node.find(".feeds").children().size()>0?g.node.find(".bevel-rss, .rsswrapper").removeClass("invisible"):g.node.find(".bevel-rss, rsswrapper").addClass("invisible"),$("#service-icons").children().not(".invisible").size()>0?g.node.find(".services").removeClass("invisible"):g.node.find(".services").addClass("invisible"),g.node.find("ul.links").hasClass("invisible")&&g.node.find("ul.services").hasClass("invisible")?g.node.find(".bevel-services").addClass("invisible"):g.node.find(".bevel-services").removeClass("invisible"),o.is("small")&&g.node.find(".mobile-links").children().size()>0?g.node.find(".mobile-links").removeClass("invisible"):g.node.find(".mobile-links").addClass("invisible"),g.node.find("ul.links, ul.jobs, ul.educations").each(function(){$(this).addClass("invisible").children().parent().removeClass("invisible")}),g.node.find(".profile-head,.actions").each(function(){$(this).addClass("invisible").children().not(".invisible").parent().removeClass("invisible")}),g.node.find(".meta").addClass("invisible").children("ul").not(".invisible").parent().removeClass("invisible"),r.trigger("biobox_state_checked")},show:function(){$("html").addClass("biobox-ready"),r.trigger("biobox_shown")},updateColor:function(e){if(!o.is("small")){var t=n.Settings.colors.profile_opacity,i=t/100,r=n.Settings.colors.profile_color,e=e||a.getDecimalTriplet(r),s=e.join(",")+","+i,l=i;n.Settings.colors.profile_shadow&&(l=1),$("html").hasClass("rgba")?(g.node.css("background-color","rgba("+s+")"),g.node.find("div.bevel").css("opacity",l)):30>=t?(g.node.css("background-color","transparent"),g.node.find("div.bevel").css("opacity",0)):(g.node.css("background-color","#"+r),g.node.find("div.bevel").css("opacity",l))}},checkWidth:function(){var e=240,t=880;if(o.is("small"))return void r.trigger("biobox_width_changed");h++,g.node.find(".typekit").each(function(){var e=$(this),t=$.trim(e.text());t.length?e.removeClass("invisible"):e.addClass("invisible")});var i=g.node.find("div.profile-head");i.css("width","auto"),i.find("h1.name").css("font-size",n.Settings.fonts.font_name_size),i.find("h2.headline").css("font-size",n.Settings.fonts.font_heading_size);var a=i.width()+parseInt(i.css("padding-left"))+parseInt(i.css("padding-right")),s=g.node.find("ul.links"),l=s.width()+parseInt(i.css("padding-left"))+parseInt(i.css("padding-right")),c=g.node.find("ul.feeds"),u=c.width()+parseInt(i.css("padding-left"))+parseInt(i.css("padding-right")),d=Math.max(a,l,u);d=Math.min(d,t),d==t&&(i.width(t),i.find("h1.name,h2.headline").shrinkWrap()),g.node.find(".profile-content").stop().css({width:d}),n.Settings.profile.profile_width!==d&&(n.Settings.profile.profile_width=d,n.Settings.profile.profile_width=Math.max(n.Settings.profile.profile_width,e),n.Settings.profile.profile_width=Math.min(n.Settings.profile.profile_width,t),r.trigger("biobox_width_changed")),g.node.find(".profile-content").css("overflow","")},ensureConstrainBounds:function(){$.doTimeout("ensure_constrain_bounds");var e=$(".profile").outerWidth(),t=n.Settings.images.background_repeat,i=n.Settings.profile.text_left,o=n.Settings.profile.text_left;d("original text-left","width",e,"text_left",o),"left"!=t&&"right"!=t&&-800>i?o=-800:"left"!=t&&"right"!=t&&i+e>800?o=800-e:("left"==t||"right"==t)&&i+e>1600?o=1600-e:("left"==t||"right"==t)&&0>i&&(o=0),d("fixed text-left","width",e,"text_left",o),i!=o&&("left"!=t&&"right"!=t?$(".profile").css({right:"auto",left:"50%",marginLeft:o}):"right"==t?$(".profile").css({left:"auto",marginLeft:"auto",right:o}):"left"==t&&$(".profile").css({right:"auto",marginLeft:"auto",left:o})),$.doTimeout("ensure_constrain_bounds",3e3,function(){n.Settings.profile.text_left!=o&&(n.Settings.profile.text_left=o,r.trigger("userprofile_changed",["text_left",n.Settings.profile.text_left]))})},ContactInfo:{init:function(){s?g.ContactInfo.fill():g.ContactInfo.sort()},fill:function(){var e={success:function(e){var t=$.parseJSON(e.profile_data);n.Settings.contact.phone=t.phone||"",n.Settings.contact.country=t.country||"",n.Settings.contact.address1=t.address1||"",n.Settings.contact.address2=t.address2||"",n.Settings.contact.state=t.state||"",n.Settings.contact.city=t.city||"",n.Settings.contact.zip=t.zip||"",d(n.Settings.contact),g.ContactInfo.sort()},error:function(e){d(e)}},t={data_field:"contact"};l.post("get_user_profile_data",t,e)},sort:function(){var e=$(".profile .contactinfo"),i=$(".profile ul.addresslist"),o=$(".profile ul.locations"),a=$(".profile ul.phone");if(a.find("li").text(n.Settings.contact.phone),i.find(".phone").text(n.Settings.contact.phone),i.find(".address1").text(n.Settings.contact.address1),i.find(".address2").text(n.Settings.contact.address2),i.find(".city").text(n.Settings.contact.city),i.find(".state").text(n.Settings.contact.state),i.find(".zip").text(n.Settings.contact.zip),i.find(".country").text(n.Settings.contact.country),$.trim(i.find(".phone").text())?i.find(".phone").removeClass("invisible"):i.find(".phone").addClass("invisible"),$.trim(i.find(".address").text())?i.find(".address").removeClass("invisible"):i.find(".address").addClass("invisible"),n.Settings.location.length||n.Settings.locations.length)a.addClass("invisible"),o.removeClass("invisible"),g.ContactInfo.checkMenu();else if(o.addClass("invisible"),n.Settings.contact_visible){var s=$.trim(n.Settings.contact.city)||$.trim(n.Settings.contact.state)||$.trim(n.Settings.contact.country);if(s){var l=t.DOMAIN_NAME_URL+"/search/place:"+encodeURIComponent(s),c=$("<li><a></a></li>");c.find("a").attr("href",l),c.find("a").text(s),o.empty(),o.append(c),a.addClass("invisible"),o.removeClass("invisible"),g.ContactInfo.checkMenu({minimum_items:2})}else $.trim(n.Settings.contact.phone)?(a.removeClass("invisible"),o.addClass("invisible"),e.addClass("invisible")):(a.addClass("invisible"),o.addClass("invisible"),e.addClass("invisible"))}else a.addClass("invisible"),o.addClass("invisible"),e.addClass("invisible");g.checkState(),r.trigger("contactinfo_sorted")},checkMenu:function(e){e=$.extend({minimum_items:1},e);var t=$(".profile .contactinfo"),i=0;$.each(n.Settings.contact,function(e,t){$.trim(t).length&&i++}),i>=e.minimum_items&&n.Settings.contact_visible?t.removeClass("invisible"):t.addClass("invisible")}},checkPosition:function(){if($(".background-container").css("width","100%"),$(".profile-container").removeClass("embiggen").css("min-width",0),!o.is("small")){var e=$(".background-container").width();if(g.node.offset().left<0){var t=Math.abs(g.node.offset().left);"right"!=n.Settings.images.background_repeat&&(t=2*t),$(".background-container").css("width",e+t)}$(window).width()<g.node.outerWidth()&&$(".profile-container").css("min-width",g.node.outerWidth()),g.node.offset().left>0&&g.node.offset().left+g.node.outerWidth()>$(window).width()&&$(".profile-container").addClass("embiggen"),r.trigger("biobox_position_checked"),g.ensureConstrainBounds()}},profileClickTrack:function(){c.click(".profile .bio a","Profile Clicks",{"profile clicks":"Clicked on links in the bio"}),c.click(".profile .locations li a","Profile Clicks",{"profile clicks":"Clicked on Location"}),c.click(".profile .educations li a","Profile Clicks",{"profile clicks":"Clicked on Education"}),c.click(".profile .jobs li a","Profile Clicks",{"profile clicks":"Clicked on Work"}),c.click(".profile .tags li a","Profile Clicks",{"profile clicks":"Clicked on Interest Tags"}),c.click(".profile .links li a","Profile Clicks",{"profile clicks":"Clicked on Links"}),c.click(".profile .profile_photo img","Profile Clicks",{"profile clicks":"Clicked on the Bio Photo"}),$(".contactinfo.menu").children(".menu-toggle").on("click",function(){$(this).next(".menu-container:hidden").length&&c.log("Clicked Contact Info")}),$(".actions.menubar li.menu").children(".button.menu-toggle").on("click",function(){var e=$(this).hasClass("glyph-thumbsup")?"compliment button":$(this).hasClass("glyph-forward")?"share button":"email me button";$(this).next(".menu-container:hidden").length&&c.log(e+" clicked")})},setLinkLineHeight:function(){var e=g.node.find("ul.links li span.displayname").height();e=Math.max(e,20),$(".profile ul.links li").css("line-height",e+"px")},createIconMenus:function(){var e=g.node.find("#service-icons-setup"),t=g.node.find("#service-icons");t.find(".service-icon").remove(),t.prepend(e.html()),t.find("li.service-icon").each(function(){var e=$(this),t=e.attr("data-platform");"facebookpage"==t&&(t="facebook"),e.addClass("group-"+t).data("group",t)}),t.find("li.service-icon").each(function(){var e=$(this),i=e.data("group"),n=t.find("li.service-icon.group-"+i);if(n.length>1){var o=n.eq(0).clone().addClass("menu");o.find("a.icon").remove(),o.append('<span class="menu-toggle icon '+o.data("platform")+'"><span class="service-icon-overlay glyph-triangle-down glyph-center"></span></span>'),o.append('<ul class="menu-content"></ul>'),e.before(o),n.detach();var r=o.find("ul.menu-content");n.each(function(){var e=$(this);e.removeClass("service-icon group-"+i).addClass("item"),e.find("a.icon").removeAttr("class").text(e.data("name")),e.find(".service-icon-overlay").remove(),e.appendTo(r)}),o.menu({stopPropagation:!1})}})},videoIframewidth:function(){var e=$(".profile div.featured iframe");e&&"soundcloud"!=n.Settings.featured_video.type&&e.height(Math.floor(n.Settings.profile.profile_width*(1*n.Settings.featured_video.height/n.Settings.featured_video.width)))},recommendedUsers:function(){if(!o.isNot("small")&&!t.MAPPED&&!$("html").hasClass("has-below")){var i=$(".profile-container"),r="";r+='<div class="recommended_users">',r+='<hr class="rule" />',r+="<h4>Recommended Users</h4>",r+='<div class="thumbs-region"></div>',r+="</div>",i.after(r);var a=$(".recommended_users"),s=n.Settings.tags.concat(n.Settings.locations,n.Settings.education,n.Settings.education,$(".bio").text()),c={terms:s.join(" ")};d("tags:",c.terms);var u={success:function(t){t.results&&t.results.length?(a.show(),e(["marionette","lib/pagethumb","list/userlist"],function(e,i,n){var o=_.map(t.results.slice(0,3),function(e){return{user_name:e.un,first_name:e.fn,last_name:e.ln}}),r=new n(o),s=new i.ListView({collection:r,quickview:!1,thumb_settings:{actions:["compliment","collect","admin_flag","thumb_regen"]}}),l=new e.Region({el:a.find(".thumbs-region")});l.show(s)})):a.hide()},error:function(){a.hide()},complete:function(){}};l.post("recommended_users",c,u)}}};return $(document).ready(function(){g.init()}),g}),define("view/profile",["require","globals","data/user","model/user","editmode","viewport","viewer","lib/ajax","lib/event","lib/metrics","lib/query","lib/dialog","lib/color","lib/utils","controller/promoted","log","controller/backgroundimage","controller/biobox","jstorage","doTimeout"],function(e){var t=e("globals"),i=e("data/user"),n=e("model/user"),o=e("editmode"),r=e("viewport"),a=e("viewer"),s=e("lib/ajax"),l=e("lib/event"),c=e("lib/metrics"),u=e("lib/query"),d=e("lib/dialog"),h=(e("lib/color"),e("lib/utils")),g=e("controller/promoted"),p=e("log");e("controller/backgroundimage"),e("controller/biobox"),e("jstorage"),e("doTimeout"),p.module("view/profile");var m=p.create("profile"),f={init:function(){if(i.Settings.renamed){$("body").append('<div class="ui-widget-overlay active" style="z-index: 301"></div>');var n=t.DOMAIN_NAME_URL+"/"+i.Settings.renamed;return d.banner("<p>about.me/"+i.Settings.user_name+' has been moved to <a href="/'+i.Settings.renamed+'">about.me/'+i.Settings.renamed+'</a>.</p><p>You will be redirected shortly. If not, please <a href="/'+i.Settings.renamed+'">click here</a>.</p>',{duration:12e3}),void $.doTimeout(1e4,function(){document.location=n})}if(f.createUserModel(),o&&(AboutMe.when("viewport:not:small",function(){e(["compiled/edit"],function(){m("loading edit-desktop"),e(["view/edit"])})}),AboutMe.when("viewport:small",function(){e(["compiled/edit-mobile"],function(){m("loading edit-mobile"),e(["view/edit-mobile"])})}),m.time(" view/edit complete in")),l.ready("biobox_shown",function(){f.checkHeight(),l.on("biobox_changed",f.checkHeight),l.on("menu_show menu_hide menu_checkstate",f.checkHeight),l.on("edit_stop_dragging edit_close edit_open",f.checkHeight),l.on("app_modal_opened app_modal_closed",f.checkHeight),l.on("add_app_loaded",f.checkHeight),l.on("modal_open modal_close",f.checkHeight),f.checkQueryActions(),l.trigger("profile_ready")}),AboutMe.on("window:resize window:orientationchange",function(){$("body").removeClass("scrolled-to-resume"),f.checkHeight()}),b.init(),f.setupMetrics(),a.isUser(i.Settings.user_name)&&$(".spotlight-banner-content .edit").removeClass("invisible").click(function(){return c.log("Clicked Edit Spotlight"),window.location.href=t.DOMAIN_NAME_URL+"/spotlight",!1}),$("#spotlight_banner").length&&$("html").addClass("has-spotlight"),$("#spotlight_banner a").is(".follow_twitter,.follow_instagram,.connect_linkedin")){var r=$("#spotlight_banner a").data("spotlight_type"),s=r.replace(/follow_/,"").replace(/connect_/,"");$("body").on("click","#spotlight_banner a."+r,function(t){t.preventDefault(),m(s,this),e(["controller/followbuttons"],function(e){e[s].init(this)})})}$("body").on("click","#spotlight_banner a",function(){var e=$(this).attr("class").split(" "),t=2==e.length?e[1]:"unknown";c.log("Clicked Spotlight Banner",{clicked_spotlight:t});var i=AboutMe.request("profile:user");AboutMe.trigger("user:spotlight:click",i)});var u=$(".mobile-links,#service-icons"),h=".app-link a, li.service-icon a";u.one("click.initappmodal",h,function(t){t.preventDefault(),u.off("click.initappmodal",h);var i=$(this).closest("li").attr("data-id");e(["controller/appsmodal"],function(e){e.init(i)})}),g.initialize()},createUserModel:function(){var e=i.Settings.compliment_buttons;e.display_fave=i.Settings.allow_fave,delete e.display_chat,delete e.display_collaborate,f.user=new n({user_name:i.Settings.user_name,first_name:h.htmlDecode(i.Settings.first_name),last_name:h.htmlDecode(i.Settings.last_name),compliment_settings:e,twitter_name:i.Settings.twitter_name}),AboutMe.onRequest("profile:user",function(){return f.user})},checkHeight:function(){if(r.is("small"))return void $(".profile-container").css("height","");if(!$("body").hasClass("scrolled-to-below")){var e=$(window).height(),t=e,i=[".ui-dialog",".profile",".menu-content"],n=$("html").hasClass("has-below")?250:150;$(i.join(",")).filter(":visible").each(function(){var e=$(this).offset().top+$(this).outerHeight()+n;t=Math.max(t,e)}),t>e?$(".profile-container").height(t):$(".profile-container").css("height",""),$.doTimeout("checkHeight",4e3,function(){return r.isNot("small")&&f.checkHeight(),!0})}},checkQueryActions:function(){var i=u.parse("#!/",null,"/",!1);switch(i[0]){case"service":i[1]&&e(["controller/appsmodal"],function(e){e.showServiceByName(i[1])}),0!=t.RESET_HASH_URL&&(location.hash="")}},setupMetrics:function(){c.set({"PageComplete - Username":i.Settings.page_complete.user_name,"PageComplete - Bio/Header":i.Settings.page_complete.bio,"PageComplete - Background":i.Settings.page_complete.background,"PageComplete - Services":i.Settings.page_complete.services,"ProfileView - LoggedIn":a.logged_in}),s.get("view_page",{page:i.Settings.user_name},{},function(){})}},b={init:function(){AboutMe.whenever("viewport:small",function(){this.setiframeWidth(),this.adjustBackground()},this),AboutMe.whenever("window:resize",function(){this.setiframeWidth(),this.adjustBackground()},this),l.on("background_image_changed",_.bind(function(){this.adjustBackground()},this))},iframeSheet:function(){var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.setAttribute("type","text/css"),e.appendChild(t);var i=t.sheet;return i},setiframeWidth:function(){var e=this.iframeSheet();e&&(e.rules&&e.rules.length&&e.deleteRule(0),e.insertRule(".app-container iframe, .services_modal { width:"+r.get("mobile_width")+"px !important; }",0))},adjustBackground:function(){var e=$(".mobile-bg-test-img"),t=e.height(),i=e.width(),n=t/i,o=$(window).width()*n;return e.length?void(n>=1?($(".mobile-background-container").css("background-position","center top"),$(".mobile-background-container").height(Math.max(o/n,350))):($(".mobile-background-container").css("background-position","center center"),$(".mobile-background-container").height(Math.max(o,250)))):void $(".mobile-background-container").height(0)}};return $(document).ready(function(){f.init()}),f}),define("module/mapped",["require","globals","api/mapsocket","backbone","lib/ajax","controller/deferred","controller/iframe","log","jstorage","cookie"],function(e){var t=e("globals"),i=e("api/mapsocket"),n=(e("backbone"),e("lib/ajax"),e("controller/deferred")),o=e("controller/iframe"),r=e("log");e("jstorage"),e("cookie"),r.module("module/mapped");var a=r.create("mapped","background-color:red;color:white");o.is()||(top.location=t.DOMAIN_NAME_URL),$.cookie("testcookie",!0);var s=$.cookie("testcookie");if(!s){var l={method:"abandon_ship"};return void i.postMessage(JSON.stringify(l))}AboutMe.on("mapped:message",function(e){switch(a("mapped:message",e),e.method){case"user_data":var t=e.data;define("data/user",[],function(){return t});break;case"deferred_defer":n.store(e.obj,e.which);break;case"set_storage":$.jStorage.set(e.data.key,e.data.value,e.data.options)}})}),define("text!template/search.html",[],function(){return'<script type="text/template" id="layout-template">\n	<div id="search-field" class="pin-this"></div>\n	<div id="search-filters"></div>\n	<div id="search-related" class="pin-this invisible"></div>\n	<div id="search-number"></div>\n	<div id="search-results"></div>\n</script>\n\n<script type="text/template" id="search-field-template">\n	<div id="search-form"></div>\n	<div id="search-suggestions"></div>\n</script>\n\n<script type="text/template" id="form-template">\n	<div class="buttonfield">\n		<input class="input search-main-field" name="terms" id="terms" type="text" value="{{ data.term }}" tabindex="1" maxlength="100" autocomplete="off" autocapitalize="off" autocorrect="off" />\n		<input class="input hint" name="terms_hint" id="terms_hint" type="text" value="" maxlength="100" autocomplete="off" disabled />\n		<button class="button submitbutton glyph-search glyph-center" type="submit" tabindex="-1" data-metric="Search"></button>\n	</div>\n</script>\n\n<script type="text/template" id="suggestion-template">\n	<: if (data.type !== \'name\') { :>\n		<span>{{ data.term }}</span> <span class="search-suggestion-count glyph-{{ data.glyph }}">{{ data.count }} <span class="search-suggestion-people">{{ data.people }}</span></span>\n	<: } else if (\'search.html 1\') { :>\n		<span class="search-suggestion-count">People named</span> <span>{{ data.term }}</span>\n	<: } :>\n</script>\n\n<script type="text/template" id="no-suggestions-template">\n	<p>No results found.</p>\n</script>\n\n<script type="text/template" id="filter-template">\n	<span class="search-filter-wrap">{{ data.term }}</span>\n	<span class="glyph-close glyph-center search-filter-remove">&nbsp;</span>\n</script>\n\n<script type="text/template" id="related-terms-template">\n	<span class="search-related-label">Also try</span>\n	<ul></ul>\n</script>\n\n<script type="text/template" id="related-term-template">\n	<span class="search-related-term search-related-term-{{ data.type }}"><span class="search-related-term-bg"></span><span class="search-related-term-content">{{ data.term }}</span></span>\n</script>\n\n<script type="text/template" id="number-template">\n	<: if (data.filters_applied > 0 && data.number > 0) { :>\n		Presenting&nbsp;{{ data.number_string }}&nbsp;{{ data.people_term }}&hellip;\n	<: } else if (\'search.html 2\') { :>\n		There are no people matching your search. Try removing one or more terms to see more matches.\n	<: } :>\n</script>'}),define("lib/search_field",["require","globals","marionette","lib/utils","lib/ajax","browser","viewport","lib/metrics","model/basemodel","text!template/search.html","log"],function(e){var t=e("globals"),i=e("marionette"),n=e("lib/utils"),o=e("lib/ajax"),r=e("browser"),a=e("viewport"),s=e("lib/metrics"),l=e("model/basemodel"),c=e("text!template/search.html"),u=e("log");u.module("lib/search");var d,h,g,p=(u.create("search lib","background-color:#52364b;color:white"),AboutMe.module("Search")),m=!1,f=function(){var e;return e=p.filterList&&p.filterList.length?"Enter another interest, place, organization, or name":"Enter an interest, place, organization, or name"},b=i.Controller.extend({initialize:function(){this.listenTo(p,"search:update:layout",this.updateLayout),this.listenTo(p,"user:typed:term",this.getSuggestions),this.listenTo(p,"suggestion:submitted",this.suggestionSelected),this.listenTo(p,"suggestions:hint:update",this.suggestionHint),this.listenTo(p,"filter:add",this.searchSubmitted),this.layout=new v,p.filterList=p.filterList||[]},searchSubmitted:function(e,i){"search"!=t.PAGE&&(s.log("Search Submitted: In Nav",{page:t.PAGE,type:i,term:e}),this.goToSearchPage(e,i))},goToSearchPage:function(e,t){var i="/search/"+t+":"+e;window.location=i},updateLayout:function(){p.field&&!$(p.field).val().length&&$(p.hintField).val(f())},getSuggestions:function(e){var i=A.getTypeahead(e.toLowerCase()),n=this;$.when(i).done(function(i){var o="search"!=t.PAGE?i.slice(0,6):_.filter(i,function(e){var t=!0;return p.filterList.each(function(i){e.term.toLowerCase()==i.get("term").toLowerCase()&&e.type.toLowerCase()==i.get("type").toLowerCase()&&(t=!1)}),t});h=new k(o),n.suggestionHint(),e.toLowerCase()==$(p.field).val().toLowerCase()?(g=new S({collection:h}),d.layout.suggestionRegion.show(g)):(h&&h.reset(),d.layout.suggestionRegion.reset()),m&&h.selected&&n.suggestionSelected(h.selected)})},suggestionSelected:function(e){h&&h.reset(),d.layout.suggestionRegion.reset();var t=e?e.get("term"):null,i=e?e.get("type"):null;t&&i&&p.trigger("filter:add",t,i)},suggestionHint:function(){var e="",t=$(p.field).val(),i=t.length;if(h&&h.length&&h.selected&&i>1){e=h.selected.get("term");var n="";_.each(e.substr(0,i),function(e,i){var o=t.charAt(i);n+=e.toLowerCase()==o.toLowerCase()?o:e}),$(p.field).val(n),e=n+e.substr(i)}else 0===i&&(e=f());$(p.field).closest(".buttonfield").find(".button").removeClass("disabled"),$(p.hintField).val(e)}}),v=Backbone.Marionette.LayoutView.extend({className:"search-field",template:_.template($(c).filter("#search-field-template").html()),regions:{formRegion:"#search-form",suggestionRegion:"#search-suggestions"},onRender:function(){var e=new y;this.formRegion.show(e)}}),y=i.ItemView.extend({tagName:"form",className:"searchform",min_term_length:2,template:_.template($(c).filter("#form-template").html()),ui:{field:"#terms",hint_field:"#terms_hint",button:".button"},events:{submit:"searchSubmit","keyup @ui.field":"handleKeyup","keydown @ui.field":"handleKeydown","focus @ui.field":"handleFocus","blur @ui.field":"handleBlur"},initialize:function(){_.bindAll(this,"searchSubmit","setupShrinkwrap","getTypeahead","handleTermEntry","focusForm"),this.listenTo(p,"filter:add",this.resetForm),this.listenTo(p,"filter:remove",this.resetForm),this.listenTo(p,"filter:remove",this.focusForm),this.listenTo(p,"typeahead:update",this.handleTermEntry)},onRender:function(){p.field=this.ui.field,p.hintField=this.ui.hint_field},onShow:function(){this.ui.hint_field.val(f()),$(window).on("resize orientationchange",this.setupShrinkwrap),this.setupShrinkwrap(),this.resetForm(),p.trigger("search:update:pinned")},searchSubmit:function(e){e&&e.preventDefault(),p.trigger("search:submitted")},resetForm:function(){this.ui.field.val(""),a.isNot("small")&&this.focusForm(),d.layout.suggestionRegion.reset(),p.trigger("suggestions:hint:update")},focusForm:function(){this.ui.field.focus()},clearHint:function(){this.ui.hint_field.val("")},handleFocus:function(){"search"!=t.PAGE&&this.ui.field.val().length&&d.layout.suggestionRegion.$el&&d.layout.suggestionRegion.$el.is(":empty")&&this.handleTermEntry()},handleBlur:function(){if(!a.is("small")&&h&&h.length){if("search"!=t.PAGE){var e=this;return void _.delay(function(){e.clearHint(),d.layout.suggestionRegion.reset()},200)}var i=$(window).scrollTop();this.ui.field.focus(),$(window).scrollTop(i)}},handleKeydown:function(e){e=n.getEvent(e);var t=n.getKeyCode(e);switch(t){case 9:if(e.preventDefault(),h&&h.length&&h.selected){var i=this.ui.field.val(),o=h.selected.get("term");this.ui.field.val(o),this.ui.hint_field.val(o),i.length<o.length&&p.trigger("typeahead:update")}break;case 27:this.resetForm();break;case 16:case 20:case 17:case 18:case 224:case 17:case 91:case 93:case 37:case 39:case 13:break;case 38:if(e.preventDefault(),h&&h.length&&h.first()==h.selected)break;if(r.isNot("desktop"))break;this.clearHint(),p.trigger("suggestion:select:prev");break;case 40:if(e.preventDefault(),h&&h.length&&h.last()==h.selected)break;if(r.isNot("desktop"))break;this.clearHint(),p.trigger("suggestion:select:next");break;default:p.trigger("search:update:layout"),this.clearHint()}},handleKeyup:function(e){if(!n.isTextSelected(this.ui.field[0])){e=n.getEvent(e);var t=n.getKeyCode(e);switch(t){case 9:case 27:case 37:case 39:case 38:case 40:case 224:case 17:case 91:case 93:break;case 13:if(e.preventDefault(),this.ui.field.val().length<this.min_term_length)return;this.handleTermEntry(13);break;default:this.handleTermEntry()}}},handleTermEntry:_.debounce(function(e){e=e||0,h&&h.reset(),d.layout.suggestionRegion.reset(),this.getTypeahead(e)},20),getTypeahead:_.debounce(function(e){var t=this.ui.field.val();m=13==e?!0:!1,t.length>=this.min_term_length?($(window).scrollTop(0),p.trigger("user:typed:term",t)):(h&&h.reset(),d.layout.suggestionRegion.reset(),p.trigger("suggestions:hint:update"))},200),setupShrinkwrap:_.debounce(function(){"search"==t.PAGE&&(this.ui.field.shrinkWrap({minimum:13,evalExternally:!0,textToTest:f(),allowUpsize:!0,adjust:$(window).width()<=640?0:-50}),this.ui.hint_field.css("font-size",parseInt(this.ui.field.css("font-size"))))},100)}),w=l.extend({defaults:{type:"",term:"",glyph:"tag",people:"people",count:0,selected:!1}}),k=Backbone.Collection.extend({model:w}),x=i.ItemView.extend({tagName:"li",template:_.template($(c).filter("#suggestion-template").html()),className:"search-suggestion",events:{click:"suggestionClicked",mouseover:"suggestionHovered"},modelEvents:{change:"setSelected"},initialize:function(){_.bindAll(this,"suggestionClicked")
},onBeforeRender:function(){1==this.model.get("count")&&this.model.set("people","person"),this.setGlyph(),this.$el.addClass("suggestion-"+this.model.get("type")),this.setSelected()},setSelected:function(){this.$el.toggleClass("selected",this.model.get("selected")).attr("data-id",this.model.cid)},suggestionHovered:function(){r.isNot("desktop")||this.trigger("suggestion:hovered")},suggestionClicked:function(){this.trigger("suggestion:clicked")},setGlyph:function(){var e=this.model.get("glyph");switch(this.model.get("type")){case"keyword":e="tag";break;case"place":e="location";break;case"org":e="building";break;case"name":e="person"}this.model.set("glyph",e)}}),C=i.ItemView.extend({tagName:"li",className:"search-suggestion no-search-sugggestions",template:_.template($(c).filter("#no-suggestions-template").html())}),S=i.CollectionView.extend({tagName:"ul",className:"search-suggestions",childView:x,getEmptyView:function(){return $(p.field).closest(".buttonfield").find(".button").addClass("disabled"),C},initialize:function(){_.bindAll(this,"disableHoverSelect"),this.listenTo(p,"search:submitted",this.submitSuggestion),this.listenTo(p,"suggestion:select:prev",this.selectPrev),this.listenTo(p,"suggestion:select:next",this.selectNext),this.on("childview:suggestion:hovered",this.getModelToSelect),this.on("childview:suggestion:clicked",this.suggestionClicked)},onBeforeRender:function(){this.collection.length&&this.setSelectedSuggestion(this.collection.first())},onShow:function(){"search"==t.PAGE&&this.$el.css({minHeight:AboutMe.main_region.$el.height()-50}),$("body").addClass("suggestions-showing")},onDestroy:function(){$("body").removeClass("suggestions-showing")},suggestionClicked:function(e){this.setSelectedSuggestion(e.model,!1),this.submitSuggestion()},submitSuggestion:function(){var e=this.collection.selected||null;p.trigger("suggestion:submitted",e)},getModelToSelect:function(e){this.setSelectedSuggestion(e.model)},unsetSelectedSuggestions:function(){_.each(this.collection.models,function(e){e.set("selected",!1)})},setSelectedSuggestion:function(e,t,i){t=t||!1,this.unsetSelectedSuggestions(),e.set("selected",!0),this.collection.selected=e,p.trigger("suggestions:hint:update"),t&&(this.disableHoverSelect(),this.checkVisibility(i))},checkVisibility:function(e){var t=this.collection.selected.cid,i=this.$el.find("[data-id="+t+"]"),n=$(window).scrollTop(),o=$(window).height(),r="down"==e?.618033*o:.381967*o;if(i.length){var a=i.offset().top;("down"==e&&a>o-n-r||"up"==e&&n>a-r)&&$(window).scrollTop(a-r)}},disableHoverSelect:function(){this.off("childview:suggestion:hovered"),$(window).off("mousestartedmoving");var e=this;$(window).one("mousestartedmoving",function(){e.on("childview:suggestion:hovered",e.getModelToSelect)}),$(window).on("mousemove",function(e){(window.lastX!==e.clientX||window.lastY!==e.clientY)&&$(window).trigger("mousestartedmoving"),window.lastX=e.clientX,window.lastY=e.clientY})},selectPrev:function(){if(0!==this.collection.indexOf(this.collection.selected)){var e=this.collection.at(this.collection.indexOf(this.collection.selected)-1);this.setSelectedSuggestion(e,!0,"up")}},selectNext:function(){if(this.collection.indexOf(this.collection.selected)<this.collection.length-1){var e=this.collection.at(this.collection.indexOf(this.collection.selected)+1);this.setSelectedSuggestion(e,!0,"down")}}}),A={getTypeahead:function(e){var t=$.Deferred(),i={term:e},n={success:function(e){var i=[];_.each(e.results,function(e){i.push(_.object(["type","term","count"],e))}),t.resolve(i)},error:function(){t.reject(void 0)}};return o.post("typeahead",i,n),t.promise()}};return d=new b}),define("text!template/topnav.html",[],function(){return'<: if (data.show_logo) { :>\n	<: if (data.linked_logo) { :>\n		<a class="logo nav-link" href="[[ (data.g.ENVIRONMENT == \'production\') ? \'https://\':\'http://\' ]][[ data.g.DOMAIN_NAME ]]/">\n	<: } else if (\'topnav.html 1\') { :>\n		<span class="logo nav-item">\n	<: } :>\n\n	<span class="nav-item">\n		<img src="[[ data.g.STATIC_HOSTNAME ]]/images/logos/aboutme_logo_white.svg" />\n	</span>\n\n	<: if (data.linked_logo) { :>\n		</a>\n	<: } else if (\'topnav.html 2\') { :>\n		</span>\n	<: } :>\n<: } :>\n\n\n<: if (data.show_account_links) { :>\n	<ul class="nav accountlinks">\n		<: if (data.viewer.logged_in) { :>\n\n			<: if (! data.viewer.has_backstory) { :>\n				<li class="backstory-link">\n					<a href="/[[ data.viewer.user_name ]]/below/backstory" class="promo-link button dark orange" data-metric="Add Backstory - Button" title="Set yourself apart professionally with Backstory">Backstory</a>\n				</li>\n			<: } :>\n\n			<: if (data.show_upgrade) { :>\n				<li class="upgrade-link">\n					<a href="/upgrade" class="promo-link button dark transparent" data-metric="Upgrade">Upgrade</a>\n				</li>\n			<: } :>\n\n			<li class="dashboard">\n				<: if (data.g.PAGE === \'dashboard\') { :>\n					<span class="nav-item active">Home<span class="badge"></span></span>\n				<: } else if (\'topnav.html 3\') { :>\n					<a href="/home" class="nav-link" data-metric="Home">Home<span class="badge"></span></a>\n				<: } :>\n			</li>\n\n			<li class="mypage menu menu-right" data-menuname="User">\n				<span class="menu-head nav-link">\n					<span class="menu-toggle menu-arrow nav-item [[ (data.viewer_is_user)?\'active\':\'\' ]]">{{ data.viewer.display_first_name }}</span>\n				</span>\n				<ul class="menu-content">\n					<li class="item" data-metric="Edit Page"><a href="/[[ data.viewer.user_name ]]/#!/edit" class="editbutton">Edit Page</a></li>\n					<li class="item" data-metric="Get More Visitors"><a href="/share">Get More Visitors</a></li>\n					<: if (data.viewer.has_backstory) { :>\n						<li class="item add_backstory" data-metric="Edit Backstory - Menu"><a href="/[[ data.viewer.user_name ]]/below/backstory">Edit Backstory</a></li>\n					<: } else if (\'topnav.html 4\') { :>\n						<li class="item add_backstory" data-metric="Add Backstory - Menu"><a href="/[[ data.viewer.user_name ]]/below/backstory">Create Backstory</a></li>\n					<: } :>\n					<li class="item directories" data-metric="My Collections"><a href="/[[ data.viewer.user_name ]]/collections">My Collections</a></li>\n					<li class="item" data-metric="Stats"><a href="/stats/">Stats</a></li>\n					<li class="separator"><hr /></li>\n					<: if (data.viewer.plan_name) { :>\n						<li class="item upgrade" data-metric="Upgrade - {{ data.viewer.plan_name }}"><a href="/upgrade">{{ data.viewer.plan_name }}</a></li>\n					<: } else if (\'topnav.html 5\') { :>\n						<li class="item upgrade" data-metric="Upgrade"><a href="/upgrade">Upgrade</a></li>\n					<: } :>\n				</ul>\n			</li>\n\n			<li class="accountmenu menu menu-right" data-menuname="Account">\n				<span class="nav-link menu-head">\n					<span class="menu-toggle glyph-menu glyph-center">&nbsp;</span>\n				</span>\n				<ul class="menu-content">\n					<li class="item" data-metric="Account Settings"><a href="/account/">Account Settings</a></li>\n					<li class="item" data-metric="Invite Friends"><a href="/invite/">Invite Friends</a></li>\n					<: if (data.viewer.aol_email_url) { :>\n						<li class="item aolemail" data-metric="View Email"><a href="[[ data.viewer.aol_email_url ]]">View Email</a></li>\n					<: } :>\n					<: if (_.contains([\'development\',\'test\'], data.g.ENVIRONMENT)) { :>\n						<li class="item playground" data-metric="Playground"><a href="/me/playground">Playground</a></li>\n					<: } :>\n					<li class="item helplink" data-metric="Help"><a href="[[ data.viewer.support_link ]]" target="_blank">Help</a></li>\n					<li class="separator"><hr /></li>\n					<li class="item signin" data-metric="Log Out"><a href="/logout">Log Out</a></li>\n				</ul>\n			</li>\n\n			<li class="hamburger menu menu-right" data-menuname="Hamburger">\n				<span class="nav-link menu-head">\n					<span class="menu-toggle glyph-menu glyph-center">&nbsp;</span>\n				</span>\n				<ul class="menu-content">\n					<li class="item" data-metric="My Page"><a href="/[[ data.viewer.user_name ]]" class="my-page">My Page</a></li>\n					<li class="item" data-metric="My Collections"><a href="/[[ data.viewer.user_name ]]/collections">My Collections</a></li>\n					<li class="item" data-metric="Account Settings"><a href="/account/">Account Settings</a></li>\n					<li class="item" data-metric="Invite Friends"><a href="/invite/">Invite Friends</a></li>\n					<li class="item" data-metric="Get More Visitors"><a href="/share">Get More Visitors</a></li>\n					<li class="item" data-metric="Discover"><a href="/people/">Discover</a></li>\n					<li class="item helplink" data-metric="Help"><a href="[[ data.viewer.support_link ]]" target="_blank">Help</a></li>\n					<li class="separator"><hr /></li>\n					<: if (data.viewer.plan_name) { :>\n						<li class="item upgrade" data-metric="Upgrade - {{ data.viewer.plan_name }}"><a href="/upgrade">{{ data.viewer.plan_name }}</a></li>\n					<: } else if (\'topnav.html 6\') { :>\n						<li class="item upgrade" data-metric="Upgrade"><a href="/upgrade">Upgrade</a></li>\n					<: } :>\n					<li class="separator"><hr /></li>\n					<li class="item signin" data-metric="Log Out"><a href="/logout">Log Out</a></li>\n				</ul>\n			</li>\n\n		<: } else if (\'topnav.html 7\') { :>\n			<: if (data.show_signup) { :>\n				<li class="signup"><span class="button dark orange" data-metric="Claim your name">Claim your name!</span></li>\n			<: } :>\n			<: if (data.show_login) { :>\n				<li class="signin">\n					<: if (data.show_already_have_page) { :>\n						<span class="alreadyhaveapage">Already have a page?</span>\n					<: } :>\n					<a href="[[ data.login_link ]]" class="nav-link" data-metric="Log In">Log In</a>\n				</li>\n			<: } :>\n		<: } :>\n	</ul>\n<: } :>\n\n\n<: if (data.show_app_links) { :>\n	<ul class="nav applinks">\n		<: if (data.show_search) { :>\n			<li class="search-icon">\n				<: if (data.g.PAGE === \'search\') { :>\n					<span class="nav-item active glyph-search glyph-center">&nbsp;</span>\n				<: } else if (\'topnav.html 8\') { :>\n					<a href="/search/" class="nav-link glyph-search glyph-center" title="Find people" data-metric="Search">&nbsp;</a>\n				<: } :>\n			</li>\n			<li class="search"></li>\n		<: } :>\n\n		<: if (data.show_discover) { :>\n			<li class="people">\n				<: if (data.g.PAGE === \'people\') { :>\n					<span class="nav-item active">Discover</span>\n				<: } else if (\'topnav.html 9\') { :>\n					<a href="/people/" class="nav-link" title="Explore the best pages on about.me" data-metric="Discover">Discover</a>\n				<: } :>\n			</li>\n		<: } :>\n	</ul>\n<: } :>\n'}),define("class/menu",["log","lib/event","lib/utils","lib/escape"],function(e,t,i,n){e.module("class/menu");var o=function(e,t){var i=this;i.node=$(e),i.o=$.extend({fadeinspeed:150,fadeoutspeed:100,forcewidth:!0,stopPropagation:!0,keyboard:!1,closeOnEscape:!0},t),i.init()};o.prototype={init:function(){var e=this;e.id=i.id("menu"),e.head=e.node.find(".menu-head").first(),e.content=e.node.find(".menu-content").first(),e.content.closest(".menu-container").length||e.content.wrap('<div class="menu-container"></div>'),e.container=e.node.find(".menu-container").first(),e.menuitems=e.node.find("ul.menu-content").first(),e.menubar=e.node.parents(".menubar"),e.submenu=e.node.parents(".menu").length,e.menubar.length||(e.menubar=!1),e.node.find(".menu-arrow").addClass("glyph-triangle-down-after"),e.mobilenav||e.menuitems.length&&(e.menuitems.on("mouseover mousemove","li.item",function(){var t=$(this);t.hasClass("disabled")||t.hasClass("selected")||e.select(this)}),e.menuitems.on("mouseout",function(){e.unselect()})),e.container.on("click.menu",function(){}),e.checkState(),e.node.addClass("menu menu-setup"),e.o.afterInit&&e.o.afterInit.call(e)},toggle:function(e){var t=this;t.busy||(t.node.hasClass("active")?t.hide(e):t.show(e))},show:function(i){var o=this;if(i&&i.stopPropagation&&i.stopPropagation(),!o.busy){if(o.o.beforeShow){var r=o.o.beforeShow.call(o);if(!r)return void e("Menu not shown because beforeShow method did not return true")}if(o.busy=!0,o.hideOthers(),o.node.addClass("active"),o.container.show(),o.checkWidth(),o.content.show(),o.o.closeOnEscape&&n.listen(o.id,function(){o.hide()}),o.node.hasClass("menu-fullwidth")){var a=o.menubar.offset().left,s=o.head.offset().left,l=o.head[0].offsetWidth,c=Math.round(s-a+l+20);o.container.css({"min-width":c+"px"})}o.node.hasClass("menu-right")&&o.content.offset().left<0&&(o.node.removeClass("menu-right"),t.on("menu_hide",o.node,function(){o.node.addClass("menu-right")})),o.busy=!1,o.content.find("input:text,textarea").eq(0).focus(),o.o.afterShow&&o.o.afterShow.call(o),t.trigger("menu_show",[o]),$(window).one("click.menuhide",function(){o.hide()}),o.node.closest(".topnav").length&&t.one("banner_open",function(){o.hide()}),o.o.keyboard&&o.node.find("input").on("keydown.menu",function(e){var t=e.keyCode,i=[$.ui.keyCode.ENTER,$.ui.keyCode.UP,$.ui.keyCode.DOWN,$.ui.keyCode.TAB];return $.isInArray(t,i)&&($.doTimeout("menu.handlekey",10,function(){o.handleKey(e)}),t!=$.ui.keyCode.ENTER||o.selected.length)?!1:void 0})}},hide:function(){var t=this;if(!t.busy){if(t.o.beforeHide){var i=t.o.beforeHide.call(t);if(!i)return void e("Menu not hidden because beforeHide method did not return true")}t.busy=!0,t.o.closeOnEscape&&n.unlisten(t.id),$(window).off("click.menuhide"),t.node.removeClass("active"),$.doTimeout(100,function(){t.afterHide()}),t.o.keyboard&&(t.node.find("input").off("keydown.menu"),t.unselect())}},afterHide:function(){var e=this;e.container.hide(),e.busy=!1,e.o.afterHide&&e.o.afterHide.call(e),t.trigger("menu_hide",[e]),t.trigger("menu_hide",e.node)},checkState:function(){var e=this;e.menuitems.find("li.separator").each(function(){var e=$(this),t=e.prevAll("li").not(".invisible").eq(0),i=e.nextAll("li").not(".invisible").eq(0);t.length&&i.length&&!t.hasClass("separator")&&!i.hasClass("separator")?e.removeClass("invisible"):e.addClass("invisible")}),t.trigger("menu_checkstate",[e])},checkWidth:function(){var e=this;if(!e.mobilenav&&e.menuitems.length&&e.o.forcewidth){var t=e.node.width();e.menuitems.find("li.item").css("min-width",t+"px").on("click",function(){$(this).hasClass("disabled")||e.hide()})}},hideOthers:function(){$(".menu.active").each(function(){var e=$(this).data("menu");e&&e.hide&&e.hide()})},handleKey:function(e){var t=this,i=e.keyCode;switch(t.selected=t.menuitems.find("li.item.selected"),i){case $.ui.keyCode.ESCAPE:t.hide();break;case $.ui.keyCode.ENTER:t.selected.length&&t.selected.trigger("click");break;case $.ui.keyCode.TAB:t.selected.length&&t.selected.trigger("click");break;case $.ui.keyCode.UP:t.selectPrevItem();break;case $.ui.keyCode.DOWN:t.selectNextItem()}t.o.handleKey&&t.o.handleKey.apply(t,[e])},selectNextItem:function(){var e=this;if(e.menuitems.length){if(e.selected.length)var t=e.selected.next("li.item:not(.disabled):not(.invisible)");else var t=e.menuitems.find("li.item").not(".disabled").not(".invisible").first();e.select(t)}},selectPrevItem:function(){var e=this;if(e.menuitems.length){if(e.selected.length)var t=e.selected.prev("li.item:not(.disabled):not(.invisible)");else var t=e.menuitems.find("li.item").not(".disabled").not(".invisible").last();e.select(t)}},unselect:function(){var e=this;e.selected=e.menuitems.find("li.item.selected").removeClass("selected").is(".selected"),e.o.afterUnselect&&e.o.afterUnselect.call(e)},select:function(e){var t=this;e=$(e),e.length&&(t.unselect(),t.selected=e.addClass("selected"),t.o.afterSelect&&t.o.afterSelect.call(t))}},$.fn.menu=function(e){return this.each(function(){var t=$(this);t.hasClass("menu-setup")||t.data("menu",new o(this,e))})};var r=function(){$(".menu").menu(),$("body").on("click",".menu .menu-toggle",function(e){var t=$(this).closest(".menu");t.hasClass("menu-setup")||t.menu();var i=t.data("menu");i&&i.toggle&&i.toggle(e)})};return $(document).ready(r),o}),define("module/topnav",["require","globals","marionette","viewer","model/basemodel","lib/metrics","lib/search_field","text!template/topnav.html","log","class/menu"],function(e){var t=e("globals"),i=e("marionette"),n=e("viewer"),o=e("model/basemodel"),r=e("lib/metrics"),a=e("lib/search_field"),s=e("text!template/topnav.html"),l=e("log");e("class/menu"),l.module("module/topnav");var c=(l.create("topnav"),o.extend({calculated_values:{show_logo:function(){var e=!0;return e},linked_logo:function(){var e=!0;return _.contains(["dashboard","progresspage","contact_import","new_user"],t.PAGE)&&(e=!1),e},show_account_links:function(){if(t.PAGE_USER_RENAMED)return!1;var e=!0;return _.contains(["change_password","progresspage","contact_import"],t.PAGE)&&(e=!1),e},show_upgrade:function(){var e=!1;return _.contains(["dashboard","user"],t.PAGE)&&(e=!0,(n.get("plan_name")||n.get("upgrade_viewed"))&&(e=!1)),e},login_link:function(){var e="http://";"production"===t.ENVIRONMENT&&(e="https://");var i=e+t.DOMAIN_NAME+"/login";return"user"===t.PAGE&&t.PAGE_USER_NAME&&(i+="?came_from="+t.PAGE_USER_NAME),i},show_signup:function(){var e=!0;return _.contains(["new_user","login"],t.PAGE)&&(e=!1),e},show_login:function(){var e=!0;return _.contains(["new_user"],t.PAGE)&&(e=!1),e},show_already_have_page:function(){var e=!1;return _.contains(["home","login"],t.PAGE)&&(e=!0),e},show_app_links:function(){if(t.PAGE_USER_RENAMED)return!1;var e=!0;return _.contains(["change_password","progresspage","contact_import"],t.PAGE)&&(e=!1),e},show_search:function(){var e=!0;return _.contains(["home","progresspage","contact_import","new_user","login","change_password"],t.PAGE)&&(e=!1),e},show_discover:function(){var e=!0;return _.contains(["home","progresspage","contact_import","new_user"],t.PAGE)&&(e=!1),e},viewer_is_user:function(){return n.isUser(t.PAGE_USER_NAME)}}})),u=i.LayoutView.extend({className:"content",template:_.template(s),regions:{search_region:"li.search"},initialize:function(){this.listenTo(n.model,"change:notification_count",this.updateBadge),this.metrics()},onBeforeRender:function(){this.templateHelpers={g:t,viewer:n.model.toJSON()}},onRender:function(){this.$(".menu").menu(),this.updateBadge(),this.model.get("show_search")&&"search"!=t.PAGE&&this.search_region.show(a.layout)},ui:{badge:"li.dashboard .badge"},events:{},updateBadge:function(){if(n.logged_in){var e=n.get("notification_count");e>99&&(e="99+"),e?(this.ui.badge.text(e),this.ui.badge.parent().addClass("hasbadge")):(this.ui.badge.empty(),this.ui.badge.parent().removeClass("hasbadge"))}},metrics:function(){this.$el.on("click",".logo.nav-link",function(){var e="Nav: Clicked Logo - ";e+=n.logged_in?"Logged in":"Logged out",r.log(e)}),this.$el.on("click",".menu .menu-toggle",function(){var e=$(this).closest(".menu"),t=e.hasClass("active")?"Closed":"Opened",i="Nav: "+t+" "+e.data("menuname")+" Menu";r.log(i)}),this.$el.on("click",".menu li.item",function(){var e=$(this),t=e.closest(".menu"),i="Nav: "+t.data("menuname")+" Menu  Clicked "+e.data("metric");r.log(i)}),this.$el.on("click","ul.nav > li:not(.menu) .nav-link, ul.nav > li:not(.menu) .button",function(){var e=$(this),t="Nav: Clicked Button "+e.data("metric");r.log(t)})}});return{View:u,Model:c}}),define("text!template/footer.html",[],function(){return'<hr class="separator" />\n\n<: if (data.g.IOS_APP_PROMO) { :>\n	<a href="http://itunes.apple.com/us/app/about.me-for-iphone/id500230347" class="ios-footer"></a>\n<: } :>\n\n<p>\n	<a href="/">Home</a>\n	<span class="divider">&nbsp;</span>\n	<a href="/about/us">About Us</a>\n	<span class="divider">&nbsp;</span>\n	<a href="/people/popular">Popular Pages</a>\n	<span class="divider">&nbsp;</span>\n	<a href="http://blog.about.me">Blog</a>\n	<span class="divider">&nbsp;</span>\n	<a href="/terms">Terms of Use</a>\n	<span class="divider">&nbsp;</span>\n	<a href="/privacy">Privacy Policy</a>\n	<span class="divider">&nbsp;</span>\n	<a href="[[ data.viewer.support_link ]]" target="_blank">Help</a>\n	<span class="divider">&nbsp;</span>\n	<a href="http://twitter.com/aboutdotme" class="glyph-twitter">Follow us on Twitter</a>\n</p>\n<p class="copyright">\n	<span>&copy; [[ (new Date()).getFullYear() ]] about.me&trade;. All Rights Reserved.</span>\n</p>\n'}),define("module/footer",["require","globals","marionette","viewer","text!template/footer.html","log"],function(e){var t=e("globals"),i=e("marionette"),n=e("viewer"),o=e("text!template/footer.html"),r=e("log");r.module("module/footer");var a=(r.create("footer"),i.LayoutView.extend({className:"content",template:_.template(o),onBeforeRender:function(){this.templateHelpers={g:t,viewer:n.model.toJSON()}}}));return{View:a}}),define("lib/goog",["log"],function(e){e.module("lib/goog");var t=!0,i=i||{};return i.global=this,i.DEBUG=!0,i.LOCALE="en",i.evalWorksForGlobals_=null,i.provide=function(e){if(!t){if(i.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');delete i.implicitNamespaces_[e];for(var n=e;(n=n.substring(0,n.lastIndexOf(".")))&&!i.getObjectByName(n);)i.implicitNamespaces_[n]=!0}i.exportPath_(e)},i.isProvided_=function(e){return!i.implicitNamespaces_[e]&&!!i.getObjectByName(e)},i.setTestOnly=function(e){if(t&&!i.DEBUG)throw e=e||"",Error(": "+e)},t||(i.implicitNamespaces_={}),i.exportPath_=function(e,t,n){e=e.split("."),n=n||i.global,!(e[0]in n)&&n.execScript&&n.execScript("var "+e[0]);for(var o;e.length&&(o=e.shift());)!e.length&&i.isDef(t)?n[o]=t:n=n[o]?n[o]:n[o]={}},i.getObjectByName=function(e,t){for(var n,o=e.split("."),r=t||i.global;n=o.shift();){if(!i.isDefAndNotNull(r[n]))return null;r=r[n]}return r},i.globalize=function(e,t){var n,o=t||i.global;for(n in e)o[n]=e[n]},i.addDependency=function(e,n,o){if(!t){for(var r,e=e.replace(/\\/g,"/"),a=i.dependencies_,s=0;r=n[s];s++)a.nameToPath[r]=e,e in a.pathToNames||(a.pathToNames[e]={}),a.pathToNames[e][r]=!0;for(r=0;n=o[r];r++)e in a.requires||(a.requires[e]={}),a.requires[e][n]=!0}},i.require=function(e){if(!t&&!i.getObjectByName(e)){var n=i.getPathFromDeps_(e);if(!n)throw e="goog.require could not find: "+e,i.global.console&&i.global.console.error(e),Error(e);i.included_[n]=!0,i.writeScripts_()}},i.basePath="",i.nullFunction=function(){},i.identityFunction=function(e){return e},i.abstractMethod=function(){throw Error("unimplemented abstract method")},i.addSingletonGetter=function(e){e.getInstance=function(){return e.instance_||(e.instance_=new e)}},t||(i.included_={},i.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},i.inHtmlDocument_=function(){var e=i.global.document;return"undefined"!=typeof e&&"write"in e},i.findBasePath_=function(){if(i.global.CLOSURE_BASE_PATH)i.basePath=i.global.CLOSURE_BASE_PATH;else if(i.inHtmlDocument_())for(var e=i.global.document.getElementsByTagName("script"),t=e.length-1;t>=0;--t){var n=e[t].src,o=n.lastIndexOf("?"),o=-1==o?n.length:o;if("base.js"==n.substr(o-7,7)){i.basePath=n.substr(0,o-7);break}}},i.importScript_=function(e){var t=i.global.CLOSURE_IMPORT_SCRIPT||i.writeScriptTag_;!i.dependencies_.written[e]&&t(e)&&(i.dependencies_.written[e]=!0)},i.writeScriptTag_=function(e){return i.inHtmlDocument_()?(i.global.document.write('<script type="text/javascript" src="'+e+'"></script>'),!0):!1},i.writeScripts_=function(){function e(t){if(!(t in r.written)){if(!(t in r.visited)&&(r.visited[t]=!0,t in r.requires))for(var a in r.requires[t])if(!i.isProvided_(a)){if(!(a in r.nameToPath))throw Error("Undefined nameToPath for "+a);e(r.nameToPath[a])}t in o||(o[t]=!0,n.push(t))}}var t,n=[],o={},r=i.dependencies_;for(t in i.included_)r.written[t]||e(t);for(t=0;t<n.length;t++){if(!n[t])throw Error("Undefined script input");i.importScript_(i.basePath+n[t])}},i.getPathFromDeps_=function(e){return e in i.dependencies_.nameToPath?i.dependencies_.nameToPath[e]:null},i.findBasePath_(),i.global.CLOSURE_NO_DEPS||i.importScript_(i.basePath+"deps.js")),i.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var i=Object.prototype.toString.call(e);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t},i.propertyIsEnumerableCustom_=function(e,t){if(t in e)for(var i in e)if(i==t&&Object.prototype.hasOwnProperty.call(e,t))return!0;return!1},i.propertyIsEnumerable_=function(e,t){return e instanceof Object?Object.prototype.propertyIsEnumerable.call(e,t):i.propertyIsEnumerableCustom_(e,t)},i.isDef=function(e){return void 0!==e},i.isNull=function(e){return null===e},i.isDefAndNotNull=function(e){return null!=e},i.isArray=function(e){return"array"==i.typeOf(e)},i.isArrayLike=function(e){var t=i.typeOf(e);return"array"==t||"object"==t&&"number"==typeof e.length},i.isDateLike=function(e){return i.isObject(e)&&"function"==typeof e.getFullYear},i.isString=function(e){return"string"==typeof e},i.isBoolean=function(e){return"boolean"==typeof e},i.isNumber=function(e){return"number"==typeof e},i.isFunction=function(e){return"function"==i.typeOf(e)},i.isObject=function(e){return e=i.typeOf(e),"object"==e||"array"==e||"function"==e},i.getUid=function(e){return e[i.UID_PROPERTY_]||(e[i.UID_PROPERTY_]=++i.uidCounter_)},i.removeUid=function(e){"removeAttribute"in e&&e.removeAttribute(i.UID_PROPERTY_);try{delete e[i.UID_PROPERTY_]}catch(t){}},i.UID_PROPERTY_="closure_uid_"+Math.floor(2147483648*Math.random()).toString(36),i.uidCounter_=0,i.getHashCode=i.getUid,i.removeHashCode=i.removeUid,i.cloneObject=function(e){var t=i.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var n,t="array"==t?[]:{};for(n in e)t[n]=i.cloneObject(e[n]);return t}return e},i.bindNative_=function(e){return e.call.apply(e.bind,arguments)},i.bindJs_=function(e,t){var n=t||i.global;if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,o),e.apply(n,t)}}return function(){return e.apply(n,arguments)}},i.bind=function(){return i.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?i.bindNative_:i.bindJs_,i.bind.apply(null,arguments)},i.partial=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=Array.prototype.slice.call(arguments);return i.unshift.apply(i,t),e.apply(this,i)}},i.mixin=function(e,t){for(var i in t)e[i]=t[i]},i.now=Date.now||function(){return+new Date},i.globalEval=function(e){if(i.global.execScript)i.global.execScript(e,"JavaScript");else{if(!i.global.eval)throw Error("goog.globalEval not available");if(null==i.evalWorksForGlobals_&&(i.global.eval("var _et_ = 1;"),"undefined"!=typeof i.global._et_?(delete i.global._et_,i.evalWorksForGlobals_=!0):i.evalWorksForGlobals_=!1),i.evalWorksForGlobals_)i.global.eval(e);else{var t=i.global.document,n=t.createElement("script");n.type="text/javascript",n.defer=!1,n.appendChild(t.createTextNode(e)),t.body.appendChild(n),t.body.removeChild(n)}}},i.getCssName=function(e,t){var n,o=function(e){return i.cssNameMapping_[e]||e};return n=i.cssNameMapping_?"BY_WHOLE"==i.cssNameMappingStyle_?o:function(e){for(var e=e.split("-"),t=[],i=0;i<e.length;i++)t.push(o(e[i]));return t.join("-")}:function(e){return e},t?e+"-"+n(t):n(e)},i.setCssNameMapping=function(e,t){i.cssNameMapping_=e,i.cssNameMappingStyle_=t},i.getMsg=function(e,t){var i,n=t||{};for(i in n)var o=(""+n[i]).replace(/\$/g,"$$$$"),e=e.replace(RegExp("\\{\\$"+i+"\\}","gi"),o);return e},i.exportSymbol=function(e,t,n){i.exportPath_(e,t,n)},i.exportProperty=function(e,t,i){e[t]=i},i.inherits=function(e,t){function i(){}i.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new i,e.prototype.constructor=e},i.base=function(e,t){var i=arguments.callee.caller;if(i.superClass_)return i.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var n=Array.prototype.slice.call(arguments,2),o=!1,r=e.constructor;r;r=r.superClass_&&r.superClass_.constructor)if(r.prototype[t]===i)o=!0;else if(o)return r.prototype[t].apply(e,n);if(e[t]===i)return e.constructor.prototype[t].apply(e,n);throw Error("goog.base called from a method of one name to a method of a different name")},i.scope=function(e){e.call(i.global)},i.string={},i.string.Unicode={NBSP:""},i.string.startsWith=function(e,t){return 0==e.lastIndexOf(t,0)},i.string.endsWith=function(e,t){var i=e.length-t.length;return i>=0&&e.indexOf(t,i)==i},i.string.caseInsensitiveStartsWith=function(e,t){return 0==i.string.caseInsensitiveCompare(t,e.substr(0,t.length))},i.string.caseInsensitiveEndsWith=function(e,t){return 0==i.string.caseInsensitiveCompare(t,e.substr(e.length-t.length,t.length))},i.string.subs=function(e){for(var t=1;t<arguments.length;t++)var i=String(arguments[t]).replace(/\$/g,"$$$$"),e=e.replace(/\%s/,i);return e},i.string.collapseWhitespace=function(e){return e.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},i.string.isEmpty=function(e){return/^[\s\xa0]*$/.test(e)},i.string.isEmptySafe=function(e){return i.string.isEmpty(i.string.makeSafe(e))},i.string.isBreakingWhitespace=function(e){return!/[^\t\n\r ]/.test(e)},i.string.isAlpha=function(e){return!/[^a-zA-Z]/.test(e)},i.string.isNumeric=function(e){return!/[^0-9]/.test(e)},i.string.isAlphaNumeric=function(e){return!/[^a-zA-Z0-9]/.test(e)},i.string.isSpace=function(e){return" "==e},i.string.isUnicodeChar=function(e){return 1==e.length&&e>=" "&&"~">=e||e>=""&&"">=e},i.string.stripNewlines=function(e){return e.replace(/(\r\n|\r|\n)+/g," ")},i.string.canonicalizeNewlines=function(e){return e.replace(/(\r\n|\r|\n)/g,"\n")},i.string.normalizeWhitespace=function(e){return e.replace(/\xa0|\s/g," ")},i.string.normalizeSpaces=function(e){return e.replace(/\xa0|[ \t]+/g," ")},i.string.collapseBreakingSpaces=function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},i.string.trim=function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},i.string.trimLeft=function(e){return e.replace(/^[\s\xa0]+/,"")},i.string.trimRight=function(e){return e.replace(/[\s\xa0]+$/,"")},i.string.caseInsensitiveCompare=function(e,t){var i=String(e).toLowerCase(),n=String(t).toLowerCase();return n>i?-1:i==n?0:1},i.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,i.string.numerateCompare=function(e,t){if(e==t)return 0;if(!e)return-1;if(!t)return 1;for(var n=e.toLowerCase().match(i.string.numerateCompareRegExp_),o=t.toLowerCase().match(i.string.numerateCompareRegExp_),r=Math.min(n.length,o.length),a=0;r>a;a++){var s=n[a],l=o[a];if(s!=l)return n=parseInt(s,10),!isNaN(n)&&(o=parseInt(l,10),!isNaN(o)&&n-o)?n-o:l>s?-1:1}return n.length!=o.length?n.length-o.length:t>e?-1:1},i.string.encodeUriRegExp_=/^[a-zA-Z0-9\-_.!~*'()]*$/,i.string.urlEncode=function(e){return e=String(e),i.string.encodeUriRegExp_.test(e)?e:encodeURIComponent(e)},i.string.urlDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},i.string.newLineToBr=function(e,t){return e.replace(/(\r\n|\r|\n)/g,t?"<br />":"<br>")},i.string.htmlEscape=function(e,t){return t?e.replace(i.string.amperRe_,"&amp;").replace(i.string.ltRe_,"&lt;").replace(i.string.gtRe_,"&gt;").replace(i.string.quotRe_,"&quot;"):i.string.allRe_.test(e)?(-1!=e.indexOf("&")&&(e=e.replace(i.string.amperRe_,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(i.string.ltRe_,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(i.string.gtRe_,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(i.string.quotRe_,"&quot;")),e):e},i.string.amperRe_=/&/g,i.string.ltRe_=/</g,i.string.gtRe_=/>/g,i.string.quotRe_=/\"/g,i.string.allRe_=/[&<>\"]/,i.string.unescapeEntities=function(e){return i.string.contains(e,"&")?"document"in i.global?i.string.unescapeEntitiesUsingDom_(e):i.string.unescapePureXmlEntities_(e):e},i.string.unescapeEntitiesUsingDom_=function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},n=i.global.document.createElement("div");
return e.replace(i.string.HTML_ENTITY_PATTERN_,function(e,i){var o=t[e];if(o)return o;if("#"==i.charAt(0)){var r=Number("0"+i.substr(1));isNaN(r)||(o=String.fromCharCode(r))}return o||(n.innerHTML=e,o=n.firstChild.nodeValue),t[e]=o})},i.string.unescapePureXmlEntities_=function(e){return e.replace(/&([^;]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==t.charAt(0)){var i=Number("0"+t.substr(1));if(!isNaN(i))return String.fromCharCode(i)}return e}})},i.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,i.string.whitespaceEscape=function(e,t){return i.string.newLineToBr(e.replace(/  /g," &#160;"),t)},i.string.stripQuotes=function(e,t){for(var i=t.length,n=0;i>n;n++){var o=1==i?t:t.charAt(n);if(e.charAt(0)==o&&e.charAt(e.length-1)==o)return e.substring(1,e.length-1)}return e},i.string.truncate=function(e,t,n){return n&&(e=i.string.unescapeEntities(e)),e.length>t&&(e=e.substring(0,t-3)+"..."),n&&(e=i.string.htmlEscape(e)),e},i.string.truncateMiddle=function(e,t,n,o){if(n&&(e=i.string.unescapeEntities(e)),o&&e.length>t){o>t&&(o=t);var r=e.length-o,e=e.substring(0,t-o)+"..."+e.substring(r)}else e.length>t&&(o=Math.floor(t/2),r=e.length-o,o+=t%2,e=e.substring(0,o)+"..."+e.substring(r));return n&&(e=i.string.htmlEscape(e)),e},i.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},i.string.jsEscapeCache_={"'":"\\'"},i.string.quote=function(e){if(e=String(e),e.quote)return e.quote();for(var t=['"'],n=0;n<e.length;n++){var o=e.charAt(n),r=o.charCodeAt(0);t[n+1]=i.string.specialEscapeChars_[o]||(r>31&&127>r?o:i.string.escapeChar(o))}return t.push('"'),t.join("")},i.string.escapeString=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=i.string.escapeChar(e.charAt(n));return t.join("")},i.string.escapeChar=function(e){if(e in i.string.jsEscapeCache_)return i.string.jsEscapeCache_[e];if(e in i.string.specialEscapeChars_)return i.string.jsEscapeCache_[e]=i.string.specialEscapeChars_[e];var t=e,n=e.charCodeAt(0);return n>31&&127>n?t=e:(256>n?(t="\\x",(16>n||n>256)&&(t+="0")):(t="\\u",4096>n&&(t+="0")),t+=n.toString(16).toUpperCase()),i.string.jsEscapeCache_[e]=t},i.string.toMap=function(e){for(var t={},i=0;i<e.length;i++)t[e.charAt(i)]=!0;return t},i.string.contains=function(e,t){return-1!=e.indexOf(t)},i.string.removeAt=function(e,t,i){var n=e;return t>=0&&t<e.length&&i>0&&(n=e.substr(0,t)+e.substr(t+i,e.length-t-i)),n},i.string.remove=function(e,t){var n=RegExp(i.string.regExpEscape(t),"");return e.replace(n,"")},i.string.removeAll=function(e,t){var n=RegExp(i.string.regExpEscape(t),"g");return e.replace(n,"")},i.string.regExpEscape=function(e){return String(e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},i.string.repeat=function(e,t){return Array(t+1).join(e)},i.string.padNumber=function(e,t,n){return e=i.isDef(n)?e.toFixed(n):String(e),n=e.indexOf("."),-1==n&&(n=e.length),i.string.repeat("0",Math.max(0,t-n))+e},i.string.makeSafe=function(e){return null==e?"":String(e)},i.string.buildString=function(){return Array.prototype.join.call(arguments,"")},i.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^i.now()).toString(36)},i.string.compareVersions=function(e,t){for(var n=0,o=i.string.trim(String(e)).split("."),r=i.string.trim(String(t)).split("."),a=Math.max(o.length,r.length),s=0;0==n&&a>s;s++){var l=o[s]||"",c=r[s]||"",u=RegExp("(\\d*)(\\D*)","g"),d=RegExp("(\\d*)(\\D*)","g");do{var h=u.exec(l)||["","",""],g=d.exec(c)||["","",""];if(0==h[0].length&&0==g[0].length)break;var n=0==h[1].length?0:parseInt(h[1],10),p=0==g[1].length?0:parseInt(g[1],10),n=i.string.compareElements_(n,p)||i.string.compareElements_(0==h[2].length,0==g[2].length)||i.string.compareElements_(h[2],g[2])}while(0==n)}return n},i.string.compareElements_=function(e,t){return t>e?-1:e>t?1:0},i.string.HASHCODE_MAX_=4294967296,i.string.hashCode=function(e){for(var t=0,n=0;n<e.length;++n)t=31*t+e.charCodeAt(n),t%=i.string.HASHCODE_MAX_;return t},i.string.uniqueStringCounter_=2147483648*Math.random()|0,i.string.createUniqueString=function(){return"goog_"+i.string.uniqueStringCounter_++},i.string.toNumber=function(e){var t=Number(e);return 0==t&&i.string.isEmpty(e)?0/0:t},i.string.toCamelCaseCache_={},i.string.toCamelCase=function(e){return i.string.toCamelCaseCache_[e]||(i.string.toCamelCaseCache_[e]=String(e).replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()}))},i.string.toSelectorCaseCache_={},i.string.toSelectorCase=function(e){return i.string.toSelectorCaseCache_[e]||(i.string.toSelectorCaseCache_[e]=String(e).replace(/([A-Z])/g,"-$1").toLowerCase())},i.format={},i.format.EmailAddress=function(e,t){this.name_=t||"",this.address_=e||""},i.format.EmailAddress.OPENERS_='"<([',i.format.EmailAddress.CLOSERS_='">)]',i.format.EmailAddress.SPECIAL_CHARS_RE_=/[()<>@,;:\\\".\[\]]/,i.format.EmailAddress.ALL_DOUBLE_QUOTES_=/\"/g,i.format.EmailAddress.ESCAPED_DOUBLE_QUOTES_=/\\\"/g,i.format.EmailAddress.ALL_BACKSLASHES_=/\\/g,i.format.EmailAddress.ESCAPED_BACKSLASHES_=/\\\\/g,i.format.EmailAddress.prototype.getName=function(){return this.name_},i.format.EmailAddress.prototype.getAddress=function(){return this.address_},i.format.EmailAddress.prototype.setName=function(e){this.name_=e},i.format.EmailAddress.prototype.setAddress=function(e){this.address_=e},i.format.EmailAddress.prototype.toString=function(){var e=this.getName(),e=e.replace(i.format.EmailAddress.ALL_DOUBLE_QUOTES_,"");return i.format.EmailAddress.SPECIAL_CHARS_RE_.test(e)&&(e='"'+e.replace(i.format.EmailAddress.ALL_BACKSLASHES_,"\\\\")+'"'),""==e?this.address_:""==this.address_?e:e+" <"+this.address_+">"},i.format.EmailAddress.prototype.isValid=function(){return i.format.EmailAddress.isValidAddrSpec(this.address_)},i.format.EmailAddress.isValidAddress=function(e){return i.format.EmailAddress.parse(e).isValid()},i.format.EmailAddress.isValidAddrSpec=function(e){return/^[+a-zA-Z0-9_.-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,6}$/.test(e)},i.format.EmailAddress.parse=function(e){for(var t="",n="",o=0;o<e.length;){var r=i.format.EmailAddress.getToken_(e,o);"<"==r.charAt(0)&&-1!=r.indexOf(">")?(n=r.indexOf(">"),n=r.substring(1,n)):""==n&&(t+=r),o+=r.length}return""==n&&-1!=t.indexOf("@")&&(n=t,t=""),t=i.string.collapseWhitespace(t),t=i.string.stripQuotes(t,"'"),t=i.string.stripQuotes(t,'"'),t=t.replace(i.format.EmailAddress.ESCAPED_DOUBLE_QUOTES_,'"'),t=t.replace(i.format.EmailAddress.ESCAPED_BACKSLASHES_,"\\"),n=i.string.collapseWhitespace(n),new i.format.EmailAddress(n,t)},i.format.EmailAddress.parseList=function(e){for(var t,n=[],o="",r=0;r<e.length;)t=i.format.EmailAddress.getToken_(e,r),","==t||";"==t?(i.string.isEmpty(o)||n.push(i.format.EmailAddress.parse(o)),o="",r++):(o+=t,r+=t.length);return i.string.isEmpty(o)||n.push(i.format.EmailAddress.parse(o)),n},i.format.EmailAddress.getToken_=function(e,t){var n=e.charAt(t),o=i.format.EmailAddress.OPENERS_.indexOf(n);if(-1==o)return n;if(i.format.EmailAddress.isEscapedDlQuote_(e,t))return n;for(var o=i.format.EmailAddress.CLOSERS_.charAt(o),r=e.indexOf(o,t+1);r>=0&&i.format.EmailAddress.isEscapedDlQuote_(e,r);)r=e.indexOf(o,r+1);return r>=0?e.substring(t,r+1):n},i.format.EmailAddress.isEscapedDlQuote_=function(e,t){if('"'!=e.charAt(t))return!1;for(var i=0,n=t-1;n>=0&&"\\"==e.charAt(n);n--)i++;return i%2!=0},i}),define("lib/abtest",["log","lib/metrics","jstorage"],function(e,t){e.module("lib/abtest");var i=function(e,i){var n=$.jStorage.get("ab_"+e);if(n)return n;var o=[];$.each(i,function(e,t){if($.isArray(i))o[o.length]=this.toString();else if("object"==typeof i)for(var n=0;t>n;n++)o[o.length]=e});var r=Math.floor(Math.random()*o.length),a=o[r];$.jStorage.set("ab_"+e,a);var s={};return s[e]=a,t.log("A/B Test",s),a};return i}),function(e){function t(){e.fn.ajaxSubmit.debug&&window.console&&window.console.log&&window.console.log("[jquery.form] "+Array.prototype.join.call(arguments,""))}e.fn.ajaxSubmit=function(i){function n(){function n(){if(!p++){d.detachEvent?d.detachEvent("onload",n):d.removeEventListener("load",n,!1);var i=!0;try{if(m)throw"timeout";var r,s;s=d.contentWindow?d.contentWindow.document:d.contentDocument?d.contentDocument:d.document;var l="xml"==a.dataType||s.XMLDocument||e.isXMLDoc(s);if(t("isXml="+l),!l&&(null==s.body||""==s.body.innerHTML))return--v?(p=0,void setTimeout(n,100)):void t("Could not access iframe DOM after 50 tries.");if(h.responseText=s.body?s.body.innerHTML:null,h.responseXML=s.XMLDocument?s.XMLDocument:s,h.getResponseHeader=function(e){var t={"content-type":a.dataType};return t[e]},"json"==a.dataType||"script"==a.dataType){var u=s.getElementsByTagName("textarea")[0];if(u)h.responseText=u.value;else{var f=s.getElementsByTagName("pre")[0];f&&(h.responseText=f.innerHTML)}}else"xml"!=a.dataType||h.responseXML||null==h.responseText||(h.responseXML=o(h.responseText));r=e.httpData(h,a.dataType)}catch(b){i=!1,e.handleError(a,h,"error",b)}i&&(a.success(r,"success"),g&&e.event.trigger("ajaxSuccess",[h,a])),g&&e.event.trigger("ajaxComplete",[h,a]),g&&!--e.active&&e.event.trigger("ajaxStop"),a.complete&&a.complete(h,i?"success":"error"),setTimeout(function(){c.remove(),h.responseXML=null},100)}}function o(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.tagName?t:null}var r=u[0];if(e(":input[name=submit]",r).length)return void alert('Error: Form elements must not be named "submit".');var a=e.extend({},e.ajaxSettings,i),s=e.extend(!0,{},e.extend(!0,{},e.ajaxSettings),a),l="jqFormIO"+(new Date).getTime(),c=e('<iframe id="'+l+'" name="'+l+'" src="'+a.iframeSrc+'" />'),d=c[0];c.css({position:"absolute",top:"-1000px",left:"-1000px"});var h={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1,c.attr("src",a.iframeSrc)}},g=a.global;if(g&&!e.active++&&e.event.trigger("ajaxStart"),g&&e.event.trigger("ajaxSend",[h,a]),s.beforeSend&&s.beforeSend(h,s)===!1)return void(s.global&&e.active--);if(!h.aborted){var p=0,m=0,f=r.clk;if(f){var b=f.name;b&&!f.disabled&&(i.extraData=i.extraData||{},i.extraData[b]=f.value,"image"==f.type&&(i.extraData[name+".x"]=r.clk_x,i.extraData[name+".y"]=r.clk_y))}setTimeout(function(){var t=u.attr("target"),o=u.attr("action");r.setAttribute("target",l),"POST"!=r.getAttribute("method")&&r.setAttribute("method","POST"),r.getAttribute("action")!=a.url&&r.setAttribute("action",a.url),i.skipEncodingOverride||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),a.timeout&&setTimeout(function(){m=!0,n()},a.timeout);var s=[];try{if(i.extraData)for(var h in i.extraData)s.push(e('<input type="hidden" name="'+h+'" value="'+i.extraData[h]+'" />').appendTo(r)[0]);c.appendTo("body"),d.attachEvent?d.attachEvent("onload",n):d.addEventListener("load",n,!1),r.submit()}finally{r.setAttribute("action",o),t?r.setAttribute("target",t):u.removeAttr("target"),e(s).remove()}},10);var v=50}}if(!this.length)return t("ajaxSubmit: skipping submit process - no element selected"),this;"function"==typeof i&&(i={success:i});var o=e.trim(this.attr("action"));o&&(o=(o.match(/^([^#]+)/)||[])[1]),o=o||window.location.href||"",i=e.extend({url:o,type:this.attr("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},i||{});var r={};if(this.trigger("form-pre-serialize",[this,i,r]),r.veto)return t("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(i.beforeSerialize&&i.beforeSerialize(this,i)===!1)return t("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var a=this.formToArray(i.semantic);if(i.data){i.extraData=i.data;for(var s in i.data)if(i.data[s]instanceof Array)for(var l in i.data[s])a.push({name:s,value:i.data[s][l]});else a.push({name:s,value:i.data[s]})}if(i.beforeSubmit&&i.beforeSubmit(a,this,i)===!1)return t("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[a,this,i,r]),r.veto)return t("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var c=e.param(a);"GET"==i.type.toUpperCase()?(i.url+=(i.url.indexOf("?")>=0?"&":"?")+c,i.data=null):i.data=c;var u=this,d=[];if(i.resetForm&&d.push(function(){u.resetForm()}),i.clearForm&&d.push(function(){u.clearForm()}),!i.dataType&&i.target){var h=i.success||function(){};d.push(function(t){e(i.target).html(t).each(h,arguments)})}else i.success&&d.push(i.success);i.success=function(e,t){for(var n=0,o=d.length;o>n;n++)d[n].apply(i,[e,t,u])};for(var g=e("input:file",this).fieldValue(),p=!1,m=0;m<g.length;m++)g[m]&&(p=!0);var f=!1;return g.length&&i.iframe!==!1||i.iframe||p||f?i.closeKeepAlive?e.get(i.closeKeepAlive,n):n():e.ajax(i),this.trigger("form-submit-notify",[this,i]),this},e.fn.ajaxForm=function(t){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){return e(this).ajaxSubmit(t),!1}).bind("click.form-plugin",function(t){var i=t.target,n=e(i);if(!n.is(":submit,input:image")){var o=n.closest(":submit");if(0==o.length)return;i=o[0]}var r=this;if(r.clk=i,"image"==i.type)if(void 0!=t.offsetX)r.clk_x=t.offsetX,r.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var a=n.offset();r.clk_x=t.pageX-a.left,r.clk_y=t.pageY-a.top}else r.clk_x=t.pageX-i.offsetLeft,r.clk_y=t.pageY-i.offsetTop;setTimeout(function(){r.clk=r.clk_x=r.clk_y=null},100)})},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t){var i=[];if(0==this.length)return i;var n=this[0],o=t?n.getElementsByTagName("*"):n.elements;if(!o)return i;for(var r=0,a=o.length;a>r;r++){var s=o[r],l=s.name;if(l)if(t&&n.clk&&"image"==s.type)s.disabled||n.clk!=s||(i.push({name:l,value:e(s).val()}),i.push({name:l+".x",value:n.clk_x},{name:l+".y",value:n.clk_y}));else{var c=e.fieldValue(s,!0);if(c&&c.constructor==Array)for(var u=0,d=c.length;d>u;u++)i.push({name:l,value:c[u]});else null!==c&&"undefined"!=typeof c&&i.push({name:l,value:c})}}if(!t&&n.clk){var h=e(n.clk),g=h[0],l=g.name;l&&!g.disabled&&"image"==g.type&&(i.push({name:l,value:h.val()}),i.push({name:l+".x",value:n.clk_x},{name:l+".y",value:n.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var n=this.name;if(n){var o=e.fieldValue(this,t);if(o&&o.constructor==Array)for(var r=0,a=o.length;a>r;r++)i.push({name:n,value:o[r]});else null!==o&&"undefined"!=typeof o&&i.push({name:this.name,value:o})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],n=0,o=this.length;o>n;n++){var r=this[n],a=e.fieldValue(r,t);null===a||"undefined"==typeof a||a.constructor==Array&&!a.length||(a.constructor==Array?e.merge(i,a):i.push(a))}return i},e.fieldValue=function(e,t){var i=e.name,n=e.type,o=e.tagName.toLowerCase();if("undefined"==typeof t&&(t=!0),t&&(!i||e.disabled||"reset"==n||"button"==n||("checkbox"==n||"radio"==n)&&!e.checked||("submit"==n||"image"==n)&&e.form&&e.form.clk!=e||"select"==o&&-1==e.selectedIndex))return null;if("select"==o){var r=e.selectedIndex;if(0>r)return null;for(var a=[],s=e.options,l="select-one"==n,c=l?r+1:s.length,u=l?r:0;c>u;u++){var d=s[u];if(d.selected){var h=d.value;if(h||(h=d.attributes&&d.attributes.value&&!d.attributes.value.specified?d.text:d.value),l)return h;a.push(h)}}return a}return e.value},e.fn.clearForm=function(){return this.each(function(){e("input,select,textarea",this).clearFields()})},e.fn.clearFields=e.fn.clearInputs=function(){return this.each(function(){var e=this.type,t=this.tagName.toLowerCase();"text"==e||"password"==e||"textarea"==t?this.value="":"checkbox"==e||"radio"==e?this.checked=!1:"select"==t&&(this.selectedIndex=-1)})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0==e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0==t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var n=e(this).parent("select");t&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=t}})}}(jQuery),define("form",function(){}),/**
 * @license
 * jQuery Validation Plugin - v1.11.1 - 3/22/2013
 * https://github.com/jzaefferer/jquery-validation
 * Copyright (c) 2013 Jrn Zaefferer; Licensed MIT
 */
function(e){e.extend(e.fn,{validate:function(t){if(!this.length)return void(t&&t.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."));var i=e.data(this[0],"validator");return i?i:(this.attr("novalidate","novalidate"),i=new e.validator(t,this[0]),e.data(this[0],"validator",i),i.settings.onsubmit&&(this.validateDelegate(":submit","click",function(t){i.settings.submitHandler&&(i.submitButton=t.target),e(t.target).hasClass("cancel")&&(i.cancelSubmit=!0),void 0!==e(t.target).attr("formnovalidate")&&(i.cancelSubmit=!0)}),this.submit(function(t){function n(){var n;return i.settings.submitHandler?(i.submitButton&&(n=e("<input type='hidden'/>").attr("name",i.submitButton.name).val(e(i.submitButton).val()).appendTo(i.currentForm)),i.settings.submitHandler.call(i,i.currentForm,t),i.submitButton&&n.remove(),!1):!0}return i.settings.debug&&t.preventDefault(),i.cancelSubmit?(i.cancelSubmit=!1,n()):i.form()?i.pendingRequest?(i.formSubmitted=!0,!1):n():(i.focusInvalid(),!1)})),i)},valid:function(){if(e(this[0]).is("form"))return this.validate().form();var t=!0,i=e(this[0].form).validate();return this.each(function(){t=t&&i.element(this)}),t},removeAttrs:function(t){var i={},n=this;return e.each(t.split(/\s/),function(e,t){i[t]=n.attr(t),n.removeAttr(t)}),i},rules:function(t,i){var n=this[0];if(t){var o=e.data(n.form,"validator").settings,r=o.rules,a=e.validator.staticRules(n);switch(t){case"add":e.extend(a,e.validator.normalizeRule(i)),delete a.messages,r[n.name]=a,i.messages&&(o.messages[n.name]=e.extend(o.messages[n.name],i.messages));break;case"remove":if(!i)return delete r[n.name],a;var s={};return e.each(i.split(/\s/),function(e,t){s[t]=a[t],delete a[t]}),s}}var l=e.validator.normalizeRules(e.extend({},e.validator.classRules(n),e.validator.attributeRules(n),e.validator.dataRules(n),e.validator.staticRules(n)),n);if(l.required){var c=l.required;delete l.required,l=e.extend({required:c},l)}return l}}),e.extend(e.expr[":"],{blank:function(t){return!e.trim(""+e(t).val())},filled:function(t){return!!e.trim(""+e(t).val())},unchecked:function(t){return!e(t).prop("checked")}}),e.validator=function(t,i){this.settings=e.extend(!0,{},e.validator.defaults,t),this.currentForm=i,this.init()},e.validator.format=function(t,i){return 1===arguments.length?function(){var i=e.makeArray(arguments);return i.unshift(t),e.validator.format.apply(this,i)}:(arguments.length>2&&i.constructor!==Array&&(i=e.makeArray(arguments).slice(1)),i.constructor!==Array&&(i=[i]),e.each(i,function(e,i){t=t.replace(RegExp("\\{"+e+"\\}","g"),function(){return i})}),t)},e.extend(e.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:e([]),errorLabelContainer:e([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(e){this.lastActive=e,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,e,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(e)).hide())},onfocusout:function(e){this.checkable(e)||!(e.name in this.submitted)&&this.optional(e)||this.element(e)},onkeyup:function(e,t){(9!==t.which||""!==this.elementValue(e))&&(e.name in this.submitted||e===this.lastElement)&&this.element(e)},onclick:function(e){e.name in this.submitted?this.element(e):e.parentNode.name in this.submitted&&this.element(e.parentNode)},highlight:function(t,i,n){"radio"===t.type?this.findByName(t.name).addClass(i).removeClass(n):e(t).addClass(i).removeClass(n)},unhighlight:function(t,i,n){"radio"===t.type?this.findByName(t.name).removeClass(i).addClass(n):e(t).removeClass(i).addClass(n)}},setDefaults:function(t){e.extend(e.validator.defaults,t)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:e.validator.format("Please enter no more than {0} characters."),minlength:e.validator.format("Please enter at least {0} characters."),rangelength:e.validator.format("Please enter a value between {0} and {1} characters long."),range:e.validator.format("Please enter a value between {0} and {1}."),max:e.validator.format("Please enter a value less than or equal to {0}."),min:e.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function t(t){var i=e.data(this[0].form,"validator"),n="on"+t.type.replace(/^validate/,"");i.settings[n]&&i.settings[n].call(i,this[0],t)}this.labelContainer=e(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||e(this.currentForm),this.containers=e(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var i=this.groups={};e.each(this.settings.groups,function(t,n){"string"==typeof n&&(n=n.split(/\s/)),e.each(n,function(e,n){i[n]=t})});var n=this.settings.rules;e.each(n,function(t,i){n[t]=e.validator.normalizeRule(i)}),e(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",t).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",t),this.settings.invalidHandler&&e(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),e.extend(this.submitted,this.errorMap),this.invalid=e.extend({},this.errorMap),this.valid()||e(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var e=0,t=this.currentElements=this.elements();t[e];e++)this.check(t[e]);return this.valid()},element:function(t){t=this.validationTargetFor(this.clean(t)),this.lastElement=t,this.prepareElement(t),this.currentElements=e(t);var i=this.check(t)!==!1;return i?delete this.invalid[t.name]:this.invalid[t.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),i},showErrors:function(t){if(t){e.extend(this.errorMap,t),this.errorList=[];for(var i in t)this.errorList.push({message:t[i],element:this.findByName(i)[0]});this.successList=e.grep(this.successList,function(e){return!(e.name in t)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){e.fn.resetForm&&e(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var t=0;for(var i in e)t++;return t},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{e(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(t){}},findLastActive:function(){var t=this.lastActive;return t&&1===e.grep(this.errorList,function(e){return e.element.name===t.name}).length&&t},elements:function(){var t=this,i={};return e(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&t.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in i||!t.objectLength(e(this).rules())?!1:(i[this.name]=!0,!0)})},clean:function(t){return e(t)[0]},errors:function(){var t=this.settings.errorClass.replace(" ",".");return e(this.settings.errorElement+"."+t,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=e([]),this.toHide=e([]),this.currentElements=e([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(e){this.reset(),this.toHide=this.errorsFor(e)},elementValue:function(t){var i=e(t).attr("type"),n=e(t).val();return"radio"===i||"checkbox"===i?e("input[name='"+e(t).attr("name")+"']:checked").val():"string"==typeof n?n.replace(/\r/g,""):n},check:function(t){t=this.validationTargetFor(this.clean(t));var i,n=e(t).rules(),o=!1,r=this.elementValue(t);for(var a in n){var s={method:a,parameters:n[a]};try{if(i=e.validator.methods[a].call(this,r,t,s.parameters),"dependency-mismatch"===i){o=!0;continue}if(o=!1,"pending"===i)return void(this.toHide=this.toHide.not(this.errorsFor(t)));if(!i)return this.formatAndAdd(t,s),!1}catch(l){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+t.id+", check the '"+s.method+"' method.",l),l}}return o?void 0:(this.objectLength(n)&&this.successList.push(t),!0)},customDataMessage:function(t,i){return e(t).data("msg-"+i.toLowerCase())||t.attributes&&e(t).attr("data-msg-"+i.toLowerCase())},customMessage:function(e,t){var i=this.settings.messages[e];return i&&(i.constructor===String?i:i[t])},findDefined:function(){for(var e=0;arguments.length>e;e++)if(void 0!==arguments[e])return arguments[e];return void 0},defaultMessage:function(t,i){return this.findDefined(this.customMessage(t.name,i),this.customDataMessage(t,i),!this.settings.ignoreTitle&&t.title||void 0,e.validator.messages[i],"<strong>Warning: No message defined for "+t.name+"</strong>")},formatAndAdd:function(t,i){var n=this.defaultMessage(t,i.method),o=/\$?\{(\d+)\}/g;"function"==typeof n?n=n.call(this,i.parameters,t):o.test(n)&&(n=e.validator.format(n.replace(o,"{$1}"),i.parameters)),this.errorList.push({message:n,element:t}),this.errorMap[t.name]=n,this.submitted[t.name]=n},addWrapper:function(e){return this.settings.wrapper&&(e=e.add(e.parent(this.settings.wrapper))),e},defaultShowErrors:function(){var e,t;for(e=0;this.errorList[e];e++){var i=this.errorList[e];this.settings.highlight&&this.settings.highlight.call(this,i.element,this.settings.errorClass,this.settings.validClass),this.showLabel(i.element,i.message)}if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(e=0;this.successList[e];e++)this.showLabel(this.successList[e]);if(this.settings.unhighlight)for(e=0,t=this.validElements();t[e];e++)this.settings.unhighlight.call(this,t[e],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return e(this.errorList).map(function(){return this.element})},showLabel:function(t,i){var n=this.errorsFor(t);n.length?(n.removeClass(this.settings.validClass).addClass(this.settings.errorClass),n.html(i)):(n=e("<"+this.settings.errorElement+">").attr("for",this.idOrName(t)).addClass(this.settings.errorClass).html(i||""),this.settings.wrapper&&(n=n.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(n).length||(this.settings.errorPlacement?this.settings.errorPlacement(n,e(t)):n.insertAfter(t))),!i&&this.settings.success&&(n.text(""),"string"==typeof this.settings.success?n.addClass(this.settings.success):this.settings.success(n,t)),this.toShow=this.toShow.add(n)},errorsFor:function(t){var i=this.idOrName(t);return this.errors().filter(function(){return e(this).attr("for")===i})},idOrName:function(e){return this.groups[e.name]||(this.checkable(e)?e.name:e.id||e.name)},validationTargetFor:function(e){return this.checkable(e)&&(e=this.findByName(e.name).not(this.settings.ignore)[0]),e},checkable:function(e){return/radio|checkbox/i.test(e.type)},findByName:function(t){return e(this.currentForm).find("[name='"+t+"']")},getLength:function(t,i){switch(i.nodeName.toLowerCase()){case"select":return e("option:selected",i).length;case"input":if(this.checkable(i))return this.findByName(i.name).filter(":checked").length}return t.length},depend:function(e,t){return this.dependTypes[typeof e]?this.dependTypes[typeof e](e,t):!0},dependTypes:{"boolean":function(e){return e},string:function(t,i){return!!e(t,i.form).length},"function":function(e,t){return e(t)}},optional:function(t){var i=this.elementValue(t);return!e.validator.methods.required.call(this,i,t)&&"dependency-mismatch"},startRequest:function(e){this.pending[e.name]||(this.pendingRequest++,this.pending[e.name]=!0)},stopRequest:function(t,i){this.pendingRequest--,0>this.pendingRequest&&(this.pendingRequest=0),delete this.pending[t.name],i&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(e(this.currentForm).submit(),this.formSubmitted=!1):!i&&0===this.pendingRequest&&this.formSubmitted&&(e(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(t){return e.data(t,"previousValue")||e.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(t,i){t.constructor===String?this.classRuleSettings[t]=i:e.extend(this.classRuleSettings,t)},classRules:function(t){var i={},n=e(t).attr("class");return n&&e.each(n.split(" "),function(){this in e.validator.classRuleSettings&&e.extend(i,e.validator.classRuleSettings[this])}),i},attributeRules:function(t){var i={},n=e(t),o=n[0].getAttribute("type");for(var r in e.validator.methods){var a;"required"===r?(a=n.get(0).getAttribute(r),""===a&&(a=!0),a=!!a):a=n.attr(r),/min|max/.test(r)&&(null===o||/number|range|text/.test(o))&&(a=Number(a)),a?i[r]=a:o===r&&"range"!==o&&(i[r]=!0)}return i.maxlength&&/-1|2147483647|524288/.test(i.maxlength)&&delete i.maxlength,i},dataRules:function(t){var i,n,o={},r=e(t);for(i in e.validator.methods)n=r.data("rule-"+i.toLowerCase()),void 0!==n&&(o[i]=n);return o},staticRules:function(t){var i={},n=e.data(t.form,"validator");return n.settings.rules&&(i=e.validator.normalizeRule(n.settings.rules[t.name])||{}),i},normalizeRules:function(t,i){return e.each(t,function(n,o){if(o===!1)return void delete t[n];if(o.param||o.depends){var r=!0;switch(typeof o.depends){case"string":r=!!e(o.depends,i.form).length;break;case"function":r=o.depends.call(i,i)}r?t[n]=void 0!==o.param?o.param:!0:delete t[n]}}),e.each(t,function(n,o){t[n]=e.isFunction(o)?o(i):o}),e.each(["minlength","maxlength"],function(){t[this]&&(t[this]=Number(t[this]))}),e.each(["rangelength","range"],function(){var i;t[this]&&(e.isArray(t[this])?t[this]=[Number(t[this][0]),Number(t[this][1])]:"string"==typeof t[this]&&(i=t[this].split(/[\s,]+/),t[this]=[Number(i[0]),Number(i[1])]))}),e.validator.autoCreateRanges&&(t.min&&t.max&&(t.range=[t.min,t.max],delete t.min,delete t.max),t.minlength&&t.maxlength&&(t.rangelength=[t.minlength,t.maxlength],delete t.minlength,delete t.maxlength)),t},normalizeRule:function(t){if("string"==typeof t){var i={};e.each(t.split(/\s/),function(){i[this]=!0}),t=i}return t},addMethod:function(t,i,n){e.validator.methods[t]=i,e.validator.messages[t]=void 0!==n?n:e.validator.messages[t],3>i.length&&e.validator.addClassRules(t,e.validator.normalizeRule(t))},methods:{required:function(t,i,n){if(!this.depend(n,i))return"dependency-mismatch";if("select"===i.nodeName.toLowerCase()){var o=e(i).val();return o&&o.length>0}return this.checkable(i)?this.getLength(t,i)>0:e.trim(t).length>0},email:function(e,t){return this.optional(t)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},url:function(e,t){return this.optional(t)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},date:function(e,t){return this.optional(t)||!/Invalid|NaN/.test(""+new Date(e))},dateISO:function(e,t){return this.optional(t)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(e)},number:function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},digits:function(e,t){return this.optional(t)||/^\d+$/.test(e)},creditcard:function(e,t){if(this.optional(t))return"dependency-mismatch";if(/[^0-9 \-]+/.test(e))return!1;var i=0,n=0,o=!1;e=e.replace(/\D/g,"");for(var r=e.length-1;r>=0;r--){var a=e.charAt(r);n=parseInt(a,10),o&&(n*=2)>9&&(n-=9),i+=n,o=!o}return 0===i%10},minlength:function(t,i,n){var o=e.isArray(t)?t.length:this.getLength(e.trim(t),i);return this.optional(i)||o>=n},maxlength:function(t,i,n){var o=e.isArray(t)?t.length:this.getLength(e.trim(t),i);return this.optional(i)||n>=o},rangelength:function(t,i,n){var o=e.isArray(t)?t.length:this.getLength(e.trim(t),i);return this.optional(i)||o>=n[0]&&n[1]>=o},min:function(e,t,i){return this.optional(t)||e>=i},max:function(e,t,i){return this.optional(t)||i>=e},range:function(e,t,i){return this.optional(t)||e>=i[0]&&i[1]>=e},equalTo:function(t,i,n){var o=e(n);return this.settings.onfocusout&&o.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){e(i).valid()}),t===o.val()},remote:function(t,i,n){if(this.optional(i))return"dependency-mismatch";var o=this.previousValue(i);if(this.settings.messages[i.name]||(this.settings.messages[i.name]={}),o.originalMessage=this.settings.messages[i.name].remote,this.settings.messages[i.name].remote=o.message,n="string"==typeof n&&{url:n}||n,o.old===t)return o.valid;o.old=t;var r=this;this.startRequest(i);var a={};return a[i.name]=t,e.ajax(e.extend(!0,{url:n,mode:"abort",port:"validate"+i.name,dataType:"json",data:a,success:function(n){r.settings.messages[i.name].remote=o.originalMessage;var a=n===!0||"true"===n;if(a){var s=r.formSubmitted;r.prepareElement(i),r.formSubmitted=s,r.successList.push(i),delete r.invalid[i.name],r.showErrors()}else{var l={},c=n||r.defaultMessage(i,"remote");l[i.name]=o.message=e.isFunction(c)?c(t):c,r.invalid[i.name]=!0,r.showErrors(l)}o.valid=a,r.stopRequest(i,a)}},n)),"pending"}}}),e.format=e.validator.format}(jQuery),function(e){var t={};if(e.ajaxPrefilter)e.ajaxPrefilter(function(e,i,n){var o=e.port;"abort"===e.mode&&(t[o]&&t[o].abort(),t[o]=n)});else{var i=e.ajax;e.ajax=function(n){var o=("mode"in n?n:e.ajaxSettings).mode,r=("port"in n?n:e.ajaxSettings).port;return"abort"===o?(t[r]&&t[r].abort(),t[r]=i.apply(this,arguments),t[r]):i.apply(this,arguments)}}}(jQuery),function(e){e.extend(e.fn,{validateDelegate:function(t,i,n){return this.bind(i,function(i){var o=e(i.target);return o.is(t)?n.apply(o,arguments):void 0})}})}(jQuery),define("validate",function(){}),define("controller/signupform",["require","globals","log","viewport","viewer","lib/utils","lib/goog","lib/dialog","lib/metrics","lib/event","controller/deferred","lib/abtest","lib/ajax","log","class/menu","form","validate","cookie"],function(e){var t=e("globals"),i=e("log"),n=e("viewport"),o=e("viewer"),r=e("lib/utils"),a=e("lib/goog"),s=e("lib/dialog"),l=e("lib/metrics"),c=e("lib/event"),u=e("controller/deferred"),d=(e("lib/abtest"),e("lib/ajax")),i=e("log");e("class/menu"),e("form"),e("validate"),e("cookie"),i.module("controller/signupform");var h=i.create("signup","background-color:#45A4CE;color:white"),g={init:function(){return o.logged_in?void $.cookie("show_signup",!1,{expires:365,path:"/"}):(g.modal.init(),g.createBubble(),g.activateForms(),$(".topnav .signup .button").on("click",function(e){e.preventDefault();var i={location:"main_nav_button_"+t.PAGE+"_page"};c.trigger("signup_modal",[i])}),void(t.ENVIRONMENT.match(/(development|test)/)&&e(["controller/quickregister"])))},activateForms:function(){g.setupValidators(),g.setupSignupForm(),$(".signupbutton").on("click",g.social.popup),$(".signupbutton,.signup-submitbutton").on("click",g.track.set),$(".signup").find("form").on("submit",g.track.set)},modal:{inited:!1,init:function(){g.modal.inited||(h("Signup.modal.init"),g.modal.html=g.modal.html||$(".signup-modal").remove().html(),c.on("signup_modal",function(e,t){g.modal.open(t)}),g.modal.inited=!0)},open:function(e){g.modal.init(),h("Signup.modal.open"),e=$.extend({redirect:t.DOMAIN_NAME_URL+"/login",message:"",message_lines:2,location:"signupmodal",already_joined:!0},e),$(".ui-dialog").find(".ui-dialog-content").dialog("close"),g.modal.m=g.modal.create(),g.activateForms(),e.message?g.modal.m.find(".action").text(e.message):g.modal.m.find("h4").remove(),e.button_text&&g.modal.m.find(".signup-submitbutton .default-text, .signup-submitbutton .loading-text").text(e.button_text),e.already_joined&&g.modal.m.find(".alreadyjoined").removeClass("invisible"),h("Sign Up Modal Displayed",{location:e.location}),l.log("Sign Up Modal Displayed",{location:e.location}),u.store({action:"Signed Up: Sign Up Modal",location:e.location},"deferred_metric"),g.modal.m.find("input.first_name").focus(),g.modal.m.find(".signuplocation").val(e.location),g.modal.m.find(".or-login").removeClass("invisible").find("a").attr("href",e.redirect).on("click",function(t){t.preventDefault(),u.store({action:"Log In: Sign Up Modal",location:e.location},"deferred_metric"),window.location=e.redirect}),e.location&&t.ENVIRONMENT.match(/(development|test)/)&&c.trigger("setup_quickregister")},create:function(){var e={dialogClass:"signup-modal signupform",width:420,close:g.modal.close,autoDestroy:!0,clickOverlayToClose:!0,disableScrolling:!0};return $(g.modal.html).dialog(e)},close:function(){c.trigger("signup_modal_closed"),u.expire(),u.expire("deferred_metric")}},track:{_read:function(){var e=$.jStorage.get("signup_tracking");return e},_store:function(e){return $.jStorage.set("signup_tracking",e,{TTL:6e5})},_expire:function(){return $.jStorage.set("signup_tracking",null,{TTL:0})},set:function(){var e=$(this).closest(".signup").find(".signuplocation").val()||"login",t="email";$(this).hasClass("facebook")?(l.log("Clicked Sign In with Facebook",{Location:e}),t="facebook"):$(this).hasClass("twitter")&&(l.log("Clicked Sign In with Twitter",{Location:e}),t="twitter"),g.track._expire();var i={};i.location=e,i.method=t,g.track._store(i)},assign:function(){var e=g.track._read();g.location=e&&e.location?e.location:"unknown",g.method=e&&e.method?e.method:"unknown",h(">>>>SIGNUP location: "+g.location),h(">>>>SIGNUP method: "+g.method)}},autoCTA:null,social:{popup:function(e){e.preventDefault();var t=$(this).hasClass("facebook")?"&amp;display=popup":"",i=$(this).hasClass("facebook")?[850,550]:[650,250],n=screen.width,o=screen.height,r="width="+i[0]+",height="+i[1]+",location=no,toobar=no,directories=no,status=no,menubar=no,resizable=no,copyhistory=no,left="+(n/2-i[0]/2)+",top="+(o/2-i[1]/2),a=$(this).attr("href")+t,s="social_signup";window.open(a,s,r)}},createBubble:function(){if("user"===t.PAGE&&!n.is("small")&&"false"!=$.cookie("show_signup")){l.log("Profile Bubble Shown");var e={dismissible:!0,delayduration:2e3,type:"info",width:290,customcss:{position:"fixed",bottom:"30px",right:"30px"},classname:"signupbubble"},i="";i+="<h5>Would you like your own<br/>about.me page?</h5>",i+='<span class="link-content glyph-triangle-right-after">Claim your free page!</span>';var o=s.bubble(i,e);o.on("click",function(){window.location="/",l.log("Clicked Bubble Signup Button")}),o.find(".bubble-close").click(function(){return $.cookie("show_signup",!1,{expires:2,path:"/"}),!1}),c.trigger("signup_bubble_ready")}},bottombar:{init:function(){"user"===t.PAGE&&(n.is("small")||"false"!=$.cookie("show_signup")&&g.bottombar.config())},config:function(){var e={dismissible:!0,delayduration:2e3,type:"info",width:"auto",customcss:{position:"fixed",bottom:"0px",right:g.bottombar.resize()},classname:"bottombar"},t="Id like my own aboutme page",i=s.bubble(t,e),n='<div class="bottombarbutton bottombar-left glyph-angle-left-after glyph-center" title="View another page"></div>';n+='<div class="bottombarbutton bottombar-right glyph-angle-right-after glyph-center" title="View another page"></div>',i.find(".bubble-control").remove(),i.find(".bubble-content").prepend(n),AboutMe.on("window:resize",function(){$(".bubble.bottombar").css("right",g.bottombar.resize)}),g.bottombar.handlers(i),g.bottombar.featuredlist=g.bottombar.getFeatured(),c.trigger("bottombar_ready")},resize:function(){return($(window).width()-342)/2+"px"},handlers:function(e){e.find(".message-content").on("click",function(){window.location="/",l.log("Clicked Bottombar Button")}),e.find(".bottombar-left, .bottombar-right").on("click",function(e){if($(e.target).hasClass("bottombarbutton")){var t=$(e.target).hasClass("bottombar-left")?"prev":"next",i=g.bottombar.featuredlist;if($.cookie("bottombar_profile")){var n=parseInt($.cookie("bottombar_profile"));if("prev"==t){var o=n-1>=0?n-1:i.length-1;$.cookie("bottombar_profile",o),window.location="/"+i[o]}else{var r=n+1<=i.length-1?n+1:0;$.cookie("bottombar_profile",r),window.location="/"+i[r]}l.log("click arrow: bottombar")}else{var a=Math.floor(Math.random()*i.length);$.cookie("bottombar_profile",a),window.location="/"+i[a]}}})},getFeatured:function(){var e=[],t=["jake","andy","mousumi","pascal","nathan","shawncollins","ryanchris","tonyconrad","paul.nues","david.brock","daisyfan","brianfioca","Jacobhartog","jeffhodsdon","nickfogler"];return d.post("system_directory",{directories:'["featured"]'},{success:function(i){i.directories.featured.length?e=$.map(i.directories.featured,function(e){return e.user_name}):(h("no featured found"),e=t)},error:function(i){h(i),e=t},async:!1}),e}},setupSignupForm:function(){$(".signup form").each(function(){var e=$(this);e.on("submit",function(i){i.preventDefault();var n=function(e){h(e),top.location=t.SSL_DOMAIN+"/new_user"},o=function(){$(".signup-submitbutton").attr("disabled","disabled").addClass("loading disabled");var t=e.validate({debug:!1,errorClass:"alarum_field",errorElement:"label"});return t.form()===!0?!0:($(".signup-submitbutton").removeAttr("disabled").removeClass("loading disabled"),!1)};if(o()){var r={success:n,error:function(e){if(h(e),$.doTimeout(1e3,function(){$(".signup-submitbutton").removeAttr("disabled").removeClass("loading disabled")}),e.redirect){var t="Take Me There",i="Cancel";if(e.redirect.match(/login/))var t="Log In";var n={};n[t]=function(){$(this).dialog("close"),window.location=e.redirect},n[i]=function(){$(this).dialog("close"),$("input.email").select()},s.alert(e.msg,{buttons:n})}else s.alert(e.msg)}},a=e.serializeArray(),l={};$.each(a,function(e,t){l[t.name]=t.value}),h(l),d.post("step1",l,r)}})})},userAvailable:!1,setupValidators:function(){$.validator.addMethod("first_name",function(e,t){if($(t).closest("fieldset").find("label.alarum").remove(),e.length<1||"First name"==e)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">First name is required.</label>'),!1;var i=r.checkLength(e,1,32);return i?($(t).closest("fieldset").append('<label class="alarum confirmed" for="'+t.id+'">Name looks good!</label>'),i):($(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">First name must be 1 to 32 characters long.</label>'),i)},""),$.validator.addMethod("username",function(e,t){if($(t).closest("fieldset").find("label.alarum").remove(),e.length<1)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Username is required.</label>'),!1;var i=!0;if(!i)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Username must not end with a domain.</label>'),i;var i=r.checkLength(e,3,32);if(!i)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Username must be 3 to 32 characters long.</label>'),i;var i=r.checkRegexp(e,/^[0-9a-zA-Z_\.]+$/i);if(!i)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Username may only consist of letters, numbers, underscores, and periods.</label>'),i;var i=!r.checkRegexp(e,/[_.][_.]/i);if(!i)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Username may not contain any consecutive underscores or periods.</label>'),i;var i=r.checkRegexp(e,/^[a-zA-Z]/i);if(!i)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Username must begin with a letter.</label>'),i;var i=r.checkRegexp(e,/[0-9a-zA-Z]$/i);return i?(g.userAvailable&&$(t).closest("fieldset").append('<label class="alarum confirmed" for="'+t.id+'">Username is available!</label>'),i):($(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Username must end with a letter or a number.</label>'),i)},""),$.validator.addMethod("password",function(e,t){if($(t).closest("fieldset").find("label.alarum").remove(),e.length<1)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Password is required.</label>'),!1;var i=r.checkLength(e,6,64);return i?(i=r.checkRegexp(e,/^\S+$/,"Password field does not allow spaces."))?($(t).closest("fieldset").append('<label class="alarum confirmed" for="'+t.id+'">Password is good!</label>'),i):($(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Password field does not allow spaces.</label>'),i):($(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Password must be between 6 and 64 characters.</label>'),i)},""),$.validator.addMethod("email",function(e,t){if($(t).closest("fieldset").find("label.alarum").remove(),e.length<1||"Your email address"==e)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Email is required.</label>'),!1;var i=r.checkLength(e,6,254);if(!i)return $(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Email address must be between 6 and 254 characters.</label>'),i;var n=new a.format.EmailAddress(e);return(i=n.isValid())?($(t).closest("fieldset").append('<label class="alarum confirmed" for="'+t.id+'">Email address looks good!</label>'),i):($(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Please enter a valid email address.</label>'),i)
},""),$.validator.addMethod("captcha_phrase",function(e,t){return $(t).closest("fieldset").find("label.alarum").remove(),$(t).hasClass("bad-captcha")?($(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Please try entering the text in the box again.</label>'),$(t).removeClass("bad-captcha"),!1):e.length<1?($(t).closest("fieldset").append('<label class="alarum" for="'+t.id+'">Please enter the text shown in the box.</label>'),!1):!0},"")}};return $(document).ready(g.init),g}),define("text!template/forgot_password.html",[],function(){return'<form action="/forgot_password" method="post" onsubmit="return false">\n	<fieldset>\n		<label class="label" for="identifier">Username or email address</label>\n		<input type="text" id="identifier" name="identifier" size="50" class="input large fullwidth required" />\n	</fieldset>\n	<fieldset class="buttons last">\n		<button type="submit" value="Send Reminder" class="button large dark blue submitbutton">\n			<span class="default-text">Reset Password</span>\n			<span class="loading-text">Resetting</span>\n		</button>\n		<span class="button large cancel">Cancel</span>\n	</fieldset>\n</form>\n'}),define("controller/forgot_password",["require","globals","marionette","viewer","text!template/forgot_password.html","lib/dialog","log","validate","form"],function(e){var t=(e("globals"),e("marionette")),i=e("viewer"),n=e("text!template/forgot_password.html"),o=e("lib/dialog"),r=e("log");e("validate"),e("form"),r.module("controller/forgot_password");var a=t.ItemView.extend({template:_.template(n),initialize:function(){_.bindAll(this,"validate","showResponse")},onBeforeRender:function(){var e={};e.viewer=i.model.toJSON(),this.templateHelpers=_.extend({},this.templateHelpers,e)},ui:{form:"form",field:"input[type=text]",submit:".button.submitbutton",cancel:".button.cancel"},onRender:function(){this.ui.field.val($("input#login").val());var e={target:"",beforeSubmit:this.validate,success:this.showResponse,dataType:"json"};this.$("form").ajaxForm(e)},validate:function(){if(this.ui.submit.hasClass("disabled"))return!1;this.$("p.error, label.alarum").remove(),this.ui.submit.attr("disabled","disabled").addClass("disabled loading");var e=this.ui.form.validate({debug:!0,errorClass:"alarum",errorElement:"label"}).form();return e||(this.ui.field.focus(),this.ui.submit.removeAttr("disabled").removeClass("disabled loading")),e},showResponse:function(e){if(e=e||{},e.success===!0)this.showSuccess();else if(e.error){this.$("p.error, label.alarum").remove();var t=$('<p class="error"></p>').hide();t.text(e.error),t.prependTo(this.ui.form).fadeIn("slow"),this.ui.field.focus().select(),this.ui.submit.removeAttr("disabled").removeClass("disabled loading")}else this.showFatalError()},showSuccess:function(e){this.trigger("close"),e=e||"We have emailed you a link to change your password.",o.banner(e,{duration:1e4})},showFatalError:function(e){this.trigger("close"),e=e||"There was a problem resetting your password. Please try again later.",o.error(e)},events:{"click @ui.cancel":"onClickCancel"},onClickCancel:function(){this.trigger("cancel")}}),s={modal:function(){var e=new a,t=$("<div/>");t.dialog({title:"Forgot Your Password?",modalView:e,dialogClass:"forgotpassword-modal",disableScrolling:!0,autoDestroy:!0,width:430,position:["center",215]})}};return AboutMe.on("user:forgot_password:ui",function(){s.modal()}),s}),define("controller/autologin",["globals","log","viewer","lib/metrics","lib/event","controller/signupform","lib/dialog","lib/ajax","controller/forgot_password"],function(e,t,i,n,o,r,a,s){t.module("controller/autologin");var l=t.create("autologin","background-color:navy;color:white"),c={init:function(){"login"!=e.PAGE&&(c.modal.init(),o.everReady("weak_login",function(t,i,r,a,s){$(".ui-dialog.auto_login").find(".ui-dialog-content").dialog("close"),n.log("Re-Auth Modal Displayed",{"trigger action":i,location:e.PAGE}),c.modal.open(i,r,a,s),o.trigger("weak_login_opened")}))},modal:{init:function(){c.modal.html=$(".autologin").remove().html()},open:function(e,t,n,r){c.modal.m=c.modal.create(),c.form=c.modal.m.find("form"),c.un=c.form.find("#login"),c.pwd=c.form.find("#password"),c.button=c.form.find(".button-submit"),i.logged_in&&(c.un.val(i.get("user_name")),c.pwd.focus()),c.form.on("submit",function(u){if(u.preventDefault(),c.button.attr("disabled","disabled").addClass("loading disabled"),!c.validate())return void c.button.removeAttr("disabled").removeClass("loading disabled");var d={ssl:!0,xhrFields:{withCredentials:!0},success:function(a){l(a.login),c.button.removeAttr("disabled").removeClass("loading disabled"),$(".ui-dialog.auto_login").find(".ui-dialog-content").dialog("close"),i.set("weak_login",!1),"ajax"==r?"POST"==n.type?(delete n.type,s.post(e,t,n)):"GET"==n.type&&(delete n.type,s.get(e,t,n)):"event"==r&&t&&o.trigger(t)},error:function(){c.button.removeAttr("disabled").removeClass("loading disabled"),a.banner("Your email or username doesnt match your password.<br />Please try again, or request a password reset.",{status:"warning"})}},h={user_name:c.un.val(),password:c.pwd.val()};s.post("login",h,d)}),c.modal.m.on("click",".forgotpassword-link",function(){AboutMe.trigger("user:forgot_password:ui")}),AboutMe.on("user:forgot_password:ui",function(){c.modal.m.dialog("close")})},create:function(){var e={title:"Please Log In to Continue",dialogClass:"auto_login",width:363,position:"center",clickOverlayToClose:function(){var e=$(this).find("input[type=text],input[type=password]").map(function(){return $(this).val()?this:void 0});return 0==e.length?!0:void 0},autoOpen:!0,autoDestroy:!0,disableScrolling:!0};return $(c.modal.html).dialog(e)}},validate:function(){c.form.find(".alarum").remove();var e=(c.un.val().length,c.un.val().length>0?!0:!1);e||c.un.addClass("error").focus().after('<span class="alarum">Username/email is required.</span>');var t=c.pwd.val().length>0?!0:!1;return t||c.pwd.addClass("error").focus().after('<span class="alarum">Password is required.</span>'),e&&t}};return $(document).ready(c.init),c}),define("controller/typekit",["globals","log","lib/event","data/user","doTimeout"],function(e,t,i,n){t.module("controller/typekit");var o={timeout:5e3,init:function(){t.time("TypeKit.init");var e=this;AboutMe.when("viewport:not:small",function(){var i=e.needed();t("Use TypeKit: "+i),i?e.load():e.loaded()}),AboutMe.when("viewport:small",function(){$("html").removeClass("wf-loading").addClass("wf-active"),i.trigger("typekit_complete")})},needed:function(){var e=new RegExp("proxima","i"),t=!1;return $(["font_name","font_heading","font_bio","font_findme"]).each(function(i,o){var r=n.Settings.fonts[o];t=t||!e.test(r)}),t},load:function(){$.doTimeout("typekit_failed",this.timeout,this.failed);var e="//use.typekit.net/"+n.Settings.fonts.font_kit+".js";require([e],function(){t("kit script loaded"),t(window.Typekit);try{window.Typekit.load({active:function(){o.loaded()}})}catch(e){t("TypeKit Error:"),t(e),o.failed()}},function(){t("kit script failed"),o.failed()})},loaded:function(){o.complete(),$("html").removeClass("wf-loading").addClass("wf-active"),i.trigger("typekit_loaded")},failed:function(){o.complete(),$("html").removeClass("wf-loading").addClass("wf-inactive"),i.trigger("typekit_failed")},complete:function(){$.doTimeout("typekit_failed"),t.timeEnd("TypeKit.init"),i.trigger("typekit_complete")}};return o.init(),o}),define("list/baselist",["require","globals","backbone","log"],function(e){var t=e("globals"),i=e("backbone"),n=e("log");n.module("list/baselist");var o=n,r=i.Collection.extend({sync:function(e,n,r){return r=r||{},"/ajax"===this.url.substring(0,5)&&(r.emulateJSON=!0,_.defaults(r,{type:r.type||"POST",success:function(e){o("There was generic ajax success.",e)},error:function(e){o("There was a generic ajax error.",e)},data:{}}),r.data._authentication_token=t.AUTH_TOKEN),i.Collection.prototype.sync.apply(this,arguments)}});return r}),define("text!template/belowthefold.html",[],function(){return'<script type="text/template" id="layout-template">\n	<div id="below-nav"></div>\n	<div id="below-nav-fixed"></div>\n	<div id="below-content"></div>\n</script>\n\n<script type="text/template" id="tab-template">\n	{{ data.title }}\n</script>\n\n<script type="text/template" id="container-template">\n	<h2 class="below-mobile-title">{{ data.title }}</h2>\n	<: if (data.edit_mode) {:>\n	<div class="container-promo"></div>\n	<div class="container-controls-wrap">\n		<div class="container-controls-inside clearfix">\n			<div class="container-controls container-controls-top"></div>\n			<div class="container-content-controls"></div>\n		</div>\n	</div>\n	<: } :>\n	<div class="container-content container-section"></div>\n	<: if (data.edit_mode) {:>\n	<div class="container-controls-wrap container-controls-wrap-bottom">\n		<div class="container-controls-inside clearfix">\n			<div class="container-controls container-controls-bottom"></div>\n		</div>\n	</div>\n	<: } :>\n</script>\n\n<script type="text/template" id="publictoggle-template">\n	<span class="public-toggle button dark transparent [[ (data.visible) ? \'glyph-close\':\'glyph-plus\']]">{{ (data.visible) ? \'Unpublish \':\'Publish \' }}{{data.title}}</span>\n</script>'}),define("controller/belowthefold",["require","globals","marionette","log","viewer","data/user","viewport","lib/event","model/basemodel","list/baselist","text!template/belowthefold.html","editmode","lib/metrics"],function(e){{var t=e("globals"),i=e("marionette"),n=e("log"),o=(e("viewer"),e("data/user")),r=e("viewport"),a=e("lib/event"),s=e("model/basemodel"),l=e("list/baselist"),c=e("text!template/belowthefold.html"),u=e("editmode");e("lib/metrics")}n.module("controller/belowthefold");var d=n.create("belowthefold","background-color:#243c8b;color:white"),h=AboutMe.module("Below");h.containers={};var g,p=t.MAPPED?0:t.NAV_HEIGHT,m=45,f=1e3,b=2e3,v=!1,y=!1,w=$(".profile-container"),k=$(".profile"),x=$(window),C=["groups"],S=[{name:"backstory",url:"backstory",title:"Backstory"},{name:"groups",url:"collections",title:"My Collections"}];h.layout=new(Backbone.Marionette.LayoutView.extend({className:"below invisible",template:_.template($(c).filter("#layout-template").html()),regions:{navRegion:"#below-nav",fixedNavRegion:"#below-nav-fixed",contentRegion:"#below-content"}}));var A=i.Controller.extend({initialize:function(){$("html").addClass("has-below"),_.bindAll(this,"scrollTo","scrollToTab"),this.listenTo(h,"below:tab:clicked",this.scrollToTab),this.listenTo(h,"below:top:clicked",this.scrollToTop),this.listenTo(h,"below:set:url",this.setURL),this.listenTo(h,"below:set:url:delay",this.setURLDelayed),AboutMe.belowTheFoldRegion.show(h.layout);var e=new F({collection:h.tabList});h.layout.navRegion.show(e);var t=new F({collection:h.tabList});h.layout.fixedNavRegion.show(t);var i=new I({collection:h.tabList});h.layout.contentRegion.show(i),this.ensureContent(),this.loadContainerContent();var n=this;a.on("below:scrollto",function(e,t){n.scrollToTab(t)}),x.on("resize orientationchange",function(){r.is("small")&&$("body").removeClass("scrolled-to-below scrolled-to-below-nav")}),this.setupScroll()},setupScroll:function(){this.checkScroll(),x.on("scroll.below_scroll resize.below_scroll",this.checkScroll)},checkScroll:function(){if(!r.is("small")){var e=$(".below"),t=k.add(".customize"),i=w.height(),n=i-x.height(),o=x.scrollTop();if(e.offset().top!==i-m&&e.css("top",i-m),o>n){var a=(o-n)/5,s=1-a/100,s=Math.max(0,s),s=Math.min(1,s);y||t.css({"-webkit-transition":"none",transition:"none",opacity:s}),0===s?t.css("visibility","hidden"):t.css("visibility","");var l=i-p-m;return o>=l?(y=!0,$("body").addClass("scrolled-to-below-nav")):(y=!1,$("body").removeClass("scrolled-to-below-nav")),v=!0,void $("body").addClass("scrolled-to-below")}t.css({opacity:"",visibility:""}),h.trigger("below:notabs:accessed"),v=!1,y=!1,$("body").removeClass("scrolled-to-below scrolled-to-below-nav")}},parseQuery:function(e){if(!e)return void a.trigger("below:ok-to-show-modals");if(e=e.split("/"),e.shift(),!e||!e.length)return a.trigger("below:ok-to-show-modals"),void this.scrollToTop();var i=h.tabList.map(function(e){return"below/"+e.get("url")});if(!_.contains(i,e.join("/")))return a.trigger("below:ok-to-show-modals"),t.MAPPED||h.router.navigate(o.Settings.user_name),!1;x.scrollTop(0);{var n=this;$(".below").height()}_.delay(function(){n.scrollToRoute(e.join("-"))},1500)},scrollToRoute:function(e){var t=h.tabList.findWhere({url:e.replace(/below-/,"")});t&&this.scrollTo("below-"+t.get("name"),t.get("url"))},scrollToTab:function(e){var t=h.tabList.findWhere({name:e.replace(/below-/,"")});this.scrollTo("below-"+t.get("name"),t.get("url"))},scrollTo:function(e,t){var i=$("#"+e);i.length&&(h.trigger("below:set:url:delay",t),$(".below").css("top",w.height()-m),$("body,html").animate({scrollTop:i.offset().top-p-m},f,"easeOutQuart"))},scrollToTop:function(){h.trigger("below:set:url:delay");$("body,html").animate({scrollTop:0},f,"easeOutQuart")},setURLDelayed:_.debounce(function(e){this.setURL(e)},b),setURL:function(e){var i=o.Settings.user_name;e&&_.isObject(e)&&(e=e.get("url")),e&&(i+="/below/"+e),t.MAPPED||h.router.navigate(i)},ensureContent:function(){var e=[],t=[];h.tabList.each(function(i){e.push("below_"+i.get("name")+"_ready"),t.push("below_"+i.get("name")+"_empty")}),a.on(e.join(" "),function(){h.layout.$el.removeClass("invisible")}),a.on(t.join(" "),function(e,t){var i=h.tabList.findWhere({name:t});h.tabList.remove(i)}),a.ready(t.join(" "),function(){AboutMe.belowTheFoldRegion.reset(),x.off("scroll.below_scroll resize.below_scroll")})},loadContainerContent:function(){h.tabList.each(function(t){e(["controller/below_"+t.get("name")])})}}),E=s.extend({url:"/ajax/set_below_visibility",defaults:{name:"foo",title:"Bar",active:""}}),T=l.extend({url:"/ajax/get_below_visibility/",model:E,parse:function(e){var t=_.map(S,function(t){return t.visible=e[t.name],t});return t}}),M=i.ItemView.extend({tagName:"li",events:{click:"handleClick"},className:function(){return"below-tab"+this.model.get("active")},template:_.template($(c).filter("#tab-template").html()),initialize:function(){this.model.on("change",this.render,this),this.$el.attr("id","below-tab-"+this.model.get("name"))},onRender:function(){this.$el.attr("class",_.result(this,"className"))},handleClick:function(e){e.stopPropagation(),r.is("small")||h.trigger("below:tab:clicked","below-"+this.model.get("name"))}}),F=i.CollectionView.extend({className:"below-tabs",tagName:"ul",childView:M,initialize:function(){_.bindAll(this,"removeActive"),this.listenTo(h,"below:tab:accessed",this.tabAccessed),this.listenTo(h,"below:notabs:accessed",this.toTop)},onShow:function(){h.layout.fixedNavRegion.$el.on("click",function(e){v&&(e.stopPropagation(),h.trigger("below:top:clicked"))})},tabAccessed:function(e){this.removeActive();var t=this.children.findByModel(e);t&&(t.model.set("active"," active"),h.trigger("below:set:url:delay",e))},removeActive:function(){this.children.each(function(e){e.model.set("active","")})},toTop:function(){this.removeActive(),h.trigger("below:set:url:delay")}}),R=i.ItemView.extend({className:"publictoggle",template:_.template($(c).filter("#publictoggle-template").html()),ui:{publictoggle:".button"},events:{"click @ui.publictoggle":"toggleVisibility"},initialize:function(){this.model.on("change",this.render,this)},toggleVisibility:function(){this.model.save({visible:!this.model.get("visible")}),this.render()}}),j=i.LayoutView.extend({className:"below-container",regions:{containerContent:".container-content"},template:_.template($(c).filter("#container-template").html()),initialize:function(){_.bindAll(this,"handleScroll"),this.$el.attr("id","below-"+this.model.get("name")),h.containers[this.model.get("name")]=this,u&&(this.model.set("edit_mode",!0),this.addRegion("containerControlTop",".container-controls-top"),this.addRegion("containerControlBottom",".container-controls-bottom"),this.addRegion("containerContentControl",".container-content-controls"),this.addRegion("containerPromo",".container-promo")),x.on("scroll",this.handleScroll)},handleScroll:function(){var e=this.$el.offset().top,t=x.scrollTop();t>=e-p-m&&h.trigger("below:tab:accessed",this.model)},onShow:function(){if(u){var e=new R({model:this.model}),t=new R({model:this.model});this.containerControlTop.show(e),this.containerControlBottom.show(t)}}}),I=i.CollectionView.extend({className:"below-containers",childView:j,initialize:function(){_.bindAll(this,"setLastHeight")},onShow:function(){this.setLastHeight();var e=this;x.on("resize orientationchange",function(){e.setLastHeight()})},setLastHeight:function(){var e=r.is("small")?0:x.height()-p-m;this.$el.find(".below-container").last().css({minHeight:e})}});return h.addInitializer(function(){function e(e){if(!u){var n=h.tabList.where({visible:!1});h.tabList.remove(n)}if(t.MAPPED){var o=h.tabList.filter(function(e){return _.contains(C,e.get("name"))});h.tabList.remove(o)}return e.length?(g=new A,h.router=new i.AppRouter({controller:g,appRoutes:{"*segments(/)":"parseQuery"}}),void AboutMe.trigger("router:done")):void AboutMe.trigger("below:no:sections")}t.FRAMED||(AboutMe.addRegions({belowTheFoldRegion:"#belowthefold"}),h.tabList=new T,h.tabList.fetch({success:e,error:function(){d("There was an error fetching below tabs")},data:{user_name:o.Settings.user_name}}))}),h}),define("text!template/pagethumb.html",[],function(){return'<: if (data.settings.linked && data.href) { :>\n<a href="[[ data.href ]]"\n	<: if (data.settings.target) { :> target="[[ data.settings.target ]]"<: } :>\n>\n<: } :>\n\n<span class="thumbwrap"\n	<: if (data.settings.show_tooltip) { :> title="{{ data.display_name }}"<: } :>\n	>\n	<img class="thumb" alt="{{ data.display_name }}"\n		<: if (data.img_src) { :> src="[[ data.img_src ]]"<: } :>\n	>\n	<span class="thumbborder"></span>\n	[[ data.actions_template ]]\n</span>\n\n<: if (data.settings.show_data) { :>\n<span class="thumbdata">\n	<span class="name">{{ data.display_name }}&nbsp;</span>\n</span>\n<: } :>\n\n<: if (data.settings.linked && data.href) { :>\n</a>\n<: } :>\n'}),define("text!template/pagethumb_actions.html",[],function(){return'<: if (data.settings.primary_actions_style === \'buttons\') { :>\n	<span class="actions primary buttonbar">\n		<: if (data.actions.compliment) { :><span class="action button dark grey compliment glyph-thumbsup glyph-center" title="Send {{ data.display_first_name }} a compliment">&nbsp;</span><: } :>\n		<: if (data.actions.collect) { :><span class="action button dark grey collect glyph-plus glyph-center" title="Add {{ data.display_first_name }} to a collection">&nbsp;</span><: } :>\n	</span>\n<: } else if (data.settings.primary_actions_style === \'icons\') { :>\n	<ul class="actions primary">\n		<: if (data.actions.collect) { :><li class="glyph-plus collect action">&nbsp;</li><: } :>\n		<: if (data.actions.compliment) { :><li class="glyph-thumbsup compliment action">&nbsp;</li><: } :>\n	</ul>\n<: } :>\n	<span class="actions secondary">\n		<: if (data.actions.remove) { :><span class="action remove glyph-close glyph-center" title="Remove {{ data.display_first_name }}"></span><: } :>\n		<: if (data.actions.admin_remove) { :><span class="action admin_remove glyph-close glyph-center" title="Remove {{ data.display_first_name }}"></span><: } :>\n		<: if (data.actions.admin_flag) { :><span class="action admin_flag glyph-flag glyph-center" title="Flag {{ data.display_first_name }}"></span><: } :>\n		<: if (data.actions.mute) { :><span class="action mute glyph-block glyph-center" title="Mute {{ data.display_first_name }}"></span><: } :>\n		<: if (data.actions.thumb_regen) { :><span class="action thumb_regen glyph-reload glyph-center" title="Regenerate {{ data.possessive_first_name }} thumbnail"></span><: } :>\n	</span>\n\n'}),define("backbone.collectionsubset",["require","backbone"],function(e){var t=e("backbone");(function(){t.CollectionSubset=function(){function e(e){null==e&&(e={}),e=_.defaults(e,{refresh:!0,triggers:null,filter:function(){return!0},name:null,child:null,parent:null}),this.triggers=e.triggers?e.triggers.split(" "):[],e.child||(e.child=new e.parent.constructor),this.setParent(e.parent),this.setChild(e.child),this.setFilter(e.filter),e.model&&(this.child.model=e.model),e.refresh&&this.refresh(),this.name=e.name}return e.extend=t.Model.extend,_.extend(e.prototype,t.Events),e.prototype.setParent=function(e){var t,i=this;return null!=(t=this.parent)&&t.off(null,null,this),this.parent=e,this.parent.on("add",this._onParentAdd,this),this.parent.on("remove",this._onParentRemove,this),this.parent.on("reset",this._onParentReset,this),this.parent.on("change",this._onParentChange,this),this.parent.on("dispose",this.dispose,this),this.parent.on("loading",function(){return i.child.trigger("loading")},this),this.parent.on("ready",function(){return i.child.trigger("ready")},this)},e.prototype.setChild=function(e){var t;return null!=(t=this.child)&&t.off(null,null,this),this.child=e,this.child.on("add",this._onChildAdd,this),this.child.on("reset",this._onChildReset,this),this.child.on("dispose",this.dispose,this),this.child.superset=this.parent,this.child.filterer=this,this.child.url=this.parent.url,this.child.model=this.parent.model},e.prototype.setFilter=function(e){var t;return t=function(t){var i,n;return i=e.call(this,t),n=this.parent.filterer?this.parent.filterer.filter(t):!0,i&&n},this.filter=_.bind(t,this)},e.prototype.refresh=function(e){var t;return null==e&&(e={}),t=this.parent.filter(this.filter),this.child.reset(t,{subset:this}),this.child.trigger("refresh")},e.prototype._replaceChildModel=function(e){var t,i;return t=this._getByCid(this.child,e.cid),t!==e?_.isUndefined(t)?this.child.add(e,{subset:this}):(i=this.child.indexOf(t),this.child.remove(t),this.child.add(e,{at:i,subset:this})):void 0},e.prototype._onParentAdd=function(e,t,i){return i&&i.subset===this?void 0:this.filter(e)?this._replaceChildModel(e):void 0},e.prototype._onParentRemove=function(e,t,i){return this.child.remove(e,i)},e.prototype._onParentReset=function(){return this.refresh()},e.prototype._onParentChange=function(e){return this.triggerMatched(e)?this.filter(e)?this.child.add(e):this.child.remove(e):void 0},e.prototype._onChildAdd=function(e,t,i){var n;if((!i||i.subset!==this)&&(this.parent.add(e),n=this._getByCid(this.parent,e.cid)))return this.filter(n)?this._replaceChildModel(n):this.child.remove(e)},e.prototype._onChildReset=function(e,t){return t&&t.subset===this?void 0:(this.parent.add(this.child.models),this.refresh())},e.prototype._getByCid=function(e,t){var i;return i=e.getByCid||e.get,i.apply(e,[t])},e.prototype.triggerMatched=function(e){var t;return 0===this.triggers.length?!0:e.hasChanged()?(t=_.keys(e.changedAttributes()),_.intersection(this.triggers,t).length>0):!1},e.prototype.dispose=function(){var e,t,i,n,o;if(!this.disposed){for(this.trigger("dispose",this),this.parent.off(null,null,this),this.child.off(null,null,this),"function"==typeof(t=this.child).dispose&&t.dispose(),this.off(),o=["parent","child","options"],i=0,n=o.length;n>i;i++)e=o[i],delete this[e];return this.disposed=!0}},e}(),t.Collection.prototype.subcollection=function(e){var i;return null==e&&(e={}),_.defaults(e,{child:new this.constructor,parent:this}),i=new t.CollectionSubset(e),i.child},"undefined"!=typeof module&&null!==module&&(module.exports=t.CollectionSubset)}).call(this)}),define("text!template/compliment_modal.html",[],function(){return'<: if (data.options.show_thumb) { :>\n	<section class="thumb">\n		<div class="pagethumb">\n			<span class="thumbwrap"></span>\n		</div>\n	</section>\n<: } :>\n\n<: if (! data.logged_in) { :>\n	<p class="compliment-note">Compliments are a fun, light way to communicate.<br />Send one to {{ data.display_first_name }} today!</p>\n<: } :>\n\n<ul class="compliments">\n	<: \n		// if all compliments are off, we show them all instead of none\n		// compliments sent in this scenario are ignored\n		var all_off = ! _.reduce(data.compliment_settings, function(memo, value, key) {\n			return memo || value;\n		}, false);\n	:>\n	<: if (all_off || data.compliment_settings.display_fave) { :><li class="compliment fave glyph-star" data-compliment="fave">Favorite</li><: } :>\n	<: if (all_off || data.compliment_settings.display_wellwritten) { :><li class="compliment wellwritten glyph-pencil" data-compliment="wellwritten">Awesome bio</li><: } :>\n	<: if (all_off || data.compliment_settings.display_love) { :><li class="compliment love glyph-heart" data-compliment="love">Love your page</li><: } :>\n	<: if (all_off || data.compliment_settings.display_inspired) { :><li class="compliment inspired glyph-lightning" data-compliment="inspired">Im inspired</li><: } :>\n	<: if (all_off || data.compliment_settings.display_greatpic) { :><li class="compliment greatpic glyph-photo" data-compliment="greatpic">Great photo</li><: } :>\n	<: if (all_off || data.compliment_settings.display_impressed) { :><li class="compliment impressed glyph-wow" data-compliment="impressed">Im impressed</li><: } :>\n	<: if (all_off || data.compliment_settings.display_greatpage) { :><li class="compliment greatpage glyph-trophy" data-compliment="greatpage">Great page</li><: } :>\n	<: if (all_off || data.compliment_settings.display_cool) { :><li class="compliment cool glyph-sunglasses" data-compliment="cool">Youre cool</li><: } :>\n	<: if (all_off || data.compliment_settings.display_fan) { :><li class="compliment fan glyph-thumbsup" data-compliment="fan">Im a fan</li><: } :>\n	<: if (all_off || data.compliment_settings.display_creative) { :><li class="compliment creative glyph-lightbulb" data-compliment="creative">Creative</li><: } :>\n</ul>\n'}),define("text!template/share_banner.html",[],function(){return'<: if (data.type === "fave") { :>\n	<p><strong>{{ data.user.display_name }}</strong> has been added to <strong><a href="[[ data.viewer.page_url ]]/collections/fave">Your Favorites</a></strong>.</p>\n<: } else if (data.type === "compliment") { :>\n	<p>Your compliment has been sent. <strong>Share it!</strong></p>\n<: } else if (data.type === "update_photo") { :>\n	<p>Youve just updated your photo. <strong>Share it!</strong></p>\n<: } else if (data.type === "add_backstory") { :>\n	<p>Youve just added your Backstory. <strong>Share it!</strong></p>\n<: } :>\n\n<p class="buttons">\n	<a href="[[ data.tweet_url ]]" class="button large twitter glyph-twitter" target="_blank">Tweet This</a>\n	<: if (data.facebook_url) { :>\n		<a href="[[ data.facebook_url ]]" class="button large facebook glyph-facebook" target="_blank">Share on Facebook</a>\n	<: } :>\n</p>\n'}),define("controller/compliment_modal",["require","globals","marionette","viewer","model/user","model/member","model/group","list/grouplist","viewport","lib/ajax","lib/dialog","lib/metrics","lib/event","controller/deferred","text!template/compliment_modal.html","text!template/share_banner.html","log"],function(e){var t=e("globals"),i=e("marionette"),n=e("viewer"),o=e("model/user"),r=(e("model/member"),e("model/group"),e("list/grouplist"),e("viewport")),a=e("lib/ajax"),s=e("lib/dialog"),l=e("lib/metrics"),c=e("lib/event"),u=e("controller/deferred"),d=e("text!template/compliment_modal.html"),h=e("text!template/share_banner.html"),g=e("log");g.module("controller/compliment_modal");var p=g,m=i.LayoutView.extend({template:_.template(d),defaults:{show_thumb:!0},regions:{thumb_region:"section.thumb"},initialize:function(e){this.options=_.extend({},this.defaults,e),r.is("small")&&(this.options.show_thumb=!1)},onBeforeRender:function(){var e={};e.options=_.clone(this.options),e.logged_in=n.logged_in,this.templateHelpers=_.extend({},this.templateHelpers,e)},onRender:function(){this.checkExistingCompliments(),this.options.show_thumb&&e(["lib/pagethumb"],_.bind(function(e){var t=new e.ItemView({model:this.model,settings:{linked:!1,show_data:!1}});this.thumb_region.show(t)},this))},checkExistingCompliments:function(){if(n.logged_in){var e=this;n.Groups.isUserInGroup(this.model,"fave")&&this.$(".compliment.fave").addClass("active");var t={user_name:this.model.get("user_name"),actor:n.get("user_name")},i={success:function(t){_.each(t,function(t,i){t===!0&&e.$(".compliment").filter("."+i).addClass("active")})}};a.post("compliments_issued",t,i)}},events:{"click .compliment":"clickCompliment"},clickCompliment:function(e){var t=$(e.target),i=t.data("compliment"),o=this.model;if(!i)return p.error("Compliment type not found");if(n.isUser(o)){switch(i){case"fave":s.banner('You cant fave yourself. Try faving <a href="/people/staffpicks">someone else</a>!',{status:"warning"});break;default:var r=["you look nice today.","did you get a haircut?","nice shoes.","your page looks great!","have you been working out?"];s.banner("You cant compliment yourself, but hey, "+_.sample(r),{status:"warning"})}return this.trigger("fadeout"),void this.trigger("cancel")}if(n.logged_in){t.addClass("loading");var a=f.send(o,i);a.kept(function(e){t.removeClass("loading").addClass("active"),this.trigger("fadeout"),this.trigger("success",e,i)},this),a.broken(function(){t.removeClass("loading"),this.trigger("error")},this)}else f.defer(o,i),this.trigger("cancel")}}),f={modal:function(e,t){if(!(e instanceof o))return p.error("Compliment.modal requires a User");if(!e.get("compliment_settings"))return void e.fetch({complete:function(){e.get("compliment_settings")||e.set("compliment_settings",{display_cool:!0,display_creative:!0,display_fan:!0,display_fave:!0,display_greatpage:!0,display_greatpic:!0,display_impressed:!0,display_inspired:!0,display_love:!0,display_wellwritten:!0}),f.modal(e,t)}});t||(t={}),t.model=e;var i=new m(t),n=$("<div></div>");n.dialog({modalView:i,title:"Send "+e.escape("display_first_name")+" a Compliment",dialogClass:"compliment-modal",width:400,position:"center",disableScrolling:!0,autoDestroy:!0,clickOverlayToClose:!0,open:function(){i.on("fadeout",function(){n.dialog("option","hide","fadeOut")}),i.on("success",function(){n.dialog("close"),AboutMe.trigger("user:compliment:success",e)})},close:function(){i.off(),AboutMe.trigger("user:compliment:ui:closed")}})},send:function(e,t){if(!(e instanceof o))return p.error("Compliment.send requires a User");var i=AboutMe.request("user:compliment",e,t);return i.kept(function(){f.showSuccessBanner(e,t)}),i.broken(function(){f.showErrorBanner(e,t)}),i.done(function(){AboutMe.trigger("user:compliment:complete")}),i},showSuccessBanner:function(e,t){var i={user:e.toJSON(),viewer:n.model.toJSON(),type:t},o="http://twitter.com/intent/tweet?text=",r="I "+("fave"==t?"faved":"complimented")+" "+e.get("possessive_display_name")+" page at @aboutdotme! Check it out: "+e.get("page_url");e.get("twitter_name")&&(r=r+" @"+e.get("twitter_name")),o+=encodeURIComponent(r),i.tweet_url=o,n.get("facebook_compliment_share")||(i.facebook_url="http://www.facebook.com/share.php?u="+encodeURIComponent(e.get("page_url"))),"fave"!=i.type&&(i.type="compliment");var a=_.template(h,i),u=s.banner(a,{duration:7e3});u.find(".button.twitter").click(function(){l.log("Tweet - After Compliment")}),u.find(".button.facebook").click(function(){l.log("FB Share - After Compliment")}),l.log("Compliment",{"Compliment Type":t}),c.trigger("compliment_sent")},showErrorBanner:function(){s.banner("There was an error sending your compliment. Please try again later.",{status:"error"})},defer:function(e,i){if(!(e instanceof o))return p.error("Compliment.defer requires a User");var n={action:"compliment",data:{user:e.attributes,type:i}};u.store(n);var r=t.MAPPED?"/"+e.get("user_name"):encodeURIComponent(document.location),a={redirect:t.DOMAIN_NAME_URL+"/login?came_from="+r,message:"Almost sent! Make sure "+e.get("first_name")+" gets your compliment. Join today.",location:"fave"==i?t.PAGE+"_fave":t.PAGE+"_compliment",button_text:"Send Compliment"};c.trigger("signup_modal",[a])}};return AboutMe.on("user:compliment:ui",function(e,t){f.modal(e,t)}),AboutMe.on("user:compliment",function(e,t){f.send(e,t)}),f}),define("text!template/create_group.html",[],function(){return'<form onsubmit="return false" class="creategroupform">\n	<fieldset>\n		<input type="text" class="input large fullwidth" maxlength="50" placeholder="" value="" />\n		<label class="alarum"></label>\n		<: if (data.suggestions && data.suggestions.length) { :>\n			<label class="suggestions">\n				Suggestions:\n				<span class="suggestion text link">{{ data.suggestions[0] }}</span>,\n				<span class="suggestion text link">{{ data.suggestions[1] }}</span>,\n				or <span class="suggestion text link">{{ data.suggestions[2] }}</span>.\n			</label>\n		<: } :>\n	</fieldset>\n	<fieldset class="buttons last">\n		<button type="submit" class="button large dark blue">Create</button>\n		<span class="button large cancel">Cancel</button>\n	</fieldset>\n</form>\n'
}),define("controller/create_group",["require","globals","marionette","viewer","model/user","model/member","model/basemodel","model/group","lib/event","lib/dialog","lib/utils","text!template/create_group.html","log"],function(e){var t=(e("globals"),e("marionette")),i=e("viewer"),n=(e("model/user"),e("model/member")),o=e("model/basemodel"),r=e("model/group"),a=(e("lib/event"),e("lib/dialog")),s=(e("lib/utils"),e("text!template/create_group.html")),l=e("log");l.module("controller/create_group");var c=l,u=o.extend({initialize:function(){this.resetGroup(),this.on("all",this.onEvent)},onEvent:function(e,t){c("model event",e,t)},resetGroup:function(){this.group=new r({owner:i.get("user_name")})},validate:function(){if(!this.group.isValid())return this.group.validationError;var e=i.model.grouplist.findWhere({name:this.group.get("name")});return e?"That name is already in use.":void this.trigger("valid")}}),d=t.ItemView.extend({template:_.template(s),initialize:function(e){_.defaults(this.options,e,{show_success_banner:!0}),this.on("success",this.showSuccessBanner),this.on("show",this.reset)},onBeforeRender:function(){var e={},t=i.get("tags"),n=["My Team","My Friends","My Family","My Co-workers"];t=_.sample(t,2),t=t.concat(_.sample(n,3)),t=t.slice(0,3),e.suggestions=t,this.templateHelpers=_.extend({},this.templateHelpers,e)},ui:{form:"form",field:"input[type=text]",error:"label.alarum",suggestions:"label.suggestions",suggestion:".suggestion",submitbutton:"button[type=submit]",cancelbutton:".button.cancel"},events:{"click @ui.suggestion":"onClickSuggestion","submit @ui.form":"submit","click @ui.cancelbutton":"cancel"},onClickSuggestion:function(e){var t=$(e.target).text();this.ui.field.val(t),this.ui.field.focus()},submit:function(){this.hideError();var e=$.trim(this.ui.field.val());if(this.ui.field.val(e),this.model.group.set("display",e),this.model.group.set("name",this.model.group.getCanonicalName()),this.model.isValid()){this.ui.submitbutton.addClass("loading disabled").attr("disabled","disabled"),this.listenToOnce(i.model.grouplist,"add",function(e){this.ui.submitbutton.removeClass("loading disabled").removeAttr("disabled"),this.trigger("success",e),this.reset(),this.trigger("close")},this);var t=AboutMe.request("group:create",this.model.group);t.kept(function(){this.options.add_user&&AboutMe.trigger("user:collect:success",this.options.add_user)},this),t.broken(function(e){this.ui.submitbutton.removeClass("loading disabled").removeAttr("disabled");var t;switch(e.error){case 106:t="That name is already in use.";break;case 110:t="That name is invalid.";break;default:t="There was an error creating this collection."}this.model.validationError=t,this.model.trigger("invalid")},this)}},cancel:function(){this.trigger("cancel")},reset:function(){this.model=new u,this.options.add_user&&this.model.group.memberlist.add(new n(this.options.add_user.attributes)),this.listenTo(this.model,"invalid",this.showError),this.ui.field.val(""),this.ui.field.focus(10),this.trigger("reset")},showError:function(){this.model.validationError&&(this.ui.error.text(this.model.validationError).show(),this.ui.suggestions.hide(),this.ui.field.one("keydown",_.bind(function(){this.hideError()},this)),this.ui.field.select(),this.trigger("form:error"))},hideError:function(){this.ui.error.hide(),this.ui.suggestions.show(),this.trigger("form:error:removed")},showSuccessBanner:function(e){if(e&&this.options.show_success_banner){var t=e.toJSON(),i='The collection <strong><a href="[[ data.url ]]" class="routed">{{ data.display }}</a></strong> has been created.',n=_.template(i,t);a.banner(n)}}}),h=function(){if(i.logged_in){var e=new d,t=$("<div></div>");t.dialog({modalView:e,title:"Please name this collection",dialogClass:"newgroupmodal",autoDestroy:!0,clickOverlayToClose:function(){var e=$(this).find("input[type=text],textarea").map(function(){return $(this).val()?this:void 0});return 0===e.length?!0:void 0},disableScrolling:!0,width:400,position:["center",250],create:function(){{var e=$(this);e.closest(".ui-dialog"),e.dialog("option","id")}},open:function(){e.on("success",function(e){AboutMe.trigger("create_group_modal:group_created",e)})}})}};return AboutMe.onRequest("group:create:ui",function(){h()}),{FormModel:u,FormView:d}}),define("text!template/collect_modal.html",[],function(){return'<script class="layout">\n<: if (data.options.show_thumb) { :>\n	<section class="thumb">\n		<div class="pagethumb">\n			<span class="thumbwrap"></span>\n		</div>\n	</section>\n<: } :>\n<section class="list"></section>\n<section class="form"></section>\n</script>\n\n\n<script class="groupitem">\n{{ data.display }}\n</script>\n\n\n<script class="form">\n<form onsubmit="return false" class="creategroupform">\n	<fieldset class="last buttonfield">\n		<input type="text" class="input large" maxlength="50" id="group_display_name" name="group_display_name" placeholder="Add to a new collection" value="" />\n		<label class="alarum"></label>\n		<button type="submit" class="button large createbutton">\n			<span class="default-text">Create</span>\n			<span class="loading-text">&nbsp;</span>\n		</button>\n	</fieldset>\n</form>\n</script>\n\n'}),define("controller/collect_modal",["require","globals","marionette","viewer","model/user","model/member","model/group","list/grouplist","controller/create_group","viewport","lib/metrics","lib/event","controller/deferred","text!template/collect_modal.html","log","backbone.collectionsubset"],function(e){var t=e("globals"),i=e("marionette"),n=e("viewer"),o=e("model/user"),r=e("model/member"),a=(e("model/group"),e("list/grouplist"),e("controller/create_group")),s=e("viewport"),l=e("lib/metrics"),c=e("lib/event"),u=e("controller/deferred"),d=e("text!template/collect_modal.html"),h=e("log");e("backbone.collectionsubset"),h.module("controller/collect_modal");var g=h,p=i.ItemView.extend({tagName:"li",className:"item",template:_.template($(d).filter("script.groupitem").html()),initialize:function(){this.listenTo(this.model.memberlist,"add remove",this.setCheckedClass),this.$el.data("cid",this.model.cid)},onRender:function(){this.setCheckedClass()},setCheckedClass:function(){this.$el.toggleClass("checked glyph-check",!!this.model.memberlist.hasUser(this.options.user))}}),m=i.CollectionView.extend({tagName:"ul",className:"groups",childView:p,initialize:function(e){this.options=_.extend({},this.defaults,e),this.childViewOptions={user:this.options.user},this.listenTo(this.collection,"sort",this.render)},ui:{item:".item"},events:{"click @ui.item":"onClickItem"},onClickItem:function(e){var t,i=$(e.target),n=i.data("cid"),o=this.collection.get(n),a=this.options.user,s=o.memberlist.hasUser(a);s?t=AboutMe.request("group:remove:user",o,s):(i.addClass("loading glyph-check"),t=AboutMe.request("group:add:user",o,new r(a.attributes)),t.kept(function(){AboutMe.trigger("user:collect:success",a)}),t.done(function(){i.removeClass("loading")}))}}),f=i.LayoutView.extend({template:_.template($(d).filter("script.layout").html()),defaults:{show_thumb:!0},regions:{thumb_region:"section.thumb",list_region:"section.list",form_region:"section.form"},initialize:function(e){this.options=_.extend({},this.defaults,e),this.list_view=new m({collection:this.options.collection,user:this.options.user}),this.form_view=new a.FormView({template:_.template($(d).filter("script.form").html()),add_user:this.options.user,show_success_banner:!1}),this.listenTo(this,"show",this.onShow),this.listenTo(this,"show",this.resize),this.listenTo(this,"form:error",this.onFormError),this.listenTo(this.form_view,"form:error form:error:removed",this.resize),this.listenTo(this.options.collection,"add remove",this.resize),this.listenTo(AboutMe,"window:resize",_.debounce(this.resize,100))},onBeforeRender:function(){var e={};e.options=_.clone(this.options),delete e.options.collection,this.templateHelpers=_.extend({},this.templateHelpers,e)},onRender:function(){this.options.show_thumb&&e(["lib/pagethumb"],_.bind(function(e){var t=new e.ItemView({model:this.options.user,settings:{linked:!1,show_data:!1}});this.thumb_region.show(t)},this)),this.list_region.show(this.list_view),this.form_region.show(this.form_view)},resize:function(){var e,t,i=this.$el.closest(".ui-dialog"),n=this.$el.find("ul.groups"),o=n.find("li.item").height();n.removeAttr("style"),e=i.height()-n.height(),t=$(window).height()-e,s.isNot("small")&&(t-=60),t=Math.max(t,3*o),n.css("max-height",t+"px"),this.trigger("resized")}}),b={modal:function(e,i){if(n.logged_in){if(!(e instanceof o))return g.error("Collect.modal requires a User");i=_.extend({},i,{collection:n.model.grouplist.subcollection({filter:function(e){return e.isNot("auto")}}),user:e});var r=new f(i),a=$("<div></div>");a.dialog({modalView:r,title:"Add "+e.escape("display_first_name")+" to a Collection",dialogClass:"collect-modal",autoDestroy:!0,clickOverlayToClose:function(){var e=$(this).find("input[type=text],textarea").map(function(){return $(this).val()?this:void 0});return 0===e.length?!0:void 0},disableScrolling:!0,width:400,position:"center",create:function(){var e=$(this),i=(e.closest(".ui-dialog"),e.dialog("option","id"));c.on("modal_cancel."+i,function(){l.log("Collections",{"collections action":"Owner canceled add to collection modal",location:t.PAGE})})},open:function(){r.on("resized",function(){a.trigger("resized")})},close:function(){AboutMe.trigger("user:collect:ui:closed")}})}},signup:function(e,i){var n={action:"collect",data:{user:e.attributes}};u.store(n);var o=t.MAPPED?"/"+e.get("user_name"):encodeURIComponent(document.location),i={redirect:t.DOMAIN_NAME_URL+"/login?came_from="+o,message:"Almost saved! Join about.me to save "+e.get("possessive_first_name")+" contact and page info for later.",location:"profile_save",button_text:"Save"};c.trigger("signup_modal",[i])}};return AboutMe.on("user:collect:ui",function(e,t){g(e),n.logged_in?b.modal(e,t):b.signup(e,t)}),b}),define("text!template/mute.html",[],function(){return'<p>Are you sure you want to mute <strong>{{data.display_name}}</strong>?</p>\n<label for="flag-user" class="flag-user-label"><input type="checkbox" name="flag-user" id="flag-user" /> Also report {{ data.display_first_name }} for abuse</label>\n<select class="input flag-reasons invisible">\n	<option value="">Select One (required)</option>\n	<option value="stalker">Repeated, unsolicited messages</option>\n	<option value="obscene">Obscene content</option>\n	<option value="other">Other</option>\n</select>\n'}),define("controller/flag",["require","globals","model/user","lib/ajax","lib/dialog","viewer","log","isInArray"],function(e){var t=(e("globals"),e("model/user")),i=e("lib/ajax"),n=e("lib/dialog"),o=e("viewer"),r=e("log");e("isInArray"),r.module("controller/flag");var a=r,s={initialize:function(){AboutMe.on("user:flag",this.flag)},flag:function(e,r){r=r||{};try{if(!o.logged_in)throw new Error("Must be logged in to flag");if(!(e instanceof t))throw new Error("Flag requires a User model");if(!r.reason)throw new Error("Must provide a reason for flagging");if(!$.isInArray(r.reason,["stalker","obscene","other","admin"]))throw new Error("Invalid flag reason")}catch(s){return a.error(s)}var l,c,u=_.extend({},r,e.toJSON()),d={action:"flag",reason:r.reason,user:e.get("user_name")},h={success:function(t){c=o.is("admin")?"<strong>{{data.display_name}}</strong> has been unpublished.":"<strong>{{data.display_name}}</strong> has been reported for review.",l=_.template(c,u),n.banner(l),AboutMe.trigger("user:flag:success",e,r),a("flagged:",t)},error:function(t){n.banner("There was a problem reporting this page. Please try again later.",{status:"warning"}),AboutMe.trigger("user:flag:error",e,r),a.error("flag error",t)}};i.post("flag",d,h)}};AboutMe.addInitializer(function(){s.initialize()})}),define("controller/mute",["require","globals","model/user","lib/ajax","lib/dialog","text!template/mute.html","viewer","log","controller/flag"],function(e){var t=(e("globals"),e("model/user")),i=e("lib/ajax"),n=e("lib/dialog"),o=e("text!template/mute.html"),r=e("viewer"),a=e("log");e("controller/flag"),a.module("controller/mute");var s=a,l={initialize:function(){AboutMe.on("user:mute:ui",this.confirm),AboutMe.on("user:mute",this.mute)},confirm:function(e){try{if(!r.logged_in)throw new Error("Must be logged in to mute");if(!(e instanceof t))throw new Error("Mute requires a User model")}catch(i){return s.error(i)}{var a,l,c,u,d=d||{},h=_.extend({},d,e.toJSON()),g=_.template(o,h);n.modal(g,{dialogClass:"mute-modal",title:"Mute "+e.escape("display_first_name"),open:function(){var e=$(this).closest(".ui-dialog");l=e.find(".button.large.dark.blue"),c=e.find("input#flag-user"),u=e.find("select.flag-reasons");var t=function(){a=u.val(),""===a?l.attr("disabled","disabled").addClass("disabled"):l.removeAttr("disabled").removeClass("disabled")};c.on("change",function(){c.is(":checked")?(u.removeClass("invisible"),l.find(".ui-button-text").text("Report"),t()):(u.addClass("invisible"),l.find(".ui-button-text").text("Mute"),l.removeAttr("disabled").removeClass("disabled"))}),u.on("change",function(){t()})},buttons:[{text:"Mute",click:function(){c.is(":checked")&&a?AboutMe.trigger("user:flag",e,{reason:a}):AboutMe.trigger("user:mute",e),$(this).dialog("close")}},{text:"Cancel",click:function(){$(this).dialog("close")}}]})}},mute:function(e){try{if(!r.logged_in)throw new Error("Must be logged in to mute");if(!(e instanceof t))throw new Error("Mute requires a User model")}catch(o){return s.error(o)}var a=e.toJSON(),l={action:"mute",user:e.get("user_name")},c={success:function(t){var i="<strong>{{data.display_name}}</strong> has been muted.",o=_.template(i,a);n.banner(o),s("muted:",t),AboutMe.trigger("user:mute:success",e)},error:function(t){n.banner("There was a problem muting this person. Please try again later.",{status:"warning"}),s.error("mute",t),AboutMe.trigger("user:mute:error",e)}};i.post("mute_user",l,c)}};AboutMe.addInitializer(function(){l.initialize()})}),define("controller/admin_flag",["require","globals","model/user","lib/dialog","lib/ajax","viewer","log","controller/flag"],function(e){var t=(e("globals"),e("model/user")),i=e("lib/dialog"),n=e("lib/ajax"),o=e("viewer"),r=e("log");e("controller/flag"),r.module("controller/admin_flag");var a=r,s={initialize:function(){AboutMe.on("admin:flag:ui",this.confirm),AboutMe.on("admin:flag",_.bind(function(e){this.send_ajax(e,{action:"flag"})},this)),AboutMe.on("admin:jail",_.bind(function(e){this.send_ajax(e,{action:"jail"})},this))},confirm:function(e){try{if(!o.is("admin"))throw new Error("AdminFlag requires admin privileges");if(!(e instanceof t))throw new Error("AdminFlag requires a User model")}catch(n){return a.error(n)}var r=e.toJSON(),s="<p>Are you sure you want to unpublish <strong>{{data.display_name}}</strong>?</p><p>Click Jail to mute all of {{data.possessive_first_name}} activity without unpublishing their account.</p>",l=_.template(s,r),c=i.alert(l,{title:"Flag "+e.escape("display_first_name"),width:380,buttons:{Unpublish:function(){AboutMe.trigger("admin:flag",e),c.dialog("close")},Jail:function(){AboutMe.trigger("admin:jail",e),c.dialog("close")},Cancel:function(){c.dialog("close")}}})},send_ajax:function(e,r){r=r||{};try{if(!o.logged_in)throw new Error("Must be logged in to flag");if(!(e instanceof t))throw new Error("Flag requires a User model");if(!$.isInArray(r.action,["flag","jail"]))throw new Error("Invalid flag reason")}catch(s){return a.error(s)}var l,c,u=_.extend({},r,e.toJSON()),d={action:r.action,user:e.get("user_name")},h={success:function(){c="jail"===r.action?"<strong>{{data.display_name}}</strong> has been troll jailed.":"<strong>{{data.display_name}}</strong> has been unpublished.",l=_.template(c,u),i.banner(l),AboutMe.trigger("admin:"+r.action+":success",e,r)},error:function(t){i.banner("There was a problem reporting this page. Please try again later.",{status:"warning"}),AboutMe.trigger("admin:"+r.action+":error",e,r),a.error("flag error",t)}};n.post("admin_flag",d,h)}};AboutMe.addInitializer(function(){s.initialize()})}),define("controller/thumb_regen",["require","globals","marionette","model/user","lib/ajax","lib/utils","lib/dialog","lib/metrics","viewer","log"],function(e){var t=(e("globals"),e("marionette"),e("model/user")),i=e("lib/ajax"),n=(e("lib/utils"),e("lib/dialog")),o=(e("lib/metrics"),e("viewer")),r=e("log");r.module("controller/thumb_regen");var a=function(e){if(o.logged_in&&o.is("admin")&&e instanceof t){var r=e.toJSON(),a={user_name:e.get("user_name")},s={success:function(){var t="The thumbnail for <strong>{{data.display_name}}</strong> will be regenerated.<br />It will take some time for the new thumbnail to appear.",i=_.template(t,r);n.banner(i),AboutMe.trigger("user:thumb_regen:success",e)},error:function(){var t='There was a problem regenerating the thumbnail for <strong class="nowrap">{{data.display_name}}</strong>. <span class="nowrap">Please try again later.</span>',i=_.template(t,r);n.banner(i),AboutMe.trigger("user:thumb_regen:error",e)}};i.post("regenerate_thumbnail",a,s)}};AboutMe.addInitializer(function(){AboutMe.on("user:thumb_regen",a)})}),define("controller/thumbviews",["globals","log","viewer","lib/utils","lib/ajax","lib/event","doTimeout","isInArray"],function(e,t,i,n,o){t.module("controller/thumbviews");var r={viewed:[],queue:{},viewthumb:function(e,t,n){e&&t&&n&&(r.viewed[n]||(r.viewed[n]=[]),$.isInArray(e,r.viewed[n])||i.logged_in&&i.isUser(e)||(r.queue[t]||(r.queue[t]=[]),$.isInArray(e,r.queue[t])||(r.queue[t].push(e),$.doTimeout("thumbviews_viewthumb",1e3,function(){r.viewthumb_submit(t,n)}))))},viewthumb_submit:function(e,i){if(r.viewed[i]&&r.queue[e]&&r.queue[e].length){var n=r.queue[e].slice(0);r.queue[e]=[];var a="";switch(i){case"dashboard":a="Home";break;case"people":a="Popular";break;case"groups":a="Collections";break;case"search":a="Search";break;case"quickview":a="QuickView";break;default:a="Other"}var s={users:JSON.stringify(n),referrer:e,source:a},l=function(e){e.users_success&&$.each(e.users_success,function(){r.viewed[i].push(this.toString())})},c={success:function(e){l(e)},error:function(e){t("There was a problem tracking views for some or all of these thumbs."),t(e),l(e)}};o.post("view_pagethumb",s,c)}}};return AboutMe.on("user:view",function(e,i){try{r.viewthumb(e.get("user_name"),document.location.href,i.source)}catch(n){t.error("Invalid data passed to user:view event",e,i)}}),r}),function(e){e.fn.pagethumbs=function(t){return this.each(function(){var i=e(this);if(i.hasClass("pagethumbs")&&!i.hasClass("pagethumbs-"+t)){var n=i.attr("class").split(" ");n=_.filter(n,function(e){return!e.match(/pagethumbs-\d+/)}),i.attr("class",n.join(" ")).addClass("pagethumbs-"+t)}})}}(jQuery),define("pagethumbs",function(){}),function(e,t){function i(e){return e&&e.toLowerCase?e.toLowerCase():e}function n(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]==t)return!o;return o}var o=!1,r=null,a=parseFloat,s=Math.min,l=/(-?\d+\.?\d*)$/g,c=/(\d+\.?\d*)$/g,u=[],d=[],h=function(e){return"string"==typeof e},g=function(e,t){for(var i,n=e.length,o=n;o--;)i=n-o-1,t(e[i],i)},p=Array.prototype.indexOf||function(e){var t=this.length,i=Number(arguments[1])||0;for(i=0>i?Math.ceil(i):Math.floor(i),0>i&&(i+=t);t>i;i++)if(i in this&&this[i]===e)return i;return-1};e.tinysort={id:"TinySort",version:"1.5.6",copyright:"Copyright (c) 2008-2013 Ron Valstar",uri:"http://tinysort.sjeiti.com/",licensed:{MIT:"http://www.opensource.org/licenses/mit-license.php",GPL:"http://www.gnu.org/licenses/gpl.html"},plugin:function(){var e=function(e,t){u.push(e),d.push(t)};return e.indexOf=p,e}(),defaults:{order:"asc",attr:r,data:r,useVal:o,place:"start",returns:o,cases:o,forceStrings:o,ignoreDashes:o,sortFunction:r}},e.fn.extend({tinysort:function(){var m,f,b,v,y=this,_=[],w=[],k=[],x=[],C=0,S=[],A=[],E=function(e){g(u,function(t){t.call(t,e)})},T=function(e,t){return"string"==typeof t&&(e.cases||(t=i(t)),t=t.replace(/^\s*(.*?)\s*$/i,"$1")),t},$=function(e,t){var i=0;for(0!==C&&(C=0);0===i&&v>C;){var n=x[C],r=n.oSettings,s=r.ignoreDashes?c:l;if(E(r),r.sortFunction)i=r.sortFunction(e,t);else if("rand"==r.order)i=Math.random()<.5?1:-1;else{var u=o,p=T(r,e.s[C]),m=T(r,t.s[C]);if(!r.forceStrings){var f=h(p)?p&&p.match(s):o,b=h(m)?m&&m.match(s):o;if(f&&b){var y=p.substr(0,p.length-f[0].length),_=m.substr(0,m.length-b[0].length);y==_&&(u=!o,p=a(f[0]),m=a(b[0]))}}i=n.iAsc*(m>p?-1:p>m?1:0)}g(d,function(e){i=e.call(e,u,p,m,i)}),0===i&&C++}return i};for(m=0,b=arguments.length;b>m;m++){var M=arguments[m];h(M)?S.push(M)-1>A.length&&(A.length=S.length-1):A.push(M)>S.length&&(S.length=A.length)}for(S.length>A.length&&(A.length=S.length),v=S.length,0===v&&(v=S.length=1,A.push({})),m=0,b=v;b>m;m++){var F=S[m],R=e.extend({},e.tinysort.defaults,A[m]),j=!(!F||""===F),I=j&&":"===F[0];x.push({sFind:F,oSettings:R,bFind:j,bAttr:!(R.attr===r||""===R.attr),bData:R.data!==r,bFilter:I,$Filter:I?y.filter(F):y,fnSort:R.sortFunction,iAsc:"asc"==R.order?1:-1})}return y.each(function(i,n){var o,r=e(n),a=r.parent().get(0),s=[];for(f=0;v>f;f++){var l=x[f],c=l.bFind?l.bFilter?l.$Filter.filter(n):r.find(l.sFind):r;s.push(l.bData?c.data(l.oSettings.data):l.bAttr?c.attr(l.oSettings.attr):l.oSettings.useVal?c.val():c.text()),o===t&&(o=c)}var u=p.call(k,a);0>u&&(u=k.push(a)-1,w[u]={s:[],n:[]}),o.length>0?w[u].s.push({s:s,e:r,n:i}):w[u].n.push({e:r,n:i})}),g(w,function(e){e.s.sort($)}),g(w,function(e){var t=e.s,i=e.n,r=t.length,a=i.length,l=r+a,c=[],u=l,d=[0,0];switch(R.place){case"first":g(t,function(e){u=s(u,e.n)});break;case"org":g(t,function(e){c.push(e.n)});break;case"end":u=a;break;default:u=0}for(m=0;l>m;m++){var h=n(c,m)?!o:m>=u&&u+r>m,p=h?0:1,f=(h?t:i)[d[p]].e;f.parent().append(f),(h||!R.returns)&&_.push(f.get(0)),d[p]++}}),y.length=0,Array.prototype.push.apply(y,_),y}}),e.fn.TinySort=e.fn.Tinysort=e.fn.tsort=e.fn.tinysort}(jQuery),define("tinysort",function(){}),define("lib/pagethumb",["require","globals","backbone","marionette","model/basemodel","viewer","browser","text!template/pagethumb.html","text!template/pagethumb_actions.html","log","backbone.collectionsubset","controller/compliment_modal","controller/collect_modal","controller/mute","controller/flag","controller/admin_flag","controller/thumb_regen","controller/thumbviews","pagethumbs","doTimeout","tinysort","vhide"],function(e){var t=e("globals"),i=e("backbone"),n=e("marionette"),o=e("model/basemodel"),r=e("viewer"),a=e("browser"),s=e("text!template/pagethumb.html"),l=e("text!template/pagethumb_actions.html"),c=e("log");e("backbone.collectionsubset"),e("controller/compliment_modal"),e("controller/collect_modal"),e("controller/mute"),e("controller/flag"),e("controller/admin_flag"),e("controller/thumb_regen"),e("controller/thumbviews"),e("pagethumbs"),e("doTimeout"),e("tinysort"),e("vhide"),c.module("lib/pagethumb");var u=c.create("pagethumb"),d={};d.Settings=o.extend({defaults:{primary_actions_style:"buttons",show_data:!0,show_tooltip:!0,linked:!0,target:"",fallback:"silhouette",track_views:!0,reload_image_on_resize:!0,actions:[]}}),d.FakeModel=o.extend({defaults:{href:"",display_name:"",img_src:""}}),d.ItemView=n.ItemView.extend({tagName:"div",className:"pagethumb",template:_.template(s),loaded:!1,templateHelpers:{},initialize:function(e){_.bindAll(this,"checkSize","detectSize","loadImage","imageLoaded","loadImageFallback","imageFallbackLoaded","imageFallbackFailed","getHref"),e.settings instanceof d.Settings||(e.settings=new d.Settings(e.settings)),this.settings=e.settings,this.model.set("href",this.getHref),this.on("show",this.deferLoadImage),this.on("show",this.triggerViewNotification),this.listenTo(this.settings,"change:show_data",this.render),this.listenTo(this.settings,"change:size",this.onSizeChange),this.listenTo(r.model,"change:admin",this.render),this.settings.get("reload_image_on_resize")&&($(window).on("resize."+this.cid,_.debounce(this.detectSize,2e3)),this.on("destroy",function(){$(window).off("resize."+this.cid)})),this.$el.data("cid",this.model.cid)},onEvent:function(e){u("pagethumb event",e)},onSettingsEvent:function(e){u("pagethumb settings event",e)},validateActions:function(){var e=this.settings.get("actions");_.isFunction(e)&&(e=e(this.model)),this.valid_actions=_.filter(e,this.validateAction,this)},validateAction:function(e){var t=!1;switch(e){case"admin_remove":a.isNot("touch")&&!r.isUser(this.model)&&r.is("admin")&&(t=!0);break;case"admin_flag":a.isNot("touch")&&!r.isUser(this.model)&&r.is("admin")&&(t=!0);break;case"mute":a.isNot("touch")&&!r.isUser(this.model)&&r.logged_in&&(t=!0);break;case"thumb_regen":a.isNot("touch")&&r.is("admin")&&(t=!0);break;case"remove":t=!0;break;case"compliment":r.isUser(this.model)||(t=!0);break;case"collect":t=!0}return t},ui:{img:"img.thumb",wrap:".thumbwrap"},onBeforeRender:function(){this.validateActions();var e={};e.settings=this.settings.toJSON(),e.actions={},_.each(this.valid_actions,function(t){e.actions[t]=!0},this),e.actions_template=_.template(l,_.extend({},e,this.model.toJSON())),this.templateHelpers=_.extend({},this.templateHelpers,e)},onRender:function(){this.$el.removeClass("loaded").addClass("loading")},onDestroy:function(){this.off(),this.ui.img.off("load"),this.ui.img.off("error")},triggerViewNotification:function(){var e=this.$el.closest(".ui-dialog.quickview").length?"quickview":t.PAGE;AboutMe.trigger("user:view",this.model,{source:e})},checkSize:function(){this.settings.get("size")||this.detectSize()},detectSize:function(){var e=this.settings.get("width");if(e||(e=this.ui.wrap.width&&this.ui.wrap.width()),!e)return void u("unable to determine width");var t=this.model.getThumbnailSizeForWidth(e);this.settings.set("size",t)},resetSize:function(){this.settings.set("size",null,{silent:!0}),this.checkSize()},onSizeChange:function(){var e=0,t=this.settings.get("size").split("x")[0],i=this.settings.previousAttributes().size;i&&(e=i.split("x")[0]),t>e&&this.deferLoadImage()},deferLoadImage:function(){requestAnimationFrame(this.loadImage)},loadImage:function(){if(this.ui.img.on){if(this.checkSize(),!this.settings.get("size"))return u.error("No size in settings");var e=this.getImagePath();return e?void(this.ui.img.attr("src")!==e&&(this.ui.img.on("load",this.imageLoaded),this.ui.img.on("error",this.loadImageFallback),this.ui.img.attr("src",e))):u.error("No valid image src")}},imageLoaded:function(){this.ui.img.off&&(this.ui.img.off(),this.$el.removeClass("loading").addClass("loaded"))},loadImageFallback:function(){this.getImagePath=this.getFallbackPath,this.ui.img.off("load"),this.ui.img.off("error"),this.ui.img.on("load",this.imageFallbackLoaded),this.ui.img.on("error",this.imageFallbackFailed),this.ui.img.attr("src",this.getFallbackPath()),this.$el.addClass("missing")},imageFallbackLoaded:function(){$.doTimeout(500,this.imageLoaded)},imageFallbackFailed:function(){u.error("imageFallbackLoaded"),this.imageLoaded()},getImagePath:function(){var e=this.settings.get("size");if(!e)return null;var t=this.model.getThumbnailUrl(e),i=this.settings.get("getImagePath");return _.isFunction(i)?i.apply(this,[t]):t},getFallbackPath:function(){var e=this.settings.get("size");return e?t.STATIC_HOSTNAME+"/images/directory/"+this.settings.get("fallback")+"-"+e+".png":null},getHref:function(){return this.options.href||this.settings.get("href")||t.DOMAIN_NAME_URL+"/"+this.model.get("user_name")},events:{"click .actions":"actionPreventDefault","click .action.compliment":"actionCompliment","click .action.collect":"actionCollect","click .action.mute":"actionMute","click .action.admin_flag":"actionAdminFlag","click .action.thumb_regen":"actionThumbRegen"},actionPreventDefault:function(e){e&&e.preventDefault&&e.preventDefault()},actionCompliment:function(e){e.preventDefault(),AboutMe.trigger("user:compliment:ui",this.model)},actionCollect:function(e){e.preventDefault(),AboutMe.trigger("user:collect:ui",this.model)},actionMute:function(e){e.preventDefault(),AboutMe.trigger("user:mute:ui",this.model)},actionAdminFlag:function(e){e.preventDefault(),AboutMe.trigger("admin:flag:ui",this.model)},actionThumbRegen:function(e){e.preventDefault(),AboutMe.trigger("user:thumb_regen",this.model)}}),d.FakeView=n.ItemView.extend({tagName:"div",className:"pagethumb",template:_.template(s),initialize:function(e){e.settings instanceof d.Settings||(e.settings=new d.Settings(e.settings)),this.settings=e.settings,this.$el.data("cid",this.model.cid)},onBeforeRender:function(){var e={};e.settings=this.settings.toJSON(),this.templateHelpers=_.extend({},this.templateHelpers,e)}}),d.ListView=n.CollectionView.extend({childView:d.ItemView,getChildView:function(e){return e instanceof d.FakeModel?d.FakeView:this.childView},defaults:{responsive:!0,quickview:{title:"Similar Pages"}},thumb_defaults:{reload_image_on_resize:!1},initialize:function(e){n.CollectionView.prototype.initialize.apply(this,arguments),this.options=_.extend({},this.defaults,e),this.$el.addClass("pagethumbs"),this.options.className&&this.$el.addClass(this.options.className),this.options.responsive&&this.$el.addClass("pagethumbs-responsive"),this.options.quickview&&this.$el.addClass("quickview"),this.settings=_.extend({},this.thumb_defaults,e.thumb_settings),this.settings=new d.Settings(this.settings),this.childViewOptions={},this.childViewOptions.settings=this.settings,this.listenTo(AboutMe,"user:flag:success user:mute:success admin:flag:success",function(e){this.collection.remove(e)},this),_.bindAll(this,"detectSize"),$(window).on("resize",_.debounce(this.detectSize,2e3))},detectSize:function(){var e=this.children.first();e&&e.detectSize&&e.detectSize()},events:{"click .pagethumb .thumbwrap":"onClickThumb"},validateTarget:function(e){var t=$(e.target);return t.closest(".actions").length?!1:t},onClickThumb:function(t){var i=this.validateTarget(t);if(i&&this.options.quickview){var n=i.closest(".pagethumb").data("cid"),o=this.collection.get(n),r=this;o&&e(["controller/quickview"],function(){AboutMe.trigger("users:quickview",_.extend({},r.options.quickview,{initial_user:o,users:r.collection}))})}}}),d.SortedListView=d.ListView.extend({initialize:function(){d.ListView.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"sort",this.render)}}),d.PaginatedView=d.ListView.extend({page_size:96,page_size_multiplier:1,page_number:0,constructor:function(e){this.superset=e.collection,e.collection=new i.Collection,d.ListView.prototype.constructor.apply(this,arguments)},initialize:function(){d.ListView.prototype.initialize.apply(this,arguments),this.listenTo(AboutMe,"user:flag:success user:mute:success admin:flag:success",function(e){this.superset.remove(e)},this),_.bindAll(this,"addPage","clearInterval","startInterval"),this.on("render",this.paginate),this.on("paginate:complete",this.onPaginationComplete),this.listenTo(this.superset,"add remove sort",this.repaginate)},onEvent:function(e){u("PageThumb.ListView event",e)},onSupersetEvent:function(e){u("Paginated superset event",e)},onCollectionEvent:function(e){u("Paginated collection event",e)},paginate:function(){if(!this.isPaginationComplete){this.$el.addClass("paginating"),$(".structure.footer").vhide(),this.startInterval();var e=this;$(window).on("scroll."+this.cid,function(){e.clearInterval(),$.doTimeout("restart_interval",500,function(){e.startInterval(),e.addPage()})}),this.addPage()}},repaginate:function(){this.isPaginationComplete=!1,this.destroyChildren(),this.collection.stopListening(),this.page_size_multiplier=1,this.page_number=0,this.collection.reset()},clearInterval:function(){clearInterval(this.add_page_interval)},startInterval:function(){this.isPaginationComplete||(u("start interval"),clearInterval(this.add_page_interval),this.add_page_interval=setInterval(this.addPage,2e3))},addPage:function(){if(!this.isPaginationComplete){var e=this.page_size*this.page_size_multiplier*this.page_number;this.page_number++;var t=this.page_size*this.page_size_multiplier*this.page_number,i=this.superset.slice(e,t);u("addPage",i.length),i.length?(u.time("addPage"),this.startBuffering(),this.collection.add(i),this.endBuffering(),u.timeEnd("addPage"),this.collection.length===this.superset.length&&this.trigger("paginate:complete")):this.trigger("paginate:complete")
}},onPaginationComplete:function(){u("pagination complete"),this.isPaginationComplete=!0,this.teardownPagination(),this.stopListening(this.superset),this.listenTo(this.superset,"sort",this.onSupersetSort),this.collection.comparator=this.superset.comparator,this.collection.listenTo(this.superset,"add",this.collection.add),this.collection.listenTo(this.superset,"remove",this.collection.remove),this.listenTo(this.collection,"sort",this.sortNodes)},teardownPagination:function(){this.off("render",this.paginate),this.off("paginate:complete"),this.$el.removeClass("paginating"),$(window).off("scroll."+this.cid),this.clearInterval(),$(".structure.footer").vshow()},onSupersetSort:function(){this.collection.comparator=this.superset.comparator,this.collection.sort()},sortNodes:function(){u.time("read/write index"),this.children.each(function(e){e.$el.attr("data-index",this.collection.indexOf(e.model))},this),u.timeEnd("read/write index"),u.time("sort on index"),this.$el.children().tinysort({attr:"data-index"}),u.timeEnd("sort on index")},onDestroy:function(){this.teardownPagination()},appendHtml:function(e,t,i){if(e.isBuffering)e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t);else{var n=e.childViewContainer?e.$(e.childViewContainer):e.$el,o=n.children();o.size()<=i?n.append(t.el):o.eq(i).before(t.el)}}});var h=!1;return d.MosaicView=n.CollectionView.extend({childView:d.ItemView,defaults:{auto_flip:!0,num_thumbs:5},thumb_defaults:{linked:!1,show_data:!1,reload_image_on_resize:!1},constructor:function(e){this.options=_.extend({},this.defaults,e),this.superset=e.collection,this.subset=new i.CollectionSubset({parent:this.superset,filter:_.bind(function(e){return this.superset.indexOf(e)<this.options.num_thumbs},this)}),this.subset.listenTo(this.superset,"add remove sort",this.subset.refresh,this),e.collection=this.subset.child,n.CollectionView.prototype.constructor.apply(this,arguments)},_initialEvents:function(){},initialize:function(e){this.$el.addClass("pagethumbs mosaic"),this.options.auto_flip&&(h&&this.$el.addClass("flipped"),h=h?!1:!0),this.childViewOptions={},this.childViewOptions.settings=_.extend({},this.thumb_defaults,e.thumb_settings),this.listenTo(this.collection,"refresh",this.render,this),this.listenTo(this.collection,"render",this.checkState),this.on("render",this.checkState),_.bindAll(this,"detectSize"),$(window).on("resize",_.debounce(this.detectSize,2e3))},checkState:function(){this.$el.pagethumbs(this.collection.length)},detectSize:function(){this.children.each(function(e){e.detectSize()})}}),d}),define("text!template/pagethumb_search.html",[],function(){return'<div class="thumbwrap">\n	<a href="/[[ data.user_name ]]" class="thumb_link" <: if (data.settings.target) { :> target="[[ data.settings.target ]]"<: } :>><img class="thumb thumb_full" /></a>\n	<div class="thumb_overlay">\n		<span class="thumb_details">\n			<span class="thumb_description">\n				<a href="/[[ data.user_name ]]">{{ data.display_name }}</a>\n				<: if (data.tags && data.tags.length) { :>\n					<span class="interests tags">\n						<: _.each(data.tags, function(tag,i) { :>\n						<:	var divider = \',&nbsp;\';\n							if (i == (data.tags.length - 1)) divider = \'\';\n							var link = \'<a href="/search/keyword:\'+encodeURIComponent(tag.toLowerCase())+\'">\'+tag+\'</a>\'+divider; :>\n						[[ link ]]\n						<: }); :>\n					</span>\n				<: } else if (\'pagethumb_search.html\') { :>\n					<span class="interests">{{ data.headline }}</span>\n				<: } :>\n			</span>\n		</span>\n	</div>\n	[[ data.actions_template ]]\n</div>\n'}),define("text!template/below_groups.html",[],function(){return'<script type="text/template" id="groups-template">\n	<h1 class="below-groups-heading">My Collections</h1>\n	<div id="below-groups-content"></div>\n	<div id="below-groups-more"></div>\n</script>\n\n<script type="text/template" id="groups-more-template">\n	<a href="/[[ data.owner ]]/collections/">See All My Collections</a>\n</script>\n\n<script type="text/template" id="group-template">\n	<div class="group-nav">\n		<span class="group-prev group-nav-item glyph-angle-thin-left glyph-center disabled"></span>\n		<span class="group-next group-nav-item glyph-angle-thin-right glyph-center"></span>\n	</div>\n	<div class="group-heading"></div>\n	<div class="group-thumbs pagethumbs-sidescroll-wrap"></div>\n</script>\n\n<script type="text/template" id="group-heading-template">\n	<a href="/[[ data.owner ]]/collections/[[ data.name ]]">{{ data.display }}</a>\n</script>\n\n<script type="text/template" id="group-more-template">\n	<a href="/[[ data.owner ]]/collections/[[ data.name ]]" class="thumbwrap">View all {{ data.total }} people</a>\n</script>\n'}),define("controller/below_groups",["require","globals","marionette","log","viewer","data/user","lib/event","controller/belowthefold","editmode","lib/metrics","list/grouplist","model/group","lib/pagethumb","text!template/pagethumb_search.html","text!template/below_groups.html"],function(e){var t=(e("globals"),e("marionette")),i=e("log"),n=(e("viewer"),e("data/user")),o=e("lib/event"),r=e("controller/belowthefold"),a=(e("editmode"),e("lib/metrics"),e("list/grouplist")),s=(e("model/group"),e("lib/pagethumb")),l=e("text!template/pagethumb_search.html"),c=e("text!template/below_groups.html");i.module("controller/below_groups");{var u,d,h=(i.create("below groups","background-color:#0f744a;color:white"),new(Backbone.Marionette.LayoutView.extend({className:"below-groups clearfix",template:_.template($(c).filter("#groups-template").html()),regions:{contentRegion:"#below-groups-content",moreRegion:"#below-groups-more"}}))),g=t.Controller.extend({initialize:function(e){this.data=e,_.bindAll(this,"showGroups"),r.containers.groups.containerContent.show(h),u=new a(e.owner_name,{public_only:!0,limit:5}),u.when("ready",function(){u.length?(o.trigger("below_groups_ready"),u.comparator=function(e){return-e.memberlist.length},u.sort(),this.showGroups()):o.trigger("below_groups_empty",["groups"])},this)},showGroups:function(){if(!h.$el.is(":visible"))return void this.showGroups();if(d=new w({collection:u}),h.contentRegion.show(d),u.options.orig_count>u.length){var e=new v({owner:this.data.owner_name});h.moreRegion.show(e)}}}),p=t.ItemView.extend({tagName:"h2",template:_.template($(c).filter("#group-heading-template").html())}),m=s.ItemView.extend({className:"pagethumb2 pagethumb2-nameonly",template:_.template(l)}),f=s.ListView.extend({className:"pagethumbs pagethumbs2 pagethumbs-sidescroll group-members",childView:m,onShow:function(){if(this.options.data.original_number_of_users>this.collection.length){var e=new y({owner:this.options.data.owner,name:this.options.data.name,total:this.options.data.original_number_of_users});this.$el.append(e.el),e.render()}}}),b=t.LayoutView.extend({className:"group",regions:{headingRegion:".group-heading",thumbsRegion:".group-thumbs"},ui:{prevButton:".group-prev",nextButton:".group-next"},events:{"click @ui.prevButton":"scrollPrev","click @ui.nextButton":"scrollNext"},template:_.template($(c).filter("#group-template").html()),initialize:function(){_.bindAll(this,"setNavButtons")},onShow:function(){var e=this;this.headingview=new p({model:this.model}),this.headingRegion.show(this.headingview);var t=25,i=this.model.get("memberlist").length,n=new Backbone.Collection(this.model.get("memberlist").first(t));this.thumblistview=new f({collection:n,quickview:!1,responsive:!1,data:{owner:this.model.get("owner"),name:this.model.get("name"),original_number_of_users:i},thumb_settings:{target:"_blank",primary_actions_style:"icons",actions:["compliment","collect","mute","admin_flag","thumb_regen"]}}),this.thumbsRegion.show(this.thumblistview),this.setupNavDims(),$(window).on("resize orientationchange",function(){e.setupNavDims()}),this.thumblistview.$el.on("scroll",this.setNavButtons)},setupNavDims:function(){var e=this;e.overall_width=-20,this.thumblistview.$el.find(".pagethumb2").each(function(){e.overall_width+=$(this).outerWidth(!0)}),this.setNavButtons()},scrollPrev:function(){var e=this.thumblistview.$el,t=e.closest(".pagethumbs-sidescroll-wrap");e.scrollLeft()<=0||e.animate({scrollLeft:"-="+t.width()},500,"easeInOutQuad")},scrollNext:function(){var e=this.thumblistview.$el,t=e.closest(".pagethumbs-sidescroll-wrap");e.scrollLeft()>=this.overall_width-t.width()||e.animate({scrollLeft:"+="+t.width()},500,"easeInOutQuad")},setNavButtons:function(){var e=this.thumblistview.$el,t=e.closest(".pagethumbs-sidescroll-wrap");this.ui.nextButton.removeClass("disabled"),this.ui.prevButton.removeClass("disabled"),(e.scrollLeft()>=this.overall_width-t.width()||this.overall_width<=t.width())&&this.ui.nextButton.addClass("disabled"),e.scrollLeft()<=0&&this.ui.prevButton.addClass("disabled")}}),v=t.ItemView.extend({template:_.template($(c).filter("#groups-more-template").html()),templateHelpers:function(){return{owner:this.options.owner}}}),y=t.ItemView.extend({className:"pagethumb2 pagethumb2-morelink",template:_.template($(c).filter("#group-more-template").html()),templateHelpers:function(){return{owner:this.options.owner,name:this.options.name,total:this.options.total}}}),w=t.CollectionView.extend({className:"groups",childView:b});new g({owner_name:n.Settings.user_name})}}),define("controller/tooltips",["require","viewport","lib/utils","log"],function(e){var t=e("viewport"),i=e("lib/utils"),n=e("log");n.module("controller/tooltips");var o=n,r={init:function(e){var t=[];$.each(e,function(e,i){$.browser.msie&&parseInt($.browser.version)<=8?i.showInIE!==!1&&t.push(i):t.push(i)}),$.each(t,function(e,t){t.tour=!0,r.tips[e]=t,r.tips[e].ID=e,$(t.attachTo).tooltip(r.tips[e]),$.each(t.tours,function(t,i){r.tours[i]||(r.tours[i]=[]),r.tours[i].push(e)})})},start:function(e){r.currentTour=e,r.tips[r.tours[e][0]].open()},cancel:function(e){r.tours[e]&&r.tours[e].length&&(r.tours[e]=[]),$(".tooltip.tour").remove()},tips:[],tours:{}},a=function(e,t){var i=this;i.node=$(e),"string"==typeof t&&(t={content:t}),i.o=$.extend({focusAttachTo:!1,scrollTo:!1,appendToBody:!1,content:"This is a tooltip!",moreOn:"none",color:"blue",tour:!1,target:i.node,showInIE:!0,arrow:"none",showCloseX:!0,bigSize:!1,modal:!1,hoverEngage:!1,moreText:"Next",closeText:null,revealDirection:"default",customClass:"",beforeOpen:function(){},afterOpen:function(){},afterMore:function(){},afterClose:function(){}},t),i.init()};return a.prototype={init:function(){var e=this,t=r.tips,i="",n=e.o.tour?"tour":"";e.o.bigSize&&(i=" big"),e.container=$('<div class="tooltip '+e.o.color+i+" "+n+'"/>').hide(),e.header=$('<div class="tooltip-header" />'),e.toggle=$('<span class="tooltip-close glyph-close glyph-center" />'),e.o.scrollTo&&(this.origScrollTop=$(window).scrollTop()),t[e.o.ID]=e,e.create()},create:function(){var e=this;if(e.header.prependTo(e.container),e.o.showCloseX&&(e.toggle.appendTo(e.header),e.container.addClass("hasclose")),e.o.customClass.length&&e.container.addClass(e.o.customClass),"none"!==e.o.arrow&&e.container.addClass(e.o.arrow+" arrow"),e.styleCalc=function(){var t=$(e.o.attachTo),i=$.extend({left:t.offset().left+t.width()/2-e.container.width()/2,top:t.offset().top+t.height()+5},e.o.style);return i},e.o.appendToBody?(e.container.appendTo("body"),e.o.originalStyles=_.clone(e.o.style)||{}):e.container.appendTo($(e.o.attachTo)),e.container.prepend('<div class="tooltip-content">'+e.o.content+"</div>"),e.o.style&&!e.o.tiny){var t=e.styleCalc()||e.o.style;e.container.css(t)}else e.o.style&&e.o.tiny&&(e.o.targetHover?e.container.css(e.o.style):e.container.closest(".tinytip-info").css(e.o.style));if(!e.o.contextual){e.container.addClass("hascount");var i='<span class="count">';i+='<span class="thiscount"></span> of <span class="totalcount"></span>',i+="</span>",e.container.prepend(i)}if(e.o.moreText||e.o.closeText){var n='<div class="buttons">',o=e.o.bigSize?" large ":" ";e.o.moreText&&(n+='<span class="button'+o+'more-button">'+e.o.moreText+"</span>"),e.o.closeText&&(n+='<span class="'+o+'close-button">'+e.o.closeText+"</span>"),n+="</div>",n=$(n),n.appendTo(e.container.find(".tooltip-content")),e.toggle.add(e.container.find(".close-button")).on("click",function(t){t.stopPropagation(),e.close(t)})}e.o.hoverEngage===!0&&e.o.target.on({"mouseenter.tooltip":function(){$.doTimeout(e.o.name,200,function(t){e.showing||(e.showing=!0,e.open(t))})},"mouseleave.tooltip":function(){$.doTimeout(e.o.name,10,function(t){e.showing&&(e.showing=!1,e.close(t))})}})},open:function(e){var n=this,a=r.tours[r.currentTour],s=$.inArray(n.o.ID,r.tours[r.currentTour]);$.each(r.tips,function(e,t){"none"!==t.o.moreOn&&t.o.target.off(t.o.moreOn),t.container.hide()}),"none"!==n.o.moreOn&&n.o.target.on(n.o.moreOn,function(e){n.more(e)}),n.container.find(".more-button").on("click.tooltipmore",function(e){return n.more(e),!1}),a&&(-1!==s&&(n.container.find(".thiscount").text(s+1),n.container.find(".totalcount").text(a.length)),s===a.length-1&&n.container.find(".more-button").text("Finish")),n.o.beforeOpen(e),n.o.modal&&$('<div class="ui-widget-overlay" style="z-index:999"></div>').appendTo("body"),n.o.style&&!n.o.tiny?n.container.css(n.o.style):n.o.style&&n.o.tiny&&n.container.closest(".tinytip-info").css(n.o.style);var l=n.o.scrollTo?500:0;_.delay(function(){if(n.o.originalStyles){var e=n.styleCalc()||n.o.style;n.container.stop().css(e)}if(n.o.scrollTo){var i=$(n.o.attachTo),o=i.offset().top,r=o+i.height()+50,a=parseInt(n.container.css("top")),s=a+n.container.height()+50,l=$(window).scrollTop()+100,c=$(window).height(),u=l+c,d=s-c,h=a-c/2;if(a=Math.min(a,o),s=Math.max(s,r),l>a||s>u){var g=300,p=t.is("small")?d:h;$("body,html").stop().animate({scrollTop:p},g)}}var m;switch(n.o.revealDirection){case"down":m=parseInt(n.container.css("top")),n.container.stop().css({top:m-10,opacity:.3}).show().animate({top:m,opacity:1},250);break;case"up":m=parseInt(n.container.css("top")),n.container.stop().css({top:m+10,opacity:.3}).show().animate({top:m,opacity:1},250);break;case"left":m=parseInt(n.container.css("left")),n.container.stop().css({left:m+10,opacity:.3}).show().animate({left:m,opacity:1},250);break;case"right":m=parseInt(n.container.css("left")),n.container.stop().css({left:m-10,opacity:.3}).show().animate({left:m,opacity:1},250);break;default:n.container.stop().fadeIn(250)}},l),n.o.focusAttachTo&&(_.isString(n.o.focusAttachTo)?(o("focusAttachTo",n.o.focusAttachTo),$(n.o.focusAttachTo).focus()):$(n.o.attachTo).focus()),$(window).on("keyup.checktipreturn",function(e){e=i.getEvent(e);var t=i.getKeyCode(e);13===t||9===t?(e.preventDefault(),n.container.is(":visible")&&n.container.find(".more-button").click()):27===t&&n.close(e)}),n.o.afterOpen(e)},more:function(e){var t=this,i=r.tours[r.currentTour],n=$.inArray(t.o.ID,r.tours[r.currentTour]);t.o.modal&&$(".ui-widget-overlay").remove(),t.container.stop().fadeOut(1e3,function(){t.container.hide()}),i&&i.length>n+1&&-1!==n&&r.tips[r.tours[r.currentTour][n+1]].open(),i&&n===i.length-1&&(r.showing=!1,t.o.scrollTo&&$("body,document").stop().animate({scrollTop:t.origScrollTop},1e3),$(window).off("keyup.checktipreturn")),"none"!==t.o.moreOn&&t.o.target.off(t.o.moreOn),t.o.afterMore(e)},close:function(e){var t=this,i=r.tips;t.o.modal&&$(".ui-widget-overlay").remove(),t.o.contextual?t.container.stop().fadeOut(100,function(){t.container.hide()}):$.each(i,function(e,i){"none"!==i.o.moreOn&&i.o.target.off(i.o.moreOn),t.container.stop().hide()}),$(window).off("keyup.checktipreturn"),t.o&&t.o.afterClose(e)}},$.fn.tooltip=function(e){return this.each(function(){$(this).data("tooltip",new a(this,e))})},$.fn.tinytip=function(e){e=$.extend({tiny:!0,color:"tiny",contextual:!0,hoverEngage:!0,moreText:null,showCloseX:!1,targetHover:!1},e),$(e.attachTo).length&&!$("#"+e.name).length&&(e.targetHover?$(e.attachTo).tooltip(e):($(e.attachTo).append('<span class="tinytip-info" id="'+e.name+'">&nbsp;</span>'),e.attachTo="#"+e.name,$(e.attachTo).tooltip(e)))},r}),define("lib/backstory_quotes",["require"],function(){return["A leader must be inspired by the people before a leader can inspire the people.\n Simon Sinek","A man who wants to lead the orchestra must turn his back on the crowd.\n Max Lucado","A star wants to see himself rise to the top. A leader wants to see those around him rise to the top.\n Simon Sinek","All our dreams can come true, if we have the courage to pursue them.\n Walt Disney","Believe and act as if it were impossible to fail.\n Charles Kettering","Believe you can and youre halfway there.\n Theodore Roosevelt","Challenges are what make life interesting and overcoming them is what makes life meaningful.\n Joshua J. Marine","Change your thoughts and you change your world.\n Norman Vincent Peale","Courage is resistance to fear, mastery of fearnot absense of fear.\n Mark Twain","Definiteness of purpose is the starting point of all achievement.\n W. Clement Stone","Do one thing every day that scares you.\n Eleanor Roosevelt","Dont count the days, make the days count.\n Muhammad Ali","Dont find fault, find a remedy.\n Henry Ford","Dream big and dare to fail.\n Norman Vaughan","Eighty percent of success is showing up.\n Woody Allen","Either you run the day, or the day runs you.\n Jim Rohn","Even if youre on the right track, youll get run over if you just sit there.\n Will Rogers","Every moment is a fresh beginning.\n T.S. Eliot","Every strike brings me closer to the next home run.\n Babe Ruth","Fall seven times and stand up eight.\n Japanese Proverb","Fortune sides with him who dares.\n Virgil","Go confidently in the direction of your dreams.  Live the life you have imagined.\n Henry David Thoreau","I am not a product of my circumstances. I am a product of my decisions.\n Stephen Covey","I attribute my success to this: I never gave or took any excuse.\n Florence Nightingale","I find that the harder I work, the more luck I seem to have.\n Thomas Jefferson","If the wind will not serve, take to the oars.\n Latin Proverb","If you can dream it, you can achieve it.\n Zig Ziglar","If you want to achieve excellence, you can get there today. As of this second, quit doing less-than-excellent work.\n Thomas J. Watson","If you want to build a ship, dont drum up people to collect wood, and dont assign them tasks and work, but rather teach them to long for the endless immensity of the sea.\n Antoine de Saint-Exupry","If your actions inspire others to dream more, learn more, do more and become more, you are a leader.\n John Quincy Adams","If youre offered a seat on a rocket ship, dont ask what seat! Just get on.\n Sheryl Sandberg","Innovation distinguishes between a leader and a follower.\n Steve Jobs","Its not the years in your life that count. Its the life in your years.\n Abraham Lincoln","Im a great believer in luck, and I find the harder I work, the more I have of it.\n Thomas Jefferson","Keep your face to the sunshine and you can never see the shadow.\n Helen Keller","Leaders dont force people to followthey invite them on a journey.\n Charles S. Lauer","Leaders must be close enough to relate to others, but far enough ahead to motivate them.\n John Maxwell","Leadership is intentional influence.\n Michael McKinney","Leadership is the art of getting someone else to do something you want done because he wants to do it.\n Dwight D. Eisenhower","Leadership is the capacity to translate vision into reality.\n Warren Bennis","Life is 10% what happens to me and 90% of how I react to it.\n Charles Swindoll","Life is not about finding yourself. Life is about creating yourself.\n Lolly Daskal","Life isnt about getting and having, its about giving and being.\n Kevin Kruse","Make each day your masterpiece.\n John Wooden","Management is efficiency in climbing the ladder of success; leadership determines whether the ladder is leaning against the right wall.\n Stephen R. Covey","Nothing is impossible, the word itself says, Im possible!\n Audrey Hepburn","Nothing will work unless you do.\n Maya Angelou","Once you choose hope, anythings possible.\n Christopher Reeve","Only those who dare to fail greatly can ever achieve greatly.\n Robert F. Kennedy","Opportunities dont often come along. So, when they do, you have to grab them.\n Audrey Hepburn","People ask the difference between a leader and a boss. The leader leads, and the boss drives.\n Theodore Roosevelt","People don't buy what you do; they buy why you do it. And what you do simply proves what you believe.\n Simon Sinek","People who are unable to motivate themselves must be content with mediocrity, no matter how impressive their other talents.\n Andrew Carnegie","Practice isn't the thing you do once you're good. It's the thing you do that makes you good.\n Malcolm Gladwell","Start where you are. Use what you have.  Do what you can.\n Arthur Ashe","Strive not to be a success, but rather to be of value.\n Albert Einstein","Success consists of going from failure to failure without loss of enthusiasm.\n Winston Churchill","Success doesnt come to you, you go to it.\n Marva Collins","Success is going from failure to failure without losing your enthusiasm.\n Winston Churchill","Success is liking yourself, liking what you do, and liking how you do it.\n Maya Angelou","Success is the sum of small efforts, repeated day-in and day-out.\n Robert Collier","Successful leaders see the opportunities in every difficulty rather than the difficulty in every opportunity.\n Reed Markham","The best dreams happen when youre awake.\n Cherie Gilderbloom","The best way out is always through.\n Robert Frost","The definition of insanity is doing the same thing over and over and expecting different results.\n Benjamin Franklin","The difference between ordinary and extraordinary is that little extra.\n Jimmy Johnson","The future belongs to those who believe in the beauty of their dreams.\n Eleanor Roosevelt","The journey of a thousand miles begins with one step.\n Lao Tzu","The mind is everything. What you think you become.\n Buddha","The most difficult thing is the decision to act, the rest is merely tenacity.\n Amelia Earhart","The only person you are destined to become is the person you decide to be.\n Ralph Waldo Emerson","The only place success comes before work is in the dictionary.\n Vince Lombardi","The only way to do great work is to love what you do.\n Steve Jobs","The power of imagination makes us infinite.\n John Muir","The question isnt who is going to let me; its who is going to stop me.\n Ayn Rand","The starting point of all achievement is desire.\n Napolean Hill","The task of the leader is to get his people from where they are to where they have not been.\n Henry Kissinger","The tipping point is that magic moment when an idea, trend, or social behavior crosses a threshold, tips, and spreads like wildfire.\n Malcolm Gladwell","The two most important days in your life are the day you are born and the day you find out why.\n Mark Twain","There are no traffic jams along the extra mile.\n Roger Staubach","There is no chance, no destiny, no fate, that can hinder or control the firm resolve of a determined soul.\n Ella Wheeler Wilcox","There is no sale without the story; no knockout without the setup.\n Gary Vaynerchuk","There is only one success: to be able to spend your life in your own way.\n Christopher Morley","Those who do not learn from history are doomed to repeat it.\n George Santayana","To accomplish great things, we must not only act, but also dream, not only plan, but also believe.\n Anatole France","Tough times never last, but tough people do.\n Dr. Robert Schuller","Try not to become a man of success. Rather become a man of value.\n Albert Einstein","Two roads diverged in a wood, and II took the one less traveled by, and that has made all the difference.\n Robert Frost","What you do speaks so loudly that I cannot hear what you say.\n Ralph Waldo Emerson","Whatever the mind of man can conceive and believe, it can achieve.\n Napoleon Hill","Winning isnt everything, but wanting to win is.\n Vince Lombardi","Without ambition one starts nothing. Without work one finishes nothing. The prize will not be sent to you. You have to win it.\n Ralph Waldo Emerson","You cant use up creativity.  The more you use, the more you have.\n Maya Angelou","You dont lead by pointing and telling people some place to go. You lead by going to that place and making a case.\n Ken Kesey","You have to accept whatever comes, and the only important thing is that you meet it with the best you have to give.\n Eleanor Roosevelt","You miss 100% of the shots you dont take.\n Wayne Gretzky","You must be the change you wish to see in the world.\n Gandhi","You must expect great things of yourself before you can do them.\n Michael Jordan","You must not only aim right, but draw the bow with all your might.\n Henry David Thoreau","Your time is limited, so dont waste it living someone elses life.\n Steve Jobs"]}),define("text!template/below_backstory.html",[],function(){return'<!-- backstory template -->\n<script type="text/template" id="backstory-template">\n<: var editclass = (data.editmode) ? \'editing\' : \'\'; :>\n<article class="{{editclass}}">\n	<: if (! data.editmode) { :>\n	<section class="backstory-no-content invisible">\n		<p>You have not entered any information in your Backstory, or all your Backstory sections are disabled. <a href="#" class="backstory-edit">Return to edit mode</a>.</p>\n	</section>\n	<: } :>\n	<: var visible_class = (data.editmode || data.heading.length) ? \'\' : \' invisible\';\n		if (data.editmode || data._visible.heading) { :>\n		<header class="row columns-12 resume-heading backstory-parent{{visible_class}}">\n			<: if (data.editmode) {\n				var check = data._visible.heading ? \'checked\' : \'\';\n			:>\n				<div class="item-toggle section-toggle">\n					<input type="checkbox" id="backstory-visible-heading" class="backstory-edit-visibility" {{check}} />\n					<label for="backstory-visible-heading" class="glyph-check-after" title="Show this section to your page visitors">Show this section</label>\n				</div>\n			<: } :>\n			<div class="column colspan-3">&nbsp;</div>\n			<div class="column colspan-6">\n				<h1>\n					<: if (data.editmode) { :>\n					<span class="glyph-center glyph-shuffle backstory-heading-shuffle">&nbsp;</span>\n					<: } :>\n					<span class="backstory-heading" id="backstory-heading">{{ data.heading }}</span>\n				</h1>\n				<: if (data.editmode) { :>\n					<p class="backstory-edit-help">Enter your professional objective, an inspirational quote, your philosophy, or a mission statement.</p>\n				<: } :>\n				<: if (data.contact && ! data.editmode) { :>\n				<span class="button dark transparent large emailme_button backstory-contact" data-show_phone="true">Contact Me</span>\n				<: } :>\n				<: if (data.editmode) {\n					var check = data.contact ? \'checked\' : \'\';\n				:>\n				<div class="item-toggle backstory-contact-toggle">\n					<input type="checkbox" id="backstory-visible-contact" class="backstory-contact-visibility" {{check}} />\n					<label for="backstory-visible-contact" class="glyph-check-after" title="Show \'Contact Me\' button to your visitors">Show Contact Me Button</label>\n				</div>\n				<: } :>\n\n			</div>\n			<div class="column colspan-3">&nbsp;</div>\n		</header>\n	<: } :>\n\n	<: if (data.editmode || data._visible.history) { :>\n		<section class="resume-history clearfix">\n			<: if (data.editmode) {\n				var check = data._visible.history ? \'checked\' : \'\';\n			:>\n				<div class="item-toggle section-toggle">\n					<input type="checkbox" id="backstory-visible-history" class="backstory-edit-visibility" {{check}} />\n					<label for="backstory-visible-history" class="glyph-check-after" title="Show this section to your page visitors">Show this section</label>\n				</div>\n			<: } :>\n			<div class="backstory-history-left backstory-parent">\n				<: var visible_class = (data.editmode || data.current_role.length || data.current_role_org.length || data.current_role_date.length || data.current_role_descrip.length) ? \'\' : \' invisible\'; :>\n				<div class="backstory-history-section-current backstory-parent{{visible_class}}">\n					<h3>Current Role</h3>\n					<h2 class="resume-current-position" id="backstory-current_role">{{ data.current_role }}</h2>\n					<span class="resume-current-org" id="backstory-current_role_org">{{ data.current_role_org }}</span>\n					<span class="resume-current-time" id="backstory-current_role_date">{{ data.current_role_date }}</span>\n					<span class="resume-current-descrip" id="backstory-current_role_descrip">{{ data.current_role_descrip }}</span>\n				</div>\n				<div class="backstory-history-section-work backstory-parent-work backstory-parent">\n					<h3>Work History</h3>\n					<div class="backstory-work"></div>\n				</div>\n			</div>\n			<div class="backstory-history-section-skills backstory-parent">\n				<div class="backstory-parent-skills backstory-parent">\n					<h3>Skills &amp; Expertise</h3>\n					<div class="backstory-skills"></div>\n				</div>\n				<div class="backstory-parent-education backstory-parent">\n					<h3>Education</h3>\n					<div class="backstory-education"></div>\n				</div>\n			</div>\n		</section>\n	<: } :>\n\n	<: var visible_class = (data.editmode || data.location.length) ? \'\' : \' invisible\'; :>\n	<: if (data.editmode || data._visible.map) { :>\n		<section class="resume-map backstory-parent{{visible_class}}">\n			<: if (data.editmode) {\n				var check = data._visible.map ? \'checked\' : \'\';\n			:>\n				<div class="item-toggle section-toggle">\n					<input type="checkbox" id="backstory-visible-map" class="backstory-edit-visibility" {{check}} />\n					<label for="backstory-visible-map" class="glyph-check-after" title="Show this section to your page visitors">Show this section</label>\n				</div>\n			<: } :>\n			<div id="backstory_map" class="resume-map-container"></div>\n			<div class="backstory-map-scroll-fix"></div>\n			<div class="resume-map-overlay">\n				<span class="resume-map-label">Im looking in&hellip;</span>\n				<span class="resume-map-location" id="backstory-location">{{ data.location }}</span>\n			</div>\n		</section>\n	<: } :>\n\n	<: if (data.editmode || data._visible.links) { :>\n		<section class="resume-links backstory-parent-links backstory-parent clearfix">\n			<: if (data.editmode) {\n				var check = data._visible.links ? \'checked\' : \'\';\n			:>\n				<div class="item-toggle section-toggle">\n					<input type="checkbox" id="backstory-visible-links" class="backstory-edit-visibility" {{check}} />\n					<label for="backstory-visible-links" class="glyph-check-after" title="Show this section to your page visitors">Show this section</label>\n				</div>\n			<: } :>\n			<h3>Links To My Work</h3>\n			<: if (data.editmode) { :>\n				<p class="backstory-edit-help">e.g., Dribbble, Behance, Github, etc.</p>\n			<: } :>\n			<div class="backstory-links"></div>\n		</section>\n	<: } :>\n</script>\n\n<!-- job template -->\n<script type="text/template" id="work-template">\n	<span class="resume-job-title" data-attribute="title">{{ data.title }}</span>\n	<span class="resume-job-org" data-attribute="org">{{ data.org }}</span>\n	<span class="resume-job-date" data-attribute="date">{{ data.date }}</span>\n	<p class="resume-job-descrip" data-attribute="description">{{ data.description }}</p>\n</script>\n\n<!-- education template -->\n<script type="text/template" id="education-template">\n	<span class="resume-ed-deg" data-attribute="degree">{{ data.degree }}</span>\n	<span class="resume-ed-org" data-attribute="org">{{ data.org }}</span>\n	<span class="resume-ed-date" data-attribute="date">{{ data.date }}</span>\n</script>\n\n<!-- link template -->\n<script type="text/template" id="links-template">\n	<a href="[[ data.url ]]" class="resume-link" target="_blank">\n		<: var icon = data.icon || \'generic\'; :>\n		<span class="glyph-center resume-link-icon">&nbsp;</span>\n		<span class="resume-link-title" data-attribute="title">{{ data.title }}</span>\n	</a>\n</script>\n\n<!-- link edit template -->\n<script type="text/template" id="links-edit-template">\n	<span class="resume-link resume-edit-link">\n		<: var icon = data.icon || \'generic\'; :>\n		<span class="glyph-center resume-link-icon">&nbsp;</span>\n		<span class="resume-link-title">\n			<span class="resume-link-edit-title" data-attribute="title">{{ data.title }}</span>\n			<span class="resume-link-url" data-attribute="url">{{ data.url }}</span>\n		</span>\n	</span>\n</script>\n\n<!-- skills template -->\n<script type="text/template" id="skills-template">\n	<span class="resume-skill" data-attribute="skill">{{ data.skill }}</span>\n</script>\n\n<!-- onboarding template -->\n<script type="text/template" id="onboarding-template">\n<p>Set yourself apart professionally with Backstory, your online resume.\n	<span class="backstory-onboarding-links">\n		<span class="button large dark blue backstory-tour">Take a Tour</span>\n		<a href="#" class="backstory-cancel">I will set up my Backstory another time.</a>\n	</span>\n</p>\n</script>\n\n<script type="text/template" id="controls-template">\n	<: if (data.previewing) { :>\n		<span class="backstory-edit backstory-mode-toggle glyph-pencil">&nbsp;</span>\n	<: } else { :>\n		<span class="backstory-preview backstory-mode-toggle glyph-eye">&nbsp;</span>\n		<div class="backstory-edit-options clearfix">\n			<span class="glyph-photo glyph-center backstory-color-photo">&nbsp;</span>\n			<ul class="backstory-color-scheme">\n				<li class="backstory-color-1"></li>\n				<li class="backstory-color-2"></li>\n				<li class="backstory-color-3"></li>\n				<li class="backstory-color-4"></li>\n			</ul>\n		</div>\n	<: } :>\n</script>'
}),define("controller/below_backstory",["require","globals","marionette","log","lib/metrics","viewer","data/user","lib/event","lib/color","editmode","viewport","browser","model/basemodel","controller/belowthefold","lib/dialog","lib/utils","controller/tooltips","lib/backstory_quotes","text!template/below_backstory.html","text!template/share_banner.html","doTimeout","mapquest","jstorage"],function(e){var t=(e("globals"),e("marionette")),i=e("log"),n=e("lib/metrics"),o=e("viewer"),r=e("data/user"),a=e("lib/event"),s=e("lib/color"),l=e("editmode"),c=e("viewport"),u=e("browser"),d=e("model/basemodel"),h=e("controller/belowthefold"),g=e("lib/dialog"),p=e("lib/utils"),m=e("controller/tooltips"),f=e("lib/backstory_quotes"),b=e("text!template/below_backstory.html"),v=e("text!template/share_banner.html");e("doTimeout"),e("mapquest"),e("jstorage"),i.module("controller/backstory");var y,w,k,x=i.create("backstory","background-color:#2095f0;color:white"),C=s.getGoodColor(null,[100,100,100]),S=["work","education","links","skills"],A=["skills"],E=["current_role","current_role_org","current_role_date","current_role_descrip","location"],T={work:{title:"What was your job title?",org:"Which company?",date:"When did you work here?",description:"What were your responsibilities and achievements?"},education:{degree:"What was your degree or field of study?",org:"Which school did you attend?",date:"When did you finish?"},skills:{skill:"Enter a skill, expertise, or certification"},links:{url:"Link URL",title:"Link Title"}},M=["editmode"],F=["heading","_color"],R=d.extend({readUrl:"/n/1/user/backstory?user_name="+r.Settings.user_name,updateUrl:"/n/1/user/backstory?user_name="+r.Settings.user_name,patchUrl:"/n/1/user/backstory?user_name="+r.Settings.user_name,sync:function(e,t,i){return x("sync method",e),i=i||{},i.url||(i.url=t[e+"Url"]),Backbone.sync.call(this,e,t,i)},defaults:{id:r.Settings.user_name,_visible:{heading:!0,history:!0,map:!0,links:!0},editmode:!1,_color:C,contact:!0,heading:"",current_role:"What is your latest role?",current_role_org:"Which company?",current_role_date:"How long have you been in this role?",current_role_descrip:"What were your responsibilities and achievements?",location:"Enter a location",links:[],skills:[],work:[],education:[]},initialize:function(){this.defaults.heading=this.setHeading(),x(_.clone(this.defaults)),this.on("change",function(){var e=this,t=this.changedAttributes();t&&_.each(t,function(t,i){t!==e.previous(i)&&(e._saveCache[i]=t)}),this.throttleSave()},this)},setHeading:function(){var e=f[Math.floor(Math.random()*f.length)];return e},childSave:function(e,t){var i=y.get(t);_.isArray(i)?(e=[],y[t].each(function(i){if(_.contains(A,t))_.each(_.values(i.toJSON()),function(t){t.length&&e.push(t)});else{var n=i.toJSON();_.isEmpty(n)||e.push(n)}})):e=e.toJSON(),y.set(t,e)},_lastSavedAs:{},_saveCache:{},throttleSave:_.debounce(function(){var e=this;_.each(M,function(t){_.has(e._saveCache,t)&&delete e._saveCache[t]});var t=_.clone(this._saveCache);_.each(t,function(t,i){if(_.isString(t)){var n=y.defaults[i].slice(0,t.length),o=_.contains(F,i);t!==n||o||(e._saveCache[i]="")}e._lastSavedAs[i]===e._saveCache[i]&&delete e._saveCache[i]}),_.isEmpty(this._saveCache)||y.get("editmode")&&(this.save(this._saveCache,{patch:!0,error:function(){g.banner("There was an error saving Backstory. Please try again later.",{status:"error"})}}),this._lastSavedAs=_.clone(this.toJSON()),x("Current state on server:",this._lastSavedAs),this._saveCache={})},2e3)}),j=Backbone.Marionette.LayoutView.extend({className:"below-backstory clearfix",template:_.template($(b).filter("#backstory-template").html()),ui:{visibility:".backstory-edit-visibility",text:".backstory-edit-text",collection:".backstory-edit-collection",contact_visibility:".backstory-contact-visibility",remove:".resume-remove",shuffle_quote:".backstory-heading-shuffle",edit_mode:".backstory-edit"},events:{"change @ui.visibility":"toggleVisibility","change @ui.contact_visibility":"toggleContactVisibility","blur @ui.text":"updateText","keyup @ui.text":"updateText","paste @ui.text":"updateText","input @ui.text":"updateText","focus @ui.text":"focusText","blur @ui.collection":"updateCollection","keyup @ui.collection":"updateCollection","paste @ui.collection":"updateCollection","input @ui.collection":"updateCollection","focus @ui.collection":"focusCollection","mouseup @ui.text":"defeatMouseup","mouseup @ui.collection":"defeatMouseup","keydown @ui.text":"checkForReturn","keydown @ui.collection":"checkForReturn","click @ui.remove":"removeItem","click @ui.shuffle_quote":"clearQuote","click @ui.edit_mode":"enableEditMode"},initialize:function(){this.listenTo(y,"set:color:random",this.setRandomColor),this.listenTo(y,"set:color:photo",this.setPhotoColor),l&&this.setNavButton()},onShow:function(){var e=this;_.each(S,function(t){e.$el.find(".backstory-"+t).length&&e.addRegion(t+"Region",".backstory-"+t)}),_.each(S,function(t){e.$el.find(".backstory-"+t).length&&(e[t+"Region"].show(e[t+"View"]),y.get("editmode")&&e.setupCollectionViews(t))}),this.setColors(),y.get("editmode")&&(this.setupEditTextFields(),this.setupEditMap(),$(window).on("resize orientationchange",_.debounce(function(){m.cancel("backstory")},100)))},enableEditMode:function(e){e.preventDefault(),y.trigger("goto:editmode")},clearQuote:function(){this.$el.find(".backstory-heading").text("").trigger("keyup")},setRandomColor:function(){this.setColors("random")},setPhotoColor:function(){var e=this;_.delay(function(){e.setColors("photo")},200)},setNavButton:function(){var e=$(".topnav.structure").find(".backstory-link a");e.on("click",function(e){e.preventDefault(),a.trigger("below:scrollto",["backstory"])})},toggleVisibility:function(e){var t=$(e.target),i=t.attr("id").replace(/backstory-visible-/,"");y._visible.set(i,t.is(":checked"))},toggleContactVisibility:function(e){var t=$(e.target);y.set("contact",t.is(":checked"))},setupCollectionViews:function(e){var t=this;this[e+"View"].children.each(function(i){var n=!t.isHalfUpdated(e,i.model);i.$el.toggleClass("backstory-new-item",n)}),y.get("editmode")&&this.setupEditCollectionFields()},defeatMouseup:function(){return y.dragging?void 0:!1},checkForReturn:function(e){e=p.getEvent(e);var t=$(e.target),i=p.getKeyCode(e),n=13===i||9===i,o=e.shiftKey&&9==i;if(o||n){e.preventDefault();var r=$(".backstory-tip:visible");if(r.length)return;var a=$(".resume-editable"),s=a.index(t),l=o?a.length-1:0,c=a.eq(o?s-1:s+1);return c.length||(c=a.eq(l)),c.focus(),this.ensureVisibility(c),!1}},ensureVisibility:function(e){if(!u.is("touch")){var t=$(".backstory-tip:visible");if(!t.length){var i=e.offset().top,n=$(window).scrollTop()+$(window).height()-$(window).height()/2,o=$(window).scrollTop()+150;(i>n||o>i)&&$("body,html").stop().animate({scrollTop:i-$(window).height()/2},500)}}},focusText:function(e){var t=$(e.target),i=t.attr("id").replace(/backstory-/,""),n=t.text().trim(),o=y.defaults[i].slice(0,n.length);n===o&&p.selectElementContents(t.get(0)),this.ensureVisibility(t)},updateText:function(e){e=p.getEvent(e);var t=$(e.target),i=t.attr("id").replace(/backstory-/,""),n=t.text().trim();"paste"===e.type&&_.delay(function(){t.html(t.text())},1),n.length||("heading"===i&&(y.defaults[i]=y.setHeading()),t.html(y.defaults[i]),p.selectElementContents(t.get(0))),y.set(i,n)},focusCollection:function(e){var t=$(e.target),i=t.text().trim(),n=t.data("attribute")||null,o=t.closest(".collection-item-container")||t,r=o.data("cid"),a=o.data("collection"),s=y[a].get(r);_.contains(A,a)&&_.each(s.toJSON(),function(e,t){n=t});var l=T[a][n].slice(0,i.length);i===l&&p.selectElementContents(t.get(0)),this.ensureVisibility(t)},updateCollection:function(e){e=p.getEvent(e);var t=$(e.target),i=t.text().trim(),n=t.data("attribute")||null,o=t.closest(".collection-item-container")||t,r=o.data("cid"),a=o.data("collection"),s=y[a].get(r);"paste"===e.type&&_.delay(function(){t.html(t.text())},1),_.contains(A,a)&&_.each(s.toJSON(),function(e,t){n=t});var l=T[a][n].slice(0,i.length);if(i!==l||!i.length){if(i.length||(t.text(T[a][n]),p.selectElementContents(t.get(0))),s.validateThis){var c={};c[n]=i,s.validate(c)}else s.set(n,i);this.setNewStatus(a,s,o)}},setNewStatus:function(e,t,i){var n=!this.isHalfUpdated(e,t);i.toggleClass("backstory-new-item",n),this.removeEmpties(e,i),n||this.addNewField(e)},addNewField:function(e){var t=w[e+"View"].$el.find(".backstory-new-item");t.length||y[e].add(new d(T[e])),this.setupCollectionViews(e)},removeEmpties:function(e){var t=this,i=[];y[e].each(function(n){var o=!t.isHalfUpdated(e,n);o&&i.push(n)});var n=$(":focus").closest(".collection-item-container").data("cid");i.length&&i.length>1&&(i=_.map(i,function(t){return n===t.cid?t:void y[e].remove(t)})),i=_.compact(i),1===i.length&&i[0].cid!==n&&y[e].length>1&&y[e].last().cid!==i[0].cid&&(y[e].remove(i[0]),y[e].add(new d(T[e])),this.setupCollectionViews(e))},isHalfUpdated:function(e,t){var i=0,n=0;_.each(t.attributes,function(t,n){if(t){var o=T[e][n].slice(0,t.length);t!==o&&i++}}),_.each(T[e],function(){n++});var o=Math.round(n/2);return i>=o},removeItem:function(e){e=p.getEvent(e);var t=$(e.target),i=t.closest(".collection-item-container"),n=i.data("cid"),o=i.data("collection"),r=y[o].get(n);y[o].remove(r),this.setupCollectionViews(o)},_prevMapCenter:{},setupMap:function(){function e(e){MQA.withModule("nominatim",function(){MQA.Nominatim.search(i,null,null,function(i){x("map search data",i);var o=i[0];if(o){var r=parseFloat(o.lat),a=parseFloat(o.lon);if(t._prevMapCenter[0]!==r||t._prevMapCenter[1]!==a||e){t._prevMapCenter=[r,a],n.empty();var s=new MQA.LatLng(o.boundingbox[0],o.boundingbox[2]),l=new MQA.LatLng(o.boundingbox[1],o.boundingbox[3]),c=new MQA.RectLL(s,l),u=["continent","ocean","sea"],d=_.contains(u,o.type)?2:4,h=_.contains(u,o.type)?3:10,g={elt:n.get(0),zoomOnDoubleClick:!1,zoom:5,latLng:{lat:r,lng:a}},p=new MQA.TileMap(g),m=new MQA.Size($("#backstory_map").width(),$("#backstory_map").height());p.logos=[],p.setSize(m),p.setDraggable(!1),p.zoomToRect(c,!0,d,h)}}})})}var t=this,i=y.get("location"),n=$("#backstory_map");i===y.defaults.location&&(i="North Atlantic Ocean"),i&&n.length&&(e(),$(window).on("resize orientationchange",_.debounce(function(){e(!0)},500)))},old_setupMap:function(e){function t(){google&&google.maps&&google.maps.Geocoder&&(i=new google.maps.Geocoder,y.getInitialGeolocation&&google.loader.ClientLocation&&(x("ip sniff data",google.loader.ClientLocation),r=google.loader.ClientLocation.address.city+", ",r+=google.loader.ClientLocation.address.region,$(".resume-map-location").text(r),y.set("location",r),y.getInitialGeolocation=!1),i.geocode({address:r},function(e,t){if(t==google.maps.GeocoderStatus.OK){if(e[0].geometry.location.toString()==o._prevMapCenter.toString())return;var i=[{stylers:[{hue:"#"+o.mapColor},{gamma:.5},{lightness:-20},{saturation:-90}]},{featureType:"landscape",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{lightness:30}]},{featureType:"road.arterial",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{lightness:-10}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]}],r={scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,draggable:!1,disableDefaultUI:!0,zoom:12,center:e[0].geometry.location};a.empty(),a=a.get(0),n=new google.maps.Map(a,r);var s=new google.maps.StyledMapType(i,{name:"Styled Map"});n.mapTypes.set("map_style",s),n.setMapTypeId("map_style"),e[0].geometry.viewport&&n.fitBounds(e[0].geometry.viewport),z._prevMapCenter=e[0].geometry.location}else x("Geocode was not successful for the following reason: "+t)}))}var i,n,o=this,r=y.get("location"),a=$("#google_map");r&&a.length&&(e?(this._prevMapCenter={},google.load("maps","3",{other_params:"sensor=false",callback:t})):t(),$(window).on("resize orientationchange",_.debounce(function(){o.setupMap(!1)},200)))},setColors:function(e){function t(){var e=($(".mobile-background-container"),$(".mobile-bg-test-img"));e.length||(x("no image length"),e=$('<img class="mobile-bg-test-img" />'),$(".mobile-background-container").append(e)),e.get(0).crossOrigin="",e.on("error",function(){x("image didnt load"),o=s.getGoodColor(null,[100,100,100]),y.trigger("set:color:photo:done"),y.set("_color",o),x("basis color from img ERROR",y.get("_color")),i(o),n(),$.doTimeout("backstory-color-fallback")}),e.on("load readystatechange ready",function(){o=s.getGoodColor(s.getDominant(e)),y.trigger("set:color:photo:done"),y.set("_color",o),$(this).remove(),$("canvas").remove(),i(o),n()}),e.get(0).src=r.Settings.images.background_image.replace("http://d13pix9kaak6wt.cloudfront.net/background/","http://s3.amazonaws.com/aboutme-images-1/background/")+"?cache_busters="+(new Date).getTime()}function i(){a=s.getIdealColor(o,-.5),l=s.getComplimentary(a),c=s.getIdealColor(o,.3)}function n(){u.mapColor=o,$(".backstory-color-1").css({backgroundColor:"#"+o}),$("#below-backstory,.backstory-color-2").css({backgroundColor:"#"+a}),$(".below-backstory .resume-map-label").css({color:"#"+l}),$(".below-backstory .resume-current-position").css({color:"#"+l}),$(".backstory-color-3").css({backgroundColor:"#"+l}),$(".below-backstory header h2").css({color:"#"+c}),$(".backstory-color-4").css({backgroundColor:"#"+c}),y.colors={basis:o,one:a,two:l,three:c},y.trigger("set:color"),u.setupMap(!0)}var o,a,l,c,u=this;"random"===e?(o=s.getGoodColor(null,[100,100,100]),y.set("_color",o)):"photo"===e?(x("setting photo color"),o=C):o=y.get("_color")||C,o===C&&y.get("editmode")?(x("getting new basis color"),t()):(x("basis color",o),i(o),n())},setupEditTextFields:function(){var e=[".below-backstory header h1 .backstory-heading",".below-backstory .resume-current-position",".below-backstory .resume-current-org",".below-backstory .resume-current-time",".below-backstory .resume-current-descrip",".below-backstory .resume-map .resume-map-location"];$(e.join(",")).attr("contenteditable","true").addClass("resume-editable backstory-edit-text")},setupEditCollectionFields:function(){var e=[".below-backstory .backstory-work .resume-job-title",".below-backstory .backstory-work .resume-job-org",".below-backstory .backstory-work .resume-job-date",".below-backstory .backstory-work .resume-job-descrip",".below-backstory .backstory-skills li .resume-skill",".below-backstory .backstory-education .resume-ed-deg",".below-backstory .backstory-education .resume-ed-org",".below-backstory .backstory-education .resume-ed-date",".below-backstory .backstory-links .resume-link-edit-title",".below-backstory .backstory-links .resume-link-url"];$(e.join(",")).attr("contenteditable","true").addClass("resume-editable backstory-edit-collection")},setupEditMap:function(){var e=this;$(".resume-map .resume-map-location").on("keyup",_.debounce(function(){y.set("location",$(this).text()),e.setupMap(!1)},1500))}}),I=t.Controller.extend({initialize:function(e){this.previewing=e.previewing||!1,x("this.previewing",this.previewing),_.bindAll(this,"setupBackstory","errorBackstory"),$("body").addClass("has-resume"),y&&y.inited?this.setupBackstory():(y=new R,y.fetch({silent:!0,success:this.setupBackstory,error:this.errorBackstory}));var t=h.tabList.findWhere({name:"backstory"});t.on("change:backstory",function(e,t){t&&this.showSuccessBanner()},this)},errorBackstory:function(){a.trigger("below_backstory_empty",["backstory"])},setupBackstory:function(){y.inited=!0,y._lastSavedAs=_.clone(y.toJSON()),x("initial lastSavedAs",y._lastSavedAs),l&&!this.previewing?y.set("editmode",!0):y.set("editmode",!1);var e=_.filter(_.values(y.get("_visible")),function(e){return e});if(!l&&!e.length)return void a.trigger("below_backstory_empty",["backstory"]);if(y.get("editmode")){var t=E;t.push("heading"),_.each(t,function(e){0===y.get(e).trim().length&&y.set(e,y.defaults[e])})}else _.each(E,function(e){if("heading"!==e){var t=y.defaults[e].slice(0,y.get(e).length);y.get(e)===t&&y.set(e,"")}});if(y.get("editmode")&&y.defaults.location===y.get("location")&&(y.getInitialGeolocation=!0),_.each(S,function(e){var t=d.extend({defaults:y.get("editmode")?T[e]:{}}),i=Backbone.Collection.extend({model:t});if(y.get(e).length&&_.contains(A,e)){var n=_.map(y.get(e),function(t){var i,n=e.length;"s"===e.substring(n-1,n)&&(i=e.substring(0,n-1));var o={};return o[i]=t,o});y[e]=new i(n)}else y[e]=new i(y.get(e));y.get("editmode")&&y[e].each(function(t){_.each(t.attributes,function(i,n){i.trim().length||t.set(n,T[e][n])})}),y[e].on("change remove",function(t){y[e].each(function(t){_.each(t.attributes,function(i,n){if(i){var o=T[e][n].slice(0,i.length);i===o&&delete t.attributes[n]}}),0===t.attributes.length&&y[e].remove(t)}),y.set(e,y[e].toJSON()),y.childSave(t,e)},y[e]),y.get("editmode")&&y[e].add(new d(T[e]))}),y._visible=new d(y.get("_visible")),y._visible.on("change",function(e){y.childSave(e,"_visible")},y),w=new j({model:y}),_.each(S,function(e){w[e+"View"]=new N({collection:y[e],list:e})}),h.containers.backstory.containerContent.show(w),y.get("editmode")){var i=$.jStorage.get("backstory_tour_dismissed"),n=h.tabList.findWhere({name:"backstory"});if(!i&&!n.get("visible"))var o=new D;var r=new P;k=new L({model:r}),h.containers.backstory.containerPromo.show(o),h.containers.backstory.containerContentControl.show(k),a.trigger("below_backstory_ready")}else this.checkContentVisibility()},checkContentVisibility:function(){_.each(S,function(e){var t=w.$el.find(".backstory-parent-"+e);t.length&&(x(e,y[e].length,y[e]),t.toggleClass("invisible",!y[e].length))}),x("backstory after visibility check",_.clone(y));var e=w.$el.find(".backstory-parent.invisible");e.each(function(){var e=$(this).parent().closest(".backstory-parent");if(e.length){var t=$(this).siblings(".backstory-parent:not(.invisible)");t.length||e.remove()}}),e.remove();var t=w.$el.find(".backstory-parent");t.length?(w.$el.find(".backstory-no-content").remove(),a.trigger("below_backstory_ready")):l?w.$el.find(".backstory-no-content").removeClass("invisible"):a.trigger("below_backstory_empty",["backstory"])},showSuccessBanner:function(){var e={type:"add_backstory"},t="http://twitter.com/intent/tweet?text=",i="I just added my Backstory on @aboutdotme! Check it out: "+o.get("page_url");o.get("twitter_name")&&(i=i+" @"+o.get("twitter_name")),t+=encodeURIComponent(i),e.tweet_url=t,o.get("facebook_compliment_share")||(e.facebook_url="http://www.facebook.com/share.php?u="+encodeURIComponent(o.get("page_url")));var r=_.template(v,e),a=g.banner(r,{duration:7e3});n.log("display: update and share",{trigger:"backstory"}),a.find(".button.twitter").click(function(){n.log("share: update and share",{target:"twitter"})}),a.find(".button.facebook").click(function(){n.log("share: update and share",{target:"facebook"})})}}),O=t.ItemView.extend({className:"collection-item-container",tagName:"li",initialize:function(){var e=$(b).filter("#"+this.options.list+"-template").html(),t=$(b).filter("#"+this.options.list+"-edit-template").html();e=y.get("editmode")?t||e:e,this.template=_.template(e),"links"===this.options.list&&(this.model.on("change:url",this.updateLinkIcon,this),this.model.on("valid:change",this.updateValidLink,this),this.model.validateThis=!0,this.model.validate=this.validateLinkURL)},onShow:function(){switch(this.$el.data("cid",this.model.cid),this.$el.data("collection",this.options.list),this.options.list){case"links":this.updateLinkIcon(),this.model.validate({url:this.model.get("url")})}},validateLinkURL:function(e){var t=e.url||null;if(e.title&&this.set("title",e.title),t){t=t.replace(/http:\/\//,"").replace(/https:\/\//,"");var i=p.validURL(t);i&&(t="http://"+t);var n=T.links.url.slice(0,t.length);t===n&&(i=!0),this.set("url",t),this.trigger("valid:change",i)}},updateValidLink:function(e){if(y.get("editmode")){var t=this.$el.find(".resume-link-url");t.toggleClass("error",!e)}else e||y.links.remove(this.model)},updateLinkIcon:function(){var e=this.model.get("url")||"",t=this.model.icon||"globe",i="globe",n=this.$el.find(".resume-link-icon"),o=[{name:"behance",url:"behance.net"},{name:"bitbucket",url:"bitbucket.org"},{name:"dribbble",url:"dribbble.com"},{name:"etsy",url:"etsy.com"},{name:"facebook",url:"facebook.com"},{name:"github",url:"github.com"},{name:"instagram",url:"instagram.com"},{name:"linkedin",url:"linkedin.com"},{name:"medium",url:"medium.com"},{name:"pinterest",url:"pinterest.com"},{name:"px500",url:"500px.com"},{name:"tumblr-no-box",url:"tumblr.com"},{name:"twitter",url:"twitter.com"},{name:"vimeo",url:"vimeo.com"},{name:"wordpress",url:"wordpress.com"},{name:"youtube",url:"youtube.com"}];if(_.each(o,function(t){e.indexOf(t.url)>-1&&(i=t.name)}),t!==i||"globe"===i){var r=_.map(o,function(e){return"glyph-"+e.name});n.removeClass(r.join(" ")+" glyph-globe"),this.model.icon=i,n.addClass("glyph-"+this.model.icon)}}}),N=t.CollectionView.extend({tagName:"ul",childView:O,childViewOptions:function(){return{list:this.options.list}},initialize:function(){this.on("show",this.handleRemoveIcon),this.on("show",this.handleDragHandle),this.collection.on("add",this.handleRemoveIcon,this),this.collection.on("add",this.handleDragHandle,this)},handleDragHandle:function(){var e=this;if(y.get("editmode")){var t='<span class="glyph-menu resume-handle" title="Drag to sort">&nbsp;</span>';this.children.each(function(e){e.$el.find(".resume-handle").length||e.$el.append(t)});var i={cursor:"move",handle:".resume-handle",axis:"y",items:"> li:not(.backstory-new-item)",placeholder:"resume-sortable-placeholder",tolerance:"pointer",forceHelperSize:!0,forcePlaceholderSize:!0,start:function(){$(this).addClass("sorting"),$(this).sortable("refreshPositions"),y.dragging=!0},stop:function(){$(this).removeClass("sorting"),$(this).sortable("refreshPositions"),y.dragging=!1},update:function(t,i){var n=e.collection.get(i.item.data("cid"));e.collection.remove(n,{silent:!0}),e.collection.add(n,{at:i.item.index(),silent:!0}),e.collection.trigger("change")}};"links"===this.options.list&&(i.cursorAt={top:20,left:5}),this.$el.sortable(i)}},handleRemoveIcon:function(){if(y.get("editmode")){var e='<span class="glyph-close resume-remove" title="Remove this item">&nbsp;</span>';this.children.each(function(t){t.$el.find(".resume-remove").length||t.$el.append(e)})}}}),D=t.ItemView.extend({className:"backstory-onboarding",tagName:"section",template:_.template($(b).filter("#onboarding-template").html()),ui:{tour:".backstory-tour",cancel:".backstory-cancel"},events:{"click @ui.tour":"startTour","click @ui.cancel":"cancelSetup"},startTour:function(){m.cancel("backstory"),l&&!y.get("editmode")&&k.togglePreview();var e=_.map(new q,function(e){return e=$.extend(V(),e)});m.init(e),m.start("backstory"),$(".backstory-tip .close-button").on("click",function(){$.jStorage.set("backstory_tour_dismissed",!0,{TTL:6e5})})},cancelSetup:function(e){e.preventDefault(),$(window).scrollTop(0)}}),P=d.extend({defaults:{previewing:!1}}),L=t.ItemView.extend({tagName:"span",className:"backstory-content-controls",template:_.template($(b).filter("#controls-template").html()),ui:{toggle:".backstory-mode-toggle",random_color:".backstory-color-scheme",photo_color:".backstory-color-photo"},events:{"click @ui.toggle":"togglePreview","click @ui.random_color":"setRandomColor","click @ui.photo_color":"setPhotoColor"},initialize:function(){var e=this;this.model.on("change",this.render,this),this.listenTo(y,"goto:editmode",this.togglePreview),this.listenTo(y,"set:color:photo:done",this.restorePhotoColor),this.listenTo(y,"set:color",this.setButtonColors),a.on("background_image_changed",function(){y.get("editmode")&&(r.Settings.images.background_image.length&&"no-background"!==r.Settings.images.background_image?e.ui.photo_color.removeClass("invisible"):e.ui.photo_color.addClass("invisible"))})},onShow:function(){y.colors&&this.setButtonColors(),r.Settings.images.background_image.length&&"no-background"!==r.Settings.images.background_image||this.ui.photo_color.addClass("invisible"),this.setTinyTips()},setTinyTips:function(){this.previewTip={name:"backstorypreviewTip",attachTo:this.ui.toggle,content:this.model.get("previewing")?"Edit your Backstory":"Preview your Backstory",targetHover:!0,arrow:"top",style:{textAlign:"center",minWidth:100,marginTop:15}},this.ui.toggle.tinytip(this.previewTip),this.model.get("previewing")||(this.photoColorTip={name:"backstoryphotoColorTip",attachTo:this.ui.photo_color,content:"Coordinate Backstory colors to your photo",targetHover:!0,arrow:"top",style:{textAlign:"center",minWidth:100,marginTop:15}},this.ui.photo_color.tinytip(this.photoColorTip),this.randomColorTip={name:"backstoryrandomColorTip",attachTo:this.ui.random_color,content:"Try a new color scheme",targetHover:!0,arrow:"top",appendToBody:!0,style:{textAlign:"center",minWidth:100,marginTop:10,marginLeft:-5}},this.ui.random_color.tinytip(this.randomColorTip))},togglePreview:function(){x("toggling previewing to ",!this.model.get("previewing")),this.model.set("previewing",!this.model.get("previewing")),z=new I({previewing:this.model.get("previewing")}),this.setTinyTips()},setRandomColor:function(){y.trigger("set:color:random")},setPhotoColor:function(){this.ui.photo_color.addClass("loading"),y.trigger("set:color:photo")},restorePhotoColor:function(){this.ui.photo_color.removeClass("loading")},setButtonColors:function(){$(".backstory-color-1").css({backgroundColor:"#"+y.colors.basis}),$(".backstory-color-2").css({backgroundColor:"#"+y.colors.one}),$(".backstory-color-3").css({backgroundColor:"#"+y.colors.two}),$(".backstory-color-4").css({backgroundColor:"#"+y.colors.three})}}),z=new I,q=function(){return[{name:"sectionvisibility",attachTo:".backstory-edit-visibility:first + label",content:"<h4>Backstory Sections</h4><p>Each section on your Backstory has a toggle button that allows you to hide or unhide your content.</p>",focusAttachTo:!1,arrow:"topright",style:{marginTop:4,marginLeft:-110}},{name:"colors",attachTo:".backstory-edit-options",content:"<h4>Color Scheme</h4><p>Select the image button above to use a color scheme that compliments your background image. Alternatively, select the color palette above to try our other recommended color schemes.</p>",focusAttachTo:!1,arrow:"topleft",style:{marginTop:10,marginLeft:118}},{name:"heading",attachTo:".below-backstory header h1",content:"<h4>Heading</h4><p>Use an inspirational quote, your philosophy, or mission statement.</p>",arrow:c.isNot("large")?"top":"topleft",focusAttachTo:u.is("touch")?!1:".backstory-heading",style:{marginLeft:c.is("large")?-60:0}},{name:"work",attachTo:".resume-current-time",content:"<h4>Work</h4><p>Include work experience that is at least somewhat relevant to what youre looking for, or the industry youre currently working in.</p><p>Include your job title, company name, duration of work, and a brief description of responsibilities and achievements.</p>",arrow:c.isNot("large")?"top":"topleft",focusAttachTo:u.is("touch")?!1:".resume-current-position",style:{marginTop:40,marginLeft:c.is("large")?-150:0}},{name:"skills",attachTo:".resume-skill:first",content:'<h4>Skills + Expertise</h4><p>Actions speak louder than words, so make a list of things you can do. Be sure to include technical skills, languages spoken, or any certifications you may have. <span class="examples">(examples: JavaScript, Photography, CPA, Fluent in Spanish, Blogging)</span></p>',arrow:c.isNot("large")?"top":"topright",style:{marginLeft:c.is("large")?-250:0}},{name:"education",attachTo:".resume-ed-date:first",content:"<h4>Education</h4><p>Enter the name of your degree or field of study, the institution that awarded it, and the date you finished your studies.</p>",arrow:c.isNot("large")?"top":"topright",focusAttachTo:u.is("touch")?!1:".resume-ed-deg:first",style:{marginLeft:c.is("large")?-250:0}},{name:"location",attachTo:".resume-map-location",content:'<h4>Location</h4><p>Open to relocation or travel? List the location worldwide that you would prefer to work in. <span class="examples">(examples: New York City, China, South America)</span></p>',arrow:"topleft",style:{marginTop:c.is("small")?10:0,marginLeft:95}},{name:"linkurl",attachTo:".resume-link-url:first",content:"<h4>Professional Links</h4><p>Use this space for links to your work on other websites. If you have a portfolio or blog, this belongs here. Be sure to include the title and web address.</p>",arrow:c.is("small")?"bottom":"bottomleft",focusAttachTo:u.is("touch")?!1:".resume-link-edit-title:first",revealDirection:"down",style:{marginTop:-300,marginLeft:100}},{name:"preview",attachTo:".backstory-mode-toggle",content:"<h4>Preview</h4><p>Take a look at what your Backstory looks like to your visitors.</p>",arrow:"top",focusAttachTo:"false",style:{marginTop:10,marginLeft:-12}},{name:"backstorypublic",attachTo:"#below-backstory .publictoggle",content:"<h4>Publish Your Backstory</h4><p>When youre ready to add your Backstory to your public profile, just flip the switch!</p>",arrow:"topleft",style:{marginTop:10,marginLeft:150},focusAttachTo:!1,afterMore:function(){$(".backstory-heading").focus()},afterClose:function(){$(".backstory-heading").focus()}}]},V=function(){return{tours:["backstory"],appendToBody:!0,focusAttachTo:u.is("touch")?!1:!0,scrollTo:!0,bigSize:!0,arrow:"top",revealDirection:"up",closeText:"End Tour",customClass:"backstory-tip"}}});
//# sourceMappingURL=common.js.map